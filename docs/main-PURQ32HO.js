var OO=Object.create;var sx=Object.defineProperty,NO=Object.defineProperties,kO=Object.getOwnPropertyDescriptor,FO=Object.getOwnPropertyDescriptors,zO=Object.getOwnPropertyNames,c_=Object.getOwnPropertySymbols,BO=Object.getPrototypeOf,ax=Object.prototype.hasOwnProperty,UD=Object.prototype.propertyIsEnumerable;var VD=(l,s,m)=>s in l?sx(l,s,{enumerable:!0,configurable:!0,writable:!0,value:m}):l[s]=m,Pt=(l,s)=>{for(var m in s||={})ax.call(s,m)&&VD(l,m,s[m]);if(c_)for(var m of c_(s))UD.call(s,m)&&VD(l,m,s[m]);return l},Gr=(l,s)=>NO(l,FO(s));var lx=(l,s)=>{var m={};for(var p in l)ax.call(l,p)&&s.indexOf(p)<0&&(m[p]=l[p]);if(l!=null&&c_)for(var p of c_(l))s.indexOf(p)<0&&UD.call(l,p)&&(m[p]=l[p]);return m};var jO=(l,s)=>()=>(s||l((s={exports:{}}).exports,s),s.exports);var VO=(l,s,m,p)=>{if(s&&typeof s=="object"||typeof s=="function")for(let y of zO(s))!ax.call(l,y)&&y!==m&&sx(l,y,{get:()=>s[y],enumerable:!(p=kO(s,y))||p.enumerable});return l};var cx=(l,s,m)=>(m=l!=null?OO(BO(l)):{},VO(s||!l||!l.__esModule?sx(m,"default",{value:l,enumerable:!0}):m,l));var u_=(l,s,m)=>new Promise((p,y)=>{var i=j=>{try{O(m.next(j))}catch(Z){y(Z)}},C=j=>{try{O(m.throw(j))}catch(Z){y(Z)}},O=j=>j.done?p(j.value):Promise.resolve(j.value).then(i,C);O((m=m.apply(l,s)).next())});var d0=jO((Lw,Ow)=>{"use strict";(function(l,s){typeof Lw=="object"&&typeof Ow<"u"?Ow.exports=s():typeof define=="function"&&define.amd?define(s):(l=typeof globalThis<"u"?globalThis:l||self,l.mapboxgl=s())})(Lw,function(){"use strict";var l,s,m;function p(i,C){if(!l)l=C;else if(!s)s=C;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",j={};l(j),m=C(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}p(["exports"],function(i){"use strict";var C="3.3.0";let O,j={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(O==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{O=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{O=t}}return O},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!j.API_URL)return null;try{let t=new URL(j.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function Z(t){return j.API_URL_REGEX.test(t)}function se(t){return t.indexOf("mapbox:")===0}function ve(t){return j.API_CDN_URL_REGEX.test(t)}function ze(t){return j.API_SPRITE_REGEX.test(t)}function at(t){return j.API_STYLE_REGEX.test(t)&&!ze(t)}let Wt={create:"create",load:"load",fullLoad:"fullLoad"};function Pn(t){let e=t.name.split("?")[0];return ve(e)&&e.includes("mapbox-gl.js")?"javascript":ve(e)&&e.includes("mapbox-gl.css")?"css":function(n){return j.API_FONTS_REGEX.test(n)}(e)?"fontRange":ze(e)?"sprite":at(e)?"style":function(n){return j.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Zt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Qt=Tr;function Tr(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}Tr.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var u=this.sampleCurveDerivativeX(n);if(Math.abs(u)<1e-6)break;n-=c/u}var f=0,_=1;for(n=t,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));o++)t>c?f=n:_=n,n=.5*(_-f)+f;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var gr=Zt(Qt),qn=Br;function Br(t,e){this.x=t,this.y=e}Br.prototype={clone:function(){return new Br(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Br.convert=function(t){return t instanceof Br?t:Array.isArray(t)?new Br(t[0],t[1]):t};var Ge=Zt(qn);let ci=Math.PI/180,Uo=180/Math.PI;function an(t){return t*ci}function Hr(t){return t*Uo}let yu=[[0,0],[1,0],[1,1],[0,1]];function it(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ho(t,e,n,o){let c=new gr(t,e,n,o);return function(u){return c.solve(u)}}let _i=ho(.25,.1,.25,1);function Xt(t,e,n){return Math.min(n,Math.max(e,t))}function qa(t,e,n){return(n=Xt((n-t)/(e-t),0,1))*n*(3-2*n)}function xs(t,e,n){let o=n-e,c=((t-e)%o+o)%o+e;return c===e?n:c}function fo(t,e,n){if(!t.length)return n(null,[]);let o=t.length,c=new Array(t.length),u=null;t.forEach((f,_)=>{e(f,(x,b)=>{x&&(u=x),c[_]=b,--o==0&&n(u,c)})})}function ii(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}let oa=1;function Wa(){return oa++}function Jl(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Ql(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ec(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function sa(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function $o(t,e){return t.indexOf(e,t.length-e.length)!==-1}function oi(t,e,n){let o={};for(let c in t)o[c]=e.call(n||this,t[c],c,t);return o}function Ki(t,e,n){let o={};for(let c in t)e.call(n||this,t[c],c,t)&&(o[c]=t[c]);return o}function Bi(t){return Array.isArray(t)?t.map(Bi):typeof t=="object"&&t?oi(t,Bi):t}let vu={};function _r(t){vu[t]||(typeof console<"u"&&console.warn(t),vu[t]=!0)}function Ji(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function aa(t){let e=0;for(let n,o,c=0,u=t.length,f=u-1;c<u;f=c++)n=t[c],o=t[f],e+=(o.x-n.x)*(n.y+o.y);return e}function Go([t,e,n]){let o=an(e+90),c=an(n);return{x:t*Math.cos(o)*Math.sin(c),y:t*Math.sin(o)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Lo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function la(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,u)=>{let f=c||u;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ir,Za,Xa,Qi,Ho,bs,Oe=null;function Y(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function re(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function he(t,e,n,o){for(;e<n;){let c=e+n>>1;t[c]<o?e=c+1:n=c}return e}function Se(t,e,n,o){for(;e<n;){let c=e+n>>1;t[c]<=o?e=c+1:n=c}return e}function ke(){return Ir==null&&(Ir=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ir}let $e={now:()=>Qi!==void 0?Qi:performance.now(),setNow(t){Qi=t},restoreNow(){Qi=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:o}=t;Ho||(Ho=document.createElement("canvas"));let c=Ho.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>Ho.width||o>Ho.height)&&(Ho.width=n,Ho.height=o),c.clearRect(-e,-e,n+2*e,o+2*e),c.drawImage(t,0,0,n,o),c.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(Za||(Za=document.createElement("a")),Za.href=t,Za.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xa==null&&(Xa=window.matchMedia("(prefers-reduced-motion: reduce)")),Xa.matches)},hasCanvasFingerprintNoise(){if(bs!==void 0)return bs;if(!ke())return bs=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let o=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<o.data.length;++c)if(c%4!=3&&n++!==o.data[c])return bs=!0,!0;return bs=!1,!1}},pt="mapbox-tiles",Ae=500,gt=50,ct,yt;function Yt(){try{return caches}catch{}}function Fn(){let t=Yt();t&&!ct&&(ct=t.open(pt))}function Qn(t){let e=t.indexOf("?");if(e<0)return t;let n=["language","worldview"],o=new URLSearchParams,c=new URLSearchParams(t.slice(e));for(let u of n){let f=c.get(u);f&&o.set(u,f)}return`${t.slice(0,e)}?${o.toString()}`}function zn(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(n));for(let c in e)o.set(c,e[c]);return`${t.slice(0,n)}?${o.toString()}`}let Sn=1/0,In={supported:!1,testSupport:function(t){!jr&&Wn&&(Jn?ui(t):On=t)}},On,Wn,jr=!1,Jn=!1,yi=typeof self<"u"?self:{};function ui(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Wn),t.isContextLost())return;In.supported=!0}catch{}t.deleteTexture(e),jr=!0}yi.document&&(Wn=yi.document.createElement("img"),Wn.onload=function(){On&&ui(On),On=null,Jn=!0},Wn.onerror=function(){jr=!0,On=null},Wn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Mi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Mi);class Sr extends Error{constructor(e,n,o){n===401&&Z(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Dr=Lo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ce=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Dr())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,c){let u=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Dr(),referrerPolicy:o.referrerPolicy,signal:u.signal}),_=!1,x=!1,b=(T=f.url).indexOf("sku=")>0&&Z(T);var T;o.type==="json"&&f.headers.set("Accept","application/json");let I=(P,L,N)=>{if(x)return;if(P&&P.message!=="SecurityError"&&_r(P.toString()),L&&N)return M(L);let z=Date.now();fetch(f).then(V=>{if(V.ok){let W=b?V.clone():null;return M(V,W,z)}return c(new Sr(V.statusText,V.status,o.url))}).catch(V=>{V.name!=="AbortError"&&c(new Error(`${V.message} ${o.url}`))})},M=(P,L,N)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then(z=>{x||(L&&N&&function(V,W,J){if(Fn(),!ct)return;let K=la(W.headers.get("Cache-Control")||"");if(K["no-store"])return;let ie={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((de,me)=>ie.headers.set(me,de)),K["max-age"]&&ie.headers.set("Expires",new Date(J+1e3*K["max-age"]).toUTCString());let ne=ie.headers.get("Expires");if(!ne||new Date(ne).getTime()-J<42e4)return;let le=Qn(V.url);if(W.status===206){let de=V.headers.get("Range");if(!de)return;ie.status=200,le=zn(le,{range:de})}(function(de,me){if(yt===void 0)try{new Response(new ReadableStream),yt=!0}catch{yt=!1}yt?me(de.body):de.blob().then(me)})(W,de=>{let me=new Response(de,ie);Fn(),ct&&ct.then(be=>be.put(le,me)).catch(be=>_r(be.message))})}(f,L,N),_=!0,c(null,z,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(z=>{x||c(new Error(z.message))})};return b?function(P,L){if(Fn(),!ct)return L(null);ct.then(N=>{let z=Qn(P.url),V=P.headers.get("Range");V&&(z=zn(z,{range:V})),N.match(z).then(W=>{let J=function(K){if(!K)return!1;let ie=new Date(K.headers.get("Expires")||0),ne=la(K.headers.get("Cache-Control")||"");return ie>Date.now()&&!ne["no-cache"]}(W);N.delete(z),J&&N.put(z,W.clone()),L(null,W,J)}).catch(L)}).catch(L)}(f,I):I(null,null),{cancel:()=>{x=!0,_||u.abort()}}}(t,e);if(Lo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,c){let u=new XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let f in o.headers)u.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let f=u.response;if(o.type==="json")try{f=JSON.parse(u.response)}catch(_){return c(_)}c(null,f,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new Sr(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(t,e)},Pe=function(t,e){return Ce(ii(t,{type:"arrayBuffer"}),e)};function He(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ze,tt;Ze=[],tt=0;let nt=function(t,e){if(In.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),tt>=j.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ze.push(u),u}tt++;let n=!1,o=()=>{if(!n)for(n=!0,tt--;Ze.length&&tt<j.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Ze.shift(),{requestParameters:f,callback:_,cancelled:x}=u;x||(u.cancel=nt(f,_).cancel)}},c=Pe(t,(u,f,_,x)=>{o(),u?e(u):f&&(self.createImageBitmap?function(b,T){let I=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(I).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,T)=>e(b,T,_,x)):function(b,T){let I=new Image;I.onload=()=>{T(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Je})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let M=new Blob([new Uint8Array(b)],{type:"image/png"});I.src=b.byteLength?URL.createObjectURL(M):Je}(f,(b,T)=>e(b,T,_,x)))});return{cancel:()=>{c.cancel(),o()}}},Ye="01",ot="NO_ACCESS_TOKEN",Qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function At(t){let e=t.match(Qe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ln(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let bt="mapbox.eventData";function Un(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class nr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Un(j.ACCESS_TOKEN),o="";return o=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(+("0x"+u)))):j.ACCESS_TOKEN||"",e?`${bt}.${e}:${o}`:`${bt}:${o}`}fetchEventData(){let e=Y("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let u=localStorage.getItem(o);u&&(this.anonId=u)}catch{_r("Unable to read from LocalStorage")}}saveEventData(){let e=Y("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(o,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{_r("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,c){if(!j.EVENTS_URL)return;let u=At(j.EVENTS_URL);u.params.push(`access_token=${c||j.ACCESS_TOKEN||""}`);let f={event:this.type,created:new Date(e).toISOString()},_=n?ii(f,n):f,x={url:ln(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,T){return Ce(ii(b,{method:"POST"}),T)}(x,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let fr=new class extends nr{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){j.EVENTS_URL&&j.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>se(n)||Z(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Un(j.ACCESS_TOKEN),n=e?e.u:j.ACCESS_TOKEN,o=n!==this.eventData.tokenU;ec(this.anonId)||(this.anonId=Jl(),o=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),f=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;o=o||_>=1||_<-1||u.getDate()!==f.getDate()}else o=!0;o?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Ye,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},Ar=fr.postTurnstileEvent.bind(fr),Kr=new class extends nr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,j.EVENTS_URL&&(n||j.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ot)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ec(this.anonId)||(this.anonId=Jl()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Ye,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Tn=Kr.postMapLoadEvent.bind(Kr),ji=new class extends nr{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){j.EVENTS_URL&&(t||j.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),o=function(c){let u=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),_=function(P){let L={};if(P){for(let N in P)if(N!=="other")for(let z of P[N]){let V=`${N}ResolveRangeMin`,W=`${N}ResolveRangeMax`,J=`${N}RequestCount`,K=`${N}RequestCachedCount`;L[V]=Math.min(L[V]||1/0,z.startTime),L[W]=Math.max(L[W]||-1/0,z.responseEnd);let ie=ne=>{L[ne]===void 0&&(L[ne]=0),++L[ne]};z.transferSize!==void 0&&z.transferSize===0&&ie(K),ie(J)}}return L}(function(P,L){let N={};if(P)for(let z of P){let V=L(z);N[V]===void 0&&(N[V]=[]),N[V].push(z)}return N}(u,Pn)),x=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},M=(P,L,N)=>{N!=null&&P.push({name:L,value:N.toString()})};for(let P in _)M(I.counters,P,_[P]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(M(I.counters,"interactionRangeMin",c.interactionRange[0]),M(I.counters,"interactionRangeMax",c.interactionRange[1])),f)for(let P of Object.keys(Wt)){let L=Wt[P],N=f.find(z=>z.name===L);N&&M(I.counters,L,N.startTime)}return M(I.counters,"visibilityHidden",c.visibilityHidden),M(I.attributes,"style",function(P){if(P)for(let L of P){let N=L.name.split("?")[0];if(at(N)){let z=N.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(u)),M(I.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),M(I.attributes,"fogEnabled",c.fogEnabled?"true":"false"),M(I.attributes,"projection",c.projection),M(I.attributes,"zoom",c.zoom),M(I.metadata,"devicePixelRatio",x),M(I.metadata,"connectionEffectiveType",T),M(I.metadata,"navigatorUserAgent",navigator.userAgent),M(I.metadata,"screenWidth",window.screen.width),M(I.metadata,"screenHeight",window.screen.height),M(I.metadata,"windowWidth",window.innerWidth),M(I.metadata,"windowHeight",window.innerHeight),M(I.metadata,"mapWidth",c.width/x),M(I.metadata,"mapHeight",c.height/x),M(I.metadata,"webglRenderer",c.renderer),M(I.metadata,"webglVendor",c.vendor),M(I.metadata,"sdkVersion",C),M(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let c of o.metadata);for(let c of o.counters);for(let c of o.attributes);this.postEvent(e,o,()=>{},t)}},po=ji.postPerformanceEvent.bind(ji),Jr=new class extends nr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!j.API_URL||!j.SESSION_PATH)return;let c=At(j.API_URL+j.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${o||j.ACCESS_TOKEN||""}`);let u={url:ln(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,_){return Ce(ii(f,{method:"GET"}),_)}(u,f=>{this.pendingRequest=null,n(f),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,j.SESSION_PATH&&j.API_URL&&(n||j.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ot)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},tc=Jr.getSessionAPI.bind(Jr),ws=new Set;function Ya(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function fd(t,e,n){if(n&&n[t]){let o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class ca{constructor(e,n={}){ii(this,n),this.type=e}}class pd extends ca{constructor(e,n={}){super("error",ii({error:e},n))}}class Ka{on(e,n){return this._listeners=this._listeners||{},Ya(e,n,this._listeners),this}off(e,n){return fd(e,n,this._listeners),fd(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ya(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new ca(e,n||{}));let o=e.type;if(this.listens(o)){e.target=this;let c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let _ of c)_.call(this,e);let u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let _ of u)fd(o,_,this._oneTimeListeners),_.call(this,e);let f=this._eventedParent;f&&(ii(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof pd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}i.y=void 0;var _m={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xu(t){return(t=Math.round(t))<0?0:t>255?255:t}function md(t){return xu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function bu(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function gd(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{i.y={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in _m)return _m[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),c=n.indexOf(")");if(o!==-1&&c+1===n.length){var u=n.substr(0,o),f=n.substr(o+1,c-(o+1)).split(","),_=1;switch(u){case"rgba":if(f.length!==4)return null;_=bu(f.pop());case"rgb":return f.length!==3?null:[md(f[0]),md(f[1]),md(f[2]),_];case"hsla":if(f.length!==4)return null;_=bu(f.pop());case"hsl":if(f.length!==3)return null;var x=(parseFloat(f[0])%360+360)%360/360,b=bu(f[1]),T=bu(f[2]),I=T<=.5?T*(b+1):T+b-T*b,M=2*T-I;return[xu(255*gd(M,I,x+1/3)),xu(255*gd(M,I,x)),xu(255*gd(M,I,x-1/3)),_];default:return null}}return null}}catch{}class Ci{constructor(e,n,o,c=1){this.r=e,this.g=n,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof Ci)return e;if(typeof e!="string")return;let n=i.y(e);return n?new Ci(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${c})`}toArray(){let{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*o/c,c]}toArray01(){let{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,o/c,c]}toArray01Scaled(e){let{r:n,g:o,b:c,a:u}=this;return u===0?[0,0,0]:[n/u*e,o/u*e,c/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:o,a:c}=this;return[e,n,o,c]}toArray01Linear(){let{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(o/c,2.2),c]}}Ci.black=new Ci(0,0,0,1),Ci.white=new Ci(1,1,1,1),Ci.transparent=new Ci(0,0,0,0),Ci.red=new Ci(1,0,0,1),Ci.blue=new Ci(0,0,1,1);var Mr=Ci;function cn(t,e,n){return t*(1-n)+e*n}function ym(t,e,n){return t.map((o,c)=>cn(o,e[c],n))}var wu=Object.freeze({__proto__:null,array:ym,color:function(t,e,n){return new Mr(cn(t.r,e.r,n),cn(t.g,e.g,n),cn(t.b,e.b,n),cn(t.a,e.a,n))},number:cn});function _d(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}class p0 extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Oo=p0;class yd{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[o,c]of n)this.bindings[o]=c}concat(e){return new yd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var m0=yd;let Ja={kind:"null"},lt={kind:"number"},Dn={kind:"string"},Mn={kind:"boolean"},eo={kind:"color"},Qa={kind:"object"},mn={kind:"value"},Tu={kind:"collator"},el={kind:"formatted"},nc={kind:"resolvedImage"};function Si(t,e){return{kind:"array",itemType:t,N:e}}function Er(t){if(t.kind==="array"){let e=Er(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let Dt=[Ja,lt,Dn,Mn,eo,el,Qa,Si(mn),nc];function ua(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ua(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of Dt)if(!ua(n,e))return null}}return`Expected ${Er(t)} but found ${Er(e)} instead.`}function Lt(t,e){return e.some(n=>n.kind===t.kind)}function Ts(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Kt{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tl{constructor(e,n,o,c,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=u}}class Qr{constructor(e){this.sections=e}static fromString(e){return new Qr([new tl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Qr?e:Qr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class Mt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Mt({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function vm(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ha(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Mr||t instanceof Kt||t instanceof Qr||t instanceof Mt)return!0;if(Array.isArray(t)){for(let e of t)if(!ha(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!ha(t[e]))return!1;return!0}return!1}function Pr(t){if(t===null)return Ja;if(typeof t=="string")return Dn;if(typeof t=="boolean")return Mn;if(typeof t=="number")return lt;if(t instanceof Mr)return eo;if(t instanceof Kt)return Tu;if(t instanceof Qr)return el;if(t instanceof Mt)return nc;if(Array.isArray(t)){let e=t.length,n;for(let o of t){let c=Pr(o);if(n){if(n===c)continue;n=mn;break}n=c}return Si(n||mn,e)}return Qa}function to(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Mr||t instanceof Qr||t instanceof Mt?t.toString():JSON.stringify(t)}class Es{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ha(e[1]))return n.error("invalid value");let o=e[1],c=Pr(o),u=n.expectedType;return c.kind!=="array"||c.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(c=u),new Es(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mr?["rgba"].concat(this.value.toArray()):this.value instanceof Qr?this.value.serialize():this.value}}var qo=Es,Rr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let vd={string:Dn,number:lt,boolean:Mn,object:Qa};class xd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1,u=e[0];if(u==="array"){let _,x;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in vd)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=vd[b],c++}else _=mn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}o=Si(_,x)}else o=vd[u];let f=[];for(;c<e.length;c++){let _=n.parse(e[c],c,mn);if(!_)return null;f.push(_)}return new xd(o,f)}evaluate(e){for(let n=0;n<this.args.length;n++){let o=this.args[n].evaluate(e);if(!ua(this.type,Pr(o)))return o;if(n===this.args.length-1)throw new Rr(`Expected value to be of type ${Er(this.type)}, but found ${Er(Pr(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(o=>o.serialize()))}}var Wo=xd;class nl{constructor(e){this.type=el,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");let c=[],u=!1;for(let f=1;f<=e.length-1;++f){let _=e[f];if(u&&typeof _=="object"&&!Array.isArray(_)){u=!1;let x=null;if(_["font-scale"]&&(x=n.parse(_["font-scale"],1,lt),!x))return null;let b=null;if(_["text-font"]&&(b=n.parse(_["text-font"],1,Si(Dn)),!b))return null;let T=null;if(_["text-color"]&&(T=n.parse(_["text-color"],1,eo),!T))return null;let I=c[c.length-1];I.scale=x,I.font=b,I.textColor=T}else{let x=n.parse(e[f],1,mn);if(!x)return null;let b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new nl(c)}evaluate(e){return new Qr(this.sections.map(n=>{let o=n.content.evaluate(e);return Pr(o)===nc?new tl("",o,null,null,null):new tl(to(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class da{constructor(e,n){this.type=nc,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let o=n.parse(e[1],1,Dn);if(!o)return n.error("No image name provided.");if(e.length===2)return new da(o);let c=n.parse(e[2],1,Dn);return c?new da(o,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=Mt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function rl(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let mo={"to-boolean":Mn,"to-color":eo,"to-number":lt,"to-string":Dn};class Eu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[0],c=[],u=Ja;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let f=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=Si(n.expectedType.itemType,f)}else{if(!(f>0&&ha(e[1][0])))return null;u=Si(Pr(e[1][0]),f)}for(let _=0;_<f;_++){let x=e[1][_],b;if(rl(x)==="array")b=n.parse(x,void 0,u.itemType);else{let T=rl(x);if(T!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${T}.`);b=n.registry.literal.parse(["literal",x===void 0?null:x],n)}if(!b)return null;c.push(b)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=mo[o];for(let f=1;f<e.length;f++){let _=n.parse(e[f],f,mn);if(!_)return null;c.push(_)}}return new Eu(u,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,o;for(let c of this.args){if(n=c.evaluate(e),o=null,n instanceof Mr)return n;if(typeof n=="string"){let u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:vm(n[0],n[1],n[2],n[3]),!o))return new Mr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Rr(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let o of this.args){if(n=o.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new Rr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Qr.fromString(to(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Mt.fromString(to(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):to(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new nl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new da(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Zo=Eu;let rc=["Unknown","Point","LineString","Polygon"];var xm=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(o*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Mr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class fa{constructor(e,n,o,c,u){this.name=e,this.type=n,this._evaluate=o,this.args=c,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let n=fa.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let o=e[0],c=fa.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[],x=null,b=-1;for(let[T,I]of f){if(Array.isArray(T)&&T.length!==e.length-1)continue;_.push(T),b++,x=new Mm(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let M=[],P=!1;for(let L=1;L<e.length;L++){let N=e[L],z=Array.isArray(T)?T[L-1]:T.type,V=x.parse(N,1+M.length,z);if(!V){P=!0;break}M.push(V)}if(!P)if(Array.isArray(T)&&T.length!==M.length)x.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let L=0;L<M.length;L++){let N=Array.isArray(T)?T[L]:T.type,z=M[L];x.concat(L+1).checkSubtype(N,z.type)}if(x.errors.length===0)return new fa(o,u,I,M,b)}}if(_.length===1)n.errors.push(...x.errors);else{let T=(_.length?_:f.map(([M])=>M)).map(bm).join(" | "),I=[];for(let M=1;M<e.length;M++){let P=n.parse(e[M],1+I.length);if(!P)return null;I.push(Er(P.type))}n.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){fa.definitions=n;for(let o in n)e[o]=fa}}function bm(t){return Array.isArray(t)?`(${t.map(Er).join(", ")})`:`(${Er(t.type)}...)`}var hn=fa;class ic{constructor(e,n,o){this.type=Tu,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");let c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Mn);if(!c)return null;let u=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Mn);if(!u)return null;let f=null;return o.locale&&(f=n.parse(o.locale,1,Dn),!f)?null:new ic(c,u,f)}evaluate(e){return new Kt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var bd={exports:{}};bd.exports=function(){function t(o,c,u,f,_){for(;f>u;){if(f-u>600){var x=f-u+1,b=c-u+1,T=Math.log(x),I=.5*Math.exp(2*T/3),M=.5*Math.sqrt(T*I*(x-I)/x)*(b-x/2<0?-1:1);t(o,c,Math.max(u,Math.floor(c-b*I/x+M)),Math.min(f,Math.floor(c+(x-b)*I/x+M)),_)}var P=o[c],L=u,N=f;for(e(o,u,c),_(o[f],P)>0&&e(o,u,f);L<N;){for(e(o,L,N),L++,N--;_(o[L],P)<0;)L++;for(;_(o[N],P)>0;)N--}_(o[u],P)===0?e(o,u,N):e(o,++N,f),N<=c&&(u=N+1),c<=N&&(f=N-1)}}function e(o,c,u){var f=o[c];o[c]=o[u],o[u]=f}function n(o,c){return o<c?-1:o>c?1:0}return function(o,c,u,f,_){t(o,c,u||0,f||o.length-1,_||n)}}();var g0=Zt(bd.exports);function _0(t){let e=0;for(let n,o,c=0,u=t.length,f=u-1;c<u;f=c++)n=t[c],o=t[f],e+=(o.x-n.x)*(n.y+o.y);return e}function Is(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ds(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Iu(t,e,n){let o=t[0]-e[0],c=t[1]-e[1],u=t[0]-n[0],f=t[1]-n[1];return o*f-u*c==0&&o*u<=0&&c*f<=0}function il(t,e,n=!1){let o=!1;for(let _=0,x=e.length;_<x;_++){let b=e[_];for(let T=0,I=b.length,M=I-1;T<I;M=T++){let P=b[M],L=b[T];if(Iu(t,P,L))return n;(u=P)[1]>(c=t)[1]!=(f=L)[1]>c[1]&&c[0]<(f[0]-u[0])*(c[1]-u[1])/(f[1]-u[1])+u[0]&&(o=!o)}}var c,u,f;return o}function wd(t,e,n,o){let c=o[0]-n[0],u=o[1]-n[1],f=(t[0]-n[0])*u-c*(t[1]-n[1]),_=(e[0]-n[0])*u-c*(e[1]-n[1]);return f>0&&_<0||f<0&&_>0}function Xo(t,e,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*u[0]!=0&&!(!wd(t,e,n,o)||!wd(n,o,t,e));var c,u}let Ms=8192;function oc(t,e){let n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Ms),Math.round(o*c*Ms)]}function Td(t,e){for(let n=0;n<e.length;n++)if(il(t,e[n]))return!0;return!1}function Ed(t,e,n){for(let o of n)for(let c=0,u=o.length,f=u-1;c<u;f=c++)if(Xo(t,e,o[f],o[c]))return!0;return!1}function no(t,e){for(let n=0;n<t.length;++n)if(!il(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Ed(t[n],t[n+1],e))return!1;return!0}function wm(t,e){for(let n=0;n<e.length;n++)if(no(t,e[n]))return!0;return!1}function Id(t,e,n){let o=[];for(let c=0;c<t.length;c++){let u=[];for(let f=0;f<t[c].length;f++){let _=oc(t[c][f],n);Is(e,_),u.push(_)}o.push(u)}return o}function Dd(t,e,n){let o=[];for(let c=0;c<t.length;c++){let u=Id(t[c],e,n);o.push(u)}return o}function Md(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){let c=.5*o,u=t[0]-n[0]>c?-o:n[0]-t[0]>c?o:0;u===0&&(u=t[0]-n[2]>c?-o:n[2]-t[0]>c?o:0),t[0]+=u}Is(e,t)}function Cd(t,e,n,o){let c=Math.pow(2,o.z)*Ms,u=[o.x*Ms,o.y*Ms],f=[];if(!t)return f;for(let _ of t)for(let x of _){let b=[x.x+u[0],x.y+u[1]];Md(b,e,n,c),f.push(b)}return f}function Sd(t,e,n,o){let c=Math.pow(2,o.z)*Ms,u=[o.x*Ms,o.y*Ms],f=[];if(!t)return f;for(let x of t){let b=[];for(let T of x){let I=[T.x+u[0],T.y+u[1]];Is(e,I),b.push(I)}f.push(b)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let x of f)for(let b of x)Md(b,e,n,c)}var _;return f}class ol{constructor(e,n){this.type=Mn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ha(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){let u=o.features[c].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ol(o,o.features[c].geometry)}else if(o.type==="Feature"){let c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ol(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ol(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(o.type==="Polygon"){let _=Id(o.coordinates,u,f),x=Cd(n.geometry(),c,u,f);if(!Ds(c,u))return!1;for(let b of x)if(!il(b,_))return!1}if(o.type==="MultiPolygon"){let _=Dd(o.coordinates,u,f),x=Cd(n.geometry(),c,u,f);if(!Ds(c,u))return!1;for(let b of x)if(!Td(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){let c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(o.type==="Polygon"){let _=Id(o.coordinates,u,f),x=Sd(n.geometry(),c,u,f);if(!Ds(c,u))return!1;for(let b of x)if(!no(b,_))return!1}if(o.type==="MultiPolygon"){let _=Dd(o.coordinates,u,f),x=Sd(n.geometry(),c,u,f);if(!Ds(c,u))return!1;for(let b of x)if(!wm(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Du=ol,sc={exports:{}};sc.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),o=Math.PI/180,c=function(b,T){if(b===void 0)throw new Error("No latitude given.");if(T&&!t[T])throw new Error("Unknown unit "+T+". Use one of: "+Object.keys(t).join(", "));var I=6378.137*o*(T?t[T]:1),M=Math.cos(b*o),P=1/(1-n*(1-M*M)),L=Math.sqrt(P);this.kx=I*L*M,this.ky=I*L*P*(1-n)},u={units:{configurable:!0}};function f(b,T){return b[0]===T[0]&&b[1]===T[1]}function _(b,T,I){var M=x(T[0]-b[0]);return[b[0]+M*I,b[1]+(T[1]-b[1])*I]}function x(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}return c.fromTile=function(b,T,I){var M=Math.PI*(1-2*(b+.5)/Math.pow(2,T)),P=Math.atan(.5*(Math.exp(M)-Math.exp(-M)))/o;return new c(P,I)},u.units.get=function(){return t},c.prototype.distance=function(b,T){var I=x(b[0]-T[0])*this.kx,M=(b[1]-T[1])*this.ky;return Math.sqrt(I*I+M*M)},c.prototype.bearing=function(b,T){var I=x(T[0]-b[0])*this.kx;return Math.atan2(I,(T[1]-b[1])*this.ky)/o},c.prototype.destination=function(b,T,I){var M=I*o;return this.offset(b,Math.sin(M)*T,Math.cos(M)*T)},c.prototype.offset=function(b,T,I){return[b[0]+T/this.kx,b[1]+I/this.ky]},c.prototype.lineDistance=function(b){for(var T=0,I=0;I<b.length-1;I++)T+=this.distance(b[I],b[I+1]);return T},c.prototype.area=function(b){for(var T=0,I=0;I<b.length;I++)for(var M=b[I],P=0,L=M.length,N=L-1;P<L;N=P++)T+=x(M[P][0]-M[N][0])*(M[P][1]+M[N][1])*(I?-1:1);return Math.abs(T)/2*this.kx*this.ky},c.prototype.along=function(b,T){var I=0;if(T<=0)return b[0];for(var M=0;M<b.length-1;M++){var P=b[M],L=b[M+1],N=this.distance(P,L);if((I+=N)>T)return _(P,L,(T-(I-N))/N)}return b[b.length-1]},c.prototype.pointToSegmentDistance=function(b,T,I){var M=T[0],P=T[1],L=x(I[0]-M)*this.kx,N=(I[1]-P)*this.ky,z=0;return L===0&&N===0||((z=(x(b[0]-M)*this.kx*L+(b[1]-P)*this.ky*N)/(L*L+N*N))>1?(M=I[0],P=I[1]):z>0&&(M+=L/this.kx*z,P+=N/this.ky*z)),L=x(b[0]-M)*this.kx,N=(b[1]-P)*this.ky,Math.sqrt(L*L+N*N)},c.prototype.pointOnLine=function(b,T){for(var I,M,P,L,N=1/0,z=0;z<b.length-1;z++){var V=b[z][0],W=b[z][1],J=x(b[z+1][0]-V)*this.kx,K=(b[z+1][1]-W)*this.ky,ie=0;J===0&&K===0||((ie=(x(T[0]-V)*this.kx*J+(T[1]-W)*this.ky*K)/(J*J+K*K))>1?(V=b[z+1][0],W=b[z+1][1]):ie>0&&(V+=J/this.kx*ie,W+=K/this.ky*ie));var ne=(J=x(T[0]-V)*this.kx)*J+(K=(T[1]-W)*this.ky)*K;ne<N&&(N=ne,I=V,M=W,P=z,L=ie)}return{point:[I,M],index:P,t:Math.max(0,Math.min(1,L))}},c.prototype.lineSlice=function(b,T,I){var M=this.pointOnLine(I,b),P=this.pointOnLine(I,T);if(M.index>P.index||M.index===P.index&&M.t>P.t){var L=M;M=P,P=L}var N=[M.point],z=M.index+1,V=P.index;!f(I[z],N[0])&&z<=V&&N.push(I[z]);for(var W=z+1;W<=V;W++)N.push(I[W]);return f(I[V],P.point)||N.push(P.point),N},c.prototype.lineSliceAlong=function(b,T,I){for(var M=0,P=[],L=0;L<I.length-1;L++){var N=I[L],z=I[L+1],V=this.distance(N,z);if((M+=V)>b&&P.length===0&&P.push(_(N,z,(b-(M-V))/V)),M>=T)return P.push(_(N,z,(T-(M-V))/V)),P;M>b&&P.push(z)}return P},c.prototype.bufferPoint=function(b,T){var I=T/this.ky,M=T/this.kx;return[b[0]-M,b[1]-I,b[0]+M,b[1]+I]},c.prototype.bufferBBox=function(b,T){var I=T/this.ky,M=T/this.kx;return[b[0]-M,b[1]-I,b[2]+M,b[3]+I]},c.prototype.insideBBox=function(b,T){return x(b[0]-T[0])>=0&&x(b[0]-T[2])<=0&&b[1]>=T[1]&&b[1]<=T[3]},Object.defineProperties(c,u),c}();var Cs=Zt(sc.exports),Ad={exports:{}};Ad.exports=function(){var t=function(n,o){if(n===void 0&&(n=[]),o===void 0&&(o=e),this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function e(n,o){return n<o?-1:n>o?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var o=this.data,c=this.compare,u=o[n];n>0;){var f=n-1>>1,_=o[f];if(c(u,_)>=0)break;o[n]=_,n=f}o[n]=u},t.prototype._down=function(n){for(var o=this.data,c=this.compare,u=this.length>>1,f=o[n];n<u;){var _=1+(n<<1),x=o[_],b=_+1;if(b<this.length&&c(o[b],x)<0&&(_=b,x=o[b]),c(x,f)>=0)break;o[n]=x,n=_}o[n]=f},t}();var ro=Zt(Ad.exports),rt=8192;function Mu(t,e){return e.dist-t.dist}let Pd=100,ac=50;function Rd(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ss(t){return t[1]-t[0]+1}function go(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Ld(t,e){if(t[0]>t[1])return[null,null];let n=Ss(t);if(e){if(n===2)return[t,null];let o=Math.floor(n/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(n===1)return[t,null];let o=Math.floor(n/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function pa(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!go(e,t.length))return n;for(let o=e[0];o<=e[1];++o)Is(n,t[o]);return n}function Cu(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let o=0;o<t[n].length;++o)Is(e,t[n][o]);return e}function ma(t,e,n){if(Rd(t)||Rd(e))return NaN;let o=0,c=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[o,c])}function Od(t){return 360*t-180}function y0(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function sl(t,e){let n=Math.pow(2,e.z),o=(t.y/rt+e.y)/n;return[Od((t.x/rt+e.x)/n),y0(o)]}function v0(t,e){let n=[];for(let o=0;o<t.length;++o)n.push(sl(t[o],e));return n}function Tm(t,e,n){let o=n.pointOnLine(e,t).point;return n.distance(t,o)}function Em(t,e,n,o,c){let u=n.slice(o[0],o[1]+1),f=1/0;for(let _=e[0];_<=e[1];++_)if((f=Math.min(f,Tm(t[_],u,c)))===0)return 0;return f}function Nd(t,e,n,o,c){let u=Math.min(c.pointToSegmentDistance(t,n,o),c.pointToSegmentDistance(e,n,o)),f=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(o,t,e));return Math.min(u,f)}function x0(t,e,n,o,c){if(!go(e,t.length)||!go(o,n.length))return NaN;let u=1/0;for(let f=e[0];f<e[1];++f)for(let _=o[0];_<o[1];++_){if(Xo(t[f],t[f+1],n[_],n[_+1]))return 0;u=Math.min(u,Nd(t[f],t[f+1],n[_],n[_+1],c))}return u}function b0(t,e,n,o,c){if(!go(e,t.length)||!go(o,n.length))return NaN;let u=1/0;for(let f=e[0];f<=e[1];++f)for(let _=o[0];_<=o[1];++_)if((u=Math.min(u,c.distance(t[f],n[_])))===0)return u;return u}function w0(t,e,n){if(il(t,e,!0))return 0;let o=1/0;for(let c of e){let u=c.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[u-1]&&(o=Math.min(o,n.pointToSegmentDistance(t,c[u-1],c[0])))===0||(o=Math.min(o,Tm(t,c,n)))===0)return o}return o}function Im(t,e,n,o){if(!go(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(il(t[u],n,!0))return 0;let c=1/0;for(let u=e[0];u<e[1];++u)for(let f of n)for(let _=0,x=f.length,b=x-1;_<x;b=_++){if(Xo(t[u],t[u+1],f[b],f[_]))return 0;c=Math.min(c,Nd(t[u],t[u+1],f[b],f[_],o))}return c}function lc(t,e){for(let n of t)for(let o=0;o<=n.length-1;++o)if(il(n[o],e,!0))return!0;return!1}function T0(t,e,n,o=1/0){let c=Cu(t),u=Cu(e);if(o!==1/0&&ma(c,u,n)>=o)return o;if(Ds(c,u)){if(lc(t,e))return 0}else if(lc(e,t))return 0;let f=o;for(let _ of t)for(let x=0,b=_.length,T=b-1;x<b;T=x++)for(let I of e)for(let M=0,P=I.length,L=P-1;M<P;L=M++){if(Xo(_[T],_[x],I[L],I[M]))return 0;f=Math.min(f,Nd(_[T],_[x],I[L],I[M],n))}return f}function Su(t,e,n,o,c,u,f){if(u===null||f===null)return;let _=ma(pa(o,u),pa(c,f),n);_<e&&t.push({dist:_,range1:u,range2:f})}function kd(t,e,n,o,c=1/0){let u=Math.min(o.distance(t[0],n[0][0]),c);if(u===0)return u;let f=new ro([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Mu),_=e?ac:Pd,x=Cu(n);for(;f.length;){let b=f.pop();if(b.dist>=u)continue;let T=b.range1;if(Ss(T)<=_){if(!go(T,t.length))return NaN;if(e){let I=Im(t,T,n,o);if((u=Math.min(u,I))===0)return u}else for(let I=T[0];I<=T[1];++I){let M=w0(t[I],n,o);if((u=Math.min(u,M))===0)return u}}else{let I=Ld(T,e);if(I[0]!==null){let M=ma(pa(t,I[0]),x,o);M<u&&f.push({dist:M,range1:I[0],range2:[0,0]})}if(I[1]!==null){let M=ma(pa(t,I[1]),x,o);M<u&&f.push({dist:M,range1:I[1],range2:[0,0]})}}}return u}function Dm(t,e,n,o,c,u=1/0){let f=Math.min(u,c.distance(t[0],n[0]));if(f===0)return f;let _=new ro([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Mu),x=e?ac:Pd,b=o?ac:Pd;for(;_.length;){let T=_.pop();if(T.dist>=f)continue;let I=T.range1,M=T.range2;if(Ss(I)<=x&&Ss(M)<=b){if(!go(I,t.length)||!go(M,n.length))return NaN;if(e&&o?f=Math.min(f,x0(t,I,n,M,c)):e||o?e&&!o?f=Math.min(f,Em(n,M,t,I,c)):!e&&o&&(f=Math.min(f,Em(t,I,n,M,c))):f=Math.min(f,b0(t,I,n,M,c)),f===0)return f}else{let P=Ld(I,e),L=Ld(M,o);Su(_,f,c,t,n,P[0],L[0]),Su(_,f,c,t,n,P[0],L[1]),Su(_,f,c,t,n,P[1],L[0]),Su(_,f,c,t,n,P[1],L[1])}}return f}function Fd(t,e,n,o,c=1/0){let u=c,f=pa(t,[0,t.length-1]);for(let _ of n)if(!(u!==1/0&&ma(f,pa(_,[0,_.length-1]),o)>=u)&&(u=Math.min(u,Dm(t,e,_,!0,o,u)),u===0))return u;return u}function Au(t,e,n,o,c=1/0){let u=c,f=pa(t,[0,t.length-1]);for(let _ of n){if(u!==1/0&&ma(f,Cu(_),o)>=u)continue;let x=kd(t,e,_,o,u);if(isNaN(x))return x;if((u=Math.min(u,x))===0)return u}return u}function zd(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class ga{constructor(e,n){this.type=lt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ha(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let c=0;c<o.features.length;++c)if(zd(o.features[c].geometry.type))return new ga(o,o.features[c].geometry)}else if(o.type==="Feature"){if(zd(o.geometry.type))return new ga(o,o.geometry)}else if(zd(o.type))return new ga(o,o)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),o=e.canonicalID();if(n!=null&&o!=null){if(e.geometryType()==="Point")return function(c,u,f){let _=[];for(let b of c)for(let T of b)_.push(sl(T,u));let x=new Cs(_[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Dm(_,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x):f.type==="MultiLineString"?Fd(_,!1,f.coordinates,x):f.type==="Polygon"||f.type==="MultiPolygon"?Au(_,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,x):null}(n,o,this.geometries);if(e.geometryType()==="LineString")return function(c,u,f){let _=[];for(let b of c){let T=[];for(let I of b)T.push(sl(I,u));_.push(T)}let x=new Cs(_[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Fd(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,x);if(f.type==="MultiLineString"){let b=1/0;for(let T=0;T<f.coordinates.length;T++){let I=Fd(f.coordinates[T],!0,_,x,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}if(f.type==="Polygon"||f.type==="MultiPolygon"){let b=1/0;for(let T=0;T<_.length;T++){let I=Au(_[T],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,x,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return null}(n,o,this.geometries);if(e.geometryType()==="Polygon")return function(c,u,f){let _=[];for(let b of function(T,I){let M=T.length;if(M<=1)return[T];let P=[],L,N;for(let z=0;z<M;z++){let V=_0(T[z]);V!==0&&(T[z].area=Math.abs(V),N===void 0&&(N=V<0),N===V<0?(L&&P.push(L),L=[T[z]]):L.push(T[z]))}return L&&P.push(L),P}(c)){let T=[];for(let I=0;I<b.length;++I)T.push(v0(b[I],u));_.push(T)}let x=new Cs(_[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Au(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,x);if(f.type==="MultiLineString"){let b=1/0;for(let T=0;T<f.coordinates.length;T++){let I=Au(f.coordinates[T],!0,_,x,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return f.type==="Polygon"||f.type==="MultiPolygon"?function(b,T,I){let M=1/0;for(let P of b)for(let L of T){let N=T0(P,L,I,M);if(isNaN(N))return N;if((M=Math.min(M,N))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,_,x):null}(n,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Pu=ga;function cc(t,e){switch(t){case"string":return to(e);case"number":return+e;case"boolean":return!!e;case"color":return Mr.parse(e);case"formatted":return Qr.fromString(to(e));case"resolvedImage":return Mt.fromString(to(e))}return e}function Bd(t,e,n,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class uc{constructor(e,n,o){this.type=e,this.key=n,this.scope=o}static parse(e,n){let o=n.expectedType;if(o==null&&(o=mn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof qo))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=n.parse(e[2],2);return u instanceof qo?new uc(o,to(c.value),to(u.value)):n.error("Scope of 'config' expression must be a string literal.")}return new uc(o,to(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(n);if(!o)return null;let{type:c,value:u,values:f,minValue:_,maxValue:x,stepValue:b}=o,T=o.default.evaluate(e),I=T;if(u){let M=e.scope;e.scope=(M||"").split("").slice(1).join(""),I=u.evaluate(e),e.scope=M}return c&&(I=cc(c,I)),I===void 0||_===void 0&&x===void 0&&b===void 0||(typeof I=="number"?I=Bd(I,_,x,b):Array.isArray(I)&&(I=I.map(M=>typeof M=="number"?Bd(M,_,x,b):M))),u!==void 0&&I!==void 0&&f&&!f.includes(I)&&(I=T,c&&(I=cc(c,I))),(c&&c!==this.type||I!==void 0&&Pr(I)!==this.type)&&(I=cc(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}var al=uc;function ll(t){if(t instanceof hn&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Du||t instanceof Pu)return!1;let e=!0;return t.eachChild(n=>{e&&!ll(n)&&(e=!1)}),e}function hc(t){if(t instanceof hn&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!hc(n)&&(e=!1)}),e}function dc(t){if(t instanceof al)return!1;let e=!0;return t.eachChild(n=>{e&&!dc(n)&&(e=!1)}),e}function ei(t,e){if(t instanceof hn&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!ei(o,e)&&(n=!1)}),n}class As{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let o=e[1];return n.scope.has(o)?new As(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vi=As;class jd{constructor(e,n=[],o,c=new m0,u=[],f,_){this.registry=e,this.path=n,this.key=n.map(x=>`[${x}]`).join(""),this.scope=c,this.errors=u,this.expectedType=o,this._scope=f,this.options=_}parse(e,n,o,c,u={}){return n||o?this.concat(n,o,c)._parse(e,u):this._parse(e,u)}_parse(e,n){function o(c,u,f){return f==="assert"?new Wo(u,[c]):f==="coerce"?new Zo(u,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let u=c.parse(e,this);if(!u)return null;if(this.expectedType){let f=this.expectedType,_=u.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(f,_))return null}else u=o(u,f,n.typeAnnotation||"coerce");else u=o(u,f,n.typeAnnotation||"assert")}if(!(u instanceof qo)&&u.type.kind!=="resolvedImage"&&Vd(u)){let f=new xm(this._scope,this.options);try{u=new qo(u.type,u.evaluate(f))}catch(_){return this.error(_.message),null}}return u}return Zo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){let c=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new jd(this.registry,c,n||null,u,this.errors,this._scope,this.options)}error(e,...n){let o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Oo(o,e))}checkSubtype(e,n){let o=ua(e,n);return o&&this.error(o),o}}var Mm=jd;function Vd(t){if(t instanceof vi)return Vd(t.boundExpression);if(t instanceof hn&&t.name==="error"||t instanceof ic||t instanceof Du||t instanceof Pu||t instanceof al)return!1;let e=t instanceof Zo||t instanceof Wo,n=!0;return t.eachChild(o=>{n=e?n&&Vd(o):n&&o instanceof qo}),!!n&&ll(t)&&ei(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _a(t,e){let n=t.length-1,o,c,u=0,f=n,_=0;for(;u<=f;)if(_=Math.floor((u+f)/2),o=t[_],c=t[_+1],o<=e){if(_===n||e<c)return _;u=_+1}else{if(!(o>e))throw new Rr("Input is not a number.");f=_-1}return 0}class Ru{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,u]of o)this.labels.push(c),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let o=n.parse(e[1],1,lt);if(!o)return null;let c=[],u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let f=1;f<e.length;f+=2){let _=f===1?-1/0:e[f],x=e[f+1],b=f,T=f+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let I=n.parse(x,T,u);if(!I)return null;u=u||I.type,c.push([_,I])}return new Ru(u,o,c)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);let u=n.length;return c>=n[u-1]?o[u-1].evaluate(e):o[_a(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var fc=Ru;let Cm=.95047,Ps=1.08883,Sm=4/29,cl=6/29,Ud=3*cl*cl,Am=cl*cl*cl,E0=Math.PI/180,_o=180/Math.PI;function Lu(t){return t>Am?Math.pow(t,1/3):t/Ud+Sm}function Ou(t){return t>cl?t*t*t:Ud*(t-Sm)}function Nu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ku(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $d(t){let e=ku(t.r),n=ku(t.g),o=ku(t.b),c=Lu((.4124564*e+.3575761*n+.1804375*o)/Cm),u=Lu((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-Lu((.0193339*e+.119192*n+.9503041*o)/Ps)),alpha:t.a}}function Gd(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Ou(e),n=Cm*Ou(n),o=Ps*Ou(o),new Mr(Nu(3.2404542*n-1.5371385*e-.4985314*o),Nu(-.969266*n+1.8760108*e+.041556*o),Nu(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function Pm(t,e,n){let o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}let ul={forward:$d,reverse:Gd,interpolate:function(t,e,n){return{l:cn(t.l,e.l,n),a:cn(t.a,e.a,n),b:cn(t.b,e.b,n),alpha:cn(t.alpha,e.alpha,n)}}},hl={forward:function(t){let{l:e,a:n,b:o}=$d(t),c=Math.atan2(o,n)*_o;return{h:c<0?c+360:c,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*E0,n=t.c;return Gd({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Pm(t.h,e.h,n),c:cn(t.c,e.c,n),l:cn(t.l,e.l,n),alpha:cn(t.alpha,e.alpha,n)}}};var Hd=Object.freeze({__proto__:null,hcl:hl,lab:ul});class pc{constructor(e,n,o,c,u){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(let[f,_]of u)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,n,o,c){let u=0;if(e.name==="exponential")u=dl(n,e.base,o,c);else if(e.name==="linear")u=dl(n,1,o,c);else if(e.name==="cubic-bezier"){let f=e.controlPoints;u=new gr(f[0],f[1],f[2],f[3]).solve(dl(n,1,o,c))}return u}static parse(e,n){let[o,c,u,...f]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let b=c[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:b}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let b=c.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,lt),!u)return null;let _=[],x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=eo:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let b=0;b<f.length;b+=2){let T=f[b],I=f[b+1],M=b+3,P=b+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(_.length&&_[_.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);let L=n.parse(I,P,x);if(!L)return null;x=x||L.type,_.push([T,L])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new pc(x,o,c,u,_):n.error(`Type ${Er(x)} is not interpolatable.`)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);let u=n.length;if(c>=n[u-1])return o[u-1].evaluate(e);let f=_a(n,c),_=pc.interpolationFactor(this.interpolation,c,n[f],n[f+1]),x=o[f].evaluate(e),b=o[f+1].evaluate(e);return this.operator==="interpolate"?wu[this.type.kind.toLowerCase()](x,b,_):this.operator==="interpolate-hcl"?hl.reverse(hl.interpolate(hl.forward(x),hl.forward(b),_)):ul.reverse(ul.interpolate(ul.forward(x),ul.forward(b),_))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function dl(t,e,n,o){let c=o-n,u=t-n;return c===0?0:e===1?u/c:(Math.pow(e,u)-1)/(Math.pow(e,c)-1)}var Vi=pc;class fl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null,c=n.expectedType;c&&c.kind!=="value"&&(o=c);let u=[];for(let _ of e.slice(1)){let x=n.parse(_,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,u.push(x)}let f=c&&u.some(_=>ua(c,_.type));return new fl(f?mn:o,u)}evaluate(e){let n,o=null,c=0;for(let u of this.args){if(c++,o=u.evaluate(e),o&&o instanceof Mt&&!o.available&&(n||(n=o),o=null,c===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var qd=fl;class Fu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let u=1;u<e.length-1;u+=2){let f=e[u];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,u);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);let _=n.parse(e[u+1],u+1);if(!_)return null;o.push([f,_])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new Fu(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}var Wd=Fu;class Rs{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,lt),c=n.parse(e[2],2,Si(n.expectedType||mn));return o&&c?new Rs(c.type.itemType,o,c):null}evaluate(e){let n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Rr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Rr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Rr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var gn=Rs;class Zd{constructor(e,n){this.type=Mn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,mn),c=n.parse(e[2],2,mn);return o&&c?Lt(o.type,[Mn,Dn,lt,Ja,mn])?new Zd(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(o.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ts(n,["boolean","string","number","null"]))throw new Rr(`Expected first argument to be of type boolean, string, number or null, but found ${Er(Pr(n))} instead.`);if(!Ts(o,["string","array"]))throw new Rr(`Expected second argument to be of type array or string, but found ${Er(Pr(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var I0=Zd;class zu{constructor(e,n,o){this.type=lt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,mn),c=n.parse(e[2],2,mn);if(!o||!c)return null;if(!Lt(o.type,[Mn,Dn,lt,Ja,mn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,lt);return u?new zu(o,c,u):null}return new zu(o,c)}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ts(n,["boolean","string","number","null"]))throw new Rr(`Expected first argument to be of type boolean, string, number or null, but found ${Er(Pr(n))} instead.`);if(!Ts(o,["string","array"]))throw new Rr(`Expected second argument to be of type array or string, but found ${Er(Pr(o))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Rm=zu;class Xd{constructor(e,n,o,c,u,f){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=u,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let u={},f=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],I=e[b+1];Array.isArray(T)||(T=[T]);let M=n.concat(b);if(T.length===0)return M.error("Expected at least one branch label.");for(let L of T){if(typeof L!="number"&&typeof L!="string")return M.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,Pr(L)))return null}else o=Pr(L);if(u[String(L)]!==void 0)return M.error("Branch labels must be unique.");u[String(L)]=f.length}let P=n.parse(I,b,c);if(!P)return null;c=c||P.type,f.push(P)}let _=n.parse(e[1],1,mn);if(!_)return null;let x=n.parse(e[e.length-1],e.length-1,c);return x?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new Xd(o,c,_,u,f,x):null}evaluate(e){let n=this.input.evaluate(e);return(Pr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],c={};for(let f of n){let _=c[this.cases[f]];_===void 0?(c[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[_][1].push(f)}let u=f=>this.inputType.kind==="number"?Number(f):f;for(let[f,_]of o)e.push(_.length===1?u(_[0]):_.map(u)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var Lm=Xd;class Bu{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);let c=[];for(let f=1;f<e.length-1;f+=2){let _=n.parse(e[f],f,Mn);if(!_)return null;let x=n.parse(e[f+1],f+1,o);if(!x)return null;c.push([_,x]),o=o||x.type}let u=n.parse(e[e.length-1],e.length-1,o);return u?new Bu(o,c,u):null}evaluate(e){for(let[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Om=Bu;class mc{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,mn),c=n.parse(e[2],2,lt);if(!o||!c)return null;if(!Lt(o.type,[Si(mn),Dn,mn]))return n.error(`Expected first argument to be of type array or string, but found ${Er(o.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,lt);return u?new mc(o.type,o,c,u):null}return new mc(o.type,o,c)}evaluate(e){let n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ts(n,["string","array"]))throw new Rr(`Expected first argument to be of type array or string, but found ${Er(Pr(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var pl=mc;function Yd(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Kd(t,e,n,o){return o.compare(e,n)===0}function ml(t,e,n){let o=t!=="=="&&t!=="!=";return class G2{constructor(u,f,_){this.type=Mn,this.lhs=u,this.rhs=f,this.collator=_,this.hasUntypedArgument=u.type.kind==="value"||f.type.kind==="value"}static parse(u,f){if(u.length!==3&&u.length!==4)return f.error("Expected two or three arguments.");let _=u[0],x=f.parse(u[1],1,mn);if(!x)return null;if(!Yd(_,x.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${Er(x.type)}'.`);let b=f.parse(u[2],2,mn);if(!b)return null;if(!Yd(_,b.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${Er(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${Er(x.type)}' and '${Er(b.type)}'.`);o&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new Wo(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new Wo(x.type,[b])));let T=null;if(u.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(T=f.parse(u[3],3,Tu),!T)return null}return new G2(x,b,T)}evaluate(u){let f=this.lhs.evaluate(u),_=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){let x=Pr(f),b=Pr(_);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new Rr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let x=Pr(f),b=Pr(_);if(x.kind!=="string"||b.kind!=="string")return e(u,f,_)}return this.collator?n(u,f,_,this.collator.evaluate(u)):e(u,f,_)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[t];return this.eachChild(f=>{u.push(f.serialize())}),u}}}let Jd=ml("==",function(t,e,n){return e===n},Kd),Qd=ml("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!Kd(0,e,n,o)}),D0=ml("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),M0=ml(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),Nm=ml("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),C0=ml(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class ef{constructor(e,n,o,c,u,f){this.type=Dn,this.number=e,this.locale=n,this.currency=o,this.unit=c,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let o=n.parse(e[1],1,lt);if(!o)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=n.parse(c.locale,1,Dn),!u))return null;let f=null;if(c.currency&&(f=n.parse(c.currency,1,Dn),!f))return null;let _=null;if(c.unit&&(_=n.parse(c.unit,1,Dn),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,lt),!x))return null;let b=null;return c["max-fraction-digits"]&&(b=n.parse(c["max-fraction-digits"],1,lt),!b)?null:new ef(o,u,f,_,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class tf{constructor(e){this.type=lt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Er(o.type)} instead.`):new tf(o):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Rr(`Expected value to be of type string or array, but found ${Er(Pr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function km(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let nf={"==":Jd,"!=":Qd,">":M0,"<":D0,">=":C0,"<=":Nm,array:Wo,at:gn,boolean:Wo,case:Om,coalesce:qd,collator:ic,format:nl,image:da,in:I0,"index-of":Rm,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:tf,let:Wd,literal:qo,match:Lm,number:Wo,"number-format":ef,object:Wo,slice:pl,step:fc,string:Wo,"to-boolean":Zo,"to-color":Zo,"to-number":Zo,"to-string":Zo,var:vi,within:Du,distance:Pu,config:al};function rf(t,[e,n,o,c]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=c?c.evaluate(t):1,f=vm(e,n,o,u);if(f)throw new Rr(f);return new Mr(e/255*u,n/255*u,o/255*u,u)}function Fm(t,[e,n,o,c]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let u=c?c.evaluate(t):1,f=function(b,T,I,M){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[b,T,I,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[b,T,I,M]:[b,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[b,T,I,M]:[b,T,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,o,u);if(f)throw new Rr(f);let _=`hsla(${e}, ${n}%, ${o}%, ${u})`,x=Mr.parse(_);if(!x)throw new Rr(`Failed to parse HSLA color: ${_}`);return x}function of(t,e){return t in e}function sf(t,e){let n=e[t];return n===void 0?null:n}function ya(t){return{type:t}}hn.register(nf,{error:[{kind:"error"},[Dn],(t,[e])=>{throw new Rr(e.evaluate(t))}],typeof:[Dn,[mn],(t,[e])=>Er(Pr(e.evaluate(t)))],"to-rgba":[Si(lt,4),[eo],(t,[e])=>e.evaluate(t).toArray()],rgb:[eo,[lt,lt,lt],rf],rgba:[eo,[lt,lt,lt,lt],rf],hsl:[eo,[lt,lt,lt],Fm],hsla:[eo,[lt,lt,lt,lt],Fm],has:{type:Mn,overloads:[[[Dn],(t,[e])=>of(e.evaluate(t),t.properties())],[[Dn,Qa],(t,[e,n])=>of(e.evaluate(t),n.evaluate(t))]]},get:{type:mn,overloads:[[[Dn],(t,[e])=>sf(e.evaluate(t),t.properties())],[[Dn,Qa],(t,[e,n])=>sf(e.evaluate(t),n.evaluate(t))]]},"feature-state":[mn,[Dn],(t,[e])=>sf(e.evaluate(t),t.featureState||{})],properties:[Qa,[],t=>t.properties()],"geometry-type":[Dn,[],t=>t.geometryType()],id:[mn,[],t=>t.id()],zoom:[lt,[],t=>t.globals.zoom],pitch:[lt,[],t=>t.globals.pitch||0],"distance-from-center":[lt,[],t=>t.distanceFromCenter()],"measure-light":[lt,[Dn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[lt,[],t=>t.globals.heatmapDensity||0],"line-progress":[lt,[],t=>t.globals.lineProgress||0],"raster-value":[lt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[lt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[lt,[],t=>t.globals.skyRadialProgress||0],accumulated:[mn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[lt,ya(lt),(t,e)=>{let n=0;for(let o of e)n+=o.evaluate(t);return n}],"*":[lt,ya(lt),(t,e)=>{let n=1;for(let o of e)n*=o.evaluate(t);return n}],"-":{type:lt,overloads:[[[lt,lt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[lt],(t,[e])=>-e.evaluate(t)]]},"/":[lt,[lt,lt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[lt,[lt,lt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[lt,[lt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))],log2:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[lt,[lt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[lt,[lt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[lt,[lt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[lt,[lt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[lt,[lt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[lt,[lt],(t,[e])=>Math.atan(e.evaluate(t))],min:[lt,ya(lt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[lt,ya(lt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[lt,[lt],(t,[e])=>Math.abs(e.evaluate(t))],round:[lt,[lt],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[lt,[lt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[lt,[lt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Mn,[Dn,mn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Mn,[mn],(t,[e])=>t.id()===e.value],"filter-type-==":[Mn,[Dn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Mn,[Dn,mn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Mn,[mn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Mn,[Dn,mn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Mn,[mn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Mn,[Dn,mn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Mn,[mn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Mn,[Dn,mn],(t,[e,n])=>{let o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Mn,[mn],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Mn,[mn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Mn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Mn,[Si(Dn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Mn,[Si(mn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Mn,[Dn,Si(mn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Mn,[Dn,Si(mn)],(t,[e,n])=>function(o,c,u,f){for(;u<=f;){let _=u+f>>1;if(c[_]===o)return!0;c[_]>o?f=_-1:u=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Mn,overloads:[[[Mn,Mn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[ya(Mn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Mn,overloads:[[[Mn,Mn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[ya(Mn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Mn,[Mn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Mn,[Dn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Dn,[Dn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Dn,[Dn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Dn,ya(mn),(t,e)=>e.map(n=>to(n.evaluate(t))).join("")],"resolved-locale":[Dn,[Tu],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[lt,[lt,lt,mn],(t,e)=>{let[n,o,c]=e.map(f=>f.evaluate(t));if(n>o||n===o)return n;let u;if(typeof c=="string")u=function(f){let _=0;if(f.length===0)return _;for(let x=0;x<f.length;x++)_=(_<<5)-_+f.charCodeAt(x),_|=0;return _}(c);else{if(typeof c!="number")throw new Rr(`Invalid seed input: ${c}`);u=c}return n+km(u)()*(o-n)}]});var gl=nf;function af(t){return{result:"success",value:t}}function va(t){return{result:"error",value:t}}function zm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ju(t){return t["property-type"]==="data-driven"}function lf(t){return zm(t.expression,"measure-light")}function Bm(t){return zm(t.expression,"zoom")}function cf(t){return!!t.expression&&t.expression.interpolated}function Vu(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function jm(t){return t}function uf(t,e){let n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",c=o||!(o||t.property!==void 0),u=t.type||(cf(e)?"exponential":"interval");if(n&&((t=_d({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],Mr.parse(b[1])])),t.default=Mr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Hd[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,_,x;if(u==="exponential")f=Vm;else if(u==="interval")f=A0;else if(u==="categorical"){f=S0,_=Object.create(null);for(let b of t.stops)_[b[0]]=b[1];x=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);f=Um}if(o){let b={},T=[];for(let P=0;P<t.stops.length;P++){let L=t.stops[P],N=L[0].zoom;b[N]===void 0&&(b[N]={zoom:N,type:t.type,property:t.property,default:t.default,stops:[]},T.push(N)),b[N].stops.push([L[0].value,L[1]])}let I=[];for(let P of T)I.push([b[P].zoom,uf(b[P],e)]);let M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Vi.interpolationFactor.bind(void 0,M),zoomStops:I.map(P=>P[0]),evaluate:({zoom:P},L)=>Vm({stops:I,base:t.base},e,P).evaluate(P,L)}}if(c){let b=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Vi.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(t,e,T,_,x)}}return{kind:"source",evaluate(b,T){let I=T&&T.properties?T.properties[t.property]:void 0;return I===void 0?gc(t.default,e.default):f(t,e,I,_,x)}}}function gc(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function S0(t,e,n,o,c){return gc(typeof n===c?o[n]:void 0,t.default,e.default)}function A0(t,e,n){if(rl(n)!=="number")return gc(t.default,e.default);let o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];let c=_a(t.stops.map(u=>u[0]),n);return t.stops[c][1]}function Vm(t,e,n){let o=t.base!==void 0?t.base:1;if(rl(n)!=="number")return gc(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let u=_a(t.stops.map(T=>T[0]),n),f=function(T,I,M,P){let L=P-M,N=T-M;return L===0?0:I===1?N/L:(Math.pow(I,N)-1)/(Math.pow(I,L)-1)}(n,o,t.stops[u][0],t.stops[u+1][0]),_=t.stops[u][1],x=t.stops[u+1][1],b=wu[e.type]||jm;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=Hd[t.colorSpace];b=(I,M)=>T.reverse(T.interpolate(T.forward(I),T.forward(M),f))}return typeof _.evaluate=="function"?{evaluate(...T){let I=_.evaluate.apply(void 0,T),M=x.evaluate.apply(void 0,T);if(I!==void 0&&M!==void 0)return b(I,M,f)}}:b(_,x,f)}function Um(t,e,n){return e.type==="color"?n=Mr.parse(n):e.type==="formatted"?n=Qr.fromString(n.toString()):e.type==="resolvedImage"?n=Mt.fromString(n.toString()):rl(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),gc(n,t.default,e.default)}class Uu{constructor(e,n,o,c){this.expression=e,this._warningHistory={},this._evaluator=new xm(o,c),this._defaultValue=n?function(u){return u.type==="color"&&(Vu(u.default)||Array.isArray(u.default))?new Mr(0,0,0,0):u.type==="color"?Mr.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,u,f,_,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,u,f,_,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Rr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function _c(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in gl}function $u(t,e,n,o){let c=new Mm(gl,[],e?function(f){let _={color:eo,string:Dn,number:lt,enum:Dn,boolean:Mn,formatted:el,resolvedImage:nc};return f.type==="array"?Si(_[f.value]||mn,f.length):_[f.type]}(e):void 0,void 0,void 0,n,o),u=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?af(new Uu(u,e,n,o)):va(c.errors)}class hf{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!hc(n.expression),this.isConfigDependent=!dc(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,u,f)}evaluate(e,n,o,c,u,f){return this._styleExpression.evaluate(e,n,o,c,u,f)}}class yc{constructor(e,n,o,c,u){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!hc(n.expression),this.isLightConstant=u,this.isConfigDependent=!dc(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,u,f)}evaluate(e,n,o,c,u,f){return this._styleExpression.evaluate(e,n,o,c,u,f)}interpolationFactor(e,n,o){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,e,n,o):0}}function Gu(t,e,n,o){if((t=$u(t,e,n,o)).result==="error")return t;let c=t.value.expression,u=ll(c);if(!u&&!ju(e))return va([new Oo("","data expressions not supported")]);let f=ei(c,["zoom","pitch","distance-from-center"]);if(!f&&!Bm(e))return va([new Oo("","zoom expressions not supported")]);let _=ei(c,["measure-light"]);if(!_&&!lf(e))return va([new Oo("","measure-light expression not supported")]);let x=e.expression&&e.expression.relaxZoomRestriction,b=xc(c);return b||f||x?b instanceof Oo?va([b]):b instanceof Vi&&!cf(e)?va([new Oo("",'"interpolate" expressions cannot be used with this property')]):af(b?new yc(u?"camera":"composite",t.value,b.labels,b instanceof Vi?b.interpolation:void 0,_):new hf(u?"constant":"source",t.value,_)):va([new Oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class vc{constructor(e,n){this._parameters=e,this._specification=n,_d(this,uf(this._parameters,this._specification))}static deserialize(e){return new vc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function xc(t){let e=null;if(t instanceof Wd)e=xc(t.result);else if(t instanceof qd){for(let n of t.args)if(e=xc(n),e)break}else(t instanceof fc||t instanceof Vi)&&t.input instanceof hn&&t.input.name==="zoom"&&(e=t);return e instanceof Oo||t.eachChild(n=>{let o=xc(n);o instanceof Oo?e=o:e&&o&&e!==o&&(e=new Oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var P0=vo,yo=3;function vo(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var u=0;u<this.d*this.d;u++){var f=c[yo+u],_=c[yo+u+1];o.push(f===_?null:c.subarray(f,_))}var x=c[yo+o.length+1];this.keys=c.subarray(c[yo+o.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}vo.prototype.insert=function(t,e,n,o,c){this._forEachCell(e,n,o,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c)},vo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vo.prototype._insertCell=function(t,e,n,o,c,u){this.cells[c].push(u)},vo.prototype.query=function(t,e,n,o,c){var u=this.min,f=this.max;if(t<=u&&e<=u&&f<=n&&f<=o&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,o,this._queryCell,_,{},c),_},vo.prototype._queryCell=function(t,e,n,o,c,u,f,_){var x=this.cells[c];if(x!==null)for(var b=this.keys,T=this.bboxes,I=0;I<x.length;I++){var M=x[I];if(f[M]===void 0){var P=4*M;(_?_(T[P+0],T[P+1],T[P+2],T[P+3]):t<=T[P+2]&&e<=T[P+3]&&n>=T[P+0]&&o>=T[P+1])?(f[M]=!0,u.push(b[M])):f[M]=!1}}},vo.prototype._forEachCell=function(t,e,n,o,c,u,f,_){for(var x=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(n),I=this._convertToCellCoord(o),M=x;M<=T;M++)for(var P=b;P<=I;P++){var L=this.d*P+M;if((!_||_(this._convertFromCellCoord(M),this._convertFromCellCoord(P),this._convertFromCellCoord(M+1),this._convertFromCellCoord(P+1)))&&c.call(this,t,e,n,o,L,u,f,_))return}},vo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},vo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},vo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=yo+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=e,f=0;f<t.length;f++){var _=t[f];c[yo+f]=u,c.set(_,u),u+=_.length}return c[yo+t.length]=u,c.set(this.keys,u),c[yo+t.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};var Yo=Zt(P0);let bc={};function ut(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),bc[e]={klass:t,omit:n.omit||[]}}ut(Object,"Object"),Yo.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Yo.deserialize=function(t){return new Yo(t.buffer)},Object.defineProperty(Yo,"name",{value:"Grid"}),ut(Yo,"Grid"),ut(Mr,"Color"),ut(Error,"Error"),ut(Qr,"Formatted"),ut(tl,"FormattedSection"),ut(Sr,"AJAXError"),ut(Mt,"ResolvedImage"),ut(vc,"StylePropertyFunction"),ut(Uu,"StyleExpression",{omit:["_evaluator"]}),ut(yc,"ZoomDependentExpression"),ut(hf,"ZoomConstantExpression"),ut(hn,"CompoundExpression",{omit:["_evaluate"]});for(let t in gl)bc[gl[t]._classRegistryKey]||ut(gl[t],`Expression${t}`);function $m(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Hu(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Ls(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($m(t)||Hu(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let o of t)n.push(Ls(o,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[o,c]of t.entries())n[o]=Ls(c);return n}if(typeof t=="object"){let n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let u in t)t.hasOwnProperty(u)&&(bc[o].omit.indexOf(u)>=0||(c[u]=Ls(t[u],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof t)}function xa(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$m(t)||Hu(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(xa);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let c=new Map;for(let u of Object.keys(t))u!=="$name"&&c.set(u,xa(t[u]));return c}let{klass:n}=bc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let o=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(o[c]=xa(t[c]));return o}throw new Error("can't deserialize object of type "+typeof t)}let mt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Os(t){for(let e of t)if(df(e.charCodeAt(0)))return!0;return!1}function R0(t){for(let e of t)if(!L0(e.charCodeAt(0)))return!1;return!0}function L0(t){return!(mt.Arabic(t)||mt["Arabic Supplement"](t)||mt["Arabic Extended-A"](t)||mt["Arabic Presentation Forms-A"](t)||mt["Arabic Presentation Forms-B"](t))}function df(t){return!(t!==746&&t!==747&&(t<4352||!(mt["Bopomofo Extended"](t)||mt.Bopomofo(t)||mt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||mt["CJK Compatibility Ideographs"](t)||mt["CJK Compatibility"](t)||mt["CJK Radicals Supplement"](t)||mt["CJK Strokes"](t)||!(!mt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||mt["CJK Unified Ideographs Extension A"](t)||mt["CJK Unified Ideographs"](t)||mt["Enclosed CJK Letters and Months"](t)||mt["Hangul Compatibility Jamo"](t)||mt["Hangul Jamo Extended-A"](t)||mt["Hangul Jamo Extended-B"](t)||mt["Hangul Jamo"](t)||mt["Hangul Syllables"](t)||mt.Hiragana(t)||mt["Ideographic Description Characters"](t)||mt.Kanbun(t)||mt["Kangxi Radicals"](t)||mt["Katakana Phonetic Extensions"](t)||mt.Katakana(t)&&t!==12540||!(!mt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!mt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||mt["Unified Canadian Aboriginal Syllabics"](t)||mt["Unified Canadian Aboriginal Syllabics Extended"](t)||mt["Vertical Forms"](t)||mt["Yijing Hexagram Symbols"](t)||mt["Yi Syllables"](t)||mt["Yi Radicals"](t))))}function Gm(t){return!(df(t)||function(e){return!!(mt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||mt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||mt["Letterlike Symbols"](e)||mt["Number Forms"](e)||mt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||mt["Control Pictures"](e)&&e!==9251||mt["Optical Character Recognition"](e)||mt["Enclosed Alphanumerics"](e)||mt["Geometric Shapes"](e)||mt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||mt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||mt["CJK Symbols and Punctuation"](e)||mt.Katakana(e)||mt["Private Use Area"](e)||mt["CJK Compatibility Forms"](e)||mt["Small Form Variants"](e)||mt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Hm(t){return t>=1424&&t<=2303||mt["Arabic Presentation Forms-A"](t)||mt["Arabic Presentation Forms-B"](t)}function qm(t,e){return!(!e&&Hm(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||mt.Khmer(t))}function ff(t){for(let e of t)if(Hm(e.charCodeAt(0)))return!0;return!1}let pf="deferred",mf="loading",gf="loaded",_f=null,Ai="unavailable",Ns=null,Wm=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ai="error"),_f&&_f(t)};function yf(){vf.fire(new ca("pluginStateChange",{pluginStatus:Ai,pluginURL:Ns}))}let vf=new Ka,ks=function(){return Ai},xf=function(){if(Ai!==pf||!Ns)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ai=mf,yf(),Ns&&Pe({url:Ns},t=>{t?Wm(t):(Ai=gf,yf())})},Ui={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ai===gf||Ui.applyArabicShaping!=null,isLoading:()=>Ai===mf,setState(t){Ai=t.pluginStatus,Ns=t.pluginURL},isParsed:()=>Ui.applyArabicShaping!=null&&Ui.processBidirectionalText!=null&&Ui.processStyledBidirectionalText!=null,getPluginURL:()=>Ns};class ar{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,o){for(let c of n)if(!qm(c.charCodeAt(0),o))return!1;return!0}(e,Ui.isLoaded())}}class qu{constructor(e,n,o,c){this.property=e,this.value=n,this.expression=function(u,f,_,x){if(Vu(u))return new vc(u,f);if(_c(u)||Array.isArray(u)&&u.length>0){let b=Gu(u,f,_,x);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=u;return typeof u=="string"&&f.type==="color"&&(b=Mr.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(n===void 0?e.specification.default:n,e.specification,o,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class bf{constructor(e,n,o){this.property=e,this.value=new qu(e,void 0,n,o)}transitioned(e,n){return new wf(this.property,this.value,n,ii({},e.transition,this.transition),e.now)}untransitioned(){return new wf(this.property,this.value,null,{},0)}}class Ko{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=o,this.isConfigDependent=!1}getValue(e){return Bi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new bf(this._values[e].property,this._scope,this._options)),this._values[e].value=new qu(this._values[e].property,n===null?void 0:Bi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let o=this._properties.properties;if(e)for(let c in e){let u=e[c];if($o(c,"-transition")){let f=c.slice(0,-11);o[f]&&this.setTransition(f,u)}else o[c]&&this.setValue(c,u)}}getTransition(e){return Bi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new bf(this._values[e].property)),this._values[e].transition=Bi(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let o=new ba(this._properties);for(let c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){let e=new ba(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class wf{constructor(e,n,o,c,u){let f=c.delay||0,_=c.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+f,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){let c=e.now||0,u=this.value.possiblyEvaluate(e,n,o),f=this.prior;if(f){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return f.possiblyEvaluate(e,n,o);{let _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,n,o),u,it(_))}}return u}}class ba{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){let c=new wc(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,n,o);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class O0{constructor(e,n,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=o,this.isConfigDependent=!1}getValue(e){return Bi(this._values[e].value)}setValue(e,n){this._values[e]=new qu(this._values[e].property,n===null?void 0:Bi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){let c=new wc(this._properties);for(let u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,n,o);return c}}class _l{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class wc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Xe{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){let c=wu[this.specification.type];return c?c(e,n,o):e}}class Et{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new _l(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new _l(this,{kind:"constant",value:void 0},e.parameters);let c=wu[this.specification.type];return c?new _l(this,{kind:"constant",value:c(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,c,u,f){return e.kind==="constant"?e.value:e.evaluate(n,o,c,u,f)}}class wa{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class lr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new ar(0,{});for(let o in e){let c=e[o];c.specification.overridable&&this.overridableProperties.push(o);let u=this.defaultPropertyValues[o]=new qu(c,void 0),f=this.defaultTransitionablePropertyValues[o]=new bf(c);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(n)}}}function Tc(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ec(t){if(Array.isArray(t))return t.map(Ec);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Ec(t[n]);return e}return Tc(t)}ut(Et,"DataDrivenProperty"),ut(Xe,"DataConstantProperty"),ut(wa,"ColorRampProperty");var ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Tf(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Tf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function $i(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tf(t)||(t=Ic(t));let n=t,o=!0;try{o=function(b){if(!yl(b))return b;let T=Ec(b);return Ef(T),T=Zm(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=ye[`filter_${e}`],u=$u(o,c),f=null;if(u.result==="error")throw new Error(u.value.map(b=>`${b.key}: ${b.message}`).join(", "));f=(b,T,I)=>u.value.evaluate(b,T,{},I);let _=null,x=null;if(o!==n){let b=$u(n,c);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,I,M,P,L)=>b.value.evaluate(T,I,{},M,void 0,void 0,P,L),x=!ll(b.value.expression)}return{filter:f,dynamicFilter:_||void 0,needGeometry:Xm(o),needFeature:!!x}}function Zm(t){if(!Array.isArray(t))return t;let e=function(n){if(N0.has(n[0])){for(let o=1;o<n.length;o++)if(yl(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>Zm(n))}function Ef(t){let e=!1,n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||yl(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||yl(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||yl(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)Ef(t[o])}function yl(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(yl(t[n]))return!0;return!1}let N0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function k0(t,e){return t<e?-1:t>e?1:0}function Xm(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Xm(t[e]))return!0;return!1}function Ic(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Dc(t[1],t[2],"=="):e==="!="?Mc(Dc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Dc(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Ic))):e==="all"?["all"].concat(t.slice(1).map(Ic)):e==="none"?["all"].concat(t.slice(1).map(Ic).map(Mc)):e==="in"?If(t[1],t.slice(2)):e==="!in"?Mc(If(t[1],t.slice(2))):e==="has"?Ym(t[1]):e!=="!has"||Mc(Ym(t[1]));var n}function Dc(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function If(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(k0)]]:["filter-in-small",t,["literal",e]]}}function Ym(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Mc(t){return["!",t]}let Wu="";function Df(t,e){return e?`${t}${Wu}${e}`:t}let Cc="-transition";class Pi extends Ka{constructor(e,n,o,c){if(super(),this.id=e.id,this.fqid=Df(this.id,o),this.type=e.type,this.scope=o,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new O0(n.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Ko(n.paint,this.scope,c);for(let u in e.paint)this.setPaintProperty(u,e.paint[u]);for(let u in e.layout)this.setLayoutProperty(u,e.layout[u]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wc(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,n),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return $o(e,Cc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let o=this._transitionablePaint,c=o._properties.properties;if($o(e,Cc)){let I=e.slice(0,-11);return c[I]&&o.setTransition(I,n||void 0),!1}if(!c[e])return!1;let u=o._values[e],f=u.value.isDataDriven(),_=u.value;o.setValue(e,n),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let x=o._values[e].value,b=x.isDataDriven(),T=$o(e,"pattern")||e==="line-dasharray";return b||f||T||this._handleOverridablePaintPropertyUpdate(e,_,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Ki({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof _l&&ju(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=$i(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}let F0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zu{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class er{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Rn(t,e=1){let n=0,o=0;return{members:t.map(c=>{let u=F0[c.type].BYTES_PER_ELEMENT,f=n=Sc(n,Math.max(e,u)),_=c.components||1;return o=Math.max(o,u),n+=u*_,{name:c.name,type:c.type,components:_,offset:f}}),size:Sc(n,Math.max(o,e)),alignment:e}}function Sc(t,e){return Math.ceil(t/e)*e}class xo extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}xo.prototype.bytesPerElement=4,ut(xo,"StructArrayLayout2i4");class xi extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){let u=3*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=c,e}}xi.prototype.bytesPerElement=6,ut(xi,"StructArrayLayout3i6");class Jo extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let f=4*e;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=c,this.int16[f+3]=u,e}}Jo.prototype.bytesPerElement=8,ut(Jo,"StructArrayLayout4i8");class Mf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c,u)}emplace(e,n,o,c,u,f){let _=5*e;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=c,this.int16[_+3]=u,this.int16[_+4]=f,e}}Mf.prototype.bytesPerElement=10,ut(Mf,"StructArrayLayout5i10");class Cf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,f,_)}emplace(e,n,o,c,u,f,_,x){let b=6*e,T=12*e,I=3*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[T+4]=c,this.uint8[T+5]=u,this.uint8[T+6]=f,this.uint8[T+7]=_,this.float32[I+2]=x,e}}Cf.prototype.bytesPerElement=12,ut(Cf,"StructArrayLayout2i4ub1f12");class Fs extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let f=4*e;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=c,this.float32[f+3]=u,e}}Fs.prototype.bytesPerElement=16,ut(Fs,"StructArrayLayout4f16");class zs extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c,u)}emplace(e,n,o,c,u,f){let _=6*e,x=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=o,this.uint16[_+2]=c,this.uint16[_+3]=u,this.float32[x+2]=f,e}}zs.prototype.bytesPerElement=12,ut(zs,"StructArrayLayout4ui1f12");class vl extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let f=4*e;return this.uint16[f+0]=n,this.uint16[f+1]=o,this.uint16[f+2]=c,this.uint16[f+3]=u,e}}vl.prototype.bytesPerElement=8,ut(vl,"StructArrayLayout4ui8");class Xu extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,u,f)}emplace(e,n,o,c,u,f,_){let x=6*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=u,this.int16[x+4]=f,this.int16[x+5]=_,e}}Xu.prototype.bytesPerElement=12,ut(Xu,"StructArrayLayout6i12");class Ac extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_,x,b,T,I,M){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,u,f,_,x,b,T,I,M)}emplace(e,n,o,c,u,f,_,x,b,T,I,M,P){let L=12*e;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=c,this.int16[L+3]=u,this.uint16[L+4]=f,this.uint16[L+5]=_,this.uint16[L+6]=x,this.uint16[L+7]=b,this.int16[L+8]=T,this.int16[L+9]=I,this.int16[L+10]=M,this.int16[L+11]=P,e}}Ac.prototype.bytesPerElement=24,ut(Ac,"StructArrayLayout4i4ui4i24");class Sf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f){let _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,u,f)}emplace(e,n,o,c,u,f,_){let x=10*e,b=5*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.float32[b+2]=u,this.float32[b+3]=f,this.float32[b+4]=_,e}}Sf.prototype.bytesPerElement=20,ut(Sf,"StructArrayLayout3i3f20");class Af extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Af.prototype.bytesPerElement=4,ut(Af,"StructArrayLayout1ul4");class No extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}No.prototype.bytesPerElement=4,ut(No,"StructArrayLayout2ui4");class Pf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_,x,b,T,I,M,P){let L=this.length;return this.resize(L+1),this.emplace(L,e,n,o,c,u,f,_,x,b,T,I,M,P)}emplace(e,n,o,c,u,f,_,x,b,T,I,M,P,L){let N=20*e,z=10*e;return this.int16[N+0]=n,this.int16[N+1]=o,this.int16[N+2]=c,this.int16[N+3]=u,this.int16[N+4]=f,this.float32[z+3]=_,this.float32[z+4]=x,this.float32[z+5]=b,this.float32[z+6]=T,this.int16[N+14]=I,this.uint32[z+8]=M,this.uint16[N+18]=P,this.uint16[N+19]=L,e}}Pf.prototype.bytesPerElement=40,ut(Pf,"StructArrayLayout5i4f1i1ul2ui40");class Pc extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,f,_)}emplace(e,n,o,c,u,f,_,x){let b=8*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=c,this.int16[b+4]=u,this.int16[b+5]=f,this.int16[b+6]=_,this.int16[b+7]=x,e}}Pc.prototype.bytesPerElement=16,ut(Pc,"StructArrayLayout3i2i2i16");class Yu extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c,u)}emplace(e,n,o,c,u,f){let _=4*e,x=8*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[x+6]=u,this.int16[x+7]=f,e}}Yu.prototype.bytesPerElement=16,ut(Yu,"StructArrayLayout2f1f2i16");class Rf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let f=12*e,_=3*e;return this.uint8[f+0]=n,this.uint8[f+1]=o,this.float32[_+1]=c,this.float32[_+2]=u,e}}Rf.prototype.bytesPerElement=12,ut(Rf,"StructArrayLayout2ub2f12");class Vr extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){let u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,this.uint16[u+2]=c,e}}Vr.prototype.bytesPerElement=6,ut(Vr,"StructArrayLayout3ui6");class xl extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie){let ne=this.length;return this.resize(ne+1),this.emplace(ne,e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie)}emplace(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie,ne){let le=30*e,de=15*e,me=60*e;return this.int16[le+0]=n,this.int16[le+1]=o,this.int16[le+2]=c,this.float32[de+2]=u,this.float32[de+3]=f,this.uint16[le+8]=_,this.uint16[le+9]=x,this.uint32[de+5]=b,this.uint32[de+6]=T,this.uint32[de+7]=I,this.uint16[le+16]=M,this.uint16[le+17]=P,this.uint16[le+18]=L,this.float32[de+10]=N,this.float32[de+11]=z,this.uint8[me+48]=V,this.uint8[me+49]=W,this.uint8[me+50]=J,this.uint32[de+13]=K,this.int16[le+28]=ie,this.uint8[me+58]=ne,e}}xl.prototype.bytesPerElement=60,ut(xl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ku extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie,ne,le,de,me,be,ge,Me,Ne,Ie,Le,Te){let Re=this.length;return this.resize(Re+1),this.emplace(Re,e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie,ne,le,de,me,be,ge,Me,Ne,Ie,Le,Te)}emplace(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie,ne,le,de,me,be,ge,Me,Ne,Ie,Le,Te,Re){let Ke=20*e,Fe=40*e,dt=80*e;return this.float32[Ke+0]=n,this.float32[Ke+1]=o,this.int16[Fe+4]=c,this.int16[Fe+5]=u,this.int16[Fe+6]=f,this.int16[Fe+7]=_,this.int16[Fe+8]=x,this.int16[Fe+9]=b,this.int16[Fe+10]=T,this.int16[Fe+11]=I,this.int16[Fe+12]=M,this.uint16[Fe+13]=P,this.uint16[Fe+14]=L,this.uint16[Fe+15]=N,this.uint16[Fe+16]=z,this.uint16[Fe+17]=V,this.uint16[Fe+18]=W,this.uint16[Fe+19]=J,this.uint16[Fe+20]=K,this.uint16[Fe+21]=ie,this.uint16[Fe+22]=ne,this.uint16[Fe+23]=le,this.uint16[Fe+24]=de,this.uint16[Fe+25]=me,this.uint16[Fe+26]=be,this.uint16[Fe+27]=ge,this.uint32[Ke+14]=Me,this.float32[Ke+15]=Ne,this.float32[Ke+16]=Ie,this.float32[Ke+17]=Le,this.float32[Ke+18]=Te,this.uint8[dt+76]=Re,e}}Ku.prototype.bytesPerElement=80,ut(Ku,"StructArrayLayout2f9i15ui1ul4f1ub80");class Rc extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Rc.prototype.bytesPerElement=4,ut(Rc,"StructArrayLayout1f4");class Bs extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c,u)}emplace(e,n,o,c,u,f){let _=5*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.float32[_+3]=u,this.float32[_+4]=f,e}}Bs.prototype.bytesPerElement=20,ut(Bs,"StructArrayLayout5f20");class Lf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,f,_)}emplace(e,n,o,c,u,f,_,x){let b=7*e;return this.float32[b+0]=n,this.float32[b+1]=o,this.float32[b+2]=c,this.float32[b+3]=u,this.float32[b+4]=f,this.float32[b+5]=_,this.float32[b+6]=x,e}}Lf.prototype.bytesPerElement=28,ut(Lf,"StructArrayLayout7f28");class Lc extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,c)}emplace(e,n,o,c,u){let f=6*e;return this.uint32[3*e+0]=n,this.uint16[f+2]=o,this.uint16[f+3]=c,this.uint16[f+4]=u,e}}Lc.prototype.bytesPerElement=12,ut(Lc,"StructArrayLayout1ul3ui12");class Of extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Of.prototype.bytesPerElement=2,ut(Of,"StructArrayLayout1ui2");class Ta extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){let u=3*e;return this.float32[u+0]=n,this.float32[u+1]=o,this.float32[u+2]=c,e}}Ta.prototype.bytesPerElement=12,ut(Ta,"StructArrayLayout3f12");class Oc extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Oc.prototype.bytesPerElement=8,ut(Oc,"StructArrayLayout2f8");class Nf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z){let V=this.length;return this.resize(V+1),this.emplace(V,e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z)}emplace(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V){let W=16*e;return this.float32[W+0]=n,this.float32[W+1]=o,this.float32[W+2]=c,this.float32[W+3]=u,this.float32[W+4]=f,this.float32[W+5]=_,this.float32[W+6]=x,this.float32[W+7]=b,this.float32[W+8]=T,this.float32[W+9]=I,this.float32[W+10]=M,this.float32[W+11]=P,this.float32[W+12]=L,this.float32[W+13]=N,this.float32[W+14]=z,this.float32[W+15]=V,e}}Nf.prototype.bytesPerElement=64,ut(Nf,"StructArrayLayout16f64");class Nc extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,u,f,_){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,u,f,_)}emplace(e,n,o,c,u,f,_,x){let b=10*e,T=5*e;return this.uint16[b+0]=n,this.uint16[b+1]=o,this.uint16[b+2]=c,this.uint16[b+3]=u,this.float32[T+2]=f,this.float32[T+3]=_,this.float32[T+4]=x,e}}Nc.prototype.bytesPerElement=20,ut(Nc,"StructArrayLayout4ui3f20");class kf extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}kf.prototype.bytesPerElement=1,ut(kf,"StructArrayLayout1ub1");class Km extends Zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Km.prototype.size=40;class Jm extends Pf{get(e){return new Km(this,e)}}ut(Jm,"CollisionBoxArray");class Qm extends Zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Qm.prototype.size=60;class eg extends xl{get(e){return new Qm(this,e)}}ut(eg,"PlacedSymbolArray");class tg extends Zu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}tg.prototype.size=80;class ng extends Ku{get(e){return new tg(this,e)}}ut(ng,"SymbolInstanceArray");class rg extends Rc{getoffsetX(e){return this.float32[1*e+0]}}ut(rg,"GlyphOffsetArray");class kc extends xo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ut(kc,"SymbolLineVertexArray");class ig extends Zu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ig.prototype.size=12;class og extends Lc{get(e){return new ig(this,e)}}ut(og,"FeatureIndexArray");class Fc extends No{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ut(Fc,"FillExtrusionCentroidArray");let z0=Rn([{name:"a_pos",components:2,type:"Int16"}],4),sg=Rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,o,c){let u=this.segments[this.segments.length-1];return e>yr.MAX_VERTEX_ARRAY_LENGTH&&_r(`Max vertices per segment is ${yr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>yr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:n,primitiveOffset:o,vertexLength:0,primitiveLength:0},c!==void 0&&(u.sortKey=c),this.segments.push(u)),u}prepareSegment(e,n,o,c){return this._prepareSegment(e,n.length,o.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new yr([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Ff(t,e){return 256*(t=Xt(Math.floor(t),0,255))+Xt(Math.floor(e),0,255)}yr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut(yr,"SegmentVector");let ag=Rn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lg=Rn([{name:"a_dash",components:4,type:"Uint16"}]);var zc={exports:{}},Ju={exports:{}};(function(t){t.exports=function(e,n){var o,c,u,f,_,x,b,T;for(c=e.length-(o=3&e.length),u=n,_=3432918353,x=461845907,T=0;T<c;)b=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,u=27492+(65535&(f=5*(65535&(u=(u^=b=(65535&(b=(b=(65535&b)*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*x+(((b>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,o){case 3:b^=(255&e.charCodeAt(T+2))<<16;case 2:b^=(255&e.charCodeAt(T+1))<<8;case 1:u^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(T)))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*x+(((b>>>16)*x&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}})(Ju);var zf=Ju.exports,cg={exports:{}};(function(t){t.exports=function(e,n){for(var o,c=e.length,u=n^c,f=0;c>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(o>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++f;switch(c){case 3:u^=(255&e.charCodeAt(f+2))<<16;case 2:u^=(255&e.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}})(cg);var ug=zf,hg=cg.exports;zc.exports=ug,zc.exports.murmur3=ug,zc.exports.murmur2=hg;var Bf=Zt(zc.exports);class Bc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(dg(e)),this.positions.push(n,o,c)}eachPosition(e,n){let o=dg(e),c=0,u=this.ids.length-1;for(;c<u;){let f=c+u>>1;this.ids[f]>=o?u=f:c=f+1}for(;this.ids[c]===o;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return jf(o,c,0,o.length-1),n&&(n.add(o.buffer),n.add(c.buffer)),{ids:o,positions:c}}static deserialize(e){let n=new Bc,o;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==o&&n.uniqueIds.push(c),o=c;return n.indexed=!0,n}}function dg(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Bf(String(t))}function jf(t,e,n,o){for(;n<o;){let c=t[n+o>>1],u=n-1,f=o+1;for(;;){do u++;while(t[u]<c);do f--;while(t[f]>c);if(u>=f)break;Qu(t,u,f),Qu(e,3*u,3*f),Qu(e,3*u+1,3*f+1),Qu(e,3*u+2,3*f+2)}f-n<o-f?(jf(t,e,n,f),n=f+1):(jf(t,e,f+1,o),o=f)}}function Qu(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}ut(Bc,"FeaturePositionMap");class Qo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class eh extends Qo{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class hi extends Qo{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class js extends Qo{constructor(e){super(e),this.current=[0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class fg extends Qo{constructor(e){super(e),this.current=[0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class h extends Qo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class r extends Qo{constructor(e){super(e),this.current=Mr.transparent}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let a=new Float32Array(16);class d extends Qo{constructor(e){super(e),this.current=a}set(e,n,o){if(this.fetchUniformLocation(e,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let g=new Float32Array(9),v=new Float32Array(4);class w extends Qo{constructor(e){super(e),this.current=v}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function E(t){return[Ff(255*t.r,255*t.g),Ff(255*t.b,255*t.a)]}class D{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o,c,u){n.set(e,u,c.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new r(e):new hi(e)}}class S{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,o,c,u){let f=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;f&&n.set(e,u,f)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new h(e):new hi(e)}}class A{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,u,f,_){let x=this.paintVertexArray.length,b=this.expression.evaluate(new ar(0,{brightness:f}),n,{},u,c,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,b)}updatePaintArray(e,n,o,c,u,f,_){let x=this.expression.evaluate({zoom:0,brightness:_},o,c,void 0,u);this._setPaintValue(e,n,x)}_setPaintValue(e,n,o){if(this.type==="color"){let c=E(o);for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class R{constructor(e,n,o,c,u,f){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,o,c,u,f,_){let x=this.expression.evaluate(new ar(this.zoom,{brightness:f}),n,{},u,c,_),b=this.expression.evaluate(new ar(this.zoom+1,{brightness:f}),n,{},u,c,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,x,b)}updatePaintArray(e,n,o,c,u,f,_){let x=this.expression.evaluate({zoom:this.zoom,brightness:_},o,c,void 0,u),b=this.expression.evaluate({zoom:this.zoom+1,brightness:_},o,c,void 0,u);this._setPaintValue(e,n,x,b)}_setPaintValue(e,n,o,c){if(this.type==="color"){let u=E(o),f=E(c);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,u[0],u[1],f[0],f[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,c,u){let f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,_=Xt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(e,u,_)}getBinding(e,n){return new hi(e)}}class k{constructor(e,n,o,c,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(o==="array"?lg:ag).members;for(let f=0;f<n.length;++f);this.paintVertexArray=new c}populatePaintArray(e,n,o){let c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,u,f,_){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,n,o,c){if(!c||!o)return;let u=c[o];if(!u)return;let{tl:f,br:_,pixelRatio:x}=u;for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,f[0],f[1],_[0],_[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class F{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];let c=[];for(let u in e.paint._values){let f=e.paint.get(u);if(!o(u)||!(f instanceof _l&&ju(f.property.specification)))continue;let _=G(u,e.type),x=f.value,b=f.property.specification.type,T=!!f.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),M=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||M)if(x.kind==="source"||M||I){let P=Q(u,b,"source");this.binders[u]=I?new k(x,_,b,P,e.id):new A(x,_,b,P),c.push(`/a_${u}`)}else{let P=Q(u,b,"composite");this.binders[u]=new R(x,_,b,T,n,P),c.push(`/z_${u}`)}else this.binders[u]=I?new S(x.value,_):new D(x.value,_,b),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof A||n instanceof R?n.maxValue:0}populatePaintArrays(e,n,o,c,u,f,_){for(let x in this.binders){let b=this.binders[x];(b instanceof A||b instanceof R||b instanceof k)&&b.populatePaintArray(e,n,o,c,u,f,_)}}setConstantPatternPositions(e){for(let n in this.binders){let o=this.binders[n];o instanceof S&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,n,o,c,u,f,_,x){let b=!1,T=Object.keys(e),I=T.length!==0,M=I?T:n.uniqueIds;for(let P in this.binders){let L=this.binders[P];if((L instanceof A||L instanceof R||L instanceof k)&&(L.expression.isStateDependent===!0||L.expression.isLightConstant===!1)){let N=u.paint.get(P);L.expression=N.value;for(let z of M){let V=e[z.toString()];n.eachPosition(z,(W,J,K)=>{let ie=c.feature(W);L.updatePaintArray(J,K,ie,V,f,_,x)})}if(!I)for(let z of o.uniqueIds){let V=e[z.toString()];o.eachPosition(z,(W,J,K)=>{let ie=c.feature(W);L.updatePaintArray(J,K,ie,V,f,_,x)})}b=!0}}return b}defines(){let e=[];for(let n in this.binders){let o=this.binders[n];(o instanceof D||o instanceof S)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof A||o instanceof R||o instanceof k)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof D||o instanceof S||o instanceof R)for(let c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let o in this.binders){let c=this.binders[o];if(c instanceof D||c instanceof S||c instanceof R)for(let u of c.uniformNames)n.push({name:u,property:o,binding:c.getBinding(e,u)})}return n}setUniforms(e,n,o,c,u){for(let{name:f,property:_,binding:x}of o)this.binders[_].setUniform(e,x,u,c.get(_),f)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof A||n instanceof R||n instanceof k)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let o=this.binders[n];(o instanceof A||o instanceof R||o instanceof k)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof A||n instanceof R||n instanceof k)&&n.destroy()}}}class ${constructor(e,n,o=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new F(c,n,o);this.needsUpload=!1,this._featureMap=new Bc,this._featureMapWithoutIds=new Bc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,o,c,u,f,_,x){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,n,c,u,f,_,x);n.id!==void 0?this._featureMap.add(n.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c,u,f){for(let _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,c,u,f||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let U={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function G(t,e){return U[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let B={"line-pattern":{source:zs,composite:zs},"fill-pattern":{source:zs,composite:zs},"fill-extrusion-pattern":{source:zs,composite:zs},"line-dasharray":{source:vl,composite:vl}},q={color:{source:Oc,composite:Fs},number:{source:Rc,composite:Oc}};function Q(t,e,n){let o=B[t];return o&&o[n]||q[e][n]}ut(D,"ConstantBinder"),ut(S,"PatternConstantBinder"),ut(A,"SourceExpressionBinder"),ut(k,"PatternCompositeBinder"),ut(R,"CompositeExpressionBinder"),ut(F,"ProgramConfiguration",{omit:["_buffers"]}),ut($,"ProgramConfigurationSet");let X=rt/Math.PI/2,ee=5,H=6,te=16383,oe=64,ae=[oe,32,16],ue=-X,xe=X;function fe(t,e,n,o=X){return n=an(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function De(t,e,n){return fe(Math.cos(an(t)),Math.sin(an(t)),e,n)}let Ee=63710088e-1,Be=2*Math.PI*Ee;class pe{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pe(xs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,o=this.lat*n,c=e.lat*n,u=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Ee*Math.acos(Math.min(u,1))}toBounds(e=0){let n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new we({lng:this.lng-o,lat:this.lat-n},{lng:this.lng+o,lat:this.lat+n})}toEcef(e){return De(this.lat,this.lng,X+e*X/Ee)}static convert(e){if(e instanceof pe)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new pe(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new pe(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class we{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof pe?new pe(e.lng,e.lat):pe.convert(e),this}setSouthWest(e){return this._sw=e instanceof pe?new pe(e.lng,e.lat):pe.convert(e),this}extend(e){let n=this._sw,o=this._ne,c,u;if(e instanceof pe)c=e,u=e;else{if(!(e instanceof we))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(we.convert(e)):this.extend(pe.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(pe.convert(e)):this;if(c=e._sw,u=e._ne,!c||!u)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new pe(c.lng,c.lat),this._ne=new pe(u.lng,u.lat)),this}getCenter(){return new pe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pe(this.getWest(),this.getNorth())}getSouthEast(){return new pe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=pe.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof we?e:new we(e)}}var ce={};(function(t,e){(function(n){function o(u,f,_){var x=c(256*u,256*(f=Math.pow(2,_)-f-1),_),b=c(256*(u+1),256*(f+1),_);return x[0]+","+x[1]+","+b[0]+","+b[1]}function c(u,f,_){var x=2*Math.PI*6378137/256/Math.pow(2,_);return[u*x-2*Math.PI*6378137/2,f*x-2*Math.PI*6378137/2]}n.getURL=function(u,f,_,x,b,T){return T=T||{},u+"?"+["bbox="+o(_,x,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+f].join("&")},n.getTileBBox=o,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,ce);var _e=ce;class je{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=et(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let o=_e.getTileBBox(this.x,this.y,this.z),c=function(u,f,_){let x,b="";for(let T=u;T>0;T--)x=1<<T-1,b+=(f&x?1:0)+(_&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class We{constructor(e,n){this.wrap=e,this.canonical=n,this.key=et(e,n.z,n.z,n.x,n.y)}}class qe{constructor(e,n,o,c,u){this.overscaledZ=e,this.wrap=n,this.canonical=new je(o,+c,+u),this.key=n===0&&e===o?this.canonical.key:et(n,e,o,c,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new qe(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qe(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return et(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return et(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new qe(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new qe(n,this.wrap,n,o,c),new qe(n,this.wrap,n,o+1,c),new qe(n,this.wrap,n,o,c+1),new qe(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new qe(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new qe(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new We(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function et(t,e,n,o,c){let u=1<<Math.min(n,22),f=u*(c%u)+o%u;return t&&n<22&&(f+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*f+n)+(e-n)}let ft=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new qe(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new qe(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new qe(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new qe(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ut(je,"CanonicalTileID"),ut(qe,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let wt=0,_t=25.5;function xt(t){return Be*Math.cos(t*Math.PI/180)}function Ut(t){return(180+t)/360}function Rt(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function zt(t,e){return t/xt(e)}function kt(t){return 360*t-180}function dn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Hn(t,e){return t*xt(dn(e))}let en=85.051129;function cr(t){return Math.cos(an(Xt(t,-en,en)))}function tn(t,e){let n=Xt(e,wt,_t),o=Math.pow(2,n);return cr(t)*Be/(512*o)}function yn(t){return 1/Math.cos(t*Math.PI/180)}function nn(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/rt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/rt/(1<<t.z)}class _n{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){let o=pe.convert(e);return new _n(Ut(o.lng),Rt(o.lat),zt(n,o.lat))}toLngLat(){return new pe(kt(this.x),dn(this.y))}toAltitude(){return Hn(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Be*yn(dn(this.y))}}function Zn(t,e,n,o,c,u,f,_,x){let b=(e+o)/2,T=(n+c)/2,I=new Ge(b,T);_(I),function(M,P,L,N,z,V){let W=L-z,J=N-V;return Math.abs((N-P)*W-(L-M)*J)/Math.hypot(W,J)}(I.x,I.y,u.x,u.y,f.x,f.y)>=x?(Zn(t,e,n,b,T,u,I,_,x),Zn(t,b,T,o,c,I,f,_,x)):t.push(f)}function En(t,e,n){let o=t[0],c=o.x,u=o.y;e(o);let f=[o];for(let _=1;_<t.length;_++){let x=t[_],{x:b,y:T}=x;e(x),Zn(f,c,u,b,T,o,x,e,n),c=b,u=T,o=x}return f}function Ur(t,e,n,o){if(o(e,n)){let c=e.add(n)._mult(.5);Ur(t,e,c,o),Ur(t,c,n,o)}else t.push(n)}function ti(t,e){let n=t[0],o=[n];for(let c=1;c<t.length;c++){let u=t[c];Ur(o,n,u,e),n=u}return o}let Ri=Math.pow(2,14)-1,ko=-Ri-1;function Li(t,e){let n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=Xt(n,ko,Ri),t.y=Xt(o,ko,Ri),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&_r("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function $r(t,e,n){let o=t.loadGeometry(),c=t.extent,u=rt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let f=1<<e.z,{scale:_,x,y:b,projection:T}=n,I=M=>{let P=kt((e.x+M.x/c)/f),L=dn((e.y+M.y/c)/f),N=T.project(P,L);M.x=(N.x*_-x)*c,M.y=(N.y*_-b)*c};for(let M=0;M<o.length;M++)if(t.type!==1)o[M]=En(o[M],I,1);else{let P=[];for(let L of o[M])L.x<0||L.x>=c||L.y<0||L.y>=c||(I(L),P.push(L));o[M]=P}}for(let f of o)for(let _ of f)Li(_,u);return o}function Lr(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?$r(t):[]}}function di(t,e,n,o,c){t.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}function bi(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Oi{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new xo,this.indexArray=new Vr,this.segments=new yr,this.programConfigurations=new $(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){let u=this.layers[0],f=[],_=null;u.type==="circle"&&(_=u.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:I,sourceLayerIndex:M}of e){let P=this.layers[0]._featureFilter.needGeometry,L=Lr(b,P);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),L,o))continue;let N=_?_.evaluate(L,{},o):void 0,z={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:I,geometry:P?L.geometry:$r(b,o,c),patterns:{},sortKey:N};f.push(z)}_&&f.sort((b,T)=>b.sortKey-T.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Xu,x=c.projection);for(let b of f){let{geometry:T,index:I,sourceLayerIndex:M}=b,P=e[I].feature;this.addFeature(b,T,I,n.availableImages,o,x,n.brightness),n.featureIndex.insert(P,T,I,M,this.index)}}update(e,n,o,c,u){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,z0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,sg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,c,u,f,_){for(let x of n)for(let b of x){let T=b.x,I=b.y;if(T<0||T>=rt||I<0||I>=rt)continue;if(f){let L=f.projectTilePoint(T,I,u),N=f.upVector(u,T,I),z=this.globeExtVertexArray;bi(z,L,N),bi(z,L,N),bi(z,L,N),bi(z,L,N)}let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=M.vertexLength;di(this.layoutVertexArray,T,I,-1,-1),di(this.layoutVertexArray,T,I,1,-1),di(this.layoutVertexArray,T,I,1,1),di(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,u,_)}}function Fo(t,e){for(let n=0;n<t.length;n++)if(es(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(es(t,e[n]))return!0;return!!Vc(t,e)}function Vs(t,e,n){return!!es(t,e)||!!Uc(e,t,n)}function Ea(t,e){if(t.length===1)return th(e,t[0]);for(let n=0;n<e.length;n++){let o=e[n];for(let c=0;c<o.length;c++)if(es(t,o[c]))return!0}for(let n=0;n<t.length;n++)if(th(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Vc(t,e[n]))return!0;return!1}function jc(t,e,n){if(t.length>1){if(Vc(t,e))return!0;for(let o=0;o<e.length;o++)if(Uc(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(Uc(t[o],e,n))return!0;return!1}function Vc(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let o=t[n],c=t[n+1];for(let u=0;u<e.length-1;u++)if(Vf(o,c,e[u],e[u+1]))return!0}return!1}function Vf(t,e,n,o){return Ji(t,n,o)!==Ji(e,n,o)&&Ji(t,e,n)!==Ji(t,e,o)}function Uc(t,e,n){let o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(bl(t,e[c-1],e[c])<o)return!0;return!1}function bl(t,e,n){let o=e.distSqr(n);if(o===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function th(t,e){let n,o,c,u=!1;for(let f=0;f<t.length;f++){n=t[f];for(let _=0,x=n.length-1;_<n.length;x=_++)o=n[_],c=n[x],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(u=!u)}return u}function es(t,e){let n=!1;for(let o=0,c=t.length-1;o<t.length;c=o++){let u=t[o],f=t[c];u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(n=!n)}return n}function Nw(t,e,n,o,c){for(let f of t)if(e<=f.x&&n<=f.y&&o>=f.x&&c>=f.y)return!0;let u=[new Ge(e,n),new Ge(e,c),new Ge(o,c),new Ge(o,n)];if(t.length>2){for(let f of u)if(es(t,f))return!0}for(let f=0;f<t.length-1;f++)if(iP(t[f],t[f+1],u))return!0;return!1}function iP(t,e,n){let o=n[0],c=n[2];if(t.x<o.x&&e.x<o.x||t.x>c.x&&e.x>c.x||t.y<o.y&&e.y<o.y||t.y>c.y&&e.y>c.y)return!1;let u=Ji(t,e,n[0]);return u!==Ji(t,e,n[1])||u!==Ji(t,e,n[2])||u!==Ji(t,e,n[3])}function nh(t,e,n,o,c,u){let f=e.y-t.y,_=t.x-e.x;if(u=u||0){let x=f*f+_*_;if(x===0)return!0;let b=Math.sqrt(x);f/=b,_/=b}return!((n.x-t.x)*f+(n.y-t.y)*_-u<0||(o.x-t.x)*f+(o.y-t.y)*_-u<0||(c.x-t.x)*f+(c.y-t.y)*_-u<0)}function B0(t,e,n,o,c,u,f){return!(nh(t,e,o,c,u,f)||nh(e,n,o,c,u,f)||nh(n,t,o,c,u,f)||nh(o,c,t,e,n,f)||nh(c,u,t,e,n,f)||nh(u,o,t,e,n,f))}function rh(t,e,n){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function pg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function kw(t,e,n,o,c){if(!e[0]&&!e[1])return t;let u=Ge.convert(e)._mult(c);n==="viewport"&&u._rotate(-o);let f=[];for(let _=0;_<t.length;_++)f.push(t[_].sub(u));return f}function Fw(t,e,n,o){let c=Ge.convert(t)._mult(o);return e==="viewport"&&c._rotate(-n),c}ut(Oi,"CircleBucket",{omit:["layers"]});let oP=new lr({"circle-sort-key":new Et(ye.layout_circle["circle-sort-key"]),visibility:new Xe(ye.layout_circle.visibility)});var sP={paint:new lr({"circle-radius":new Et(ye.paint_circle["circle-radius"]),"circle-color":new Et(ye.paint_circle["circle-color"]),"circle-blur":new Et(ye.paint_circle["circle-blur"]),"circle-opacity":new Et(ye.paint_circle["circle-opacity"]),"circle-translate":new Xe(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Xe(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xe(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xe(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Et(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Et(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Et(ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xe(ye.paint_circle["circle-emissive-strength"])}),layout:oP},qr={},Wr={};Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.setMatrixArrayType=function(t){Wr.ARRAY_TYPE=Bw=t},Wr.toRadian=function(t){return t*lP},Wr.equals=function(t,e){return Math.abs(t-e)<=zw*Math.max(1,Math.abs(t),Math.abs(e))},Wr.RANDOM=Wr.ARRAY_TYPE=Wr.EPSILON=void 0;var zw=1e-6;Wr.EPSILON=zw;var Bw=typeof Float32Array<"u"?Float32Array:Array;Wr.ARRAY_TYPE=Bw;var aP=Math.random;Wr.RANDOM=aP;var lP=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ur={};function j0(t){return j0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j0(t)}Object.defineProperty(ur,"__esModule",{value:!0}),ur.create=function(){var t=new wl.ARRAY_TYPE(4);return wl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},ur.clone=function(t){var e=new wl.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ur.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ur.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},ur.fromValues=function(t,e,n,o){var c=new wl.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c},ur.set=function(t,e,n,o,c){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t},ur.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},ur.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=n*u-c*o;return f?(t[0]=u*(f=1/f),t[1]=-o*f,t[2]=-c*f,t[3]=n*f,t):null},ur.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},ur.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},ur.multiply=Vw,ur.rotate=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x+u*_,t[1]=c*x+f*_,t[2]=o*-_+u*x,t[3]=c*-_+f*x,t},ur.scale=function(t,e,n){var o=e[1],c=e[2],u=e[3],f=n[0],_=n[1];return t[0]=e[0]*f,t[1]=o*f,t[2]=c*_,t[3]=u*_,t},ur.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t},ur.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},ur.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ur.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},ur.LDU=function(t,e,n,o){return t[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-t[2]*n[1],[t,e,n]},ur.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},ur.subtract=Uw,ur.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ur.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],f=e[0],_=e[1],x=e[2],b=e[3];return Math.abs(n-f)<=wl.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-_)<=wl.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-x)<=wl.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-b)<=wl.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},ur.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},ur.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},ur.sub=ur.mul=void 0;var wl=function(t,e){if(t&&t.__esModule)return t;if(t===null||j0(t)!=="object"&&typeof t!="function")return{default:t};var n=jw(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function jw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(jw=function(o){return o?n:e})(t)}function Vw(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=n[0],x=n[1],b=n[2],T=n[3];return t[0]=o*_+u*x,t[1]=c*_+f*x,t[2]=o*b+u*T,t[3]=c*b+f*T,t}function Uw(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}ur.mul=Vw,ur.sub=Uw;var pr={};function V0(t){return V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V0(t)}Object.defineProperty(pr,"__esModule",{value:!0}),pr.create=function(){var t=new Us.ARRAY_TYPE(6);return Us.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},pr.clone=function(t){var e=new Us.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},pr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},pr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},pr.fromValues=function(t,e,n,o,c,u){var f=new Us.ARRAY_TYPE(6);return f[0]=t,f[1]=e,f[2]=n,f[3]=o,f[4]=c,f[5]=u,f},pr.set=function(t,e,n,o,c,u,f){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=f,t},pr.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=n*u-o*c;return x?(t[0]=u*(x=1/x),t[1]=-o*x,t[2]=-c*x,t[3]=n*x,t[4]=(c*_-u*f)*x,t[5]=(o*f-n*_)*x,t):null},pr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},pr.multiply=Gw,pr.rotate=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=Math.sin(n),T=Math.cos(n);return t[0]=o*T+u*b,t[1]=c*T+f*b,t[2]=o*-b+u*T,t[3]=c*-b+f*T,t[4]=_,t[5]=x,t},pr.scale=function(t,e,n){var o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=n[0],b=n[1];return t[0]=e[0]*x,t[1]=o*x,t[2]=c*b,t[3]=u*b,t[4]=f,t[5]=_,t},pr.translate=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=n[0],T=n[1];return t[0]=o,t[1]=c,t[2]=u,t[3]=f,t[4]=o*b+u*T+_,t[5]=c*b+f*T+x,t},pr.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t[4]=0,t[5]=0,t},pr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},pr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},pr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},pr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},pr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},pr.subtract=Hw,pr.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},pr.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t},pr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},pr.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],f=t[4],_=t[5],x=e[0],b=e[1],T=e[2],I=e[3],M=e[4],P=e[5];return Math.abs(n-x)<=Us.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(o-b)<=Us.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-T)<=Us.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-I)<=Us.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(f-M)<=Us.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(_-P)<=Us.EPSILON*Math.max(1,Math.abs(_),Math.abs(P))},pr.sub=pr.mul=void 0;var Us=function(t,e){if(t&&t.__esModule)return t;if(t===null||V0(t)!=="object"&&typeof t!="function")return{default:t};var n=$w(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function $w(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return($w=function(o){return o?n:e})(t)}function Gw(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=n[0],T=n[1],I=n[2],M=n[3],P=n[4],L=n[5];return t[0]=o*b+u*T,t[1]=c*b+f*T,t[2]=o*I+u*M,t[3]=c*I+f*M,t[4]=o*P+u*L+_,t[5]=c*P+f*L+x,t}function Hw(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}pr.mul=Gw,pr.sub=Hw;var $n={};function U0(t){return U0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U0(t)}Object.defineProperty($n,"__esModule",{value:!0}),$n.create=function(){var t=new bo.ARRAY_TYPE(9);return bo.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},$n.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},$n.clone=function(t){var e=new bo.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},$n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},$n.fromValues=function(t,e,n,o,c,u,f,_,x){var b=new bo.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=n,b[3]=o,b[4]=c,b[5]=u,b[6]=f,b[7]=_,b[8]=x,b},$n.set=function(t,e,n,o,c,u,f,_,x,b){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=f,t[6]=_,t[7]=x,t[8]=b,t},$n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},$n.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},$n.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8],I=T*f-_*b,M=-T*u+_*x,P=b*u-f*x,L=n*I+o*M+c*P;return L?(t[0]=I*(L=1/L),t[1]=(-T*o+c*b)*L,t[2]=(_*o-c*f)*L,t[3]=M*L,t[4]=(T*n-c*x)*L,t[5]=(-_*n+c*u)*L,t[6]=P*L,t[7]=(-b*n+o*x)*L,t[8]=(f*n-o*u)*L,t):null},$n.adjoint=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8];return t[0]=f*T-_*b,t[1]=c*b-o*T,t[2]=o*_-c*f,t[3]=_*x-u*T,t[4]=n*T-c*x,t[5]=c*u-n*_,t[6]=u*b-f*x,t[7]=o*x-n*b,t[8]=n*f-o*u,t},$n.determinant=function(t){var e=t[3],n=t[4],o=t[5],c=t[6],u=t[7],f=t[8];return t[0]*(f*n-o*u)+t[1]*(-f*e+o*c)+t[2]*(u*e-n*c)},$n.multiply=Ww,$n.translate=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=n[0],P=n[1];return t[0]=o,t[1]=c,t[2]=u,t[3]=f,t[4]=_,t[5]=x,t[6]=M*o+P*f+b,t[7]=M*c+P*_+T,t[8]=M*u+P*x+I,t},$n.rotate=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=Math.sin(n),P=Math.cos(n);return t[0]=P*o+M*f,t[1]=P*c+M*_,t[2]=P*u+M*x,t[3]=P*f-M*o,t[4]=P*_-M*c,t[5]=P*x-M*u,t[6]=b,t[7]=T,t[8]=I,t},$n.scale=function(t,e,n){var o=n[0],c=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},$n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},$n.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},$n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},$n.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},$n.fromQuat=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=n+n,_=o+o,x=c+c,b=n*f,T=o*f,I=o*_,M=c*f,P=c*_,L=c*x,N=u*f,z=u*_,V=u*x;return t[0]=1-I-L,t[3]=T-V,t[6]=M+z,t[1]=T+V,t[4]=1-b-L,t[7]=P-N,t[2]=M-z,t[5]=P+N,t[8]=1-b-I,t},$n.normalFromMat4=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8],I=e[9],M=e[10],P=e[11],L=e[12],N=e[13],z=e[14],V=e[15],W=n*_-o*f,J=n*x-c*f,K=n*b-u*f,ie=o*x-c*_,ne=o*b-u*_,le=c*b-u*x,de=T*N-I*L,me=T*z-M*L,be=T*V-P*L,ge=I*z-M*N,Me=I*V-P*N,Ne=M*V-P*z,Ie=W*Ne-J*Me+K*ge+ie*be-ne*me+le*de;return Ie?(t[0]=(_*Ne-x*Me+b*ge)*(Ie=1/Ie),t[1]=(x*be-f*Ne-b*me)*Ie,t[2]=(f*Me-_*be+b*de)*Ie,t[3]=(c*Me-o*Ne-u*ge)*Ie,t[4]=(n*Ne-c*be+u*me)*Ie,t[5]=(o*be-n*Me-u*de)*Ie,t[6]=(N*le-z*ne+V*ie)*Ie,t[7]=(z*K-L*le-V*J)*Ie,t[8]=(L*ne-N*K+V*W)*Ie,t):null},$n.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},$n.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},$n.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},$n.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},$n.subtract=Zw,$n.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},$n.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t},$n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},$n.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],f=t[4],_=t[5],x=t[6],b=t[7],T=t[8],I=e[0],M=e[1],P=e[2],L=e[3],N=e[4],z=e[5],V=e[6],W=e[7],J=e[8];return Math.abs(n-I)<=bo.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(o-M)<=bo.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(c-P)<=bo.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(u-L)<=bo.EPSILON*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(f-N)<=bo.EPSILON*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(_-z)<=bo.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(x-V)<=bo.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(b-W)<=bo.EPSILON*Math.max(1,Math.abs(b),Math.abs(W))&&Math.abs(T-J)<=bo.EPSILON*Math.max(1,Math.abs(T),Math.abs(J))},$n.sub=$n.mul=void 0;var bo=function(t,e){if(t&&t.__esModule)return t;if(t===null||U0(t)!=="object"&&typeof t!="function")return{default:t};var n=qw(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function qw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(qw=function(o){return o?n:e})(t)}function Ww(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=n[0],P=n[1],L=n[2],N=n[3],z=n[4],V=n[5],W=n[6],J=n[7],K=n[8];return t[0]=M*o+P*f+L*b,t[1]=M*c+P*_+L*T,t[2]=M*u+P*x+L*I,t[3]=N*o+z*f+V*b,t[4]=N*c+z*_+V*T,t[5]=N*u+z*x+V*I,t[6]=W*o+J*f+K*b,t[7]=W*c+J*_+K*T,t[8]=W*u+J*x+K*I,t}function Zw(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}$n.mul=Ww,$n.sub=Zw;var Gt={};function $0(t){return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$0(t)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var t=new xr.ARRAY_TYPE(16);return xr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Gt.clone=function(t){var e=new xr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Gt.fromValues=function(t,e,n,o,c,u,f,_,x,b,T,I,M,P,L,N){var z=new xr.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=n,z[3]=o,z[4]=c,z[5]=u,z[6]=f,z[7]=_,z[8]=x,z[9]=b,z[10]=T,z[11]=I,z[12]=M,z[13]=P,z[14]=L,z[15]=N,z},Gt.set=function(t,e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=f,t[6]=_,t[7]=x,t[8]=b,t[9]=T,t[10]=I,t[11]=M,t[12]=P,t[13]=L,t[14]=N,t[15]=z,t},Gt.identity=Yw,Gt.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],c=e[3],u=e[6],f=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=u,t[11]=e[14],t[12]=c,t[13]=f,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Gt.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8],I=e[9],M=e[10],P=e[11],L=e[12],N=e[13],z=e[14],V=e[15],W=n*_-o*f,J=n*x-c*f,K=n*b-u*f,ie=o*x-c*_,ne=o*b-u*_,le=c*b-u*x,de=T*N-I*L,me=T*z-M*L,be=T*V-P*L,ge=I*z-M*N,Me=I*V-P*N,Ne=M*V-P*z,Ie=W*Ne-J*Me+K*ge+ie*be-ne*me+le*de;return Ie?(t[0]=(_*Ne-x*Me+b*ge)*(Ie=1/Ie),t[1]=(c*Me-o*Ne-u*ge)*Ie,t[2]=(N*le-z*ne+V*ie)*Ie,t[3]=(M*ne-I*le-P*ie)*Ie,t[4]=(x*be-f*Ne-b*me)*Ie,t[5]=(n*Ne-c*be+u*me)*Ie,t[6]=(z*K-L*le-V*J)*Ie,t[7]=(T*le-M*K+P*J)*Ie,t[8]=(f*Me-_*be+b*de)*Ie,t[9]=(o*be-n*Me-u*de)*Ie,t[10]=(L*ne-N*K+V*W)*Ie,t[11]=(I*K-T*ne-P*W)*Ie,t[12]=(_*me-f*ge-x*de)*Ie,t[13]=(n*ge-o*me+c*de)*Ie,t[14]=(N*J-L*ie-z*W)*Ie,t[15]=(T*ie-I*J+M*W)*Ie,t):null},Gt.adjoint=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=e[4],_=e[5],x=e[6],b=e[7],T=e[8],I=e[9],M=e[10],P=e[11],L=e[12],N=e[13],z=e[14],V=e[15];return t[0]=_*(M*V-P*z)-I*(x*V-b*z)+N*(x*P-b*M),t[1]=-(o*(M*V-P*z)-I*(c*V-u*z)+N*(c*P-u*M)),t[2]=o*(x*V-b*z)-_*(c*V-u*z)+N*(c*b-u*x),t[3]=-(o*(x*P-b*M)-_*(c*P-u*M)+I*(c*b-u*x)),t[4]=-(f*(M*V-P*z)-T*(x*V-b*z)+L*(x*P-b*M)),t[5]=n*(M*V-P*z)-T*(c*V-u*z)+L*(c*P-u*M),t[6]=-(n*(x*V-b*z)-f*(c*V-u*z)+L*(c*b-u*x)),t[7]=n*(x*P-b*M)-f*(c*P-u*M)+T*(c*b-u*x),t[8]=f*(I*V-P*N)-T*(_*V-b*N)+L*(_*P-b*I),t[9]=-(n*(I*V-P*N)-T*(o*V-u*N)+L*(o*P-u*I)),t[10]=n*(_*V-b*N)-f*(o*V-u*N)+L*(o*b-u*_),t[11]=-(n*(_*P-b*I)-f*(o*P-u*I)+T*(o*b-u*_)),t[12]=-(f*(I*z-M*N)-T*(_*z-x*N)+L*(_*M-x*I)),t[13]=n*(I*z-M*N)-T*(o*z-c*N)+L*(o*M-c*I),t[14]=-(n*(_*z-x*N)-f*(o*z-c*N)+L*(o*x-c*_)),t[15]=n*(_*M-x*I)-f*(o*M-c*I)+T*(o*x-c*_),t},Gt.determinant=function(t){var e=t[0],n=t[1],o=t[2],c=t[3],u=t[4],f=t[5],_=t[6],x=t[7],b=t[8],T=t[9],I=t[10],M=t[11],P=t[12],L=t[13],N=t[14],z=t[15];return(e*f-n*u)*(I*z-M*N)-(e*_-o*u)*(T*z-M*L)+(e*x-c*u)*(T*N-I*L)+(n*_-o*f)*(b*z-M*P)-(n*x-c*f)*(b*N-I*P)+(o*x-c*_)*(b*L-T*P)},Gt.multiply=Kw,Gt.translate=function(t,e,n){var o,c,u,f,_,x,b,T,I,M,P,L,N=n[0],z=n[1],V=n[2];return e===t?(t[12]=e[0]*N+e[4]*z+e[8]*V+e[12],t[13]=e[1]*N+e[5]*z+e[9]*V+e[13],t[14]=e[2]*N+e[6]*z+e[10]*V+e[14],t[15]=e[3]*N+e[7]*z+e[11]*V+e[15]):(c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=e[9],P=e[10],L=e[11],t[0]=o=e[0],t[1]=c,t[2]=u,t[3]=f,t[4]=_,t[5]=x,t[6]=b,t[7]=T,t[8]=I,t[9]=M,t[10]=P,t[11]=L,t[12]=o*N+_*z+I*V+e[12],t[13]=c*N+x*z+M*V+e[13],t[14]=u*N+b*z+P*V+e[14],t[15]=f*N+T*z+L*V+e[15]),t},Gt.scale=function(t,e,n){var o=n[0],c=n[1],u=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Gt.rotate=function(t,e,n,o){var c,u,f,_,x,b,T,I,M,P,L,N,z,V,W,J,K,ie,ne,le,de,me,be,ge,Me=o[0],Ne=o[1],Ie=o[2],Le=Math.hypot(Me,Ne,Ie);return Le<xr.EPSILON?null:(Me*=Le=1/Le,Ne*=Le,Ie*=Le,c=Math.sin(n),u=Math.cos(n),x=e[1],b=e[2],T=e[3],M=e[5],P=e[6],L=e[7],z=e[9],V=e[10],W=e[11],J=Me*Me*(f=1-u)+u,ne=Me*Ne*f-Ie*c,le=Ne*Ne*f+u,de=Ie*Ne*f+Me*c,me=Me*Ie*f+Ne*c,be=Ne*Ie*f-Me*c,ge=Ie*Ie*f+u,t[0]=(_=e[0])*J+(I=e[4])*(K=Ne*Me*f+Ie*c)+(N=e[8])*(ie=Ie*Me*f-Ne*c),t[1]=x*J+M*K+z*ie,t[2]=b*J+P*K+V*ie,t[3]=T*J+L*K+W*ie,t[4]=_*ne+I*le+N*de,t[5]=x*ne+M*le+z*de,t[6]=b*ne+P*le+V*de,t[7]=T*ne+L*le+W*de,t[8]=_*me+I*be+N*ge,t[9]=x*me+M*be+z*ge,t[10]=b*me+P*be+V*ge,t[11]=T*me+L*be+W*ge,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Gt.rotateX=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),u=e[4],f=e[5],_=e[6],x=e[7],b=e[8],T=e[9],I=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*c+b*o,t[5]=f*c+T*o,t[6]=_*c+I*o,t[7]=x*c+M*o,t[8]=b*c-u*o,t[9]=T*c-f*o,t[10]=I*c-_*o,t[11]=M*c-x*o,t},Gt.rotateY=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),u=e[0],f=e[1],_=e[2],x=e[3],b=e[8],T=e[9],I=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c-b*o,t[1]=f*c-T*o,t[2]=_*c-I*o,t[3]=x*c-M*o,t[8]=u*o+b*c,t[9]=f*o+T*c,t[10]=_*o+I*c,t[11]=x*o+M*c,t},Gt.rotateZ=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),u=e[0],f=e[1],_=e[2],x=e[3],b=e[4],T=e[5],I=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c+b*o,t[1]=f*c+T*o,t[2]=_*c+I*o,t[3]=x*c+M*o,t[4]=b*c-u*o,t[5]=T*c-f*o,t[6]=I*c-_*o,t[7]=M*c-x*o,t},Gt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Gt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromRotation=function(t,e,n){var o,c,u,f=n[0],_=n[1],x=n[2],b=Math.hypot(f,_,x);return b<xr.EPSILON?null:(f*=b=1/b,_*=b,x*=b,o=Math.sin(e),c=Math.cos(e),t[0]=f*f*(u=1-c)+c,t[1]=_*f*u+x*o,t[2]=x*f*u-_*o,t[3]=0,t[4]=f*_*u-x*o,t[5]=_*_*u+c,t[6]=x*_*u+f*o,t[7]=0,t[8]=f*x*u+_*o,t[9]=_*x*u-f*o,t[10]=x*x*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Gt.fromXRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromYRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromZRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.fromRotationTranslation=Jw,Gt.fromQuat2=function(t,e){var n=new xr.ARRAY_TYPE(3),o=-e[0],c=-e[1],u=-e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=o*o+c*c+u*u+f*f;return I>0?(n[0]=2*(_*f+T*o+x*u-b*c)/I,n[1]=2*(x*f+T*c+b*o-_*u)/I,n[2]=2*(b*f+T*u+_*c-x*o)/I):(n[0]=2*(_*f+T*o+x*u-b*c),n[1]=2*(x*f+T*c+b*o-_*u),n[2]=2*(b*f+T*u+_*c-x*o)),Jw(t,e,n),t},Gt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Gt.getScaling=Qw,Gt.getRotation=function(t,e){var n=new xr.ARRAY_TYPE(3);Qw(n,e);var o=1/n[0],c=1/n[1],u=1/n[2],f=e[0]*o,_=e[1]*c,x=e[2]*u,b=e[4]*o,T=e[5]*c,I=e[6]*u,M=e[8]*o,P=e[9]*c,L=e[10]*u,N=f+T+L,z=0;return N>0?(z=2*Math.sqrt(N+1),t[3]=.25*z,t[0]=(I-P)/z,t[1]=(M-x)/z,t[2]=(_-b)/z):f>T&&f>L?(z=2*Math.sqrt(1+f-T-L),t[3]=(I-P)/z,t[0]=.25*z,t[1]=(_+b)/z,t[2]=(M+x)/z):T>L?(z=2*Math.sqrt(1+T-f-L),t[3]=(M-x)/z,t[0]=(_+b)/z,t[1]=.25*z,t[2]=(I+P)/z):(z=2*Math.sqrt(1+L-f-T),t[3]=(_-b)/z,t[0]=(M+x)/z,t[1]=(I+P)/z,t[2]=.25*z),t},Gt.fromRotationTranslationScale=function(t,e,n,o){var c=e[0],u=e[1],f=e[2],_=e[3],x=c+c,b=u+u,T=f+f,I=c*x,M=c*b,P=c*T,L=u*b,N=u*T,z=f*T,V=_*x,W=_*b,J=_*T,K=o[0],ie=o[1],ne=o[2];return t[0]=(1-(L+z))*K,t[1]=(M+J)*K,t[2]=(P-W)*K,t[3]=0,t[4]=(M-J)*ie,t[5]=(1-(I+z))*ie,t[6]=(N+V)*ie,t[7]=0,t[8]=(P+W)*ne,t[9]=(N-V)*ne,t[10]=(1-(I+L))*ne,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Gt.fromRotationTranslationScaleOrigin=function(t,e,n,o,c){var u=e[0],f=e[1],_=e[2],x=e[3],b=u+u,T=f+f,I=_+_,M=u*b,P=u*T,L=u*I,N=f*T,z=f*I,V=_*I,W=x*b,J=x*T,K=x*I,ie=o[0],ne=o[1],le=o[2],de=c[0],me=c[1],be=c[2],ge=(1-(N+V))*ie,Me=(P+K)*ie,Ne=(L-J)*ie,Ie=(P-K)*ne,Le=(1-(M+V))*ne,Te=(z+W)*ne,Re=(L+J)*le,Ke=(z-W)*le,Fe=(1-(M+N))*le;return t[0]=ge,t[1]=Me,t[2]=Ne,t[3]=0,t[4]=Ie,t[5]=Le,t[6]=Te,t[7]=0,t[8]=Re,t[9]=Ke,t[10]=Fe,t[11]=0,t[12]=n[0]+de-(ge*de+Ie*me+Re*be),t[13]=n[1]+me-(Me*de+Le*me+Ke*be),t[14]=n[2]+be-(Ne*de+Te*me+Fe*be),t[15]=1,t},Gt.fromQuat=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=n+n,_=o+o,x=c+c,b=n*f,T=o*f,I=o*_,M=c*f,P=c*_,L=c*x,N=u*f,z=u*_,V=u*x;return t[0]=1-I-L,t[1]=T+V,t[2]=M-z,t[3]=0,t[4]=T-V,t[5]=1-b-L,t[6]=P+N,t[7]=0,t[8]=M+z,t[9]=P-N,t[10]=1-b-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Gt.frustum=function(t,e,n,o,c,u,f){var _=1/(n-e),x=1/(c-o),b=1/(u-f);return t[0]=2*u*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*x,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(c+o)*x,t[10]=(f+u)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*u*2*b,t[15]=0,t},Gt.perspectiveNO=eT,Gt.perspectiveZO=function(t,e,n,o,c){var u,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(u=1/(o-c)),t[14]=c*o*u):(t[10]=-1,t[14]=-o),t},Gt.perspectiveFromFieldOfView=function(t,e,n,o){var c=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),f=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),x=2/(f+_),b=2/(c+u);return t[0]=x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(f-_)*x*.5,t[9]=(c-u)*b*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t},Gt.orthoNO=tT,Gt.orthoZO=function(t,e,n,o,c,u,f){var _=1/(e-n),x=1/(o-c),b=1/(u-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+n)*_,t[13]=(c+o)*x,t[14]=u*b,t[15]=1,t},Gt.lookAt=function(t,e,n,o){var c,u,f,_,x,b,T,I,M,P,L=e[0],N=e[1],z=e[2],V=o[0],W=o[1],J=o[2],K=n[0],ie=n[1],ne=n[2];return Math.abs(L-K)<xr.EPSILON&&Math.abs(N-ie)<xr.EPSILON&&Math.abs(z-ne)<xr.EPSILON?Yw(t):(T=L-K,I=N-ie,M=z-ne,c=W*(M*=P=1/Math.hypot(T,I,M))-J*(I*=P),u=J*(T*=P)-V*M,f=V*I-W*T,(P=Math.hypot(c,u,f))?(c*=P=1/P,u*=P,f*=P):(c=0,u=0,f=0),_=I*f-M*u,x=M*c-T*f,b=T*u-I*c,(P=Math.hypot(_,x,b))?(_*=P=1/P,x*=P,b*=P):(_=0,x=0,b=0),t[0]=c,t[1]=_,t[2]=T,t[3]=0,t[4]=u,t[5]=x,t[6]=I,t[7]=0,t[8]=f,t[9]=b,t[10]=M,t[11]=0,t[12]=-(c*L+u*N+f*z),t[13]=-(_*L+x*N+b*z),t[14]=-(T*L+I*N+M*z),t[15]=1,t)},Gt.targetTo=function(t,e,n,o){var c=e[0],u=e[1],f=e[2],_=o[0],x=o[1],b=o[2],T=c-n[0],I=u-n[1],M=f-n[2],P=T*T+I*I+M*M;P>0&&(T*=P=1/Math.sqrt(P),I*=P,M*=P);var L=x*M-b*I,N=b*T-_*M,z=_*I-x*T;return(P=L*L+N*N+z*z)>0&&(L*=P=1/Math.sqrt(P),N*=P,z*=P),t[0]=L,t[1]=N,t[2]=z,t[3]=0,t[4]=I*z-M*N,t[5]=M*L-T*z,t[6]=T*N-I*L,t[7]=0,t[8]=T,t[9]=I,t[10]=M,t[11]=0,t[12]=c,t[13]=u,t[14]=f,t[15]=1,t},Gt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Gt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Gt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Gt.subtract=nT,Gt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Gt.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t},Gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Gt.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],f=t[4],_=t[5],x=t[6],b=t[7],T=t[8],I=t[9],M=t[10],P=t[11],L=t[12],N=t[13],z=t[14],V=t[15],W=e[0],J=e[1],K=e[2],ie=e[3],ne=e[4],le=e[5],de=e[6],me=e[7],be=e[8],ge=e[9],Me=e[10],Ne=e[11],Ie=e[12],Le=e[13],Te=e[14],Re=e[15];return Math.abs(n-W)<=xr.EPSILON*Math.max(1,Math.abs(n),Math.abs(W))&&Math.abs(o-J)<=xr.EPSILON*Math.max(1,Math.abs(o),Math.abs(J))&&Math.abs(c-K)<=xr.EPSILON*Math.max(1,Math.abs(c),Math.abs(K))&&Math.abs(u-ie)<=xr.EPSILON*Math.max(1,Math.abs(u),Math.abs(ie))&&Math.abs(f-ne)<=xr.EPSILON*Math.max(1,Math.abs(f),Math.abs(ne))&&Math.abs(_-le)<=xr.EPSILON*Math.max(1,Math.abs(_),Math.abs(le))&&Math.abs(x-de)<=xr.EPSILON*Math.max(1,Math.abs(x),Math.abs(de))&&Math.abs(b-me)<=xr.EPSILON*Math.max(1,Math.abs(b),Math.abs(me))&&Math.abs(T-be)<=xr.EPSILON*Math.max(1,Math.abs(T),Math.abs(be))&&Math.abs(I-ge)<=xr.EPSILON*Math.max(1,Math.abs(I),Math.abs(ge))&&Math.abs(M-Me)<=xr.EPSILON*Math.max(1,Math.abs(M),Math.abs(Me))&&Math.abs(P-Ne)<=xr.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ne))&&Math.abs(L-Ie)<=xr.EPSILON*Math.max(1,Math.abs(L),Math.abs(Ie))&&Math.abs(N-Le)<=xr.EPSILON*Math.max(1,Math.abs(N),Math.abs(Le))&&Math.abs(z-Te)<=xr.EPSILON*Math.max(1,Math.abs(z),Math.abs(Te))&&Math.abs(V-Re)<=xr.EPSILON*Math.max(1,Math.abs(V),Math.abs(Re))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var xr=function(t,e){if(t&&t.__esModule)return t;if(t===null||$0(t)!=="object"&&typeof t!="function")return{default:t};var n=Xw(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function Xw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Xw=function(o){return o?n:e})(t)}function Yw(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kw(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=e[9],P=e[10],L=e[11],N=e[12],z=e[13],V=e[14],W=e[15],J=n[0],K=n[1],ie=n[2],ne=n[3];return t[0]=J*o+K*_+ie*I+ne*N,t[1]=J*c+K*x+ie*M+ne*z,t[2]=J*u+K*b+ie*P+ne*V,t[3]=J*f+K*T+ie*L+ne*W,t[4]=(J=n[4])*o+(K=n[5])*_+(ie=n[6])*I+(ne=n[7])*N,t[5]=J*c+K*x+ie*M+ne*z,t[6]=J*u+K*b+ie*P+ne*V,t[7]=J*f+K*T+ie*L+ne*W,t[8]=(J=n[8])*o+(K=n[9])*_+(ie=n[10])*I+(ne=n[11])*N,t[9]=J*c+K*x+ie*M+ne*z,t[10]=J*u+K*b+ie*P+ne*V,t[11]=J*f+K*T+ie*L+ne*W,t[12]=(J=n[12])*o+(K=n[13])*_+(ie=n[14])*I+(ne=n[15])*N,t[13]=J*c+K*x+ie*M+ne*z,t[14]=J*u+K*b+ie*P+ne*V,t[15]=J*f+K*T+ie*L+ne*W,t}function Jw(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=o+o,x=c+c,b=u+u,T=o*_,I=o*x,M=o*b,P=c*x,L=c*b,N=u*b,z=f*_,V=f*x,W=f*b;return t[0]=1-(P+N),t[1]=I+W,t[2]=M-V,t[3]=0,t[4]=I-W,t[5]=1-(T+N),t[6]=L+z,t[7]=0,t[8]=M+V,t[9]=L-z,t[10]=1-(T+P),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Qw(t,e){var n=e[4],o=e[5],c=e[6],u=e[8],f=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,o,c),t[2]=Math.hypot(u,f,_),t}function eT(t,e,n,o,c){var u,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+o)*(u=1/(o-c)),t[14]=2*c*o*u):(t[10]=-1,t[14]=-2*o),t}function tT(t,e,n,o,c,u,f){var _=1/(e-n),x=1/(o-c),b=1/(u-f);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*_,t[13]=(c+o)*x,t[14]=(f+u)*b,t[15]=1,t}function nT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Gt.perspective=eT,Gt.ortho=tT,Gt.mul=Kw,Gt.sub=nT;var jt={},$t={};function G0(t){return G0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G0(t)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=iT,$t.clone=function(t){var e=new Ia.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},$t.length=oT,$t.fromValues=function(t,e,n){var o=new Ia.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},$t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},$t.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},$t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},$t.subtract=sT,$t.multiply=aT,$t.divide=lT,$t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},$t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},$t.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},$t.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},$t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},$t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},$t.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t},$t.distance=cT,$t.squaredDistance=uT,$t.squaredLength=hT,$t.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},$t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},$t.normalize=function(t,e){var n=e[0],o=e[1],c=e[2],u=n*n+o*o+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},$t.dot=dT,$t.cross=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=n[0],_=n[1],x=n[2];return t[0]=c*x-u*_,t[1]=u*f-o*x,t[2]=o*_-c*f,t},$t.lerp=function(t,e,n,o){var c=e[0],u=e[1],f=e[2];return t[0]=c+o*(n[0]-c),t[1]=u+o*(n[1]-u),t[2]=f+o*(n[2]-f),t},$t.hermite=function(t,e,n,o,c,u){var f=u*u,_=f*(2*u-3)+1,x=f*(u-2)+u,b=f*(u-1),T=f*(3-2*u);return t[0]=e[0]*_+n[0]*x+o[0]*b+c[0]*T,t[1]=e[1]*_+n[1]*x+o[1]*b+c[1]*T,t[2]=e[2]*_+n[2]*x+o[2]*b+c[2]*T,t},$t.bezier=function(t,e,n,o,c,u){var f=1-u,_=f*f,x=u*u,b=_*f,T=3*u*_,I=3*x*f,M=x*u;return t[0]=e[0]*b+n[0]*T+o[0]*I+c[0]*M,t[1]=e[1]*b+n[1]*T+o[1]*I+c[1]*M,t[2]=e[2]*b+n[2]*T+o[2]*I+c[2]*M,t},$t.random=function(t,e){e=e||1;var n=2*Ia.RANDOM()*Math.PI,o=2*Ia.RANDOM()-1,c=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=o*e,t},$t.transformMat4=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=n[3]*o+n[7]*c+n[11]*u+n[15];return t[0]=(n[0]*o+n[4]*c+n[8]*u+n[12])/(f=f||1),t[1]=(n[1]*o+n[5]*c+n[9]*u+n[13])/f,t[2]=(n[2]*o+n[6]*c+n[10]*u+n[14])/f,t},$t.transformMat3=function(t,e,n){var o=e[0],c=e[1],u=e[2];return t[0]=o*n[0]+c*n[3]+u*n[6],t[1]=o*n[1]+c*n[4]+u*n[7],t[2]=o*n[2]+c*n[5]+u*n[8],t},$t.transformQuat=function(t,e,n){var o=n[0],c=n[1],u=n[2],f=e[0],_=e[1],x=e[2],b=c*x-u*_,T=u*f-o*x,I=o*_-c*f,M=c*I-u*T,P=u*b-o*I,L=o*T-c*b,N=2*n[3];return T*=N,I*=N,P*=2,L*=2,t[0]=f+(b*=N)+(M*=2),t[1]=_+T+P,t[2]=x+I+L,t},$t.rotateX=function(t,e,n,o){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[0],u[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),u[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},$t.rotateY=function(t,e,n,o){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),u[1]=c[1],u[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},$t.rotateZ=function(t,e,n,o){var c=[],u=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],u[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),u[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),u[2]=c[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},$t.angle=function(t,e){var n=t[0],o=t[1],c=t[2],u=e[0],f=e[1],_=e[2],x=Math.sqrt(n*n+o*o+c*c)*Math.sqrt(u*u+f*f+_*_),b=x&&dT(t,e)/x;return Math.acos(Math.min(Math.max(b,-1),1))},$t.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},$t.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},$t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},$t.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=e[0],f=e[1],_=e[2];return Math.abs(n-u)<=Ia.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-f)<=Ia.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(c-_)<=Ia.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},$t.forEach=$t.sqrLen=$t.len=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=void 0;var Ia=function(t,e){if(t&&t.__esModule)return t;if(t===null||G0(t)!=="object"&&typeof t!="function")return{default:t};var n=rT(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function rT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(rT=function(o){return o?n:e})(t)}function iT(){var t=new Ia.ARRAY_TYPE(3);return Ia.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function oT(t){return Math.hypot(t[0],t[1],t[2])}function sT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function aT(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function lT(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function cT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function uT(t,e){var n=e[0]-t[0],o=e[1]-t[1],c=e[2]-t[2];return n*n+o*o+c*c}function hT(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function dT(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}$t.sub=sT,$t.mul=aT,$t.div=lT,$t.dist=cT,$t.sqrDist=uT,$t.len=oT,$t.sqrLen=hT;var Da,cP=(Da=iT(),function(t,e,n,o,c,u){var f,_;for(e||(e=3),n||(n=0),_=o?Math.min(o*e+n,t.length):t.length,f=n;f<_;f+=e)Da[0]=t[f],Da[1]=t[f+1],Da[2]=t[f+2],c(Da,Da,u),t[f]=Da[0],t[f+1]=Da[1],t[f+2]=Da[2];return t});$t.forEach=cP;var on={};function H0(t){return H0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H0(t)}Object.defineProperty(on,"__esModule",{value:!0}),on.create=pT,on.clone=function(t){var e=new zo.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},on.fromValues=function(t,e,n,o){var c=new zo.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=o,c},on.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},on.set=function(t,e,n,o,c){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t},on.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},on.subtract=mT,on.multiply=gT,on.divide=_T,on.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},on.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},on.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},on.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},on.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},on.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},on.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},on.distance=yT,on.squaredDistance=vT,on.length=xT,on.squaredLength=bT,on.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},on.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},on.normalize=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=n*n+o*o+c*c+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=n*f,t[1]=o*f,t[2]=c*f,t[3]=u*f,t},on.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},on.cross=function(t,e,n,o){var c=n[0]*o[1]-n[1]*o[0],u=n[0]*o[2]-n[2]*o[0],f=n[0]*o[3]-n[3]*o[0],_=n[1]*o[2]-n[2]*o[1],x=n[1]*o[3]-n[3]*o[1],b=n[2]*o[3]-n[3]*o[2],T=e[0],I=e[1],M=e[2],P=e[3];return t[0]=I*b-M*x+P*_,t[1]=-T*b+M*f-P*u,t[2]=T*x-I*f+P*c,t[3]=-T*_+I*u-M*c,t},on.lerp=function(t,e,n,o){var c=e[0],u=e[1],f=e[2],_=e[3];return t[0]=c+o*(n[0]-c),t[1]=u+o*(n[1]-u),t[2]=f+o*(n[2]-f),t[3]=_+o*(n[3]-_),t},on.random=function(t,e){var n,o,c,u,f,_;e=e||1;do f=(n=2*zo.RANDOM()-1)*n+(o=2*zo.RANDOM()-1)*o;while(f>=1);do _=(c=2*zo.RANDOM()-1)*c+(u=2*zo.RANDOM()-1)*u;while(_>=1);var x=Math.sqrt((1-f)/_);return t[0]=e*n,t[1]=e*o,t[2]=e*c*x,t[3]=e*u*x,t},on.transformMat4=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3];return t[0]=n[0]*o+n[4]*c+n[8]*u+n[12]*f,t[1]=n[1]*o+n[5]*c+n[9]*u+n[13]*f,t[2]=n[2]*o+n[6]*c+n[10]*u+n[14]*f,t[3]=n[3]*o+n[7]*c+n[11]*u+n[15]*f,t},on.transformQuat=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=n[0],_=n[1],x=n[2],b=n[3],T=b*o+_*u-x*c,I=b*c+x*o-f*u,M=b*u+f*c-_*o,P=-f*o-_*c-x*u;return t[0]=T*b+P*-f+I*-x-M*-_,t[1]=I*b+P*-_+M*-f-T*-x,t[2]=M*b+P*-x+T*-_-I*-f,t[3]=e[3],t},on.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},on.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},on.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},on.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],f=e[0],_=e[1],x=e[2],b=e[3];return Math.abs(n-f)<=zo.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-_)<=zo.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-x)<=zo.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-b)<=zo.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},on.forEach=on.sqrLen=on.len=on.sqrDist=on.dist=on.div=on.mul=on.sub=void 0;var zo=function(t,e){if(t&&t.__esModule)return t;if(t===null||H0(t)!=="object"&&typeof t!="function")return{default:t};var n=fT(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function fT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(fT=function(o){return o?n:e})(t)}function pT(){var t=new zo.ARRAY_TYPE(4);return zo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function mT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function gT(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function _T(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function yT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function vT(t,e){var n=e[0]-t[0],o=e[1]-t[1],c=e[2]-t[2],u=e[3]-t[3];return n*n+o*o+c*c+u*u}function xT(t){return Math.hypot(t[0],t[1],t[2],t[3])}function bT(t){var e=t[0],n=t[1],o=t[2],c=t[3];return e*e+n*n+o*o+c*c}on.sub=mT,on.mul=gT,on.div=_T,on.dist=yT,on.sqrDist=vT,on.len=xT,on.sqrLen=bT;var uP=function(){var t=pT();return function(e,n,o,c,u,f){var _,x;for(n||(n=4),o||(o=0),x=c?Math.min(c*n+o,e.length):e.length,_=o;_<x;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],u(t,t,f),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function q0(t){return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q0(t)}on.forEach=uP,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=W0,jt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},jt.setAxisAngle=TT,jt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>$c.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),n},jt.getAngle=function(t,e){var n=ST(t,e);return Math.acos(2*n*n-1)},jt.multiply=ET,jt.rotateX=function(t,e,n){n*=.5;var o=e[0],c=e[1],u=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x+f*_,t[1]=c*x+u*_,t[2]=u*x-c*_,t[3]=f*x-o*_,t},jt.rotateY=function(t,e,n){n*=.5;var o=e[0],c=e[1],u=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x-u*_,t[1]=c*x+f*_,t[2]=u*x+o*_,t[3]=f*x-c*_,t},jt.rotateZ=function(t,e,n){n*=.5;var o=e[0],c=e[1],u=e[2],f=e[3],_=Math.sin(n),x=Math.cos(n);return t[0]=o*x+c*_,t[1]=c*x-o*_,t[2]=u*x+f*_,t[3]=f*x-u*_,t},jt.calculateW=function(t,e){var n=e[0],o=e[1],c=e[2];return t[0]=n,t[1]=o,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-o*o-c*c)),t},jt.exp=IT,jt.ln=DT,jt.pow=function(t,e,n){return DT(t,e),CT(t,t,n),IT(t,t),t},jt.slerp=gg,jt.random=function(t){var e=$c.RANDOM(),n=$c.RANDOM(),o=$c.RANDOM(),c=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=u*Math.sin(2*Math.PI*o),t[3]=u*Math.cos(2*Math.PI*o),t},jt.invert=function(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=n*n+o*o+c*c+u*u,_=f?1/f:0;return t[0]=-n*_,t[1]=-o*_,t[2]=-c*_,t[3]=u*_,t},jt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},jt.fromMat3=MT,jt.fromEuler=function(t,e,n,o){var c=.5*Math.PI/180;e*=c,n*=c,o*=c;var u=Math.sin(e),f=Math.cos(e),_=Math.sin(n),x=Math.cos(n),b=Math.sin(o),T=Math.cos(o);return t[0]=u*x*T-f*_*b,t[1]=f*_*T+u*x*b,t[2]=f*x*b-u*_*T,t[3]=f*x*T+u*_*b,t},jt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},jt.setAxes=jt.sqlerp=jt.rotationTo=jt.equals=jt.exactEquals=jt.normalize=jt.sqrLen=jt.squaredLength=jt.len=jt.length=jt.lerp=jt.dot=jt.scale=jt.mul=jt.add=jt.set=jt.copy=jt.fromValues=jt.clone=void 0;var $c=mg(Wr),hP=mg($n),Ma=mg($t),wo=mg(on);function wT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(wT=function(o){return o?n:e})(t)}function mg(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||q0(t)!=="object"&&typeof t!="function")return{default:t};var n=wT(e);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function W0(){var t=new $c.ARRAY_TYPE(4);return $c.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function TT(t,e,n){n*=.5;var o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function ET(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=n[0],x=n[1],b=n[2],T=n[3];return t[0]=o*T+f*_+c*b-u*x,t[1]=c*T+f*x+u*_-o*b,t[2]=u*T+f*b+o*x-c*_,t[3]=f*T-o*_-c*x-u*b,t}function IT(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=Math.sqrt(n*n+o*o+c*c),_=Math.exp(u),x=f>0?_*Math.sin(f)/f:0;return t[0]=n*x,t[1]=o*x,t[2]=c*x,t[3]=_*Math.cos(f),t}function DT(t,e){var n=e[0],o=e[1],c=e[2],u=e[3],f=Math.sqrt(n*n+o*o+c*c),_=f>0?Math.atan2(f,u)/f:0;return t[0]=n*_,t[1]=o*_,t[2]=c*_,t[3]=.5*Math.log(n*n+o*o+c*c+u*u),t}function gg(t,e,n,o){var c,u,f,_,x,b=e[0],T=e[1],I=e[2],M=e[3],P=n[0],L=n[1],N=n[2],z=n[3];return(u=b*P+T*L+I*N+M*z)<0&&(u=-u,P=-P,L=-L,N=-N,z=-z),1-u>$c.EPSILON?(c=Math.acos(u),f=Math.sin(c),_=Math.sin((1-o)*c)/f,x=Math.sin(o*c)/f):(_=1-o,x=o),t[0]=_*b+x*P,t[1]=_*T+x*L,t[2]=_*I+x*N,t[3]=_*M+x*z,t}function MT(t,e){var n,o=e[0]+e[4]+e[8];if(o>0)n=Math.sqrt(o+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var u=(c+1)%3,f=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*u+u]-e[3*f+f]+1),t[c]=.5*n,t[3]=(e[3*u+f]-e[3*f+u])*(n=.5/n),t[u]=(e[3*u+c]+e[3*c+u])*n,t[f]=(e[3*f+c]+e[3*c+f])*n}return t}jt.clone=wo.clone,jt.fromValues=wo.fromValues,jt.copy=wo.copy,jt.set=wo.set,jt.add=wo.add,jt.mul=ET;var CT=wo.scale;jt.scale=CT;var ST=wo.dot;jt.dot=ST,jt.lerp=wo.lerp;var AT=wo.length;jt.length=AT,jt.len=AT;var PT=wo.squaredLength;jt.squaredLength=PT,jt.sqrLen=PT;var Z0=wo.normalize;jt.normalize=Z0,jt.exactEquals=wo.exactEquals,jt.equals=wo.equals;var ts,RT,LT,dP=(ts=Ma.create(),RT=Ma.fromValues(1,0,0),LT=Ma.fromValues(0,1,0),function(t,e,n){var o=Ma.dot(e,n);return o<-.999999?(Ma.cross(ts,RT,e),Ma.len(ts)<1e-6&&Ma.cross(ts,LT,e),Ma.normalize(ts,ts),TT(t,ts,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ma.cross(ts,e,n),t[0]=ts[0],t[1]=ts[1],t[2]=ts[2],t[3]=1+o,Z0(t,t))});jt.rotationTo=dP;var X0,Y0,fP=(X0=W0(),Y0=W0(),function(t,e,n,o,c,u){return gg(X0,e,c,u),gg(Y0,n,o,u),gg(t,X0,Y0,2*u*(1-u)),t});jt.sqlerp=fP;var ns,pP=(ns=hP.create(),function(t,e,n,o){return ns[0]=n[0],ns[3]=n[1],ns[6]=n[2],ns[1]=o[0],ns[4]=o[1],ns[7]=o[2],ns[2]=-e[0],ns[5]=-e[1],ns[8]=-e[2],Z0(t,MT(t,ns))});jt.setAxes=pP;var fn={};function K0(t){return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K0(t)}Object.defineProperty(fn,"__esModule",{value:!0}),fn.create=function(){var t=new Gi.ARRAY_TYPE(8);return Gi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},fn.clone=function(t){var e=new Gi.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},fn.fromValues=function(t,e,n,o,c,u,f,_){var x=new Gi.ARRAY_TYPE(8);return x[0]=t,x[1]=e,x[2]=n,x[3]=o,x[4]=c,x[5]=u,x[6]=f,x[7]=_,x},fn.fromRotationTranslationValues=function(t,e,n,o,c,u,f){var _=new Gi.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=o;var x=.5*c,b=.5*u,T=.5*f;return _[4]=x*o+b*n-T*e,_[5]=b*o+T*t-x*n,_[6]=T*o+x*e-b*t,_[7]=-x*t-b*e-T*n,_},fn.fromRotationTranslation=kT,fn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},fn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fn.fromMat4=function(t,e){var n=Ca.create();OT.getRotation(n,e);var o=new Gi.ARRAY_TYPE(3);return OT.getTranslation(o,e),kT(t,n,o),t},fn.copy=FT,fn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fn.set=function(t,e,n,o,c,u,f,_,x){return t[0]=e,t[1]=n,t[2]=o,t[3]=c,t[4]=u,t[5]=f,t[6]=_,t[7]=x,t},fn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},fn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},fn.getTranslation=function(t,e){var n=e[4],o=e[5],c=e[6],u=e[7],f=-e[0],_=-e[1],x=-e[2],b=e[3];return t[0]=2*(n*b+u*f+o*x-c*_),t[1]=2*(o*b+u*_+c*f-n*x),t[2]=2*(c*b+u*x+n*_-o*f),t},fn.translate=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=.5*n[0],x=.5*n[1],b=.5*n[2],T=e[4],I=e[5],M=e[6],P=e[7];return t[0]=o,t[1]=c,t[2]=u,t[3]=f,t[4]=f*_+c*b-u*x+T,t[5]=f*x+u*_-o*b+I,t[6]=f*b+o*x-c*_+M,t[7]=-o*_-c*x-u*b+P,t},fn.rotateX=function(t,e,n){var o=-e[0],c=-e[1],u=-e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=_*f+T*o+x*u-b*c,M=x*f+T*c+b*o-_*u,P=b*f+T*u+_*c-x*o,L=T*f-_*o-x*c-b*u;return Ca.rotateX(t,e,n),t[4]=I*(f=t[3])+L*(o=t[0])+M*(u=t[2])-P*(c=t[1]),t[5]=M*f+L*c+P*o-I*u,t[6]=P*f+L*u+I*c-M*o,t[7]=L*f-I*o-M*c-P*u,t},fn.rotateY=function(t,e,n){var o=-e[0],c=-e[1],u=-e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=_*f+T*o+x*u-b*c,M=x*f+T*c+b*o-_*u,P=b*f+T*u+_*c-x*o,L=T*f-_*o-x*c-b*u;return Ca.rotateY(t,e,n),t[4]=I*(f=t[3])+L*(o=t[0])+M*(u=t[2])-P*(c=t[1]),t[5]=M*f+L*c+P*o-I*u,t[6]=P*f+L*u+I*c-M*o,t[7]=L*f-I*o-M*c-P*u,t},fn.rotateZ=function(t,e,n){var o=-e[0],c=-e[1],u=-e[2],f=e[3],_=e[4],x=e[5],b=e[6],T=e[7],I=_*f+T*o+x*u-b*c,M=x*f+T*c+b*o-_*u,P=b*f+T*u+_*c-x*o,L=T*f-_*o-x*c-b*u;return Ca.rotateZ(t,e,n),t[4]=I*(f=t[3])+L*(o=t[0])+M*(u=t[2])-P*(c=t[1]),t[5]=M*f+L*c+P*o-I*u,t[6]=P*f+L*u+I*c-M*o,t[7]=L*f-I*o-M*c-P*u,t},fn.rotateByQuatAppend=function(t,e,n){var o=n[0],c=n[1],u=n[2],f=n[3],_=e[0],x=e[1],b=e[2],T=e[3];return t[0]=_*f+T*o+x*u-b*c,t[1]=x*f+T*c+b*o-_*u,t[2]=b*f+T*u+_*c-x*o,t[3]=T*f-_*o-x*c-b*u,t[4]=(_=e[4])*f+(T=e[7])*o+(x=e[5])*u-(b=e[6])*c,t[5]=x*f+T*c+b*o-_*u,t[6]=b*f+T*u+_*c-x*o,t[7]=T*f-_*o-x*c-b*u,t},fn.rotateByQuatPrepend=function(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=n[0],x=n[1],b=n[2],T=n[3];return t[0]=o*T+f*_+c*b-u*x,t[1]=c*T+f*x+u*_-o*b,t[2]=u*T+f*b+o*x-c*_,t[3]=f*T-o*_-c*x-u*b,t[4]=o*(T=n[7])+f*(_=n[4])+c*(b=n[6])-u*(x=n[5]),t[5]=c*T+f*x+u*_-o*b,t[6]=u*T+f*b+o*x-c*_,t[7]=f*T-o*_-c*x-u*b,t},fn.rotateAroundAxis=function(t,e,n,o){if(Math.abs(o)<Gi.EPSILON)return FT(t,e);var c=Math.hypot(n[0],n[1],n[2]);o*=.5;var u=Math.sin(o),f=u*n[0]/c,_=u*n[1]/c,x=u*n[2]/c,b=Math.cos(o),T=e[0],I=e[1],M=e[2],P=e[3];t[0]=T*b+P*f+I*x-M*_,t[1]=I*b+P*_+M*f-T*x,t[2]=M*b+P*x+T*_-I*f,t[3]=P*b-T*f-I*_-M*x;var L=e[4],N=e[5],z=e[6],V=e[7];return t[4]=L*b+V*f+N*x-z*_,t[5]=N*b+V*_+z*f-L*x,t[6]=z*b+V*x+L*_-N*f,t[7]=V*b-L*f-N*_-z*x,t},fn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},fn.multiply=zT,fn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},fn.lerp=function(t,e,n,o){var c=1-o;return BT(e,n)<0&&(o=-o),t[0]=e[0]*c+n[0]*o,t[1]=e[1]*c+n[1]*o,t[2]=e[2]*c+n[2]*o,t[3]=e[3]*c+n[3]*o,t[4]=e[4]*c+n[4]*o,t[5]=e[5]*c+n[5]*o,t[6]=e[6]*c+n[6]*o,t[7]=e[7]*c+n[7]*o,t},fn.invert=function(t,e){var n=_g(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},fn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},fn.normalize=function(t,e){var n=_g(e);if(n>0){n=Math.sqrt(n);var o=e[0]/n,c=e[1]/n,u=e[2]/n,f=e[3]/n,_=e[4],x=e[5],b=e[6],T=e[7],I=o*_+c*x+u*b+f*T;t[0]=o,t[1]=c,t[2]=u,t[3]=f,t[4]=(_-o*I)/n,t[5]=(x-c*I)/n,t[6]=(b-u*I)/n,t[7]=(T-f*I)/n}return t},fn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},fn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},fn.equals=function(t,e){var n=t[0],o=t[1],c=t[2],u=t[3],f=t[4],_=t[5],x=t[6],b=t[7],T=e[0],I=e[1],M=e[2],P=e[3],L=e[4],N=e[5],z=e[6],V=e[7];return Math.abs(n-T)<=Gi.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(o-I)<=Gi.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(c-M)<=Gi.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-P)<=Gi.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(f-L)<=Gi.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(_-N)<=Gi.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(x-z)<=Gi.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(b-V)<=Gi.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))},fn.sqrLen=fn.squaredLength=fn.len=fn.length=fn.dot=fn.mul=fn.setReal=fn.getReal=void 0;var Gi=J0(Wr),Ca=J0(jt),OT=J0(Gt);function NT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(NT=function(o){return o?n:e})(t)}function J0(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||K0(t)!=="object"&&typeof t!="function")return{default:t};var n=NT(e);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}function kT(t,e,n){var o=.5*n[0],c=.5*n[1],u=.5*n[2],f=e[0],_=e[1],x=e[2],b=e[3];return t[0]=f,t[1]=_,t[2]=x,t[3]=b,t[4]=o*b+c*x-u*_,t[5]=c*b+u*f-o*x,t[6]=u*b+o*_-c*f,t[7]=-o*f-c*_-u*x,t}function FT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function zT(t,e,n){var o=e[0],c=e[1],u=e[2],f=e[3],_=n[4],x=n[5],b=n[6],T=n[7],I=e[4],M=e[5],P=e[6],L=e[7],N=n[0],z=n[1],V=n[2],W=n[3];return t[0]=o*W+f*N+c*V-u*z,t[1]=c*W+f*z+u*N-o*V,t[2]=u*W+f*V+o*z-c*N,t[3]=f*W-o*N-c*z-u*V,t[4]=o*T+f*_+c*b-u*x+I*W+L*N+M*V-P*z,t[5]=c*T+f*x+u*_-o*b+M*W+L*z+P*N-I*V,t[6]=u*T+f*b+o*x-c*_+P*W+L*V+I*z-M*N,t[7]=f*T-o*_-c*x-u*b+L*W-I*N-M*z-P*V,t}fn.getReal=Ca.copy,fn.setReal=Ca.copy,fn.mul=zT;var BT=Ca.dot;fn.dot=BT;var jT=Ca.length;fn.length=jT,fn.len=jT;var _g=Ca.squaredLength;fn.squaredLength=_g,fn.sqrLen=_g;var Jt={};function Q0(t){return Q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q0(t)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=UT,Jt.clone=function(t){var e=new Gc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Jt.fromValues=function(t,e){var n=new Gc.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Jt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Jt.set=function(t,e,n){return t[0]=e,t[1]=n,t},Jt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Jt.subtract=$T,Jt.multiply=GT,Jt.divide=HT,Jt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Jt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Jt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Jt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Jt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Jt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Jt.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t},Jt.distance=qT,Jt.squaredDistance=WT,Jt.length=ZT,Jt.squaredLength=XT,Jt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Jt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Jt.normalize=function(t,e){var n=e[0],o=e[1],c=n*n+o*o;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},Jt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Jt.cross=function(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t},Jt.lerp=function(t,e,n,o){var c=e[0],u=e[1];return t[0]=c+o*(n[0]-c),t[1]=u+o*(n[1]-u),t},Jt.random=function(t,e){e=e||1;var n=2*Gc.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Jt.transformMat2=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[2]*c,t[1]=n[1]*o+n[3]*c,t},Jt.transformMat2d=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[2]*c+n[4],t[1]=n[1]*o+n[3]*c+n[5],t},Jt.transformMat3=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[3]*c+n[6],t[1]=n[1]*o+n[4]*c+n[7],t},Jt.transformMat4=function(t,e,n){var o=e[0],c=e[1];return t[0]=n[0]*o+n[4]*c+n[12],t[1]=n[1]*o+n[5]*c+n[13],t},Jt.rotate=function(t,e,n,o){var c=e[0]-n[0],u=e[1]-n[1],f=Math.sin(o),_=Math.cos(o);return t[0]=c*_-u*f+n[0],t[1]=c*f+u*_+n[1],t},Jt.angle=function(t,e){var n=t[0],o=t[1],c=e[0],u=e[1],f=Math.sqrt(n*n+o*o)*Math.sqrt(c*c+u*u);return Math.acos(Math.min(Math.max(f&&(n*c+o*u)/f,-1),1))},Jt.zero=function(t){return t[0]=0,t[1]=0,t},Jt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Jt.equals=function(t,e){var n=t[0],o=t[1],c=e[0],u=e[1];return Math.abs(n-c)<=Gc.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-u)<=Gc.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},Jt.forEach=Jt.sqrLen=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=Jt.len=void 0;var Gc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Q0(t)!=="object"&&typeof t!="function")return{default:t};var n=VT(void 0);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}(Wr);function VT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(VT=function(o){return o?n:e})(t)}function UT(){var t=new Gc.ARRAY_TYPE(2);return Gc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function $T(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function GT(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function HT(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function qT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function WT(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function ZT(t){return Math.hypot(t[0],t[1])}function XT(t){var e=t[0],n=t[1];return e*e+n*n}Jt.len=ZT,Jt.sub=$T,Jt.mul=GT,Jt.div=HT,Jt.dist=qT,Jt.sqrDist=WT,Jt.sqrLen=XT;var mP=function(){var t=UT();return function(e,n,o,c,u,f){var _,x;for(n||(n=2),o||(o=0),x=c?Math.min(c*n+o,e.length):e.length,_=o;_<x;_+=n)t[0]=e[_],t[1]=e[_+1],u(t,t,f),e[_]=t[0],e[_+1]=t[1];return e}}();function ev(t){return ev=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ev(t)}Jt.forEach=mP,Object.defineProperty(qr,"__esModule",{value:!0}),i.a7=qr.vec4=i.N=qr.vec3=qr.vec2=qr.quat2=i.bi=qr.quat=i.a6=qr.mat4=i.co=qr.mat3=qr.mat2d=i.b4=qr.mat2=qr.glMatrix=void 0;var gP=$s(Wr);qr.glMatrix=gP;var _P=$s(ur);i.b4=qr.mat2=_P;var yP=$s(pr);qr.mat2d=yP;var vP=$s($n);i.co=qr.mat3=vP;var xP=$s(Gt);i.a6=qr.mat4=xP;var bP=$s(jt);i.bi=qr.quat=bP;var wP=$s(fn);qr.quat2=wP;var TP=$s(Jt);qr.vec2=TP;var EP=$s($t);i.N=qr.vec3=EP;var IP=$s(on);function YT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(YT=function(o){return o?n:e})(t)}function $s(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||ev(t)!=="object"&&typeof t!="function")return{default:t};var n=YT(e);if(n&&n.has(t))return n.get(t);var o={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var f=c?Object.getOwnPropertyDescriptor(t,u):null;f&&(f.get||f.set)?Object.defineProperty(o,u,f):o[u]=t[u]}return o.default=t,n&&n.set(t,o),o}i.a7=qr.vec4=IP;class tv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){let c=i.N.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,o){if(i.N.equals(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;let[c,u,f]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],T=c*c+u*u+f*f,I=2*(_*c+x*u+b*f),M=I*I-4*T*(_*_+x*x+b*b-n*n);if(M<0){let P=Math.max(-I/2,0),L=_+c*P,N=x+u*P,z=b+f*P,V=Math.hypot(L,N,z);return o[0]=L*n/V,o[1]=N*n/V,o[2]=z*n/V,!1}{let P=(-I-Math.sqrt(M))/(2*T);if(P<0){let L=Math.hypot(_,x,b);return o[0]=_*n/L,o[1]=x*n/L,o[2]=b*n/L,!1}return o[0]=_+c*P,o[1]=x+u*P,o[2]=b+f*P,!0}}}class nv{constructor(e,n,o,c,u){this.TL=e,this.TR=n,this.BR=o,this.BL=c,this.horizon=u}static fromInvProjectionMatrix(e,n,o){let c=[-1,1,1],u=[1,1,1],f=[1,-1,1],_=[-1,-1,1],x=i.N.transformMat4(c,c,e),b=i.N.transformMat4(u,u,e),T=i.N.transformMat4(f,f,e),I=i.N.transformMat4(_,_,e);return new nv(x,b,T,I,n/o)}}function Uf(t,e,n){let o=1/0,c=-1/0,u=[];for(let f of t){i.N.sub(u,f,e);let _=i.N.dot(u,n);o=Math.min(o,_),c=Math.max(c,_)}return[o,c]}function KT(t,e){let n=!0;for(let o=0;o<t.planes.length;o++){let c=t.planes[o],u=0;for(let f=0;f<e.length;f++)u+=i.N.dot(c,e[f])+c[3]>=0;if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function JT(t,e){for(let n of t.projections){let o=Uf(e,t.points[0],n.axis);if(n.projection[1]<o[0]||n.projection[0]>o[1])return 0}return 1}function QT(t,e){let n=0,o=[0,0,0,0];for(let c=0;c<t.length;c++)o[0]=t[c][0],o[1]=t[c][1],o[2]=t[c][2],o[3]=1,i.a7.dot(o,e)>=0&&n++;return n}class rv{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=mr.fromPoints(this.points),this.projections=[],this.frustumEdges=[i.N.sub([],this.points[2],this.points[3]),i.N.sub([],this.points[0],this.points[3]),i.N.sub([],this.points[4],this.points[0]),i.N.sub([],this.points[5],this.points[1]),i.N.sub([],this.points[6],this.points[2]),i.N.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let c=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:c,projection:Uf(this.points,this.points[0],c)}),this.projections.push({axis:u,projection:Uf(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,o,c){let u=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=i.a7.transformMat4([],b,e),I=1/T[3]/n*u;return i.a7.mul(T,T,[I,I,c?1/T[3]:I,I])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=i.N.sub([],f[b[0]],f[b[1]]),I=i.N.sub([],f[b[2]],f[b[1]]),M=i.N.normalize([],i.N.cross([],T,I)),P=-i.N.dot(M,f[b[1]]);return M.concat(P)}),x=[];for(let b=0;b<f.length;b++)x.push([f[b][0],f[b][1],f[b][2]]);return new rv(x,_)}intersectsPrecise(e,n,o){for(let c=0;c<n.length;c++)if(!QT(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!QT(e,this.planes[c]))return 0;for(let c of o)for(let u of this.frustumEdges){let f=i.N.cross([],c,u),_=i.N.length(f);if(_===0)continue;i.N.scale(f,f,1/_);let x=Uf(this.points,this.points[0],f),b=Uf(e,this.points[0],f);if(x[0]>b[1]||b[0]>x[1])return 0}return 1}}class mr{static fromPoints(e){let n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let c of e)i.N.min(n,n,c),i.N.max(o,o,c);return new mr(n,o)}static fromTileIdAndHeight(e,n,o){let c=1<<e.canonical.z,u=e.canonical.x,f=e.canonical.y;return new mr([u/c,f/c,n],[(u+1)/c,(f+1)/c,o])}static applyTransform(e,n){let o=e.getCorners();for(let c=0;c<o.length;++c)i.N.transformMat4(o[c],o[c],n);return mr.fromPoints(o)}static projectAabbCorners(e,n){let o=e.getCorners();for(let c=0;c<o.length;++c)i.N.transformMat4(o[c],o[c],n);return o}constructor(e,n){this.min=e,this.max=n,this.center=i.N.scale([],i.N.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],o=i.N.clone(this.min),c=i.N.clone(this.max);for(let u=0;u<n.length;u++)o[u]=n[u]?this.min[u]:this.center[u],c[u]=n[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new mr(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?KT(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?KT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?JT(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?JT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ut(mr,"Aabb");let DP=Rn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yg}=DP,MP=Rn([{name:"a_pos_3",components:3,type:"Int16"}]);var eE=Rn([{name:"a_pos",type:"Int16",components:2}]);function vg(t){return t*X/Ee}let CP=[new mr([ue,ue,ue],[xe,xe,xe]),new mr([ue,ue,ue],[0,0,xe]),new mr([0,ue,ue],[xe,0,xe]),new mr([ue,0,ue],[0,xe,xe]),new mr([0,0,ue],[xe,xe,xe])];function tE(t,e,n,o=!0){let c=i.N.scale([],t._camera.position,t.worldSize),u=[e,n,1,1];i.a7.transformMat4(u,u,t.pixelMatrixInverse),i.a7.scale(u,u,1/u[3]);let f=i.N.sub([],u,c),_=i.N.normalize([],f),x=t.globeMatrix,b=[x[12],x[13],x[14]],T=i.N.sub([],b,c),I=i.N.length(T),M=i.N.normalize([],T),P=t.worldSize/(2*Math.PI),L=i.N.dot(M,_),N=Math.asin(P/I);if(N<Math.acos(L)){if(!o)return null;let ge=[],Me=[];i.N.scale(ge,_,I/L),i.N.normalize(Me,i.N.sub(Me,ge,T)),i.N.normalize(_,i.N.add(_,T,i.N.scale(_,Me,Math.tan(N)*I)))}let z=[];new tv(c,_).closestPointOnSphere(b,P,z);let V=i.N.normalize([],re(x,0)),W=i.N.normalize([],re(x,1)),J=i.N.normalize([],re(x,2)),K=i.N.dot(V,z),ie=i.N.dot(W,z),ne=i.N.dot(J,z),le=Hr(Math.asin(-ie/P)),de=Hr(Math.atan2(K,ne));de=t.center.lng+function(ge,Me){let Ne=(Me-ge+180)%360-180;return Ne<-180?Ne+360:Ne}(t.center.lng,de);let me=Ut(de),be=Xt(Rt(le),0,1);return new _n(me,be)}class SP{constructor(e,n,o){this.a=i.N.sub([],e,o),this.b=i.N.sub([],n,o),this.center=o;let c=i.N.normalize([],this.a),u=i.N.normalize([],this.b);this.angle=Math.acos(i.N.dot(c,u))}}function iv(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,c,u,f){let _=Math.sin(u);return o*(Math.sin((1-f)*u)/_)+c*(Math.sin(f*u)/_)}(t.a[e],t.b[e],t.angle,Xt(n,0,1))+t.center[e]}function Gs(t){if(t.z<=1)return CP[t.z+2*t.y+t.x];let e=ov(xg(t));return mr.fromPoints(e)}function Sa(t,e,n){return i.N.scale(t,t,1-n),i.N.scaleAndAdd(t,t,e,n)}function nE(t,e,n){for(let o of t)i.N.transformMat4(o,o,e),i.N.scale(o,o,n)}function rE(t,e,n,o){let c=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){let me=Gs(n).getCorners();return nE(me,u,c),mr.fromPoints(me)}let f=xg(n,o),_=ov(f,X+vg(t._tileCoverLift));nE(_,u,c);let x=Number.MAX_VALUE,b=[-x,-x,-x],T=[x,x,x];if(f.contains(t.center)){for(let ge of _)i.N.min(T,T,ge),i.N.max(b,b,ge);b[2]=0;let me=t.point,be=[me.x*c,me.y*c,0];return i.N.min(T,T,be),i.N.max(b,b,be),new mr(T,b)}if(t._tileCoverLift>0){for(let me of _)i.N.min(T,T,me),i.N.max(b,b,me);return new mr(T,b)}let I=[u[12]*c,u[13]*c,u[14]*c],M=f.getCenter(),P=Xt(t.center.lat,-en,en),L=Xt(M.lat,-en,en),N=Ut(t.center.lng),z=Rt(P),V=N-Ut(M.lng),W=z-Rt(L);V>.5?V-=1:V<-.5&&(V+=1);let J=0;if(Math.abs(V)>Math.abs(W))J=V>=0?1:3;else{J=W>=0?0:2;let me=[u[4]*c,u[5]*c,u[6]*c],be=-Math.sin(an(W>=0?f.getSouth():f.getNorth()))*X;i.N.scaleAndAdd(I,I,me,be)}let K=_[J],ie=_[(J+1)%4],ne=new SP(K,ie,I),le=[iv(ne,0)||K[0],iv(ne,1)||K[1],iv(ne,2)||K[2]],de=Tl(t.zoom);if(de>0){let me=function({x:ge,y:Me,z:Ne},Ie,Le,Te,Re){let Ke=1/(1<<Ne),Fe=ge*Ke,dt=Fe+Ke,st=Me*Ke,Ve=st+Ke,Ct=0,vt=(Fe+dt)/2-Te;return vt>.5?Ct=-1:vt<-.5&&(Ct=1),Fe=((Fe+Ct)*Ie-(Te*=Ie))*Le+Te,dt=((dt+Ct)*Ie-Te)*Le+Te,st=(st*Ie-(Re*=Ie))*Le+Re,Ve=(Ve*Ie-Re)*Le+Re,[[Fe,Ve,0],[dt,Ve,0],[dt,st,0],[Fe,st,0]]}(n,e,t._pixelsPerMercatorPixel,N,z);for(let ge=0;ge<_.length;ge++)Sa(_[ge],me[ge],de);let be=i.N.add([],me[J],me[(J+1)%4]);i.N.scale(be,be,.5),Sa(le,be,de)}for(let me of _)i.N.min(T,T,me),i.N.max(b,b,me);return T[2]=Math.min(K[2],ie[2]),i.N.min(T,T,le),i.N.max(b,b,le),new mr(T,b)}function xg({x:t,y:e,z:n},o=!1){let c=1/(1<<n),u=new pe(kt(t*c),e===(1<<n)-1&&o?-90:dn((e+1)*c)),f=new pe(kt((t+1)*c),e===0&&o?90:dn(e*c));return new we(u,f)}function ov(t,e=X){let n=an(t.getNorth()),o=an(t.getSouth()),c=Math.cos(n),u=Math.cos(o),f=Math.sin(n),_=Math.sin(o),x=t.getWest(),b=t.getEast();return[fe(u,_,x,e),fe(u,_,b,e),fe(c,f,b,e),fe(c,f,x,e)]}function $f(t,e,n,o){let c=1<<n.z,u=(t/rt+n.x)/c;return De(dn((e/rt+n.y)/c),kt(u),o)}function bg({min:t,max:e}){return te/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let iE=new Float64Array(16);function wg(t){let e=bg(t),n=i.a6.fromScaling(iE,[e,e,e]);return i.a6.translate(n,n,i.N.negate([],t.min))}function sv(t){let e=i.a6.fromTranslation(iE,t.min),n=1/bg(t);return i.a6.scale(e,e,[n,n,n])}function av(t){let e=rt/(2*Math.PI);return t/(2*Math.PI)/e}function oE(t,e){return rt/(512*Math.pow(2,t))*bg(Gs(e))}function sE(t,e,n,o,c){let u=av(n),f=[t,e,-n/(2*Math.PI)],_=i.a6.identity(new Float64Array(16));return i.a6.translate(_,_,f),i.a6.scale(_,_,[u,u,u]),i.a6.rotateX(_,_,an(-c)),i.a6.rotateY(_,_,an(-o)),_}function Tl(t){return qa(ee,H,t)}function aE(t,e){let n=De(e.lat,e.lng),o=function(u){let f=De(u._center.lat,u._center.lng),_=i.N.fromValues(0,1,0),x=i.N.cross([],_,f),b=i.a6.fromRotation([],-u.angle,f);x=i.N.transformMat4(x,x,b),i.a6.fromRotation(b,-u._pitch,x);let T=i.N.normalize([],f);return i.N.scale(T,T,vg(u.cameraToCenterDistance/u.pixelsPerMeter)),i.N.transformMat4(T,T,b),i.N.add([],f,T)}(t),c=i.N.subtract([],o,n);return i.N.angle(c,n)}function lv(t,e){return aE(t,e)>Math.PI/2*1.01}let lE=an(85),AP=Math.cos(lE),PP=Math.sin(lE),RP=i.a6.create(),cE=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function uE(t,e,n,o,c,u,f,_,x){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(x*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(let I of e)for(let M of I){let P=M.add(_),L=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(P.x,P.y,!0):0,N=n.projection.projectTilePoint(P.x,P.y,b);if(L>0){let J=n.projection.upVector(b,P.x,P.y);N.x+=J[0]*T*L,N.y+=J[1]*T*L,N.z+=J[2]*T*L}let z=u?P:LP(N.x,N.y,N.z,o),V=u?t.tilespaceRays.map(J=>NP(J,L)):t.queryGeometry.screenGeometry,W=i.a7.transformMat4([],[N.x,N.y,N.z,1],o);if(!f&&u?x*=W[3]/n.cameraToCenterDistance:f&&!u&&(x*=n.cameraToCenterDistance/W[3]),u){let J=dn((M.y/rt+b.y)/(1<<b.z));x/=n.projection.pixelsPerMeter(J,1)/zt(1,J)}if(Vs(V,z,x))return!0}return!1}function LP(t,e,n,o){let c=i.a7.transformMat4([],[t,e,n,1],o);return new Ge(c[0]/c[3],c[1]/c[3])}let hE=i.N.fromValues(0,0,0),OP=i.N.fromValues(0,0,1);function NP(t,e){let n=i.N.create();return hE[2]=e,t.intersectsPlane(hE,OP,n),new Ge(n[0],n[1])}class dE extends Oi{}function fE(t,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=c,t}function pE(t,e,n){let{width:o,height:c}=e;o===t.width&&c===t.height||(cv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,c)},n),t.width=o,t.height=c,t.data=e.data)}function cv(t,e,n,o,c,u,f){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let _=t.data,x=e.data,b=u===4&&f;for(let T=0;T<c.height;T++){let I=((n.y+T)*t.width+n.x)*u,M=((o.y+T)*e.width+o.x)*u;if(b)for(let P=0;P<c.width;P++){let L=I+P*u+3,N=M+P*u;x[N+0]=255,x[N+1]=255,x[N+2]=255,x[N+3]=_[L]}else for(let P=0;P<c.width*u;P++)x[M+P]=_[I+P]}return e}ut(dE,"HeatmapBucket",{omit:["layers"]});class El{constructor(e,n){fE(this,e,1,n)}resize(e){pE(this,new El(e),1)}clone(){return new El({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,u){cv(e,n,o,c,u,1)}}class To{constructor(e,n){fE(this,e,4,n)}resize(e){pE(this,new To(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new To({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,u,f){cv(e,n,o,c,u,4,f)}}class mE{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ut(El,"AlphaImage"),ut(To,"RGBAImage");let kP=new lr({visibility:new Xe(ye.layout_heatmap.visibility)});var FP={paint:new lr({"heatmap-radius":new Et(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Et(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xe(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wa(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xe(ye.paint_heatmap["heatmap-opacity"])}),layout:kP};function Gf(t){let e={},n=t.resolution||256,o=t.clips?t.clips.length:1,c=t.image||new To({width:n,height:o}),u=(f,_,x)=>{e[t.evaluationKey]=x;let b=t.expression.evaluate(e);b&&(c.data[f+_+0]=Math.floor(255*b.r/b.a),c.data[f+_+1]=Math.floor(255*b.g/b.a),c.data[f+_+2]=Math.floor(255*b.b/b.a),c.data[f+_+3]=Math.floor(255*b.a))};if(t.clips)for(let f=0,_=0;f<o;++f,_+=4*n)for(let x=0,b=0;x<n;x++,b+=4){let T=x/(n-1),{start:I,end:M}=t.clips[f];u(_,b,I*(1-T)+M*T)}else for(let f=0,_=0;f<n;f++,_+=4)u(0,_,f/(n-1));return c}let zP=new lr({visibility:new Xe(ye.layout_hillshade.visibility)});var BP={paint:new lr({"hillshade-illumination-direction":new Xe(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xe(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xe(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xe(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xe(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xe(ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xe(ye.paint_hillshade["hillshade-emissive-strength"])}),layout:zP};let jP=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:VP}=jP;var uv={exports:{}};function Tg(t,e,n){n=n||2;var o,c,u,f,_,x,b,T=e&&e.length,I=T?e[0]*n:t.length,M=gE(t,0,I,n,!0),P=[];if(!M||M.next===M.prev)return P;if(T&&(M=function(N,z,V,W){var J,K,ie,ne=[];for(J=0,K=z.length;J<K;J++)(ie=gE(N,z[J]*W,J<K-1?z[J+1]*W:N.length,W,!1))===ie.next&&(ie.steiner=!0),ne.push(XP(ie));for(ne.sort(qP),J=0;J<ne.length;J++)V=WP(ne[J],V);return V}(t,e,M,n)),t.length>80*n){o=u=t[0],c=f=t[1];for(var L=n;L<I;L+=n)(_=t[L])<o&&(o=_),(x=t[L+1])<c&&(c=x),_>u&&(u=_),x>f&&(f=x);b=(b=Math.max(u-o,f-c))!==0?32767/b:0}return Hf(M,P,n,o,c,b,0),P}function gE(t,e,n,o,c){var u,f;if(c===fv(t,e,n,o)>0)for(u=e;u<n;u+=o)f=vE(u,t[u],t[u+1],f);else for(u=n-o;u>=e;u-=o)f=vE(u,t[u],t[u+1],f);return f&&Eg(f,f.next)&&(Wf(f),f=f.next),f}function Hc(t,e){if(!t)return t;e||(e=t);var n,o=t;do if(n=!1,o.steiner||!Eg(o,o.next)&&Or(o.prev,o,o.next)!==0)o=o.next;else{if(Wf(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Hf(t,e,n,o,c,u,f){if(t){!f&&u&&function(T,I,M,P){var L=T;do L.z===0&&(L.z=hv(L.x,L.y,I,M,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==T);L.prevZ.nextZ=null,L.prevZ=null,function(N){var z,V,W,J,K,ie,ne,le,de=1;do{for(V=N,N=null,K=null,ie=0;V;){for(ie++,W=V,ne=0,z=0;z<de&&(ne++,W=W.nextZ);z++);for(le=de;ne>0||le>0&&W;)ne!==0&&(le===0||!W||V.z<=W.z)?(J=V,V=V.nextZ,ne--):(J=W,W=W.nextZ,le--),K?K.nextZ=J:N=J,J.prevZ=K,K=J;V=W}K.nextZ=null,de*=2}while(ie>1)}(L)}(t,o,c,u);for(var _,x,b=t;t.prev!==t.next;)if(_=t.prev,x=t.next,u?$P(t,o,c,u):UP(t))e.push(_.i/n|0),e.push(t.i/n|0),e.push(x.i/n|0),Wf(t),t=x.next,b=x.next;else if((t=x)===b){f?f===1?Hf(t=GP(Hc(t),e,n),e,n,o,c,u,2):f===2&&HP(t,e,n,o,c,u):Hf(Hc(t),e,n,o,c,u,1);break}}}function UP(t){var e=t.prev,n=t,o=t.next;if(Or(e,n,o)>=0)return!1;for(var c=e.x,u=n.x,f=o.x,_=e.y,x=n.y,b=o.y,T=c<u?c<f?c:f:u<f?u:f,I=_<x?_<b?_:b:x<b?x:b,M=c>u?c>f?c:f:u>f?u:f,P=_>x?_>b?_:b:x>b?x:b,L=o.next;L!==e;){if(L.x>=T&&L.x<=M&&L.y>=I&&L.y<=P&&ih(c,_,u,x,f,b,L.x,L.y)&&Or(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function $P(t,e,n,o){var c=t.prev,u=t,f=t.next;if(Or(c,u,f)>=0)return!1;for(var _=c.x,x=u.x,b=f.x,T=c.y,I=u.y,M=f.y,P=_<x?_<b?_:b:x<b?x:b,L=T<I?T<M?T:M:I<M?I:M,N=_>x?_>b?_:b:x>b?x:b,z=T>I?T>M?T:M:I>M?I:M,V=hv(P,L,e,n,o),W=hv(N,z,e,n,o),J=t.prevZ,K=t.nextZ;J&&J.z>=V&&K&&K.z<=W;){if(J.x>=P&&J.x<=N&&J.y>=L&&J.y<=z&&J!==c&&J!==f&&ih(_,T,x,I,b,M,J.x,J.y)&&Or(J.prev,J,J.next)>=0||(J=J.prevZ,K.x>=P&&K.x<=N&&K.y>=L&&K.y<=z&&K!==c&&K!==f&&ih(_,T,x,I,b,M,K.x,K.y)&&Or(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;J&&J.z>=V;){if(J.x>=P&&J.x<=N&&J.y>=L&&J.y<=z&&J!==c&&J!==f&&ih(_,T,x,I,b,M,J.x,J.y)&&Or(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;K&&K.z<=W;){if(K.x>=P&&K.x<=N&&K.y>=L&&K.y<=z&&K!==c&&K!==f&&ih(_,T,x,I,b,M,K.x,K.y)&&Or(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function GP(t,e,n){var o=t;do{var c=o.prev,u=o.next.next;!Eg(c,u)&&_E(c,o,o.next,u)&&qf(c,u)&&qf(u,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(u.i/n|0),Wf(o),Wf(o.next),o=t=u),o=o.next}while(o!==t);return Hc(o)}function HP(t,e,n,o,c,u){var f=t;do{for(var _=f.next.next;_!==f.prev;){if(f.i!==_.i&&YP(f,_)){var x=yE(f,_);return f=Hc(f,f.next),x=Hc(x,x.next),Hf(f,e,n,o,c,u,0),void Hf(x,e,n,o,c,u,0)}_=_.next}f=f.next}while(f!==t)}function qP(t,e){return t.x-e.x}function WP(t,e){var n=function(c,u){var f,_=u,x=c.x,b=c.y,T=-1/0;do{if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){var I=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(I<=x&&I>T&&(T=I,f=_.x<_.next.x?_:_.next,I===x))return f}_=_.next}while(_!==u);if(!f)return null;var M,P=f,L=f.x,N=f.y,z=1/0;_=f;do x>=_.x&&_.x>=L&&x!==_.x&&ih(b<N?x:T,b,L,N,b<N?T:x,b,_.x,_.y)&&(M=Math.abs(b-_.y)/(x-_.x),qf(_,c)&&(M<z||M===z&&(_.x>f.x||_.x===f.x&&ZP(f,_)))&&(f=_,z=M)),_=_.next;while(_!==P);return f}(t,e);if(!n)return e;var o=yE(n,t);return Hc(o,o.next),Hc(n,n.next)}function ZP(t,e){return Or(t.prev,t,e.prev)<0&&Or(e.next,t,t.next)<0}function hv(t,e,n,o,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function XP(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function ih(t,e,n,o,c,u,f,_){return(c-f)*(e-_)>=(t-f)*(u-_)&&(t-f)*(o-_)>=(n-f)*(e-_)&&(n-f)*(u-_)>=(c-f)*(o-_)}function YP(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&_E(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(qf(t,e)&&qf(e,t)&&function(n,o){var c=n,u=!1,f=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next;while(c!==n);return u}(t,e)&&(Or(t.prev,t,e.prev)||Or(t,e.prev,e))||Eg(t,e)&&Or(t.prev,t,t.next)>0&&Or(e.prev,e,e.next)>0)}function Or(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Eg(t,e){return t.x===e.x&&t.y===e.y}function _E(t,e,n,o){var c=Dg(Or(t,e,n)),u=Dg(Or(t,e,o)),f=Dg(Or(n,o,t)),_=Dg(Or(n,o,e));return c!==u&&f!==_||!(c!==0||!Ig(t,n,e))||!(u!==0||!Ig(t,o,e))||!(f!==0||!Ig(n,t,o))||!(_!==0||!Ig(n,e,o))}function Ig(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Dg(t){return t>0?1:t<0?-1:0}function qf(t,e){return Or(t.prev,t,t.next)<0?Or(t,e,t.next)>=0&&Or(t,t.prev,e)>=0:Or(t,e,t.prev)<0||Or(t,t.next,e)<0}function yE(t,e){var n=new dv(t.i,t.x,t.y),o=new dv(e.i,e.x,e.y),c=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,o.next=n,n.prev=o,u.next=o,o.prev=u,o}function vE(t,e,n,o){var c=new dv(t,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Wf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function dv(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fv(t,e,n,o){for(var c=0,u=e,f=n-o;u<n;u+=o)c+=(t[f]-t[u])*(t[u+1]+t[f+1]),f=u;return c}uv.exports=Tg,uv.exports.default=Tg,Tg.deviation=function(t,e,n,o){var c=e&&e.length,u=Math.abs(fv(t,0,c?e[0]*n:t.length,n));if(c)for(var f=0,_=e.length;f<_;f++)u-=Math.abs(fv(t,e[f]*n,f<_-1?e[f+1]*n:t.length,n));var x=0;for(f=0;f<o.length;f+=3){var b=o[f]*n,T=o[f+1]*n,I=o[f+2]*n;x+=Math.abs((t[b]-t[I])*(t[T+1]-t[b+1])-(t[b]-t[T])*(t[I+1]-t[b+1]))}return u===0&&x===0?0:Math.abs((x-u)/u)},Tg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<t.length;c++){for(var u=0;u<t[c].length;u++)for(var f=0;f<e;f++)n.vertices.push(t[c][u][f]);c>0&&n.holes.push(o+=t[c-1].length)}return n};var Mg=Zt(uv.exports);function pv(t,e){let n=t.length;if(n<=1)return[t];let o=[],c,u;for(let f=0;f<n;f++){let _=aa(t[f]);_!==0&&(t[f].area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(c&&o.push(c),c=[t[f]]):c.push(t[f]))}if(c&&o.push(c),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(g0(o[f],e,1,o[f].length-1,KP),o[f]=o[f].slice(0,e));return o}function KP(t,e){return e.area-t.area}function mv(t,e,n){let o=n.patternDependencies,c=!1;for(let u of e){let f=u.paint.get(`${t}-pattern`);f.isConstant()||(c=!0);let _=f.constantOr(null);_&&(c=!0,o[_]=!0)}return c}function gv(t,e,n,o,c){let u=c.patternDependencies;for(let f of e){let _=f.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:o},n,{},c.availableImages);x=x&&x.name?x.name:x,u[x]=!0,n.patterns[f.id]=x}}return n}class _v{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xo,this.indexArray=new Vr,this.indexArray2=new No,this.programConfigurations=new $(e.layers,e.zoom),this.segments=new yr,this.segments2=new yr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,o,c){this.hasPattern=mv("fill",this.layers,n);let u=this.layers[0].layout.get("fill-sort-key"),f=[];for(let{feature:_,id:x,index:b,sourceLayerIndex:T}of e){let I=this.layers[0]._featureFilter.needGeometry,M=Lr(_,I);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),M,o))continue;let P=u?u.evaluate(M,{},o,n.availableImages):void 0,L={id:x,properties:_.properties,type:_.type,sourceLayerIndex:T,index:b,geometry:I?M.geometry:$r(_,o,c),patterns:{},sortKey:P};f.push(L)}u&&f.sort((_,x)=>_.sortKey-x.sortKey);for(let _ of f){let{geometry:x,index:b,sourceLayerIndex:T}=_;if(this.hasPattern){let I=gv("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(_,x,b,o,{},n.availableImages,n.brightness);n.featureIndex.insert(e[b].feature,x,b,T,this.index)}}update(e,n,o,c,u){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(e,n,o,c,u,f){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,o,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,u,f=[],_){for(let x of pv(n,500)){let b=0;for(let N of x)b+=N.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=T.vertexLength,M=[],P=[];for(let N of x){if(N.length===0)continue;N!==x[0]&&P.push(M.length/2);let z=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),V=z.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(V+N.length-1,V),M.push(N[0].x),M.push(N[0].y);for(let W=1;W<N.length;W++)this.layoutVertexArray.emplaceBack(N[W].x,N[W].y),this.indexArray2.emplaceBack(V+W-1,V+W),M.push(N[W].x),M.push(N[W].y);z.vertexLength+=N.length,z.primitiveLength+=N.length}let L=Mg(M,P);for(let N=0;N<L.length;N+=3)this.indexArray.emplaceBack(I+L[N],I+L[N+1],I+L[N+2]);T.vertexLength+=b,T.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,c,_)}}ut(_v,"FillBucket",{omit:["layers","patternFeatures"]});let JP=new lr({"fill-sort-key":new Et(ye.layout_fill["fill-sort-key"]),visibility:new Xe(ye.layout_fill.visibility)});var QP={paint:new lr({"fill-antialias":new Xe(ye.paint_fill["fill-antialias"]),"fill-opacity":new Et(ye.paint_fill["fill-opacity"]),"fill-color":new Et(ye.paint_fill["fill-color"]),"fill-outline-color":new Et(ye.paint_fill["fill-outline-color"]),"fill-translate":new Xe(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Xe(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Et(ye.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xe(ye.paint_fill["fill-emissive-strength"])}),layout:JP};let eR=Rn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tR=Rn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),nR=Rn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),rR=Rn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),iR=Rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oR}=eR;var Cg={},sR=qn,xE=oh;function oh(t,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=c,t.readFields(aR,this,e)}function aR(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,c){for(var u=o.readVarint()+o.pos;o.pos<u;){var f=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[f]=_}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function lR(t){for(var e,n,o=0,c=0,u=t.length,f=u-1;c<u;f=c++)o+=((n=t[f]).x-(e=t[c]).x)*(e.y+n.y);return o}oh.types=["Unknown","Point","LineString","Polygon"],oh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,c=0,u=0,f=0,_=[];t.pos<n;){if(c<=0){var x=t.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)u+=t.readSVarint(),f+=t.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new sR(u,f));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},oh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,c=0,u=0,f=1/0,_=-1/0,x=1/0,b=-1/0;t.pos<e;){if(o<=0){var T=t.readVarint();n=7&T,o=T>>3}if(o--,n===1||n===2)(c+=t.readSVarint())<f&&(f=c),c>_&&(_=c),(u+=t.readSVarint())<x&&(x=u),u>b&&(b=u);else if(n!==7)throw new Error("unknown command "+n)}return[f,x,_,b]},oh.prototype.toGeoJSON=function(t,e,n){var o,c,u=this.extent*Math.pow(2,n),f=this.extent*t,_=this.extent*e,x=this.loadGeometry(),b=oh.types[this.type];function T(P){for(var L=0;L<P.length;L++){var N=P[L];P[L]=[360*(N.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+_)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(o=0;o<x.length;o++)I[o]=x[o][0];T(x=I);break;case 2:for(o=0;o<x.length;o++)T(x[o]);break;case 3:for(x=function(P){var L=P.length;if(L<=1)return[P];for(var N,z,V=[],W=0;W<L;W++){var J=lR(P[W]);J!==0&&(z===void 0&&(z=J<0),z===J<0?(N&&V.push(N),N=[P[W]]):N.push(P[W]))}return N&&V.push(N),V}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)T(x[o][c])}x.length===1?x=x[0]:b="Multi"+b;var M={type:"Feature",geometry:{type:b,coordinates:x},properties:this.properties};return"id"in this&&(M.id=this.id),M};var cR=xE,bE=wE;function wE(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(uR,this,e),this.length=this._features.length}function uR(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var c=null,u=o.readVarint()+o.pos;o.pos<u;){var f=o.readVarint()>>3;c=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return c}(n))}wE.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new cR(this._pbf,e,this.extent,this._keys,this._values)};var hR=bE;function dR(t,e,n){if(t===3){var o=new hR(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var yv=Cg.VectorTile=function(t,e){this.layers=t.readFields(dR,{},e)},Sg=Cg.VectorTileFeature=xE;function Ag(t,e,n,o){let c=[],u=o===0?(f,_,x,b,T,I)=>{f.push(new Ge(I,x+(I-_)/(b-_)*(T-x)))}:(f,_,x,b,T,I)=>{f.push(new Ge(_+(I-x)/(T-x)*(b-_),I))};for(let f of t){let _=[];for(let x of f){if(x.length<=2)continue;let b=[];for(let M=0;M<x.length-1;M++){let P=x[M].x,L=x[M].y,N=x[M+1].x,z=x[M+1].y,V=o===0?P:L,W=o===0?N:z;V<e?W>e&&u(b,P,L,N,z,e):V>n?W<n&&u(b,P,L,N,z,n):b.push(x[M]),W<e&&V>=e&&u(b,P,L,N,z,e),W>n&&V<=n&&u(b,P,L,N,z,n)}let T=x[x.length-1],I=o===0?T.x:T.y;I>=e&&I<=n&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),_.push(b))}_.length&&c.push(_)}return c}function Pg(t,e){return t.x-e.x||t.y-e.y}function TE(t,e){return Pg(t.min,e.min)===0&&Pg(t.max,e.max)===0}function EE(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function IE(t,e,n){let o=1/rt,c=1/(1<<n.canonical.z),u=(e.x*o+n.canonical.x)*c+n.wrap,f=(e.y*o+n.canonical.y)*c;return{min:new Ge((t.x*o+n.canonical.x)*c+n.wrap,(t.y*o+n.canonical.y)*c),max:new Ge(u,f)}}function fR(t,e,n){let o=1<<n.canonical.z,c=((e.x-n.wrap)*o-n.canonical.x)*rt,u=(e.y*o-n.canonical.y)*rt;return{min:new Ge(((t.x-n.wrap)*o-n.canonical.x)*rt,(t.y*o-n.canonical.y)*rt),max:new Ge(c,u)}}function DE(t,e,n,o,c,u,f){let _=t.indices,x=t.vertices,b=[];for(let T=o;T<o+c;T+=3){let I=e[n[T+0]+u],M=e[n[T+1]+u],P=e[n[T+2]+u],L=Math.min(I.x,M.x,P.x),N=Math.max(I.x,M.x,P.x),z=Math.min(I.y,M.y,P.y),V=Math.max(I.y,M.y,P.y);b.length=0,t.grid.query(new Ge(L,z),new Ge(N,V),b);for(let W=0;W<b.length;W++){let J=b[W];if(B0(x[_[3*J+0]],x[_[3*J+1]],x[_[3*J+2]],I,M,P,f))return!0}}return!1}function ME(t,e,n,o){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(n.vertices.length<t.vertices.length)return ME(n,o,t,e);let u=e.canonical,f=o.canonical,_=Math.pow(2,f.z-u.z);c=t.vertices.map(x=>new Ge(x.x*u.x*rt*_-f.x*rt,x.y*u.y*rt*_-f.y*rt))}return DE(n,c,t.indices,0,t.indices.length,0,0)}Cg.VectorTileLayer=bE;class CE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function SE(t,e,n,o){let c=0,u=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(n[f]<t[f]||n[f]>e[f])return null}else{let _=1/o[f],x=(t[f]-n[f])*_,b=(e[f]-n[f])*_;if(x>b){let T=x;x=b,b=T}if(x>c&&(c=x),b<u&&(u=b),c>u)return null}return c}function AE(t,e,n,o,c,u,f,_,x,b,T){let I=o-t,M=c-e,P=u-n,L=f-t,N=_-e,z=x-n,V=T[1]*z-T[2]*N,W=T[2]*L-T[0]*z,J=T[0]*N-T[1]*L,K=I*V+M*W+P*J;if(Math.abs(K)<1e-15)return null;let ie=1/K,ne=b[0]-t,le=b[1]-e,de=b[2]-n,me=(ne*V+le*W+de*J)*ie;if(me<0||me>1)return null;let be=le*P-de*M,ge=de*I-ne*P,Me=ne*M-le*I,Ne=(T[0]*be+T[1]*ge+T[2]*Me)*ie;return Ne<0||me+Ne>1?null:(L*be+N*ge+z*Me)*ie}function PE(t,e,n){return(t-e)/(n-e)}function RE(t,e,n,o,c,u,f,_,x){let b=1<<n,T=u-o,I=f-c,M=(t+1)/b*T+o,P=(e+0)/b*I+c,L=(e+1)/b*I+c;_[0]=(t+0)/b*T+o,_[1]=P,x[0]=M,x[1]=L}class LE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(u){let f=Math.ceil(Math.log2(u.dim/8)),_=[],x=Math.ceil(Math.pow(2,f)),b=1/x,T=(P,L,N,z,V)=>{let W=z?1:0,J=(P+1)*N-W,K=L*N,ie=(L+1)*N-W;V[0]=P*N,V[1]=K,V[2]=J,V[3]=ie},I=new CE(x),M=[];for(let P=0;P<x*x;P++){T(P%x,Math.floor(P/x),b,!1,M);let L=Il(M[0],M[1],u),N=Il(M[2],M[1],u),z=Il(M[2],M[3],u),V=Il(M[0],M[3],u);I.minimums.push(Math.min(L,N,z,V)),I.maximums.push(Math.max(L,N,z,V)),I.leaves.push(1)}for(_.push(I),x/=2;x>=1;x/=2){let P=_[_.length-1];I=new CE(x);for(let L=0;L<x*x;L++){T(L%x,Math.floor(L/x),2,!0,M);let N=P.getElevation(M[0],M[1]),z=P.getElevation(M[2],M[1]),V=P.getElevation(M[2],M[3]),W=P.getElevation(M[0],M[3]),J=P.isLeaf(M[0],M[1]),K=P.isLeaf(M[2],M[1]),ie=P.isLeaf(M[2],M[3]),ne=P.isLeaf(M[0],M[3]),le=Math.min(N.min,z.min,V.min,W.min),de=Math.max(N.max,z.max,V.max,W.max),me=J&&K&&ie&&ne;I.maximums.push(de),I.minimums.push(le),I.leaves.push(de-le<=5&&me?1:0)}_.push(I)}return _}(this.dem),o=n.length-1,c=n[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,c,u,f,_=1){return SE([e,n,-100],[o,c,this.maximums[0]*_],u,f)}raycast(e,n,o,c,u,f,_=1){if(!this.nodeCount)return null;let x=this.raycastRoot(e,n,o,c,u,f,_);if(x==null)return null;let b=[],T=[],I=[],M=[],P=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:L,t:N,nodex:z,nodey:V,depth:W}=P.pop();if(this.leaves[L]){RE(z,V,W,e,n,o,c,I,M);let K=1<<W,ie=(z+0)/K,ne=(z+1)/K,le=(V+0)/K,de=(V+1)/K,me=Il(ie,le,this.dem)*_,be=Il(ne,le,this.dem)*_,ge=Il(ne,de,this.dem)*_,Me=Il(ie,de,this.dem)*_,Ne=AE(I[0],I[1],me,M[0],I[1],be,M[0],M[1],ge,u,f),Ie=AE(M[0],M[1],ge,I[0],M[1],Me,I[0],I[1],me,u,f),Le=Math.min(Ne!==null?Ne:Number.MAX_VALUE,Ie!==null?Ie:Number.MAX_VALUE);if(Le!==Number.MAX_VALUE)return Le;{let Te=i.N.scaleAndAdd([],u,f,N);if(OE(me,be,Me,ge,PE(Te[0],I[0],M[0]),PE(Te[1],I[1],M[1]))>=Te[2])return N}continue}let J=0;for(let K=0;K<this._siblingOffset.length;K++){RE((z<<1)+this._siblingOffset[K][0],(V<<1)+this._siblingOffset[K][1],W+1,e,n,o,c,I,M),I[2]=-100,M[2]=this.maximums[this.childOffsets[L]+K]*_;let ie=SE(I,M,u,f);if(ie!=null){let ne=ie;b[K]=ne;let le=!1;for(let de=0;de<J&&!le;de++)ne>=b[T[de]]&&(T.splice(de,0,K),le=!0);le||(T[J]=K),J++}}for(let K=0;K<J;K++){let ie=T[K];P.push({idx:this.childOffsets[L]+ie,t:b[ie],nodex:(z<<1)+this._siblingOffset[ie][0],nodey:(V<<1)+this._siblingOffset[ie][1],depth:W+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,c,u){if(e[c].isLeaf(n,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let f=c-1,_=e[f],x=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*n+this._siblingOffset[T][0],M=2*o+this._siblingOffset[T][1],P=_.getElevation(I,M),L=_.isLeaf(I,M),N=this._addNode(P.min,P.max,L);L&&(x|=1<<T),b||(b=N)}for(let T=0;T<this._siblingOffset.length;T++)x&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*o+this._siblingOffset[T][1],f,b+T)}}function OE(t,e,n,o,c,u){return cn(cn(t,n,u),cn(e,o,u),c)}function Il(t,e,n){let o=n.dim,c=Xt(t*o-.5,0,o-1),u=Xt(e*o-.5,0,o-1),f=Math.floor(c),_=Math.floor(u),x=Math.min(f+1,o-1),b=Math.min(_+1,o-1);return OE(n.get(f,_),n.get(x,_),n.get(f,b),n.get(x,b),c-f,u-_)}let pR={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mR(t,e,n){return(256*t*256+256*e+n)/10-1e4}function gR(t,e,n){return 256*t+e+n/256-32768}class Rg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return _r(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let u=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let x=0;x<u;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(u,x)]=f[this._idx(u-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,u)]=f[this._idx(x,u-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(u,-1)]=f[this._idx(u-1,0)],f[this._idx(-1,u)]=f[this._idx(0,u-1)],f[this._idx(u,u)]=f[this._idx(u-1,u-1)]}let _=o==="terrarium"?gR:mR;for(let x=0;x<f.length;++x){let b=4*x;this.floatView[x]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=$e.now()}_buildQuadTree(){this._tree=new LE(this)}get(e,n,o=!1){o&&(e=Xt(e,-1,this.dim),n=Xt(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,o){let c=this._idx(e,n),u=this.floatView[c];return this.floatView[c]=o,o-u}static getUnpackVector(e){return pR[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let o=[0,0,0,0],c=Rg.getUnpackVector(n),u=Math.floor((e+c[3])/c[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new mE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,u=n*this.dim+this.dim,f=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=u-1;break;case 1:u=c+1}switch(o){case-1:f=_-1;break;case 1:_=f+1}let x=-n*this.dim,b=-o*this.dim;for(let T=f;T<_;T++)for(let I=c;I<u;I++){let M=4*this._idx(I,T),P=4*this._idx(I+x,T+b);this.pixels[M+0]=e.pixels[P+0],this.pixels[M+1]=e.pixels[P+1],this.pixels[M+2]=e.pixels[P+2],this.pixels[M+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ut(Rg,"DEMData"),ut(LE,"DemMinMaxQuadTree",{omit:["dem"]});class sh{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){let c=o||e.findDEMTileFor(n);if(!c||!c.dem)return;let u=c.dem,f=c.tileID,_=1<<n.canonical.z-f.canonical.z;return new sh(c,u.dim/rt/_,[(n.canonical.x/_-f.canonical.x)*u.dim,(n.canonical.y/_-f.canonical.y)*u.dim])}tileCoordToPixel(e,n){let o=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new Ge(c,u)}getElevationAt(e,n,o,c){let u=e*this._scale+this._offset[0],f=n*this._scale+this._offset[1],_=Math.floor(u),x=Math.floor(f),b=this._dem;return c=!!c,o?cn(cn(b.get(_,x,c),b.get(_,x+1,c),f-x),cn(b.get(_+1,x,c),b.get(_+1,x+1,c),f-x),u-_):b.get(_,x,c)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*zt(1,e)*this._dem.stride}}let _R=Sg.types,yR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],vR=["fill-extrusion-flood-light-ground-radius"],xR=Math.pow(2,13),bR=Math.pow(2,15)-1,NE=new Ge(0,1),Dl=2147483648;function Zf(t,e,n,o,c,u,f,_){t.emplaceBack((e<<1)+f,(n<<1)+u,(Math.floor(o*xR)<<1)+c,Math.round(_))}function Lg(t,e,n,o,c,u){t.emplaceBack(e.x,e.y,(n.x<<1)+o,(n.y<<1)+c,u)}function Xf(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class kE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class FE{constructor(){this.centroidXY=new Ge(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ge(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ge(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ge(this.max.x-this.min.x,this.max.y-this.min.y)}}class zE{constructor(){this.acc=new Ge(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,o){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===rt)&&n.x===o.x)!=((n.y===0||n.y===rt)&&n.y===o.y)&&this.processBorderOverlap(n,o),c&&this.checkBorderIntersection(n,o)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,cn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>rt!=e.x>rt&&this.addBorderIntersection(1,cn(n.y,e.y,(rt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,cn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>rt!=e.y>rt&&this.addBorderIntersection(3,cn(n.x,e.x,(rt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Ge(0,0):new Ge(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function BE(t,e){let n=t.add(e)._unit(),o=Xt(t.x*n.x+t.y*n.y,-1,1);var c,u,f;return c=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(c)))/4*bR*((u=t).x*(f=e).y-u.y*f.x<0?-1:1)}let wR=[t=>t.x<0,t=>t.x>rt,t=>t.y<0,t=>t.y>rt];function TR(t,e,n,o){let c=[4];if(o===0)return c;n._mult(o);let u=t.sub(n),f=e.sub(n),_=[t,e,u,f];for(let x=0;x<4;x++)for(let b of _)if(wR[x](b)){c.push(x);break}return c}class jE{constructor(e){this.vertexArray=new Mf,this.indexArray=new Vr,this.programConfigurations=new $(e.layers,e.zoom,n=>vR.includes(n)),this._segments=new yr,this.hiddenByLandmarkVertexArray=new kf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new yr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,o,c=!1){let u=e.length;if(u>2){let f=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[f].length),x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{let b=e[0],T=e[1];x=BE(b.sub(e[u-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<u;b++){let T=b===u-1?0:b+1,I=e[b],M=e[T],P=e[T===u-1?0:T+1],L=M.sub(I)._perp()._unit(),N=BE(L,P.sub(M)._perp()._unit()),z=x,V=N;if(vv(I,M,n)||c&&$E(I,n)&&$E(M,n)){x=N;continue}let W=_.vertexLength;Lg(this.vertexArray,I,M,1,1,z),Lg(this.vertexArray,I,M,1,0,z),Lg(this.vertexArray,I,M,0,1,V),Lg(this.vertexArray,I,M,0,0,V),_.vertexLength+=4;let J=TR(I,M,L,o);for(let K of J)this._segmentToGroundQuads[f].push({id:W,region:K}),this._segmentToRegionTriCounts[f][K]+=2,_.primitiveLength+=2;x=N}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let o=0;o<n;o++)this._segmentToGroundQuads[o].sort((c,u)=>c.region-u.region);for(let o=0;o<n;o++){let c=this._segmentToGroundQuads[o],u=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((x,b)=>x+b,0);let _=0;for(let x=0;x<=4;x++){let b=f[x];if(b!==0){let T=this.regionSegments[x];T||(T=this.regionSegments[x]=new yr);let I={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+_,vertexLength:u.vertexLength,primitiveLength:b};T.get().push(I)}_+=b}for(let x=0;x<c.length;x++){let b=c[x].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,o,c,u,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,o,c,u,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,tR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,o,c,u,f){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,o,c,u,f)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&Dl?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,rR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class Og{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Vr,this.footprintVertices=new xo,this.footprintSegments=[],this.layoutVertexArray=new Jo,this.centroidVertexArray=new Fc,this.indexArray=new Vr,this.programConfigurations=new $(e.layers,e.zoom,n=>yR.includes(n)),this.segments=new yr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new jE(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,o,c){this.features=[],this.hasPattern=mv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=nn(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:u,id:f,index:_,sourceLayerIndex:x}of e){let b=this.layers[0]._featureFilter.needGeometry,T=Lr(u,b);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),T,o))continue;let I={id:f,sourceLayerIndex:x,index:_,geometry:b?T.geometry:$r(u,o,c),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(gv("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,_,o,{},n.availableImages,c,n.brightness),n.featureIndex.insert(u,I.geometry,_,x,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,o,c,u,f){for(let _ of this.features){let{geometry:x}=_;this.addFeature(_,x,_.index,n,o,c,u,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,o,c,u){let f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;let _=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,o,c,u),this.groundEffect.update(e,n,_,o,c,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,iR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,nR.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c,u,f,_,x){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new Ge(0,0),new Ge(rt,rt)],I=_.projection,M=I.name==="globe",P=_R[e.type]==="Polygon",L=new zE;L.centroidDataIndex=this.centroidData.length;let N=new FE,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);N.height=V,N.vertexArrayOffset=this.layoutVertexArray.length,N.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xu);let W=pv(n,500);for(let de=W.length-1;de>=0;de--){let me=W[de];(me.length===0||(J=me[0]).every(be=>be.x<=0)||J.every(be=>be.x>=rt)||J.every(be=>be.y<=0)||J.every(be=>be.y>=rt))&&W.splice(de,1)}var J;let K;if(M)K=WE(W,T,c);else{K=[];for(let de of W)K.push({polygon:de,bounds:T})}let ie=P?this.edgeRadius:0,ne=ie>0&&this.zoom<17,le=(de,me)=>{if(de.length===0)return!1;let be=de[de.length-1];return me.x===be.x&&me.y===be.y};for(let{polygon:de,bounds:me}of K){let be=0,ge=0;for(let Le of de)P&&!Le[0].equals(Le[Le.length-1])&&Le.push(Le[0]),ge+=P?Le.length-1:Le.length;let Me=this.segments.prepareSegment((P?5:4)*ge,this.layoutVertexArray,this.indexArray);N.footprintSegIdx<0&&(N.footprintSegIdx=this.footprintSegments.length),N.polygonSegIdx<0&&(N.polygonSegIdx=this.polygonSegments.length);let Ne={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ie=new kE;if(Ie.vertexOffset=this.footprintVertices.length,Ie.indexOffset=3*this.footprintIndices.length,Ie.ringIndices=[],P){let Le=[],Te=[];be=Me.vertexLength;for(let Ke=0;Ke<de.length;Ke++){let Fe=de[Ke];Fe.length&&Ke!==0&&Te.push(Le.length/2);let dt=[],st,Ve;st=Fe[1].sub(Fe[0])._perp()._unit(),Ie.ringIndices.push(Fe.length-1);for(let Ct=1;Ct<Fe.length;Ct++){let vt=Fe[Ct],ht=Fe[Ct===Fe.length-1?1:Ct+1],Ue=vt.clone();if(ie){Ve=ht.sub(vt)._perp()._unit();let It=st.add(Ve)._unit(),Ht=ie*Math.min(4,1/(st.x*It.x+st.y*It.y));Ue.x+=Ht*It.x,Ue.y+=Ht*It.y,Ue.x=Math.round(Ue.x),Ue.y=Math.round(Ue.y),st=Ve}!z||ie!==0&&!ne||le(dt,Ue)||dt.push(Ue),Zf(this.layoutVertexArray,Ue.x,Ue.y,0,0,1,1,0),Me.vertexLength++,this.footprintVertices.emplaceBack(vt.x,vt.y),Le.push(vt.x,vt.y),M&&Xf(this.layoutVertexExtArray,I.projectTilePoint(Ue.x,Ue.y,c),I.upVector(c,Ue.x,Ue.y))}z&&(ie===0||ne)&&(dt.length!==0&&le(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,me,b))}let Re=Mg(Le,Te);for(let Ke=0;Ke<Re.length;Ke+=3)this.footprintIndices.emplaceBack(Ie.vertexOffset+Re[Ke+0],Ie.vertexOffset+Re[Ke+1],Ie.vertexOffset+Re[Ke+2]),this.indexArray.emplaceBack(be+Re[Ke],be+Re[Ke+2],be+Re[Ke+1]),Me.primitiveLength++;Ie.indexCount+=Re.length,Ie.vertexCount+=this.footprintVertices.length-Ie.vertexOffset}for(let Le=0;Le<de.length;Le++){let Te=de[Le];L.startRing(N,Te[0]);let Re=Te.length>4&&GE(Te[Te.length-2],Te[0],Te[1]),Ke=ie?ER(Te[Te.length-2],Te[0],Te[1],ie):0,Fe=[],dt,st,Ve;st=Te[1].sub(Te[0])._perp()._unit();let Ct=!0;for(let vt=1,ht=0;vt<Te.length;vt++){let Ue=Te[vt-1],It=Te[vt],Ht=Te[vt===Te.length-1?1:vt+1];if(L.appendEdge(N,It,Ue),vv(It,Ue,me)){ie&&(st=Ht.sub(It)._perp()._unit(),Ct=!Ct);continue}let St=It.sub(Ue)._perp(),qt=St.x/(Math.abs(St.x)+Math.abs(St.y)),Ot=St.y>0?1:0,un=Ue.dist(It);if(ht+un>32768&&(ht=0),ie){Ve=Ht.sub(It)._perp()._unit();let wn=UE(Ue,It,Ht,VE(st,Ve),ie);isNaN(wn)&&(wn=0);let Cn=It.sub(Ue)._unit();Ue=Ue.add(Cn.mult(Ke))._round(),It=It.add(Cn.mult(-wn))._round(),Ke=wn,st=Ve,z&&this.zoom>=17&&(le(Fe,Ue)||Fe.push(Ue),le(Fe,It)||Fe.push(It))}let Bt=Me.vertexLength,Gn=Te.length>4&&GE(Ue,It,Ht),vn=HE(ht,Re,Ct);if(Zf(this.layoutVertexArray,Ue.x,Ue.y,qt,Ot,0,0,vn),Zf(this.layoutVertexArray,Ue.x,Ue.y,qt,Ot,0,1,vn),ht+=un,vn=HE(ht,Gn,!Ct),Re=Gn,Zf(this.layoutVertexArray,It.x,It.y,qt,Ot,0,0,vn),Zf(this.layoutVertexArray,It.x,It.y,qt,Ot,0,1,vn),Me.vertexLength+=4,this.indexArray.emplaceBack(Bt+0,Bt+1,Bt+2),this.indexArray.emplaceBack(Bt+1,Bt+3,Bt+2),Me.primitiveLength+=2,ie){let wn=be+(vt===1?Te.length-2:vt-2),Cn=vt===1?be:wn+1;if(this.indexArray.emplaceBack(Bt+1,wn,Bt+3),this.indexArray.emplaceBack(wn,Cn,Bt+3),Me.primitiveLength+=2,dt===void 0&&(dt=Bt),!vv(Ht,Te[vt],me)){let xn=vt===Te.length-1?dt:Me.vertexLength;this.indexArray.emplaceBack(Bt+2,Bt+3,xn),this.indexArray.emplaceBack(Bt+3,xn+1,xn),this.indexArray.emplaceBack(Bt+3,Cn,xn+1),Me.primitiveLength+=3}Ct=!Ct}if(M){let wn=this.layoutVertexExtArray,Cn=I.projectTilePoint(Ue.x,Ue.y,c),xn=I.projectTilePoint(It.x,It.y,c),ir=I.upVector(c,Ue.x,Ue.y),Nn=I.upVector(c,It.x,It.y);Xf(wn,Cn,ir),Xf(wn,Cn,ir),Xf(wn,xn,Nn),Xf(wn,xn,Nn)}}P&&(be+=Te.length-1),z&&ie&&this.zoom>=17&&(Fe.length!==0&&le(Fe,Fe[0])&&Fe.pop(),this.groundEffect.addData(Fe,me,b,ie>0))}this.footprintSegments.push(Ie),Ne.triangleCount=this.indexArray.length-Ne.triangleArrayOffset,this.polygonSegments.push(Ne),++N.footprintSegLen,++N.polygonSegLen}if(N.vertexCount=this.layoutVertexArray.length-N.vertexArrayOffset,N.groundVertexCount=this.groundEffect.vertexArray.length-N.groundVertexArrayOffset,N.vertexCount!==0){if(N.centroidXY=L.borders?NE:this.encodeCentroid(L,N),this.centroidData.push(N),L.borders){this.featuresOnBorder.push(L);let de=this.featuresOnBorder.length-1;for(let me=0;me<L.borders.length;me++)L.borders[me][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[me].push(de)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,c,x),this.groundEffect.addPaintPropertiesData(e,o,u,f,c,x),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let x=this.centroidData[_],b=+(x.min.y+x.max.y>rt),T=2*b+(+(x.min.x+x.max.x>rt)^b);for(let I=0;I<x.polygonSegLen;I++){let M=x.polygonSegIdx+I;e.push({centroidIdx:_,subtile:T,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}let n=new Vr;e.sort((_,x)=>_.triangleSegmentIdx===x.triangleSegmentIdx?_.subtile-x.subtile:_.triangleSegmentIdx-x.triangleSegmentIdx);let o=0,c=0,u=0;for(let _ of e){if(_.triangleSegmentIdx!==o)break;u++}let f=e.length;for(;c!==e.length;){o=e[c].triangleSegmentIdx;let _=0,x=c,b=c;for(let T=x;T<u&&e[T].subtile===_;T++)b++;for(;x!==u;){let T=e[x];_=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),M=this.centroidData[T.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=x;L<b;L++){let N=e[L],z=this.polygonSegments[N.polygonSegmentIdx],V=this.centroidData[N.centroidIdx].min,W=this.centroidData[N.centroidIdx].max,J=this.indexArray.uint16;for(let K=z.triangleArrayOffset;K<z.triangleArrayOffset+z.triangleCount;K++)n.emplaceBack(J[3*K],J[3*K+1],J[3*K+2]);P.primitiveLength+=z.triangleCount,I.x=Math.min(I.x,V.x),I.y=Math.min(I.y,V.y),M.x=Math.max(M.x,W.x),M.y=Math.max(M.y,W.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:I,max:M}),x=b;for(let L=x;L<u&&e[L].subtile===e[x].subtile;L++)b++}c=u;for(let T=c;T<f&&e[T].triangleSegmentIdx===e[c].triangleSegmentIdx;T++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,o){let c=0,u=0,f=1<<e.canonical.z;if(n){let N=n.getMinMaxForTile(e);N&&(c=N.min,u=N.max)}u+=this.maxHeight;let _=e.toUnwrapped(),x,b=[_.canonical.x/f+_.wrap,_.canonical.y/f],T=[(_.canonical.x+1)/f+_.wrap,(_.canonical.y+1)/f],I=new yr,M=(N,z,V)=>[N[0]*(1-V[0])+z[0]*V[0],N[1]*(1-V[1])+z[1]*V[1]],P=[],L=[];for(let N of this.triangleSubSegments){P[0]=N.min.x/rt,P[1]=N.min.y/rt,L[0]=N.max.x/rt,L[1]=N.max.y/rt;let z=M(b,T,P),V=M(b,T,L);if(new mr([z[0],z[1],c],[V[0],V[1],u]).intersectsPrecise(o)===0){x&&(I.segments.push(x),x=void 0);continue}let W=N.segment;x&&x.vertexOffset!==W.vertexOffset&&(I.segments.push(x),x=void 0),x?(x.vertexLength+=W.vertexLength,x.primitiveLength+=W.primitiveLength):x={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&I.segments.push(x),I}encodeCentroid(e,n){let o=e.centroid(),c=n.span(),u=Math.min(7,Math.round(c.x*this.tileToMeter/10)),f=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Ge(Xt(o.x,1,rt-1)<<3|u,Xt(o.y,1,rt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Ge(0,0);let n=e.borders,o=Number.MAX_VALUE;if(n[0][0]!==o||n[1][0]!==o){let c=n[0][0]!==o?0:1;return new Ge(6|(n[0][0]!==o?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==o?2:3;return new Ge((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==o?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Dl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,c=e.flags&Dl?NE:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||u!==c.x){for(let f=n;f<o;++f)this.centroidVertexArray.emplace(f,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,f){if(u.length!==f.length)return!1;for(let _=0;_<u.length;_++)if(u[_].sourceId!==f[_].sourceId||!TE(u[_],f[_]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let u of this.centroidData)u.flags&=2147483647;let c=[];for(let u of this.activeReplacements){let f=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(let _ of this.centroidData)if(!(_.flags&Dl||u.min.x>_.max.x||_.min.x>u.max.x||u.min.y>_.max.y||_.min.y>u.max.y))for(let x=0;x<_.footprintSegLen;x++){let b=this.footprintSegments[_.footprintSegIdx+x];if(c.length=0,IR(this.footprintVertices,b.vertexOffset,b.vertexCount,u.footprintTileId.canonical,e.canonical,c),DE(u.footprint,c,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-f)){_.flags|=Dl;break}}}for(let u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,o){let c=!1;for(let u=0;u<o.footprintSegLen;u++){let f=this.footprintSegments[o.footprintSegIdx+u],_=0;for(let x of f.ringIndices){for(let b=_,T=x+_-1;b<x+_;T=b++){let I=this.footprintVertices.int16[2*(b+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(b+f.vertexOffset)+1],P=this.footprintVertices.int16[2*(T+f.vertexOffset)+1];M>n!=P>n&&e<(this.footprintVertices.int16[2*(T+f.vertexOffset)+0]-I)*(n-M)/(P-M)+I&&(c=!c)}_=x}}return c}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,c=!0,u=4*(e+rt)*rt+(n+rt);if(this.partLookup.hasOwnProperty(u)){let f=this.partLookup[u];return f?{height:f.height,hidden:!!(f.flags&Dl)}:void 0}for(let f of this.centroidData)e>f.max.x||f.min.x>e||n>f.max.y||f.min.y>n||this.footprintContainsPoint(e,n,f)&&f&&f.height>o&&(o=f.height,this.partLookup[u]=f,c=!!(f.flags&Dl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.partLookup[u]=void 0}}function VE(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function ER(t,e,n,o){let c=e.sub(t)._perp()._unit(),u=n.sub(e)._perp()._unit();return UE(t,e,n,VE(c,u),o)}function UE(t,e,n,o,c){let u=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,c*u/o)}function vv(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function $E(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function GE(t,e,n){if(t.x<0||t.x>=rt||e.x<0||e.x>=rt||n.x<0||n.x>=rt)return!1;let o=n.sub(e),c=o.perp(),u=t.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&c.x*u.x+c.y*u.y<0}function HE(t,e,n){let o=e?2|t:-3&t;return n?1|o:-2&o}function qE(){let t=Math.PI/32,e=Math.tan(t),n=Ee;return n*Math.sqrt(1+2*e*e)-n}function WE(t,e,n){let o=1<<n.z,c=kt(n.x/o),u=kt((n.x+1)/o),f=dn(n.y/o),_=dn((n.y+1)/o);return function(x,b,T,I,M=0,P){let L=[];if(!x.length||!T||!I)return L;let N=(ne,le)=>{for(let de of ne)L.push({polygon:de,bounds:le})},z=Math.ceil(Math.log2(T)),V=Math.ceil(Math.log2(I)),W=z-V,J=[];for(let ne=0;ne<Math.abs(W);ne++)J.push(W>0?0:1);for(let ne=0;ne<Math.min(z,V);ne++)J.push(0),J.push(1);let K=x;if(K=Ag(K,b[0].y-M,b[1].y+M,1),K=Ag(K,b[0].x-M,b[1].x+M,0),!K.length)return L;let ie=[];for(J.length?ie.push({polygons:K,bounds:b,depth:0}):N(K,b);ie.length;){let ne=ie.pop(),le=ne.depth,de=J[le],me=ne.bounds[0],be=ne.bounds[1],ge=de===0?me.x:me.y,Me=de===0?be.x:be.y,Ne=P?P(de,ge,Me):.5*(ge+Me),Ie=Ag(ne.polygons,ge-M,Ne+M,de),Le=Ag(ne.polygons,Ne-M,Me+M,de);if(Ie.length){let Te=[me,new Ge(de===0?Ne:be.x,de===1?Ne:be.y)];J.length>le+1?ie.push({polygons:Ie,bounds:Te,depth:le+1}):N(Ie,Te)}if(Le.length){let Te=[new Ge(de===0?Ne:me.x,de===1?Ne:me.y),be];J.length>le+1?ie.push({polygons:Le,bounds:Te,depth:le+1}):N(Le,Te)}}return L}(t,e,Math.ceil((u-c)/11.25),Math.ceil((f-_)/11.25),1,(x,b,T)=>{if(x===0)return .5*(b+T);{let I=dn((n.y+b/rt)/o);return(Rt(.5*(dn((n.y+T/rt)/o)+I))*o-n.y)*rt}})}function IR(t,e,n,o,c,u){let f=Math.pow(2,o.z-c.z);for(let _=0;_<n;_++){let x=t.int16[2*(_+e)+0],b=t.int16[2*(_+e)+1];x=(x+c.x*rt)*f-o.x*rt,b=(b+c.y*rt)*f-o.y*rt,u.push(new Ge(x,b))}}ut(Og,"FillExtrusionBucket",{omit:["layers","features"]}),ut(FE,"PartData"),ut(kE,"FootprintSegment"),ut(zE,"BorderCentroidData"),ut(jE,"GroundEffect");let DR=new lr({visibility:new Xe(ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xe(ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var MR={paint:new lr({"fill-extrusion-opacity":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Et(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Et(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Et(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Et(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Et(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Et(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xe(ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:DR};class ah extends Ge{constructor(e,n,o){super(e,n),this.z=o}}function Yf(t,e){return t.x*e.x+t.y*e.y}function ZE(t,e){if(t.length===1){let n=0,o=e[n++],c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let u=e[n],f=t[0],_=c.sub(o),x=u.sub(o),b=f.sub(o),T=Yf(_,_),I=Yf(_,x),M=Yf(x,x),P=Yf(b,_),L=Yf(b,x),N=T*M-I*I,z=(M*P-I*L)/N,V=(T*L-I*P)/N,W=o.z*(1-z-V)+c.z*z+u.z*V;if(isFinite(W))return W}return 1/0}{let n=1/0;for(let o of e)n=Math.min(n,o.z);return n}}function XE(t,e,n,o,c,u,f,_){let x=f*c.getElevationAt(t,e,!0,!0),b=u[0]!==0,T=b?u[1]===0?f*(u[0]/7-450):f*function(I,M,P){let L=Math.floor(M[0]/8),N=Math.floor(M[1]/8),z=10*(M[0]-8*L),V=10*(M[1]-8*N),W=I.getElevationAt(L,N,!0,!0),J=I.getMeterToDEM(P),K=Math.floor(.5*(z*J-1)),ie=Math.floor(.5*(V*J-1)),ne=I.tileCoordToPixel(L,N),le=2*K+1,de=2*ie+1,me=function(Le,Te,Re,Ke,Fe){return[Le.getElevationAtPixel(Te,Re,!0),Le.getElevationAtPixel(Te+Fe,Re,!0),Le.getElevationAtPixel(Te,Re+Fe,!0),Le.getElevationAtPixel(Te+Ke,Re+Fe,!0)]}(I,ne.x-K,ne.y-ie,le,de),be=Math.abs(me[0]-me[1]),ge=Math.abs(me[2]-me[3]),Me=Math.abs(me[0]-me[2])+Math.abs(me[1]-me[3]),Ne=Math.min(.25,.5*J*(be+ge)/le),Ie=Math.min(.25,.5*J*Me/de);return W+Math.max(Ne*z,Ie*V)}(c,u,_):x;return{base:x+(n===0)?-1:n,top:b?Math.max(T+o,x+n+2):x+o}}let CR=Rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:SR}=CR,AR=Rn([{name:"a_packed",components:4,type:"Float32"}]),{members:PR}=AR;class YE{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new El({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let o=this.getKey(e,n);return this.positions[o]}trim(){let e=this.width,n=this.height=Ql(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){let c=[],u=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,_=!0;c.push({left:u,right:f,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){_=!_;let T=e[b];u=x*o,x+=T,f=x*o,c.push({left:u,right:f,isDash:_,zeroLength:T===0})}return c}addRoundDash(e,n,o){let c=n/2;for(let u=-o;u<=o;u++){let f=this.width*(this.nextRow+o+u),_=0,x=e[_];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++_]);let T=Math.abs(b-x.left),I=Math.abs(b-x.right),M=Math.min(T,I),P,L=u/o*(c+1);if(x.isDash){let N=c-Math.abs(L);P=Math.sqrt(M*M+N*N)}else P=c-Math.sqrt(M*M+L*L);this.image.data[f+b]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){let b=e[x],T=e[x+1];b.zeroLength?e.splice(x,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(x,1))}let o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);let u=this.width*this.nextRow,f=0,_=e[f];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++f]);let b=Math.abs(x-_.left),T=Math.abs(x-_.right),I=Math.min(b,T);this.image.data[u+x]=Math.max(0,Math.min(255,(_.isDash?I:-I)+n+128))}}addDash(e,n){let o=this.getKey(e,n);if(this.positions[o])return this.positions[o];let c=n==="round",u=c?7:0,f=2*u+1;if(this.nextRow+f>this.height)return _r("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(_r("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){let T=this.width/_,I=this.getDashRanges(e,this.width,T);c?this.addRoundDash(I,T,u):this.addRegularDash(I,n==="square"?.5*T:0)}let x=this.nextRow+u;this.nextRow+=f;let b={tl:[x,u],br:[_,0]};return this.positions[o]=b,b}}ut(YE,"LineAtlas");let RR=Sg.types,LR=Math.cos(Math.PI/180*37.5);class xv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Cf,this.layoutVertexArray2=new Fs,this.indexArray=new Vr,this.programConfigurations=new $(e.layers,e.zoom),this.segments=new yr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){this.hasPattern=mv("line",this.layers,n);let u=this.layers[0].layout.get("line-sort-key"),f=[];for(let{feature:T,id:I,index:M,sourceLayerIndex:P}of e){let L=this.layers[0]._featureFilter.needGeometry,N=Lr(T,L);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),N,o))continue;let z=u?u.evaluate(N,{},o):void 0,V={id:I,properties:T.properties,type:T.type,sourceLayerIndex:P,index:M,geometry:L?N.geometry:$r(T,o,c),patterns:{},sortKey:z};f.push(V)}u&&f.sort((T,I)=>T.sortKey-I.sortKey);let{lineAtlas:_,featureIndex:x}=n,b=this.addConstantDashes(_);for(let T of f){let{geometry:I,index:M,sourceLayerIndex:P}=T;if(b&&this.addFeatureDashes(T,_),this.hasPattern){let L=gv("line",this.layers,T,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(T,I,M,o,_.positions,n.availableImages,n.brightness);x.insert(e[M].feature,I,M,P,this.index)}}addConstantDashes(e){let n=!1;for(let o of this.layers){let c=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(c.kind!=="constant"||u.kind!=="constant")n=!0;else{let f=u.value,_=c.value;if(!_)continue;e.addDash(_,f)}}return n}addFeatureDashes(e,n){let o=this.zoom;for(let c of this.layers){let u=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(u.kind==="constant"&&f.kind==="constant")continue;let _,x;if(u.kind==="constant"){if(_=u.value,!_)continue}else _=u.evaluate({zoom:o},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),n.addDash(_,x),e.patterns[c.id]=n.getKey(_,x)}}update(e,n,o,c,u){let f=Object.keys(e).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,f?this.stateDependentLayers:this.layers,o,c,u)}addFeatures(e,n,o,c,u,f){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,o,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,PR)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SR),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,u,f,_){let x=this.layers[0].layout,b=x.get("line-join").evaluate(e,{}),T=x.get("line-cap").evaluate(e,{}),I=x.get("line-miter-limit"),M=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,b,T,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,c,_)}addLine(e,n,o,c,u,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let _=RR[n.type]==="Polygon",x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let b=0;for(;b<x-1&&e[b].equals(e[b+1]);)b++;if(x<(_?3:2))return;o==="bevel"&&(u=1.05);let T=this.overscaling<=16?15*rt/(512*this.overscaling):0,I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray),M,P,L,N,z;this.e1=this.e2=-1,_&&(M=e[x-2],z=e[b].sub(M)._unit()._perp());for(let V=b;V<x;V++){if(L=V===x-1?_?e[b+1]:void 0:e[V+1],L&&e[V].equals(L))continue;z&&(N=z),M&&(P=M),M=e[V],z=L?L.sub(M)._unit()._perp():N,N=N||z;let W=N.add(z);W.x===0&&W.y===0||W._unit();let J=N.x*z.x+N.y*z.y,K=W.x*z.x+W.y*z.y,ie=K!==0?1/K:1/0,ne=2*Math.sqrt(2-2*K),le=K<LR&&P&&L,de=N.x*z.y-N.y*z.x>0;if(le&&V>b){let ge=M.dist(P);if(ge>2*T){let Me=M.sub(M.sub(P)._mult(T/ge)._round());this.updateDistance(P,Me),this.addCurrentVertex(Me,N,0,0,I),P=Me}}let me=P&&L,be=me?o:_?"butt":c;if(me&&be==="round"&&(ie<f?be="miter":ie<=2&&(be="fakeround")),be==="miter"&&ie>u&&(be="bevel"),be==="bevel"&&(ie>2&&(be="flipbevel"),ie<u&&(be="miter")),P&&this.updateDistance(P,M),be==="miter")W._mult(ie),this.addCurrentVertex(M,W,0,0,I);else if(be==="flipbevel"){if(ie>100)W=z.mult(-1);else{let ge=ie*N.add(z).mag()/N.sub(z).mag();W._perp()._mult(ge*(de?-1:1))}this.addCurrentVertex(M,W,0,0,I),this.addCurrentVertex(M,W.mult(-1),0,0,I)}else if(be==="bevel"||be==="fakeround"){let ge=-Math.sqrt(ie*ie-1),Me=de?ge:0,Ne=de?0:ge;if(P&&this.addCurrentVertex(M,N,Me,Ne,I),be==="fakeround"){let Ie=Math.round(180*ne/Math.PI/20);for(let Le=1;Le<Ie;Le++){let Te=Le/Ie;if(Te!==.5){let Ke=Te-.5;Te+=Te*Ke*(Te-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Ke*Ke+(.848013+J*(.215638*J-1.06021)))}let Re=z.sub(N)._mult(Te)._add(N)._unit()._mult(de?-1:1);this.addHalfVertex(M,Re.x,Re.y,!1,de,0,I)}}L&&this.addCurrentVertex(M,z,-Me,-Ne,I)}else if(be==="butt")this.addCurrentVertex(M,W,0,0,I);else if(be==="square"){let ge=P?1:-1;P||this.addCurrentVertex(M,W,ge,ge,I),this.addCurrentVertex(M,W,0,0,I),P&&this.addCurrentVertex(M,W,ge,ge,I)}else be==="round"&&(P&&(this.addCurrentVertex(M,N,0,0,I),this.addCurrentVertex(M,N,1,1,I,!0)),L&&(this.addCurrentVertex(M,z,-1,-1,I,!0),this.addCurrentVertex(M,z,0,0,I)));if(le&&V<x-1){let ge=M.dist(L);if(ge>2*T){let Me=M.add(L.sub(M)._mult(T/ge)._round());this.updateDistance(M,Me),this.addCurrentVertex(Me,z,0,0,I),M=Me}}}}addCurrentVertex(e,n,o,c,u,f=!1){let _=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,f,!1,o,u),this.addHalfVertex(e,_,x,f,!0,-c,u)}addHalfVertex({x:e,y:n},o,c,u,f,_,x){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let b=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),x.primitiveLength++),f?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}ut(xv,"LineBucket",{omit:["layers","patternFeatures"]});let OR=new lr({"line-cap":new Et(ye.layout_line["line-cap"]),"line-join":new Et(ye.layout_line["line-join"]),"line-miter-limit":new Xe(ye.layout_line["line-miter-limit"]),"line-round-limit":new Xe(ye.layout_line["line-round-limit"]),"line-sort-key":new Et(ye.layout_line["line-sort-key"]),visibility:new Xe(ye.layout_line.visibility)});var KE={paint:new lr({"line-opacity":new Et(ye.paint_line["line-opacity"]),"line-color":new Et(ye.paint_line["line-color"]),"line-translate":new Xe(ye.paint_line["line-translate"]),"line-translate-anchor":new Xe(ye.paint_line["line-translate-anchor"]),"line-width":new Et(ye.paint_line["line-width"]),"line-gap-width":new Et(ye.paint_line["line-gap-width"]),"line-offset":new Et(ye.paint_line["line-offset"]),"line-blur":new Et(ye.paint_line["line-blur"]),"line-dasharray":new Et(ye.paint_line["line-dasharray"]),"line-pattern":new Et(ye.paint_line["line-pattern"]),"line-gradient":new wa(ye.paint_line["line-gradient"]),"line-trim-offset":new Xe(ye.paint_line["line-trim-offset"]),"line-emissive-strength":new Xe(ye.paint_line["line-emissive-strength"]),"line-border-width":new Et(ye.paint_line["line-border-width"]),"line-border-color":new Et(ye.paint_line["line-border-color"])}),layout:OR};function JE(t,e,n){return e*(rt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function QE(t,e){return 1/JE(t,1,e.tileZoom)}function eI(t,e,n,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let tI=t=>{let e=[];nI(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function nI(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let rI=new class extends Et{possiblyEvaluate(t,e){return e=new ar(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,o){return e=ii({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,o)}}(KE.paint.properties["line-width"].specification);function iI(t,e){return e>0?e+2*t:t}rI.useIntegerZoom=!0;let NR=Rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kR=Rn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),FR=Rn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let zR=Rn([{name:"a_z_offset",components:1,type:"Float32"}],4),BR=Rn([{name:"a_texb",components:2,type:"Uint16"}]),jR=Rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),VR=Rn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let oI=Rn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),UR=Rn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rn([{name:"triangle",components:3,type:"Uint16"}]),Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Rn([{type:"Float32",name:"offsetX"}]),Rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var si=24;let rs=128;function bv(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ar(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:c}=n,u=0;for(;u<o.length&&o[u]<=t;)u++;u=Math.max(0,u-1);let f=u;for(;f<o.length&&o[f]<t+1;)f++;f=Math.min(o.length-1,f);let _=o[u],x=o[f];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:n.evaluate(new ar(_)),maxSize:n.evaluate(new ar(x)),interpolationType:c}}}function Ng(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return t.kind==="source"?o/rs:t.kind==="composite"?cn(o/rs,c/rs,n):e}function lh(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:u,maxZoom:f}=t,_=c?Xt(Vi.interpolationFactor(c,e,u,f),0,1):0;t.kind==="camera"?o=cn(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:o}}var $R=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:rs,evaluateSizeForFeature:Ng,evaluateSizeForZoom:lh,getSizeData:bv});function GR(t,e,n){return t.sections.forEach(o=>{o.text=function(c,u,f){let _=u.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),Ui.applyArabicShaping&&(c=Ui.applyArabicShaping(c)),c}(o.text,e,n)}),t}let Kf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function HR(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function qR(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var WR={read:function(t,e,n,o,c){var u,f,_=8*c-o-1,x=(1<<_)-1,b=x>>1,T=-7,I=n?c-1:0,M=n?-1:1,P=t[e+I];for(I+=M,u=P&(1<<-T)-1,P>>=-T,T+=_;T>0;u=256*u+t[e+I],I+=M,T-=8);for(f=u&(1<<-T)-1,u>>=-T,T+=o;T>0;f=256*f+t[e+I],I+=M,T-=8);if(u===0)u=1-b;else{if(u===x)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,o),u-=b}return(P?-1:1)*f*Math.pow(2,u-o)},write:function(t,e,n,o,c,u){var f,_,x,b=8*u-c-1,T=(1<<b)-1,I=T>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=o?0:u-1,L=o?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=T):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+I>=1?M/x:M*Math.pow(2,1-I))*x>=2&&(f++,x/=2),f+I>=T?(_=0,f=T):f+I>=1?(_=(e*x-1)*Math.pow(2,c),f+=I):(_=e*Math.pow(2,I-1)*Math.pow(2,c),f=0));c>=8;t[n+P]=255&_,P+=L,_/=256,c-=8);for(f=f<<c|_,b+=c;b>0;t[n+P]=255&f,P+=L,f/=256,b-=8);t[n+P-L]|=128*N}},sI=rr,kg=WR;function rr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}rr.Varint=0,rr.Fixed64=1,rr.Bytes=2,rr.Fixed32=5;var wv=4294967296,aI=1/wv,lI=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Aa(t){return t.type===rr.Bytes?t.readVarint()+t.pos:t.pos+1}function ch(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function cI(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=t;c--)n.buf[c+o]=n.buf[c]}function ZR(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function XR(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function YR(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function KR(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function JR(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function QR(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function eL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function tL(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function nL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Fg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function uh(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function uI(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}rr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,u=this.pos;this.type=7&o,t(c,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Fg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=uI(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Fg(this.buf,this.pos)+Fg(this.buf,this.pos+4)*wv;return this.pos+=8,t},readSFixed64:function(){var t=Fg(this.buf,this.pos)+uI(this.buf,this.pos+4)*wv;return this.pos+=8,t},readFloat:function(){var t=kg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=kg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,u,f){var _,x,b=f.buf;if(_=(112&(x=b[f.pos++]))>>4,x<128||(_|=(127&(x=b[f.pos++]))<<3,x<128)||(_|=(127&(x=b[f.pos++]))<<10,x<128)||(_|=(127&(x=b[f.pos++]))<<17,x<128)||(_|=(127&(x=b[f.pos++]))<<24,x<128)||(_|=(1&(x=b[f.pos++]))<<31,x<128))return ch(c,_,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&lI?function(n,o,c){return lI.decode(n.subarray(o,c))}(this.buf,e,t):function(n,o,c){for(var u="",f=o;f<c;){var _,x,b,T=n[f],I=null,M=T>239?4:T>223?3:T>191?2:1;if(f+M>c)break;M===1?T<128&&(I=T):M===2?(192&(_=n[f+1]))==128&&(I=(31&T)<<6|63&_)<=127&&(I=null):M===3?(x=n[f+2],(192&(_=n[f+1]))==128&&(192&x)==128&&((I=(15&T)<<12|(63&_)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):M===4&&(x=n[f+2],b=n[f+3],(192&(_=n[f+1]))==128&&(192&x)==128&&(192&b)==128&&((I=(15&T)<<18|(63&_)<<12|(63&x)<<6|63&b)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,M=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),f+=M}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==rr.Bytes)return t.push(this.readVarint(e));var n=Aa(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==rr.Bytes)return t.push(this.readSVarint());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==rr.Bytes)return t.push(this.readBoolean());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==rr.Bytes)return t.push(this.readFloat());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==rr.Bytes)return t.push(this.readDouble());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==rr.Bytes)return t.push(this.readFixed32());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==rr.Bytes)return t.push(this.readSFixed32());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==rr.Bytes)return t.push(this.readFixed64());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==rr.Bytes)return t.push(this.readSFixed64());var e=Aa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===rr.Varint)for(;this.buf[this.pos++]>127;);else if(e===rr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===rr.Fixed32)this.pos+=4;else{if(e!==rr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),uh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),uh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),uh(this.buf,-1&t,this.pos),uh(this.buf,Math.floor(t*aI),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),uh(this.buf,-1&t,this.pos),uh(this.buf,Math.floor(t*aI),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(u,f,_){_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,u>>>=7,_.buf[_.pos++]=127&u|128,_.buf[_.pos]=127&(u>>>=7)}(o,0,n),function(u,f){var _=(7&u)<<4;f.buf[f.pos++]|=_|((u>>>=3)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,c,u){for(var f,_,x=0;x<c.length;x++){if((f=c.charCodeAt(x))>55295&&f<57344){if(!_){f>56319||x+1===c.length?(o[u++]=239,o[u++]=191,o[u++]=189):_=f;continue}if(f<56320){o[u++]=239,o[u++]=191,o[u++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(o[u++]=239,o[u++]=191,o[u++]=189,_=null);f<128?o[u++]=f:(f<2048?o[u++]=f>>6|192:(f<65536?o[u++]=f>>12|224:(o[u++]=f>>18|240,o[u++]=f>>12&63|128),o[u++]=f>>6&63|128),o[u++]=63&f|128)}return u}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&cI(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),kg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&cI(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,rr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,ZR,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,XR,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,JR,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,YR,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,KR,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,QR,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,eL,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,tL,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,nL,e)},writeBytesField:function(t,e){this.writeTag(t,rr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,rr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,rr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,rr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,rr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,rr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,rr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,rr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,rr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,rr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var hh=Zt(sI);let Tv=3;function rL(t,e,n){e.glyphs=[],t===1&&n.readMessage(iL,e)}function iL(t,e,n){if(t===3){let{id:o,bitmap:c,width:u,height:f,left:_,top:x,advance:b}=n.readMessage(oL,{});e.glyphs.push({id:o,bitmap:new El({width:u+2*Tv,height:f+2*Tv},c),metrics:{width:u,height:f,left:_,top:x,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function oL(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let hI=Tv,Eo={horizontal:1,vertical:2,horizontalOnly:3};class Jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let o=new Jf;return o.scale=e||1,o.fontStack=n,o}static forImage(e){let n=new Jf;return n.imageName=e,n}}class dh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let o=new dh;for(let c=0;c<e.sections.length;c++){let u=e.sections[c];u.image?o.addImageSection(u):o.addTextSection(u,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,o){let c="";for(let u=0;u<n.length;u++){let f=n.charCodeAt(u+1)||null,_=n.charCodeAt(u-1)||null;c+=!o&&(f&&Gm(f)&&!Kf[n[u+1]]||_&&Gm(_)&&!Kf[n[u-1]])||!Kf[n[u]]?n[u]:Kf[n[u]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&zg[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&zg[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let o=new dh;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Jf.forText(e.scale,e.fontStack||n));let o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void _r("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Jf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):_r("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ev(t,e,n,o,c,u,f,_,x,b,T,I,M,P,L){let N=dh.fromFeature(t,c);I===Eo.vertical&&N.verticalizePunctuation(M);let z=[],V=function(ne,le,de,me,be,ge){if(!ne)return[];let Me=[],Ne=function(Re,Ke,Fe,dt,st,Ve){let Ct=0;for(let vt=0;vt<Re.length();vt++){let ht=Re.getSection(vt);Ct+=dI(Re.getCodePoint(vt),ht,dt,st,Ke,Ve)}return Ct/Math.max(1,Math.ceil(Ct/Fe))}(ne,le,de,me,be,ge),Ie=ne.text.indexOf("\u200B")>=0,Le=0;for(let Re=0;Re<ne.length();Re++){let Ke=ne.getSection(Re),Fe=ne.getCodePoint(Re);if(zg[Fe]||(Le+=dI(Fe,Ke,me,be,le,ge)),Re<ne.length()-1){let dt=!((Te=Fe)<11904||!(mt["Bopomofo Extended"](Te)||mt.Bopomofo(Te)||mt["CJK Compatibility Forms"](Te)||mt["CJK Compatibility Ideographs"](Te)||mt["CJK Compatibility"](Te)||mt["CJK Radicals Supplement"](Te)||mt["CJK Strokes"](Te)||mt["CJK Symbols and Punctuation"](Te)||mt["CJK Unified Ideographs Extension A"](Te)||mt["CJK Unified Ideographs"](Te)||mt["Enclosed CJK Letters and Months"](Te)||mt["Halfwidth and Fullwidth Forms"](Te)||mt.Hiragana(Te)||mt["Ideographic Description Characters"](Te)||mt["Kangxi Radicals"](Te)||mt["Katakana Phonetic Extensions"](Te)||mt.Katakana(Te)||mt["Vertical Forms"](Te)||mt["Yi Radicals"](Te)||mt["Yi Syllables"](Te)));(sL[Fe]||dt||Ke.imageName)&&Me.push(pI(Re+1,Le,Ne,Me,aL(Fe,ne.getCodePoint(Re+1),dt&&Ie),!1))}}var Te;return mI(pI(ne.length(),Le,Ne,Me,0,!0))}(N,b,u,e,o,P),{processBidirectionalText:W,processStyledBidirectionalText:J}=Ui;if(W&&N.sections.length===1){let ne=W(N.toString(),V);for(let le of ne){let de=new dh;de.text=le,de.sections=N.sections;for(let me=0;me<le.length;me++)de.sectionIndex.push(0);z.push(de)}}else if(J){let ne=J(N.text,N.sectionIndex,V);for(let le of ne){let de=new dh;de.text=le[0],de.sectionIndex=le[1],de.sections=N.sections,z.push(de)}}else z=function(ne,le){let de=[],me=ne.text,be=0;for(let ge of le)de.push(ne.substring(be,ge)),be=ge;return be<me.length&&de.push(ne.substring(be,me.length)),de}(N,V);let K=[],ie={positionedLines:K,text:N.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ne,le,de,me,be,ge,Me,Ne,Ie,Le,Te,Re){let Ke=0,Fe=0,dt=0,st=Ne==="right"?1:Ne==="left"?0:.5,Ve=!1;for(let Ht of be){let St=Ht.getSections();for(let qt of St){if(qt.imageName)continue;let Ot=le[qt.fontStack];if(Ot&&(Ve=Ot.ascender!==void 0&&Ot.descender!==void 0,!Ve))break}if(!Ve)break}let Ct=0;for(let Ht of be){Ht.trim();let St=Ht.getMaxScale(),qt=(St-1)*si,Ot={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Ct]=Ot;let un=Ot.positionedGlyphs,Bt=0;if(!Ht.length()){Fe+=ge,++Ct;continue}let Gn=0,vn=0;for(let Cn=0;Cn<Ht.length();Cn++){let xn=Ht.getSection(Cn),ir=Ht.getSectionIndex(Cn),Nn=Ht.getCodePoint(Cn),vr=xn.scale,Nr=null,ni=null,tr=null,hr=si,Zr=0,Xr=!(Ie===Eo.horizontal||!Te&&!df(Nn)||Te&&(zg[Nn]||(vt=Nn,mt.Arabic(vt)||mt["Arabic Supplement"](vt)||mt["Arabic Extended-A"](vt)||mt["Arabic Presentation Forms-A"](vt)||mt["Arabic Presentation Forms-B"](vt))));if(xn.imageName){let Yr=me[xn.imageName];if(!Yr)continue;tr=xn.imageName,ne.iconsInText=ne.iconsInText||!0,ni=Yr.paddedRect;let Xn=Yr.displaySize;vr=vr*si/Re,Nr={width:Xn[0],height:Xn[1],left:0,top:-hI,advance:Xr?Xn[1]:Xn[0],localGlyph:!1},Zr=Ve?-Nr.height*vr:St*si-17-Xn[1]*vr,hr=Nr.advance;let oo=(Xr?Xn[0]:Xn[1])*vr-si*St;oo>0&&oo>Bt&&(Bt=oo)}else{let Yr=de[xn.fontStack];if(!Yr)continue;Yr[Nn]&&(ni=Yr[Nn]);let Xn=le[xn.fontStack];if(!Xn)continue;let oo=Xn.glyphs[Nn];if(!oo)continue;if(Nr=oo.metrics,hr=Nn!==8203?si:0,Ve){let Ll=Xn.ascender!==void 0?Math.abs(Xn.ascender):0,Ni=Xn.descender!==void 0?Math.abs(Xn.descender):0,wi=(Ll+Ni)*vr;Gn<wi&&(Gn=wi,vn=(Ll-Ni)/2*vr),Zr=-Ll*vr}else Zr=(St-vr)*si-17}Xr?(ne.verticalizable=!0,un.push({glyph:Nn,imageName:tr,x:Ke,y:Fe+Zr,vertical:Xr,scale:vr,localGlyph:Nr.localGlyph,fontStack:xn.fontStack,sectionIndex:ir,metrics:Nr,rect:ni}),Ke+=hr*vr+Le):(un.push({glyph:Nn,imageName:tr,x:Ke,y:Fe+Zr,vertical:Xr,scale:vr,localGlyph:Nr.localGlyph,fontStack:xn.fontStack,sectionIndex:ir,metrics:Nr,rect:ni}),Ke+=Nr.advance*vr+Le)}un.length!==0&&(dt=Math.max(Ke-Le,dt),Ve?gI(un,st,Bt,vn,ge*St/2):gI(un,st,Bt,0,ge/2)),Ke=0;let wn=ge*St+Bt;Ot.lineOffset=Math.max(Bt,qt),Fe+=wn,++Ct}var vt;let ht=Fe,{horizontalAlign:Ue,verticalAlign:It}=Iv(Me);(function(Ht,St,qt,Ot,un,Bt){let Gn=(St-qt)*un,vn=-Bt*Ot;for(let wn of Ht)for(let Cn of wn.positionedGlyphs)Cn.x+=Gn,Cn.y+=vn})(ne.positionedLines,st,Ue,It,dt,ht),ne.top+=-It*ht,ne.bottom=ne.top+ht,ne.left+=-Ue*dt,ne.right=ne.left+dt,ne.hasBaseline=Ve}(ie,e,n,o,z,f,_,x,I,b,M,L),!function(ne){for(let le of ne)if(le.positionedGlyphs.length!==0)return!1;return!0}(K)&&ie}let zg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function dI(t,e,n,o,c,u){if(e.imageName){let f=o[e.imageName];return f?f.displaySize[0]*e.scale*si/u+c:0}{let f=n[e.fontStack],_=f&&f.glyphs[t];return _?_.metrics.advance*e.scale+c:0}}function fI(t,e,n,o){let c=Math.pow(t-e,2);return o?t<e?c/2:2*c:c+Math.abs(n)*n}function aL(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function pI(t,e,n,o,c,u){let f=null,_=fI(e,n,c,u);for(let x of o){let b=fI(e-x.x,n,c,u)+x.badness;b<=_&&(f=x,_=b)}return{index:t,x:e,priorBreak:f,badness:_}}function mI(t){return t?mI(t.priorBreak).concat(t.index):[]}function Iv(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function gI(t,e,n,o,c){if(!(e||n||o||c))return;let u=t.length-1,f=t[u],_=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=u;x++)t[x].x-=_,t[x].y+=n+o+c}function lL(t,e,n,o){let{horizontalAlign:c,verticalAlign:u}=Iv(o),f=n[0]-t.displaySize[0]*c,_=n[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function _I(t,e,n,o,c,u){let f=t.imagePrimary,_;if(f.content){let z=f.content,V=f.pixelRatio||1;_=[z[0]/V,z[1]/V,f.displaySize[0]-z[2]/V,f.displaySize[1]-z[3]/V]}let x=e.left*u,b=e.right*u,T,I,M,P;n==="width"||n==="both"?(P=c[0]+x-o[3],I=c[0]+b+o[1]):(P=c[0]+(x+b-f.displaySize[0])/2,I=P+f.displaySize[0]);let L=e.top*u,N=e.bottom*u;return n==="height"||n==="both"?(T=c[1]+L-o[0],M=c[1]+N+o[2]):(T=c[1]+(L+N-f.displaySize[1])/2,M=T+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:T,right:I,bottom:M,left:P,collisionPadding:_}}class Pa extends Ge{constructor(e,n,o,c,u){super(e,n),this.angle=c,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new Pa(this.x,this.y,this.z,this.angle,this.segment)}}function yI(t,e,n,o,c){if(e.segment===void 0)return!0;let u=e,f=e.segment+1,_=0;for(;_>-n/2;){if(f--,f<0)return!1;_-=t[f].dist(u),u=t[f]}_+=t[f].dist(t[f+1]),f++;let x=[],b=0;for(;_<n/2;){let T=t[f],I=t[f+1];if(!I)return!1;let M=t[f-1].angleTo(T)-T.angleTo(I);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:M}),b+=M;_-x[0].distance>o;)b-=x.shift().angleDelta;if(b>c)return!1;f++,_+=T.dist(I)}return!0}function vI(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function xI(t,e,n){return t?.6*e*n:0}function bI(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function cL(t,e,n,o,c,u){let f=xI(n,c,u),_=bI(n,o)*u,x=0,b=vI(t)/2;for(let T=0;T<t.length-1;T++){let I=t[T],M=t[T+1],P=I.dist(M);if(x+P>b){let L=(b-x)/P,N=cn(I.x,M.x,L),z=cn(I.y,M.y,L),V=new Pa(N,z,0,M.angleTo(I),T);return!f||yI(t,V,_,f,e)?V:void 0}x+=P}}function uL(t,e,n,o,c,u,f,_,x){let b=xI(o,u,f),T=bI(o,c),I=T*f,M=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-I<e/4&&(e=I+e/4),wI(t,M?e/2*_%e:(T/2+2*u)*f*_%e,e,b,n,I,M,!1,x)}function wI(t,e,n,o,c,u,f,_,x){let b=u/2,T=vI(t),I=0,M=e-n,P=[];for(let L=0;L<t.length-1;L++){let N=t[L],z=t[L+1],V=N.dist(z),W=z.angleTo(N);for(;M+n<I+V;){M+=n;let J=(M-I)/V,K=cn(N.x,z.x,J),ie=cn(N.y,z.y,J);if(K>=0&&K<x&&ie>=0&&ie<x&&M-b>=0&&M+b<=T){let ne=new Pa(K,ie,0,W,L);o&&!yI(t,ne,u,o,c)||P.push(ne)}}I+=V}return _||P.length||f||(P=wI(t,I/2,n,o,c,u,f,!0,x)),P}function TI(t,e,n,o,c){let u=[];for(let f=0;f<t.length;f++){let _=t[f],x;for(let b=0;b<_.length-1;b++){let T=_[b],I=_[b+1];T.x<e&&I.x<e||(T.x<e?T=new Ge(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x<e&&(I=new Ge(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y<n&&I.y<n||(T.y<n?T=new Ge(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round():I.y<n&&(I=new Ge(T.x+(n-T.y)/(I.y-T.y)*(I.x-T.x),n)._round()),T.x>=o&&I.x>=o||(T.x>=o?T=new Ge(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x>=o&&(I=new Ge(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y>=c&&I.y>=c||(T.y>=c?T=new Ge(T.x+(c-T.y)/(I.y-T.y)*(I.x-T.x),c)._round():I.y>=c&&(I=new Ge(T.x+(c-T.y)/(I.y-T.y)*(I.x-T.x),c)._round()),x&&T.equals(x[x.length-1])||(x=[T],u.push(x)),x.push(I)))))}}return u}function EI(t){let e=0,n=0;for(let f of t)e+=f.w*f.h,n=Math.max(n,f.w);t.sort((f,_)=>_.h-f.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,u=0;for(let f of t)for(let _=o.length-1;_>=0;_--){let x=o[_];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,u=Math.max(u,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===x.w&&f.h===x.h){let b=o.pop();_<o.length&&(o[_]=b)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(o.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:c,h:u,fill:e/(c*u)||0}}ut(Pa,"Anchor");let io=1;class Dv{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:u,content:f}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=u,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+io,this.paddedRect.y+io]}get br(){return[this.paddedRect.x+this.paddedRect.w-io,this.paddedRect.y+this.paddedRect.h-io]}get displaySize(){return[(this.paddedRect.w-2*io)/this.pixelRatio,(this.paddedRect.h-2*io)/this.pixelRatio]}}class II{constructor(e,n){let o={},c={};this.haveRenderCallbacks=[];let u=[];this.addImages(e,o,u),this.addImages(n,c,u);let{w:f,h:_}=EI(u),x=new To({width:f||1,height:_||1});for(let b in e){let T=e[b],I=o[b].paddedRect;To.copy(T.data,x,{x:0,y:0},{x:I.x+io,y:I.y+io},T.data,T.sdf)}for(let b in n){let T=n[b],I=c[b].paddedRect,M=I.x+io,P=I.y+io,L=T.data.width,N=T.data.height;To.copy(T.data,x,{x:0,y:0},{x:M,y:P},T.data),To.copy(T.data,x,{x:0,y:N-1},{x:M,y:P-1},{width:L,height:1}),To.copy(T.data,x,{x:0,y:0},{x:M,y:P+N},{width:L,height:1}),To.copy(T.data,x,{x:L-1,y:0},{x:M-1,y:P},{width:1,height:N}),To.copy(T.data,x,{x:0,y:0},{x:M+L,y:P},{width:1,height:N})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(let c in e){let u=e[c],f={x:0,y:0,w:u.data.width+2*io,h:u.data.height+2*io};o.push(f),n[c]=new Dv(f,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let c in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,o),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,u]=e.tl,f=!!Object.keys(this.patternPositions).length;o.update(n.data,{useMipmap:f},{x:c,y:u})}}ut(Dv,"ImagePosition"),ut(II,"ImageAtlas");let Qf=1e20;function DI(t,e,n,o,c,u,f,_,x){for(let b=e;b<e+o;b++)MI(t,n*u+b,u,c,f,_,x);for(let b=n;b<n+c;b++)MI(t,b*u+e,1,o,f,_,x)}function MI(t,e,n,o,c,u,f){u[0]=0,f[0]=-Qf,f[1]=Qf,c[0]=t[e];for(let _=1,x=0,b=0;_<o;_++){c[_]=t[e+_*n];let T=_*_;do{let I=u[x];b=(c[_]-c[I]+T-I*I)/(_-I)/2}while(b<=f[x]&&--x>-1);x++,u[x]=_,f[x]=b,f[x+1]=Qf}for(let _=0,x=0;_<o;_++){for(;f[x+1]<_;)x++;let b=u[x],T=_-b;t[e+_*n]=c[b]+T*T}}let is=2,Mv={none:0,ideographs:1,all:2};class fh{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,o){let c=[],u=this.urls[n]||j.GLYPHS_URL;for(let f in e)for(let _ of e[f])c.push({stack:f,id:_});fo(c,({stack:f,id:_},x)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[_];if(T!==void 0)return void x(null,{stack:f,id:_,glyph:T});if(T=this._tinySDF(b,f,_),T)return b.glyphs[_]=T,void x(null,{stack:f,id:_,glyph:T});let I=Math.floor(_/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(b.ranges[I])return void x(null,{stack:f,id:_,glyph:T});let M=b.requests[I];M||(M=b.requests[I]=[],fh.loadGlyphRange(f,I,u,this.requestManager,(P,L)=>{if(L){b.ascender=L.ascender,b.descender=L.descender;for(let N in L.glyphs)this._doesCharSupportLocalGlyph(+N)||(b.glyphs[+N]=L.glyphs[+N]);b.ranges[I]=!0}for(let N of M)N(P,L);delete b.requests[I]})),M.push((P,L)=>{P?x(P):L&&x(null,{stack:f,id:_,glyph:L.glyphs[_]||null})})},(f,_)=>{if(f)o(f);else if(_){let x={};for(let{stack:b,id:T,glyph:I}of _)x[b]===void 0&&(x[b]={}),x[b].glyphs===void 0&&(x[b].glyphs={}),x[b].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[b].ascender=this.entries[b].ascender,x[b].descender=this.entries[b].descender;o(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Mv.none&&(this.localGlyphMode===Mv.all?!!this.localFontFamily:!!this.localFontFamily&&(mt["CJK Unified Ideographs"](e)||mt["Hangul Syllables"](e)||mt.Hiragana(e)||mt.Katakana(e)||mt["CJK Symbols and Punctuation"](e)||mt["CJK Unified Ideographs Extension A"](e)||mt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,o){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let N="400";/bold/i.test(n)?N="900":/medium/i.test(n)?N="500":/light/i.test(n)&&(N="200"),u=e.tinySDF=new fh.TinySDF({fontFamily:c,fontWeight:N,fontSize:24*is,buffer:3*is,radius:8*is}),u.fontWeight=N}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];let f=String.fromCodePoint(o),{data:_,width:x,height:b,glyphWidth:T,glyphHeight:I,glyphLeft:M,glyphTop:P,glyphAdvance:L}=u.draw(f);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new El({width:x,height:b},_),metrics:{width:T/is,height:I/is,left:M/is,top:P/is-27,advance:L/is,localGlyph:!0}}}}fh.loadGlyphRange=function(t,e,n,o,c){let u=256*e,f=u+255,_=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${u}-${f}`),Mi.Glyphs);Pe(_,(x,b)=>{if(x)c(x);else if(b){let T={},I=function(M){return new hh(M).readFields(rL,{})}(b);for(let M of I.glyphs)T[M.id]=M;c(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},fh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let _=this.size=t+4*e,x=this._createCanvas(_),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${u} ${t}px ${c}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(t),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-c))),x=Math.min(this.size-this.buffer,f+Math.ceil(o)),b=_+2*this.buffer,T=x+2*this.buffer,I=Math.max(b*T,0),M=new Uint8ClampedArray(I),P={data:M,width:b,height:T,glyphWidth:_,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return P;let{ctx:L,buffer:N,gridInner:z,gridOuter:V}=this;L.clearRect(N,N,_,x),L.fillText(t,N,N+f);let W=L.getImageData(N,N,_,x);V.fill(Qf,0,I),z.fill(0,0,I);for(let J=0;J<x;J++)for(let K=0;K<_;K++){let ie=W.data[4*(J*_+K)+3]/255;if(ie===0)continue;let ne=(J+N)*b+K+N;if(ie===1)V[ne]=0,z[ne]=Qf;else{let le=.5-ie;V[ne]=le>0?le*le:0,z[ne]=le<0?le*le:0}}DI(V,0,0,b,T,b,this.f,this.v,this.z),DI(z,N,N,_,x,b,this.f,this.v,this.z);for(let J=0;J<I;J++){let K=Math.sqrt(V[J])-Math.sqrt(z[J]);M[J]=Math.round(255-255*(K/this.radius+this.cutoff))}return P}};let Ml=io;function CI(t,e,n,o){let c=[],u=t.imagePrimary,f=u.pixelRatio,_=u.paddedRect.w-2*Ml,x=u.paddedRect.h-2*Ml,b=t.right-t.left,T=t.bottom-t.top,I=u.stretchX||[[0,_]],M=u.stretchY||[[0,x]],P=(ge,Me)=>ge+Me[1]-Me[0],L=I.reduce(P,0),N=M.reduce(P,0),z=_-L,V=x-N,W=0,J=L,K=0,ie=N,ne=0,le=z,de=0,me=V;if(u.content&&o){let ge=u.content;W=Bg(I,0,ge[0]),K=Bg(M,0,ge[1]),J=Bg(I,ge[0],ge[2]),ie=Bg(M,ge[1],ge[3]),ne=ge[0]-W,de=ge[1]-K,le=ge[2]-ge[0]-J,me=ge[3]-ge[1]-ie}let be=(ge,Me,Ne,Ie)=>{let Le=jg(ge.stretch-W,J,b,t.left),Te=Vg(ge.fixed-ne,le,ge.stretch,L),Re=jg(Me.stretch-K,ie,T,t.top),Ke=Vg(Me.fixed-de,me,Me.stretch,N),Fe=jg(Ne.stretch-W,J,b,t.left),dt=Vg(Ne.fixed-ne,le,Ne.stretch,L),st=jg(Ie.stretch-K,ie,T,t.top),Ve=Vg(Ie.fixed-de,me,Ie.stretch,N),Ct=new Ge(Le,Re),vt=new Ge(Fe,Re),ht=new Ge(Fe,st),Ue=new Ge(Le,st),It=new Ge(Te/f,Ke/f),Ht=new Ge(dt/f,Ve/f),St=e*Math.PI/180;if(St){let vn=Math.sin(St),wn=Math.cos(St),Cn=[wn,-vn,vn,wn];Ct._matMult(Cn),vt._matMult(Cn),Ue._matMult(Cn),ht._matMult(Cn)}let qt=ge.stretch+ge.fixed,Ot=Ne.stretch+Ne.fixed,un=Me.stretch+Me.fixed,Bt=Ie.stretch+Ie.fixed,Gn=t.imageSecondary;return{tl:Ct,tr:vt,bl:Ue,br:ht,texPrimary:{x:u.paddedRect.x+Ml+qt,y:u.paddedRect.y+Ml+un,w:Ot-qt,h:Bt-un},texSecondary:Gn?{x:Gn.paddedRect.x+Ml+qt,y:Gn.paddedRect.y+Ml+un,w:Ot-qt,h:Bt-un}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:It,pixelOffsetBR:Ht,minFontScaleX:le/f/b,minFontScaleY:me/f/T,isSDF:n}};if(o&&(u.stretchX||u.stretchY)){let ge=SI(I,z,L),Me=SI(M,V,N);for(let Ne=0;Ne<ge.length-1;Ne++){let Ie=ge[Ne],Le=ge[Ne+1];for(let Te=0;Te<Me.length-1;Te++)c.push(be(Ie,Me[Te],Le,Me[Te+1]))}}else c.push(be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function Bg(t,e,n){let o=0;for(let c of t)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function SI(t,e,n){let o=[{fixed:-Ml,stretch:0}];for(let[c,u]of t){let f=o[o.length-1];o.push({fixed:c-f.stretch,stretch:f.stretch}),o.push({fixed:c-f.stretch,stretch:f.stretch+(u-c)})}return o.push({fixed:e+Ml,stretch:n}),o}function jg(t,e,n,o){return t/e*n+o}function Vg(t,e,n,o){return t-e*n/o}function hL(t,e,n,o){let c=e+t.positionedLines[o].lineOffset;return o===0?n+c/2:n+(c+(e+t.positionedLines[o-1].lineOffset))/2}function dL(t,e=1,n=!1){let o=1/0,c=1/0,u=-1/0,f=-1/0,_=t[0];for(let P=0;P<_.length;P++){let L=_[P];(!P||L.x<o)&&(o=L.x),(!P||L.y<c)&&(c=L.y),(!P||L.x>u)&&(u=L.x),(!P||L.y>f)&&(f=L.y)}let x=Math.min(u-o,f-c),b=x/2,T=new ro([],fL);if(x===0)return new Ge(o,c);for(let P=o;P<u;P+=x)for(let L=c;L<f;L+=x)T.push(new ph(P+b,L+b,b,t));let I=function(P){let L=0,N=0,z=0,V=P[0];for(let W=0,J=V.length,K=J-1;W<J;K=W++){let ie=V[W],ne=V[K],le=ie.x*ne.y-ne.x*ie.y;N+=(ie.x+ne.x)*le,z+=(ie.y+ne.y)*le,L+=3*le}return new ph(N/L,z/L,0,P)}(t),M=T.length;for(;T.length;){let P=T.pop();(P.d>I.d||!I.d)&&(I=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,M)),P.max-I.d<=e||(b=P.h/2,T.push(new ph(P.p.x-b,P.p.y-b,b,t)),T.push(new ph(P.p.x+b,P.p.y-b,b,t)),T.push(new ph(P.p.x-b,P.p.y+b,b,t)),T.push(new ph(P.p.x+b,P.p.y+b,b,t)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${I.d}`)),I.p}function fL(t,e){return e.max-t.max}class ph{constructor(e,n,o,c){this.p=new Ge(e,n),this.h=o,this.d=function(u,f){let _=!1,x=1/0;for(let b=0;b<f.length;b++){let T=f[b];for(let I=0,M=T.length,P=M-1;I<M;P=I++){let L=T[I],N=T[P];L.y>u.y!=N.y>u.y&&u.x<(N.x-L.x)*(u.y-L.y)/(N.y-L.y)+L.x&&(_=!_),x=Math.min(x,bl(u,L,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let Cv=Number.POSITIVE_INFINITY,pL=Math.sqrt(2);function AI(t,[e,n]){let o=0,c=0;if(n===Cv){e<0&&(e=0);let u=e/pL;switch(t){case"top-right":case"top-left":c=u-7;break;case"bottom-right":case"bottom-left":c=7-u;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,c]}function Sv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mL(t,e,n,o,c,u,f,_,x,b,T,I,M,P,L){let N=u.textMaxSize.evaluate(e,{},I);N===void 0&&(N=f);let z=t.layers[0].layout,V=z.get("icon-offset").evaluate(e,{},I),W=RI(n.horizontal)||n.vertical,J=M.name==="globe",K=si,ie=f/K,ne=t.tilePixelRatio*N/K,le=(Le=t.overscaling,t.zoom>18&&Le>2&&(Le>>=1),Math.max(rt/(512*Le),1)*z.get("symbol-spacing")),de=z.get("text-padding")*t.tilePixelRatio,me=z.get("icon-padding")*t.tilePixelRatio,be=an(z.get("text-max-angle")),ge=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Me=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ne=z.get("symbol-placement"),Ie=le/2;var Le;let Te=z.get("icon-text-fit").evaluate(e,{},I),Re=z.get("icon-text-fit-padding").evaluate(e,{},I),Ke=Te!=="none",Fe;t.hasAnyIconTextFit===!1&&Ke&&(t.hasAnyIconTextFit=!0),o&&Ke&&(t.allowVerticalPlacement&&n.vertical&&(Fe=_I(o,n.vertical,Te,Re,V,ie)),W&&(o=_I(o,W,Te,Re,V,ie)));let dt=(st,Ve,Ct)=>{if(Ve.x<0||Ve.x>=rt||Ve.y<0||Ve.y>=rt)return;let vt=null;if(J){let{x:ht,y:Ue,z:It}=M.projectTilePoint(Ve.x,Ve.y,Ct);vt={anchor:new Pa(ht,Ue,It,0,void 0),up:M.upVector(Ct,Ve.x,Ve.y)}}(function(ht,Ue,It,Ht,St,qt,Ot,un,Bt,Gn,vn,wn,Cn,xn,ir,Nn,vr,Nr,ni,tr,hr,Zr,Xr,Yr,Xn,oo,Ll){let Ni=ht.addToLineVertexArray(Ue,Ht),wi,Do,mp,l_,RD,LD,OD,ND=0,kD=0,FD=0,zD=0,ex=-1,tx=-1,Hs={},BD=Bf(""),Xc=It?It.anchor:Ue,nx=Bt.layout.get("icon-text-fit").evaluate(hr,{},Xn)!=="none",rx=0,ix=0;if(Bt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[rx,ix]=Bt.layout.get("text-offset").evaluate(hr,{},Xn).map(so=>so*si):(rx=Bt.layout.get("text-radial-offset").evaluate(hr,{},Xn)*si,ix=Cv),ht.allowVerticalPlacement&&St.vertical){let so=St.vertical;if(ir)LD=Av(so),un&&(OD=Av(un));else{let ao=Bt.layout.get("text-rotate").evaluate(hr,{},Xn)+90;mp=Ug(Gn,Xc,Ue,vn,wn,Cn,so,xn,ao,Nn),un&&(l_=Ug(Gn,Xc,Ue,vn,wn,Cn,un,Nr,ao))}}if(qt){let so=Bt.layout.get("icon-rotate").evaluate(hr,{},Xn),ao=CI(qt,so,Xr,nx),bh=un?CI(un,so,Xr,nx):void 0;Do=Ug(Gn,Xc,Ue,vn,wn,Cn,qt,Nr,so),ND=4*ao.length;let jD=ht.iconSizeData,Yc=null;jD.kind==="source"?(Yc=[rs*Bt.layout.get("icon-size").evaluate(hr,{},Xn)],Yc[0]>Cl&&_r(`${ht.layerIds[0]}: Value for "icon-size" is >= ${ep}. Reduce your "icon-size".`)):jD.kind==="composite"&&(Yc=[rs*Zr.compositeIconSizes[0].evaluate(hr,{},Xn),rs*Zr.compositeIconSizes[1].evaluate(hr,{},Xn)],(Yc[0]>Cl||Yc[1]>Cl)&&_r(`${ht.layerIds[0]}: Value for "icon-size" is >= ${ep}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,ao,Yc,tr,ni,hr,!1,It,Ue,Ni.lineStartIndex,Ni.lineLength,-1,Yr,Xn,oo,Ll),ex=ht.icon.placedSymbolArray.length-1,bh&&(kD=4*bh.length,ht.addSymbols(ht.icon,bh,Yc,tr,ni,hr,Eo.vertical,It,Ue,Ni.lineStartIndex,Ni.lineLength,-1,Yr,Xn,oo,Ll),tx=ht.icon.placedSymbolArray.length-1)}for(let so in St.horizontal){let ao=St.horizontal[so];wi||(BD=Bf(ao.text),ir?RD=Av(ao):wi=Ug(Gn,Xc,Ue,vn,wn,Cn,ao,xn,Bt.layout.get("text-rotate").evaluate(hr,{},Xn),Nn));let bh=ao.positionedLines.length===1;if(FD+=PI(ht,It,Ue,ao,Ot,Bt,ir,hr,Nn,Ni,St.vertical?Eo.horizontal:Eo.horizontalOnly,bh?Object.keys(St.horizontal):[so],Hs,ex,Zr,Yr,Xn,oo),bh)break}St.vertical&&(zD+=PI(ht,It,Ue,St.vertical,Ot,Bt,ir,hr,Nn,Ni,Eo.vertical,["vertical"],Hs,tx,Zr,Yr,Xn,oo));let Ol=-1,ox=(so,ao)=>so?Math.max(so,ao):ao;Ol=ox(RD,Ol),Ol=ox(LD,Ol),Ol=ox(OD,Ol);let LO=Ol>-1?1:0;ht.glyphOffsetArray.length>=65535&&_r("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,hr.sortKey),ht.symbolInstances.emplaceBack(Ue.x,Ue.y,Xc.x,Xc.y,Xc.z,Hs.right>=0?Hs.right:-1,Hs.center>=0?Hs.center:-1,Hs.left>=0?Hs.left:-1,Hs.vertical>=0?Hs.vertical:-1,ex,tx,BD,wi!==void 0?wi:ht.collisionBoxArray.length,wi!==void 0?wi+1:ht.collisionBoxArray.length,mp!==void 0?mp:ht.collisionBoxArray.length,mp!==void 0?mp+1:ht.collisionBoxArray.length,Do!==void 0?Do:ht.collisionBoxArray.length,Do!==void 0?Do+1:ht.collisionBoxArray.length,l_||ht.collisionBoxArray.length,l_?l_+1:ht.collisionBoxArray.length,vn,FD,zD,ND,kD,LO,0,rx,ix,Ol,0,nx?1:0)})(t,Ve,vt,st,n,o,c,Fe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,de,ge,x,0,me,Me,V,e,u,b,T,I,P,L)};if(Ne==="line")for(let st of TI(e.geometry,0,0,rt,rt)){let Ve=uL(st,le,be,n.vertical||W,o,K,ne,t.overscaling,rt);for(let Ct of Ve)W&&gL(t,W.text,Ie,Ct)||dt(st,Ct,I)}else if(Ne==="line-center"){for(let st of e.geometry)if(st.length>1){let Ve=cL(st,be,n.vertical||W,o,K,ne);Ve&&dt(st,Ve,I)}}else if(e.type==="Polygon")for(let st of pv(e.geometry,0)){let Ve=dL(st,16);dt(st[0],new Pa(Ve.x,Ve.y,0,0,void 0),I)}else if(e.type==="LineString")for(let st of e.geometry)dt(st,new Pa(st[0].x,st[0].y,0,0,void 0),I);else if(e.type==="Point")for(let st of e.geometry)for(let Ve of st)dt([Ve],new Pa(Ve.x,Ve.y,0,0,void 0),I)}let ep=255,Cl=ep*rs;function PI(t,e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z,V){let W=function(ie,ne,le,de,me,be,ge,Me){let Ne=[];if(ne.positionedLines.length===0)return Ne;let Ie=de.layout.get("text-rotate").evaluate(be,{})*Math.PI/180,Le=function(dt){let st=dt[0],Ve=dt[1],Ct=st*Ve;return Ct>0?[st,-Ve]:Ct<0?[-st,Ve]:st===0?[Ve,st]:[Ve,-st]}(le),Te=Math.abs(ne.top-ne.bottom);for(let dt of ne.positionedLines)Te-=dt.lineOffset;let Re=ne.positionedLines.length,Ke=Te/Re,Fe=ne.top-le[1];for(let dt=0;dt<Re;++dt){let st=ne.positionedLines[dt];Fe=hL(ne,Ke,Fe,dt);for(let Ve of st.positionedGlyphs){if(!Ve.rect)continue;let Ct=Ve.rect||{},vt=hI+1,ht=!0,Ue=1,It=0;if(Ve.imageName){let tr=ge[Ve.imageName];if(!tr)continue;if(tr.sdf){_r("SDF images are not supported in formatted text and will be ignored.");continue}ht=!1,Ue=tr.pixelRatio,vt=io/Ue}let Ht=(me||Me)&&Ve.vertical,St=Ve.metrics.advance*Ve.scale/2,qt=Ve.metrics,Ot=Ve.rect;if(Ot===null)continue;Me&&ne.verticalizable&&(It=Ve.imageName?St-Ve.metrics.width*Ve.scale/2:0);let un=me?[Ve.x+St,Ve.y]:[0,0],Bt=[0,0],Gn=[0,0],vn=!1;me||(Ht?(Gn=[Ve.x+St+Le[0],Ve.y+Le[1]-It],vn=!0):Bt=[Ve.x+St+le[0],Ve.y+le[1]-It]);let wn=Ot.w*Ve.scale/(Ue*(Ve.localGlyph?is:1)),Cn=Ot.h*Ve.scale/(Ue*(Ve.localGlyph?is:1)),xn,ir,Nn,vr;if(Ht){let tr=Ve.y-Fe,hr=new Ge(-St,St-tr),Zr=-Math.PI/2,Xr=new Ge(...Gn);xn=new Ge(-St+Bt[0],Bt[1]),xn._rotateAround(Zr,hr)._add(Xr),xn.x+=-tr+St,xn.y-=(qt.left-vt)*Ve.scale;let Yr=Ve.imageName?qt.advance*Ve.scale:si*Ve.scale,Xn=String.fromCodePoint(Ve.glyph);HR(Xn)?xn.x+=(1-vt)*Ve.scale:qR(Xn)?xn.x+=Yr-qt.height*Ve.scale+(-vt-1)*Ve.scale:xn.x+=Ve.imageName||qt.width+2*vt===Ot.w&&qt.height+2*vt===Ot.h?(Yr-Cn)/2:(Yr-(qt.height+2*vt)*Ve.scale)/2,ir=new Ge(xn.x,xn.y-wn),Nn=new Ge(xn.x+Cn,xn.y),vr=new Ge(xn.x+Cn,xn.y-wn)}else{let tr=(qt.left-vt)*Ve.scale-St+Bt[0],hr=(-qt.top-vt)*Ve.scale+Bt[1],Zr=tr+wn,Xr=hr+Cn;xn=new Ge(tr,hr),ir=new Ge(Zr,hr),Nn=new Ge(tr,Xr),vr=new Ge(Zr,Xr)}if(Ie){let tr;tr=me?new Ge(0,0):vn?new Ge(Le[0],Le[1]):new Ge(le[0],le[1]),xn._rotateAround(Ie,tr),ir._rotateAround(Ie,tr),Nn._rotateAround(Ie,tr),vr._rotateAround(Ie,tr)}let Nr=new Ge(0,0),ni=new Ge(0,0);Ne.push({tl:xn,tr:ir,bl:Nn,br:vr,texPrimary:Ct,texSecondary:void 0,writingMode:ne.writingMode,glyphOffset:un,sectionIndex:Ve.sectionIndex,isSDF:ht,pixelOffsetTL:Nr,pixelOffsetBR:ni,minFontScaleX:0,minFontScaleY:0})}}return Ne}(0,o,x,u,f,_,c,t.allowVerticalPlacement),J=t.textSizeData,K=null;J.kind==="source"?(K=[rs*u.layout.get("text-size").evaluate(_,{},z)],K[0]>Cl&&_r(`${t.layerIds[0]}: Value for "text-size" is >= ${ep}. Reduce your "text-size".`)):J.kind==="composite"&&(K=[rs*L.compositeTextSizes[0].evaluate(_,{},z),rs*L.compositeTextSizes[1].evaluate(_,{},z)],(K[0]>Cl||K[1]>Cl)&&_r(`${t.layerIds[0]}: Value for "text-size" is >= ${ep}. Reduce your "text-size".`)),t.addSymbols(t.text,W,K,x,f,_,T,e,n,b.lineStartIndex,b.lineLength,P,N,z,V,!1);for(let ie of I)M[ie]=t.text.placedSymbolArray.length-1;return 4*W.length}function RI(t){for(let e in t)return t[e];return null}function Ug(t,e,n,o,c,u,f,_,x,b){let T=f.top,I=f.bottom,M=f.left,P=f.right,L=f.collisionPadding;if(L&&(M-=L[0],T-=L[1],P+=L[2],I+=L[3]),x){let N=new Ge(M,T),z=new Ge(P,T),V=new Ge(M,I),W=new Ge(P,I),J=an(x),K=new Ge(0,0);b&&(K=new Ge(b[0],b[1])),N._rotateAround(J,K),z._rotateAround(J,K),V._rotateAround(J,K),W._rotateAround(J,K),M=Math.min(N.x,z.x,V.x,W.x),P=Math.max(N.x,z.x,V.x,W.x),T=Math.min(N.y,z.y,V.y,W.y),I=Math.max(N.y,z.y,V.y,W.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,M,T,P,I,_,o,c,u),t.length-1}function Av(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function gL(t,e,n,o){let c=t.compareText;if(e in c){let u=c[e];for(let f=u.length-1;f>=0;f--)if(o.dist(u[f])<n)return!0}else c[e]=[];return c[e].push(o),!1}function LI(t,e){let n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),u=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),f=Math.sin(t._pitch)*u+c;return Math.min(1.01*f,c*(1/t._horizonShift))}function tp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),o=t.x*n,c=(t.x+1)*n,u=t.y*n,f=(t.y+1)*n,_=kt(o),x=kt(c),b=dn(u),T=dn(f),I=e.project(_,b),M=e.project(x,b),P=e.project(x,T),L=e.project(_,T),N=Math.min(I.x,M.x,P.x,L.x),z=Math.min(I.y,M.y,P.y,L.y),V=Math.max(I.x,M.x,P.x,L.x),W=Math.max(I.y,M.y,P.y,L.y),J=n/16;function K(ne,le,de,me,be,ge){let Me=(de+be)/2,Ne=(me+ge)/2,Ie=e.project(kt(Me),dn(Ne)),Le=Math.max(0,N-Ie.x,z-Ie.y,Ie.x-V,Ie.y-W);N=Math.min(N,Ie.x),V=Math.max(V,Ie.x),z=Math.min(z,Ie.y),W=Math.max(W,Ie.y),Le>J&&(K(ne,Ie,de,me,Me,Ne),K(Ie,le,Me,Ne,be,ge))}K(I,M,o,u,c,u),K(M,P,c,u,c,f),K(P,L,c,f,o,f),K(L,I,o,f,o,u),N-=J,z-=J,V+=J,W+=J;let ie=1/Math.max(V-N,W-z);return{scale:ie,x:N*ie,y:z*ie,x2:V*ie,y2:W*ie,projection:e}}function OI(t,{x:e,y:n},o=0){return new Ge(((e-o)*t.scale-t.x)*rt,(n*t.scale-t.y)*rt)}let _L=i.a6.identity(new Float32Array(16));class Sl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new pe(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return zt(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return LI(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,c){let u=e.horizonLineFromTop(!1),f=new Ge(n,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,n,o){let c=new Ge(n,o);if(e.elevation)return e.elevation.pointCoordinate(c);{let u=this.pointCoordinate(e,c.x,c.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return _L}createTileMatrix(e,n,o){let c,u,f,_=o.canonical,x=i.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=tp(_,this);c=1,u=b.x+o.wrap*b.scale,f=b.y,i.a6.scale(x,x,[c/b.scale,c/b.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(_.z),u=(_.x+Math.pow(2,_.z)*o.wrap)*c,f=_.y*c;return i.a6.translate(x,x,[u,f,0]),i.a6.scale(x,x,[c/rt,c/rt,1]),x}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class yL extends Sl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,o]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(an(n));this.n=(c+Math.sin(an(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:o,c,r0:u}=this,f=an(e-this.center[0]),_=an(n),x=Math.sqrt(c-2*o*Math.sin(_))/o;return{x:x*Math.sin(f*o),y:x*Math.cos(f*o)-u,z:0}}unproject(e,n){let{n:o,c,r0:u}=this,f=u+n,_=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));let x=an(this.center[0])*o;_=xs(_,-Math.PI-x,Math.PI-x);let b=Xt(Hr(_/o)+this.center[0],-180,180),T=Math.asin(Xt((c-(e*e+f*f)*o*o)/(2*o),-1,1)),I=Xt(Hr(T),-en,en);return new pe(b,I)}}let np=1.340264,rp=-.081106,ip=893e-6,op=.003796,$g=Math.sqrt(3)/2;class vL extends Sl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let o=Math.asin($g*Math.sin(n)),c=o*o,u=c*c*c;return{x:.5*(e*Math.cos(o)/($g*(np+3*rp*c+u*(7*ip+9*op*c)))/Math.PI+.5),y:1-.5*(o*(np+rp*c+u*(ip+op*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=o*o,u=c*c*c;for(let T,I,M,P=0;P<12&&(I=o*(np+rp*c+u*(ip+op*c))-n,M=np+3*rp*c+u*(7*ip+9*op*c),T=I/M,o=Xt(o-T,-Math.PI/3,Math.PI/3),c=o*o,u=c*c*c,!(Math.abs(T)<1e-12));++P);let f=$g*e*(np+3*rp*c+u*(7*ip+9*op*c))/Math.cos(o),_=Math.asin(Math.sin(o)/$g),x=Xt(180*f/Math.PI,-180,180),b=Xt(180*_/Math.PI,-en,en);return new pe(x,b)}}class xL extends Sl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let o=360*(e-.5),c=Xt(360*(.5-n),-en,en);return new pe(o,c)}}let mh=Math.PI/2;function Gg(t){return Math.tan((mh+t)/2)}class bL extends Sl{constructor(e){super(e),this.center=e.center||[0,30];let[n,o]=this.parallels=e.parallels||[30,30],c=an(n),u=an(o);this.southernCenter=c+u<0,this.southernCenter&&(c=-c,u=-u);let f=Math.cos(c),_=Gg(c);this.n=c===u?Math.sin(c):Math.log(f/Math.cos(u))/Math.log(Gg(u)/_),this.f=f*Math.pow(Gg(c),this.n)/this.n}project(e,n){n=an(n),this.southernCenter&&(n=-n),e=an(e-this.center[0]);let o=1e-6,{n:c,f:u}=this;u>0?n<-mh+o&&(n=-mh+o):n>mh-o&&(n=mh-o);let f=u/Math.pow(Gg(n),c),_=f*Math.sin(c*e),x=u-f*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:o,f:c}=this,u=c-n,f=Math.sign(u),_=Math.sign(o)*Math.sqrt(e*e+u*u),x=Math.atan2(e,Math.abs(u))*f;u*o<0&&(x-=Math.PI*Math.sign(e)*f);let b=Xt(Hr(x/o)+this.center[0],-180,180),T=Xt(Hr(2*Math.atan(Math.pow(c/_,1/o))-mh),-en,en);return new pe(b,this.southernCenter?-T:T)}}class NI extends Sl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ut(e),y:Rt(n),z:0}}unproject(e,n){let o=kt(e),c=dn(n);return new pe(o,c)}}let kI=an(en);class wL extends Sl{project(e,n){let o=(n=an(n))*n,c=o*o;return{x:.5*((e=an(e))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=25,u=0,f=o*o;do{f=o*o;let b=f*f;u=(o*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-n)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),o=Xt(o-u,-kI,kI)}while(Math.abs(u)>1e-6&&--c>0);f=o*o;let _=Xt(Hr(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Hr(o);return new pe(_,x)}}let FI=an(en);class TL extends Sl{project(e,n){n=an(n),e=an(e);let o=Math.cos(n),c=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),f=Math.sin(u)/u,_=.5*(e*c+2*o*Math.sin(e/2)/f)||0,x=.5*(n+Math.sin(n)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,u=25,f=1e-6,_=0,x=0;do{let b=Math.cos(c),T=Math.sin(c),I=2*T*b,M=T*T,P=b*b,L=Math.cos(o/2),N=Math.sin(o/2),z=2*L*N,V=N*N,W=1-P*L*L,J=W?1/W:0,K=W?Math.acos(b*L)*Math.sqrt(1/W):0,ie=.5*(2*K*b*N+2*o/Math.PI)-e,ne=.5*(K*T+c)-n,le=.5*J*(P*V+K*b*L*M)+1/Math.PI,de=J*(z*I/4-K*T*N),me=.125*J*(I*N-K*T*P*z),be=.5*J*(M*L+K*V*b)+.5,ge=de*me-be*le;_=(ne*de-ie*be)/ge,x=(ie*me-ne*le)/ge,o=Xt(o-_,-Math.PI,Math.PI),c=Xt(c-x,-FI,FI)}while((Math.abs(_)>f||Math.abs(x)>f)&&--u>0);return new pe(Hr(o),Hr(c))}}class zI extends Sl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(an(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:o,cosPhi:c}=this;return{x:an(e)*c*o+.5,y:-Math.sin(an(n))/c*o+.5,z:0}}unproject(e,n){let{scale:o,cosPhi:c}=this,u=-(n-.5)/o,f=Xt(Hr((e-.5)/o)/c,-180,180),_=Math.asin(Xt(u*c,-1,1)),x=Xt(Hr(_),-en,en);return new pe(f,x)}}class EL extends NI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,o){let c=$f(e,n,o),u=wg(Gs(o));return i.N.transformMat4(c,c,u),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let o=De(n.lat,n.lng),c=i.N.normalize([],o),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,f=zt(1,0)*rt*u;i.N.scaleAndAdd(o,o,c,f);let _=i.a6.identity(new Float64Array(16));return i.a6.multiply(_,e.pixelMatrix,e.globeMatrix),i.N.transformMat4(o,o,_),new Ge(o[0],o[1])}pixelsPerMeter(e,n){return zt(1,0)*n}pixelSpaceConversion(e,n,o){let c=zt(1,e)*n,u=cn(zt(1,45)*n,c,o);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,o){let c=sv(Gs(o.canonical));return i.a6.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:o}=e,c=wg(Gs(n));return i.a6.rotateY(c,c,an(o.lng)),i.a6.rotateX(c,c,an(o.lat)),i.a6.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,o,c){return tE(e,n,o,!0)||new _n(0,0)}pointCoordinate3D(e,n,o){let c=this.pointCoordinate(e,n,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!tE(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,u){let f=c.cameraToCenterDistance,_=c._centerAltitude*u,x=c._camera,b=c._camera.forward(),T=i.N.add([],i.N.scale([],b,-f),[0,0,_]),I=c.worldSize/(2*Math.PI),M=[0,0,-I],P=c.width/c.height,L=Math.tan(c.fovAboveCenter),N=i.N.scale([],x.up(),L),z=i.N.scale([],x.right(),L*P),V=i.N.normalize([],i.N.add([],i.N.add([],b,N),z)),W=[],J;if(new tv(T,V).closestPointOnSphere(M,I,W)){let K=i.N.add([],W,M),ie=i.N.sub([],K,T);J=Math.cos(c.fovAboveCenter)*i.N.length(ie)}else{let K=i.N.sub([],T,M),ie=i.N.sub([],M,T);i.N.normalize(ie,ie);let ne=i.N.length(K)-I;J=Math.sqrt(ne*(ne+2*I));let le=Math.acos(J/(I+ne))-Math.acos(i.N.dot(b,ie));J*=Math.cos(le)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Tl(e.zoom);if(o>0){let c=LI(e,zt(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return cn(n,c+u*(1-Math.cos(f)),Math.pow(o,10))}return n}upVector(e,n,o){return $f(n,o,e,1)}upVectorScale(e){return{metersToTile:vg(bg(Gs(e)))}}}function BI(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new NI(t);case"equirectangular":return new xL(t);case"naturalEarth":return new wL(t);case"equalEarth":return new vL(t);case"winkelTripel":return new TL(t);case"albers":return n?new zI(t):new yL(t);case"lambertConformalConic":return n?new zI(t):new bL(t);case"globe":return new EL(t)}throw new Error(`Invalid projection name: ${t.name}`)}let IL=Sg.types,DL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hg(t,e,n,o,c,u,f,_,x,b,T,I,M){let P=_?Math.min(Cl,Math.round(_[0])):0,L=_?Math.min(Cl,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),u,f,(P<<1)+(x?1:0),L,16*b,16*T,256*I,256*M)}function qg(t,e,n){t.emplaceBack(e,n)}function Wg(t,e,n,o,c,u,f){t.emplaceBack(e,n,o,c,u,f)}function Zg(t,e,n,o,c){t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c)}function ML(t){for(let e of t.sections)if(ff(e.text))return!0;return!1}class Pv{constructor(e){this.layoutVertexArray=new Ac,this.indexArray=new Vr,this.programConfigurations=e,this.segments=new yr,this.dynamicLayoutVertexArray=new Fs,this.opacityVertexArray=new Af,this.placedSymbolArray=new eg,this.iconTransitioningVertexArray=new No,this.globeExtVertexArray=new Sf,this.zOffsetVertexArray=new Rc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,o,c,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,FR.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,DL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,BR.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kR.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,zR.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ut(Pv,"SymbolBuffers");class Rv{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new yr,this.collisionVertexArray=new Rf,this.collisionVertexArrayExt=new Fs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jR.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,VR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ut(Rv,"CollisionBuffers");class Xg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i.a6.identity([]),this.placementViewportMatrix=i.a6.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bv(this.zoom,n["text-size"]),this.iconSizeData=bv(this.zoom,n["icon-size"]);let o=this.layers[0].layout,c=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Eo[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new Pv(new $(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Pv(new $(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new rg,this.lineVertexArray=new kc,this.symbolInstances=new ng}calculateGlyphDependencies(e,n,o,c,u){for(let f=0;f<e.length;f++){let _=e.codePointAt(f);if(_===void 0)break;if(n[_]=!0,c&&u&&_<=65535){let x=Kf[e.charAt(f)];x&&(n[x.charCodeAt(0)]=!0)}}}populate(e,n,o,c){let u=this.layers[0],f=u.layout,_=this.projection.name==="globe",x=f.get("text-font"),b=f.get("text-field"),T=f.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof Qr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!I&&!M)return;let L=n.iconDependencies,N=n.glyphDependencies,z=n.availableImages,V=new ar(this.zoom);for(let{feature:W,id:J,index:K,sourceLayerIndex:ie}of e){let ne=u._featureFilter.needGeometry,le=Lr(W,ne);if(!u._featureFilter.filter(V,le,o))continue;if(ne||(le.geometry=$r(W,o,c)),_&&W.type!==1&&o.z<=5){let ge=le.geometry,Me=.98078528056,Ne=(Ie,Le)=>{let Te=$f(Ie.x,Ie.y,o,1),Re=$f(Le.x,Le.y,o,1);return i.N.dot(Te,Re)<Me};for(let Ie=0;Ie<ge.length;Ie++)ge[Ie]=ti(ge[Ie],Ne)}let de,me;if(I){let ge=u.getValueAndResolveTokens("text-field",le,o,z),Me=Qr.factory(ge);ML(Me)&&(this.hasRTLText=!0),(!this.hasRTLText||ks()==="unavailable"||this.hasRTLText&&Ui.isParsed())&&(de=GR(Me,u,le))}if(M){let ge=u.getValueAndResolveTokens("icon-image",le,o,z);me=ge instanceof Mt?ge:Mt.fromString(ge)}if(!de&&!me)continue;let be=this.sortFeaturesByKey?P.evaluate(le,{},o):void 0;if(this.features.push({id:J,text:de,icon:me,index:K,sourceLayerIndex:ie,geometry:le.geometry,properties:W.properties,type:IL[W.type],sortKey:be}),me&&(L[me.namePrimary]=!0,me.nameSecondary&&(L[me.nameSecondary]=!0)),de){let ge=x.evaluate(le,{},o).join(","),Me=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Eo.vertical)>=0;for(let Ne of de.sections)if(Ne.image)L[Ne.image.namePrimary]=!0;else{let Ie=Os(de.toString()),Le=Ne.fontStack||ge,Te=N[Le]=N[Le]||{};this.calculateGlyphDependencies(Ne.text,Te,Me,this.allowVerticalPlacement,Ie)}}}f.get("symbol-placement")==="line"&&(this.features=function(W){let J={},K={},ie=[],ne=0;function le(ge){ie.push(W[ge]),ne++}function de(ge,Me,Ne){let Ie=K[ge];return delete K[ge],K[Me]=Ie,ie[Ie].geometry[0].pop(),ie[Ie].geometry[0]=ie[Ie].geometry[0].concat(Ne[0]),Ie}function me(ge,Me,Ne){let Ie=J[Me];return delete J[Me],J[ge]=Ie,ie[Ie].geometry[0].shift(),ie[Ie].geometry[0]=Ne[0].concat(ie[Ie].geometry[0]),Ie}function be(ge,Me,Ne){let Ie=Ne?Me[0][Me[0].length-1]:Me[0][0];return`${ge}:${Ie.x}:${Ie.y}`}for(let ge=0;ge<W.length;ge++){let Me=W[ge],Ne=Me.geometry,Ie=Me.text?Me.text.toString():null;if(!Ie){le(ge);continue}let Le=be(Ie,Ne),Te=be(Ie,Ne,!0);if(Le in K&&Te in J&&K[Le]!==J[Te]){let Re=me(Le,Te,Ne),Ke=de(Le,Te,ie[Re].geometry);delete J[Le],delete K[Te],K[be(Ie,ie[Ke].geometry,!0)]=Ke,ie[Re].geometry=null}else Le in K?de(Le,Te,Ne):Te in J?me(Le,Te,Ne):(le(ge),J[Le]=ne-1,K[Te]=ne-1)}return ie.filter(ge=>ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,J)=>W.sortKey-J.sortKey)}update(e,n,o,c,u){let f=Object.keys(e).length!==0;if(f&&!this.stateDependentLayers.length)return;let _=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,o,c,u),this.icon.programConfigurations.updatePaintArrays(e,n,_,o,c,u)}updateZOffset(){let e=(u,f,_)=>{o+=f,o>u.length&&u.resize(o);for(let x=-f;x<0;x++)u.emplace(x+o,_)},n=(u,f,_)=>{c+=f,c>u.length&&u.resize(c);for(let x=-f;x<0;x++)u.emplace(x+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,c=0;for(let u=0;u<this.symbolInstances.length;u++){let f=this.symbolInstances.get(u),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:x,numIconVertices:b}=f,T=f.zOffset,I=b>0;if((_>0||x>0)&&(e(this.text.zOffsetVertexArray,_,T),e(this.text.zOffsetVertexArray,x,T)),I){let{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:P}=f;M>=0&&n(this.icon.zOffsetVertexArray,b,T),P>=0&&n(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=BI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:u}of n)this.lineVertexArray.emplaceBack(c,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,u,f,_,x,b,T,I,M,P,L,N,z){let V=e.indexArray,W=e.layoutVertexArray,J=e.globeExtVertexArray,K=e.segments.prepareSegment(4*n.length,W,V,this.canOverlap?f.sortKey:void 0),ie=this.glyphOffsetArray.length,ne=K.vertexLength,le=this.allowVerticalPlacement&&_===Eo.vertical?Math.PI/2:0,de=f.text&&f.text.sections;for(let be=0;be<n.length;be++){let{tl:ge,tr:Me,bl:Ne,br:Ie,texPrimary:Le,texSecondary:Te,pixelOffsetTL:Re,pixelOffsetBR:Ke,minFontScaleX:Fe,minFontScaleY:dt,glyphOffset:st,isSDF:Ve,sectionIndex:Ct}=n[be],vt=K.vertexLength,ht=st[1];if(Hg(W,b.x,b.y,ge.x,ht+ge.y,Le.x,Le.y,o,Ve,Re.x,Re.y,Fe,dt),Hg(W,b.x,b.y,Me.x,ht+Me.y,Le.x+Le.w,Le.y,o,Ve,Ke.x,Re.y,Fe,dt),Hg(W,b.x,b.y,Ne.x,ht+Ne.y,Le.x,Le.y+Le.h,o,Ve,Re.x,Ke.y,Fe,dt),Hg(W,b.x,b.y,Ie.x,ht+Ie.y,Le.x+Le.w,Le.y+Le.h,o,Ve,Ke.x,Ke.y,Fe,dt),x){let{x:Ue,y:It,z:Ht}=x.anchor,[St,qt,Ot]=x.up;Wg(J,Ue,It,Ht,St,qt,Ot),Wg(J,Ue,It,Ht,St,qt,Ot),Wg(J,Ue,It,Ht,St,qt,Ot),Wg(J,Ue,It,Ht,St,qt,Ot),Zg(e.dynamicLayoutVertexArray,Ue,It,Ht,le)}else Zg(e.dynamicLayoutVertexArray,b.x,b.y,b.z,le);if(z){let Ue=Te||Le;qg(e.iconTransitioningVertexArray,Ue.x,Ue.y),qg(e.iconTransitioningVertexArray,Ue.x+Ue.w,Ue.y),qg(e.iconTransitioningVertexArray,Ue.x,Ue.y+Ue.h),qg(e.iconTransitioningVertexArray,Ue.x+Ue.w,Ue.y+Ue.h)}V.emplaceBack(vt,vt+1,vt+2),V.emplaceBack(vt+1,vt+2,vt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),be!==n.length-1&&Ct===n[be+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,f,f.index,{},P,L,N,de&&de[Ct])}let me=x?x.anchor:b;e.placedSymbolArray.emplaceBack(me.x,me.y,me.z,b.x,b.y,ie,this.glyphOffsetArray.length-ie,ne,T,I,b.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,M,0)}_commitLayoutVertex(e,n,o,c,u,f,_){e.emplaceBack(n,o,c,u,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,o,c,u,f,_){let x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),b=x.vertexLength,T=_.tileAnchorX,I=_.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(o.layoutVertexArray,c,u,f,T,I,new Ge(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,f,T,I,new Ge(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,f,T,I,new Ge(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,u,f,T,I,new Ge(e.x1,e.y2)),x.vertexLength+=4;let M=o.indexArray;M.emplaceBack(b,b+1),M.emplaceBack(b+1,b+2),M.emplaceBack(b+2,b+3),M.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,c,u,f){for(let _=c;_<u;_++){let x=o.get(_),b=this.getSymbolInstanceTextSize(e,f,n,_);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,n,o,c,u,f){for(let _=c;_<u;_++){let x=o.get(_),b=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rv(Pc,oI.members,No),this.iconCollisionBox=new Rv(Pc,oI.members,No);let o=lh(this.iconSizeData,e),c=lh(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let f=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,n,o,c){let u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),f=Ng(this.textSizeData,e,u)/si;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,n,o){let c=this.icon.placedSymbolArray.get(o),u=Ng(this.iconSizeData,e,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,o,c){e.emplaceBack(n,-o,-o,c),e.emplaceBack(n,o,-o,c),e.emplaceBack(n,o,o,c),e.emplaceBack(n,-o,o,c)}_updateTextDebugCollisionBoxes(e,n,o,c,u,f){for(let _=c;_<u;_++){let x=o.get(_),b=this.getSymbolInstanceTextSize(e,f,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,x.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,n,o,c,u,f){for(let _=c;_<u;_++){let x=o.get(_),b=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding,f.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=lh(this.iconSizeData,e),c=lh(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let f=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,c,u,f,_,x,b){let T={};if(n<o){let{x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K,featureIndex:ie}=e.get(n);T.textBox={x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K},T.textFeatureIndex=ie}if(c<u){let{x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K,featureIndex:ie}=e.get(c);T.verticalTextBox={x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K},T.verticalTextFeatureIndex=ie}if(f<_){let{x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K,featureIndex:ie}=e.get(f);T.iconBox={x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K},T.iconFeatureIndex=ie}if(x<b){let{x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K,featureIndex:ie}=e.get(x);T.verticalIconBox={x1:I,y1:M,x2:P,y2:L,padding:N,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:J,tileAnchorY:K},T.verticalIconFeatureIndex=ie}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<c;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),o=Math.cos(e),c=[],u=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);let x=this.symbolInstances.get(_);c.push(0|Math.round(n*x.tileAnchorX+o*x.tileAnchorY)),u.push(x.featureIndex)}return f.sort((_,x)=>c[_]-c[x]||u[x]-u[_]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=o;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ut(Xg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Xg.addDynamicAttributes=Zg;let CL=new lr({"symbol-placement":new Xe(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Xe(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xe(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Et(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xe(ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xe(ye.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Xe(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xe(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xe(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xe(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Et(ye.layout_symbol["icon-size"]),"icon-text-fit":new Et(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Et(ye.layout_symbol["icon-image"]),"icon-rotate":new Et(ye.layout_symbol["icon-rotate"]),"icon-padding":new Xe(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Xe(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Et(ye.layout_symbol["icon-offset"]),"icon-anchor":new Et(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xe(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xe(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xe(ye.layout_symbol["text-rotation-alignment"]),"text-field":new Et(ye.layout_symbol["text-field"]),"text-font":new Et(ye.layout_symbol["text-font"]),"text-size":new Et(ye.layout_symbol["text-size"]),"text-max-width":new Et(ye.layout_symbol["text-max-width"]),"text-line-height":new Et(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Et(ye.layout_symbol["text-letter-spacing"]),"text-justify":new Et(ye.layout_symbol["text-justify"]),"text-radial-offset":new Et(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xe(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new Et(ye.layout_symbol["text-anchor"]),"text-max-angle":new Xe(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Xe(ye.layout_symbol["text-writing-mode"]),"text-rotate":new Et(ye.layout_symbol["text-rotate"]),"text-padding":new Xe(ye.layout_symbol["text-padding"]),"text-keep-upright":new Xe(ye.layout_symbol["text-keep-upright"]),"text-transform":new Et(ye.layout_symbol["text-transform"]),"text-offset":new Et(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Xe(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xe(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Xe(ye.layout_symbol["text-optional"]),visibility:new Xe(ye.layout_symbol.visibility)});var Lv={paint:new lr({"icon-opacity":new Et(ye.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Et(ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Et(ye.paint_symbol["text-emissive-strength"]),"icon-color":new Et(ye.paint_symbol["icon-color"]),"icon-halo-color":new Et(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Et(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Et(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Xe(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xe(ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Et(ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Et(ye.paint_symbol["text-opacity"]),"text-color":new Et(ye.paint_symbol["text-color"],{runtimeType:eo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Et(ye.paint_symbol["text-halo-color"]),"text-halo-width":new Et(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Et(ye.paint_symbol["text-halo-blur"]),"text-translate":new Xe(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Xe(ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xe(ye.paint_symbol["icon-color-saturation"])}),layout:CL};class jI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ja,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut(jI,"FormatSectionOverride",{omit:["defaultValue"]});class Yg extends Pi{constructor(e,n,o){super(e,Lv,n,o)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let c=[];for(let u of o)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){let u=this.layout.get(e).evaluate(n,{},o,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||_c(f.value)||!u?u:function(_,x){return x.replace(/{([^{}]+)}/g,(b,T)=>T in _?String(_[T]):"")}(n.properties,u)}createBucket(e){return new Xg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Lv.paint.overridableProperties){if(!Yg.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),o=new jI(n),c=new Uu(o,n.property.specification,this.scope,this.options),u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new hf("source",c):new yc("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new _l(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Yg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let o=e.get("text-field"),c=Lv.paint.properties[n],u=!1,f=_=>{for(let x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Qr)f(o.value.value.sections);else if(o.value.kind==="source"){let _=b=>{u||(b instanceof qo&&Pr(b.value)===el?f(b.value.sections):b instanceof nl?f(b.sections):b.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return u}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),n&&o.push("symbolSDF"),o}getDefaultProgramParams(e,n){return{config:new F(this,n),overrideFog:!1}}}let SL=new lr({visibility:new Xe(ye.layout_background.visibility)});var AL={paint:new lr({"background-color":new Xe(ye.paint_background["background-color"]),"background-pattern":new Xe(ye.paint_background["background-pattern"]),"background-opacity":new Xe(ye.paint_background["background-opacity"]),"background-emissive-strength":new Xe(ye.paint_background["background-emissive-strength"])}),layout:SL};let PL=new lr({visibility:new Xe(ye.layout_raster.visibility)});var RL={paint:new lr({"raster-opacity":new Xe(ye.paint_raster["raster-opacity"]),"raster-color":new wa(ye.paint_raster["raster-color"]),"raster-color-mix":new Xe(ye.paint_raster["raster-color-mix"]),"raster-color-range":new Xe(ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xe(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xe(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xe(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Xe(ye.paint_raster["raster-saturation"]),"raster-contrast":new Xe(ye.paint_raster["raster-contrast"]),"raster-resampling":new Xe(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Xe(ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xe(ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xe(ye.paint_raster["raster-array-band"]),"raster-elevation":new Xe(ye.paint_raster["raster-elevation"])}),layout:PL},Ov=Rn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Nv{constructor(e,n,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,o){let{width:c,height:u}=e,{context:f}=this,{gl:_}=f;if(_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===u){let{x,y:b}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,x,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let T=this.format,I=_.UNSIGNED_BYTE;this.format===_.R32F&&(T=_.RED,I=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,x,b,c,u,T,I,e.data)}}else if(this.size=[c,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let x=this.format;this.format===_.R8&&(x=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,x,_.UNSIGNED_BYTE,e)}else{let x=this.format,b=this.format,T=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(x=_.DEPTH_COMPONENT16,T=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(T=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,x,c,u,0,b,T,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,o=!1){let{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,o,c){let{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),c!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Kg{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}function Jg(t,e,n,o,c,u,f,_){let x=[t,e,1,n,o,1,c,u,1],b=[f,_,1],T=i.co.adjoint([],x),[I,M,P]=i.N.transformMat3(b,b,T);return i.co.multiply(x,x,[I,0,0,0,M,0,0,0,P])}function VI(t,e,n,o,c,u,f,_){let x=function(b,T,I,M,P,L,N,z){let V=Jg(0,0,1,0,1,1,0,1),W=Jg(b,T,I,M,P,L,N,z),J=i.co.adjoint([],V);return i.co.multiply(W,W,J)}(t,e,n,o,c,u,f,_);return[x[2]/x[8]/rt,x[5]/x[8]/rt]}function Qg(t){return[t[0],Math.min(Math.max(t[1],-en),en)]}class UI extends Ka{constructor(e,n,o,c){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ca("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=nt(this.map._requestManager.transformRequest(this.url,Mi.Image),(o,c)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new pd(o)):c&&(this.image=c instanceof HTMLImageElement?$e.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Kg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ca("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Kg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],o=e[0][1];for(let u of e)u[1]>o&&(o=u[1]),u[1]<n&&(n=u[1]);let c=(o+n)/2;if(c>en?this.onNorthPole=!0:c<-en&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(_n.fromLngLat);this.tileID=function(f){let _=1/0,x=1/0,b=-1/0,T=-1/0;for(let N of f)_=Math.min(_,N.x),x=Math.min(x,N.y),b=Math.max(b,N.x),T=Math.max(T,N.y);let I=Math.max(b-_,T-x),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,M),L=Math.floor((_+b)/2*P);return L>1&&(L-=1),new je(M,L,Math.floor((x+T)/2*P))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ca("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let V in this.tiles){let W=this.tiles[V];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=tp(new je(0,0,0),this.map.transform.projection),o=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){let W=V[1].x-V[0].x,J=V[1].y-V[0].y,K=V[2].x-V[1].x,ie=V[2].y-V[1].y,ne=V[3].x-V[2].x,le=V[3].y-V[2].y,de=V[0].x-V[3].x,me=V[0].y-V[3].y,be=W*ie-K*J,ge=K*le-ne*ie,Me=ne*me-de*le,Ne=de*J-W*me;return be>0&&ge>0&&Me>0&&Ne>0||be<0&&ge<0&&Me<0&&Ne<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=tp(this.tileID,this.map.transform.projection),[u,f,_,x]=this.coordinates.map(V=>{let W=c.projection.project(V[0],V[1]);return OI(c,W)._round()});this.perspectiveTransform=VI(u.x,u.y,f.x,f.y,_.x,_.y,x.x,x.y);let b=this._boundsArray=new Jo;b.emplaceBack(u.x,u.y,0,0),b.emplaceBack(f.x,f.y,rt,0),b.emplaceBack(x.x,x.y,0,rt),b.emplaceBack(_.x,_.y,rt,rt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,Ov.members),this.boundsSegments=yr.simpleSegment(0,0,4,2);let T=[],I=[Qg((M=this.coordinates)[0]),Qg(M[1]),Qg(M[2]),Qg(M[3])];var M;let[P,L,N,z]=function(V){let W=V[0][0],J=W,K=V[0][1],ie=K;for(let ne=1;ne<V.length;ne++)V[ne][0]<W?W=V[ne][0]:V[ne][0]>J&&(J=V[ne][0]),V[ne][1]<K?K=V[ne][1]:V[ne][1]>ie&&(ie=V[ne][1]);return[W,K,J-W,ie-K]}(I);{let V=new Jo,[W,J,K,ie]=function(Re){let Ke=Re[0].x,Fe=Ke,dt=Re[0].y,st=dt;for(let Ve=1;Ve<Re.length;Ve++)Re[Ve].x<Ke?Ke=Re[Ve].x:Re[Ve].x>Fe&&(Fe=Re[Ve].x),Re[Ve].y<dt?dt=Re[Ve].y:Re[Ve].y>st&&(st=Re[Ve].y);return[Ke,dt,Fe-Ke,st-dt]}(o),ne=Re=>[(Re.x-W)/K,(Re.y-J)/ie],[le,de,me,be]=o.map(ne),ge=function(Re,Ke,Fe,dt,st,Ve,Ct,vt){let ht=Jg(0,0,1,0,1,1,0,1),Ue=Jg(Re,Ke,Fe,dt,st,Ve,Ct,vt),It=i.co.adjoint([],Ue);return i.co.multiply(ht,ht,It)}(le[0],le[1],de[0],de[1],me[0],me[1],be[0],be[1]);this.elevatedGlobePerspectiveTransform=VI(le[0],le[1],de[0],de[1],me[0],me[1],be[0],be[1]);let Me=(Re,Ke)=>{T.push(Re.lng);let Fe=Math.round((Re.lng-P)/N*rt),dt=Math.round((Re.lat-L)/z*rt),st=ne(Ke),Ve=i.N.transformMat3([],[st[0],st[1],1],ge),Ct=Math.round(Ve[0]/Ve[2]*rt),vt=Math.round(Ve[1]/Ve[2]*rt);V.emplaceBack(Fe,dt,Ct,vt)},Ne=o[3].x-o[0].x,Ie=o[3].y-o[0].y,Le=o[2].x-o[1].x,Te=o[2].y-o[1].y;for(let Re=0;Re<65;Re++){let Ke=Re/64,Fe=[o[0].x+Ke*Ne,o[0].y+Ke*Ie],dt=[o[1].x+Ke*Le,o[1].y+Ke*Te],st=dt[0]-Fe[0],Ve=dt[1]-Fe[1];for(let Ct=0;Ct<65;Ct++){let vt=Ct/64,ht={x:Fe[0]+st*vt,y:Fe[1]+Ve*vt,z:0};Me(n.projection.unproject(ht.x,ht.y),ht)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,Ov.members)}{this.maxLongitudeTriangleSize=0;let V=[],W=new Vr,J=(K,ie,ne)=>{W.emplaceBack(K,ie,ne);let le=T[K],de=T[ie],me=T[ne],be=Math.min(Math.min(le,de),me),ge=Math.max(Math.max(le,de),me)-be;ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ge),V.push(be+ge/2)};for(let K=0;K<64;K++)for(let ie=0;ie<64;ie++){let ne=65*K+ie,le=ne+1,de=ne+65,me=de+1;J(ne,de,le),J(le,de,me)}[V,W]=function(K,ie){let ne=Array.from({length:K.length},(me,be)=>be);ne.sort((me,be)=>K[me]-K[be]);let le=[],de=new Vr;for(let me=0;me<ne.length;me++){let be=ne[me];le.push(K[be]);let ge=3*be,Me=ge+1;de.emplaceBack(ie.uint16[ge],ie.uint16[Me],ie.uint16[Me+1])}return[le,de]}(V,W),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=yr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,N/rt,0,z/rt,0,0,L,P,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,o=n.gl;!this._dirty||this.texture instanceof Kg||(this.texture?this.texture.update(this.image):(this.texture=new Nv(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,c=((T,I)=>T+360*Math.round((I-T)/360))(e+180,o[0]),u=new yr,f=(T,I)=>{u.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},_=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-c)<=_){let T=Se(o,0,o.length,c+_);return T===o.length||f(T,he(o,T+1,o.length,c+360-_)-T),u}c<o[0]&&(c+=360);let x=he(o,0,o.length,c-_);if(x===o.length)return f(0,o.length),u;f(0,x-0);let b=Se(o,x+1,o.length,c+_);return b!==o.length&&f(b,o.length-b),u}}let LL=(Math.pow(256,2)-1)/16907520;class $I extends Pi{constructor(e,n,o){super(e,RL,n,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof UI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[o,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(c)||o===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Gf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,c])}}let OL=new lr({visibility:new Xe(ye["layout_raster-particle"].visibility)});var NL={paint:new lr({"raster-particle-array-band":new Xe(ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xe(ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new wa(ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xe(ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xe(ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xe(ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xe(ye["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:OL};class GI extends Pi{constructor(e,n,o){super(e,NL,n,o),this._updateColorRamp(),this.onRemove=c=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&c.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=$e.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Gf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=$e.now()}}class kL extends Pi{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let FL=new lr({visibility:new Xe(ye.layout_sky.visibility)});var zL={paint:new lr({"sky-type":new Xe(ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xe(ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xe(ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xe(ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xe(ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new wa(ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xe(ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xe(ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xe(ye.paint_sky["sky-opacity"])}),layout:FL};function kv(t,e,n){let o=[0,0,1],c=i.bi.identity([]);return i.bi.rotateY(c,c,n?-an(t)+Math.PI:an(t)),i.bi.rotateX(c,c,-an(e)),i.N.transformQuat(o,o,c),i.N.normalize(o,o)}var BL={paint:new lr({})};function HI(t,e){let n=e_(t.projection,t.zoom,t.width,t.height),o=function(u,f,_,x,b){let T=new pe(_.lng-180*Al,_.lat),I=new pe(_.lng+180*Al,_.lat),M=u.project(T.lng,T.lat),P=u.project(I.lng,I.lat),L=-Math.atan2(P.y-M.y,P.x-M.x),N=_n.fromLngLat(_);N.y=Xt(N.y,-1+Al,1-Al);let z=N.toLngLat(),V=u.project(z.lng,z.lat),W=_n.fromLngLat(z);W.x+=Al;let J=W.toLngLat(),K=u.project(J.lng,J.lat),ie=ZI(K.x-V.x,K.y-V.y,L),ne=_n.fromLngLat(z);ne.y+=Al;let le=ne.toLngLat(),de=u.project(le.lng,le.lat),me=ZI(de.x-V.x,de.y-V.y,L),be=Math.abs(ie.x)/Math.abs(me.y),ge=i.a6.identity([]);i.a6.rotateZ(ge,ge,-L*(1-(b?0:x)));let Me=i.a6.identity([]);return i.a6.scale(Me,Me,[1,1-(1-be)*x,1]),Me[4]=-me.x/me.y*x,i.a6.rotateZ(Me,Me,L),i.a6.multiply(Me,ge,Me),Me}(t.projection,0,t.center,n,e),c=qI(t);return i.a6.scale(o,o,[c,c,1]),o}function qI(t){let e=t.projection,n=e_(t.projection,t.zoom,t.width,t.height),o=WI(e,t.center),c=WI(e,pe.convert(e.center));return Math.pow(2,o*n+(1-n)*c)}function e_(t,e,n,o,c=1/0){let u=t.range;if(!u)return 0;let f=Math.min(c,Math.max(n,o)),_=Math.log(f/1024)/Math.LN2;return qa(u[0]+_,u[1]+_,e)}let Al=1/4e4;function WI(t,e){let n=Xt(e.lat,-en,en),o=new pe(e.lng-180*Al,n),c=new pe(e.lng+180*Al,n),u=t.project(o.lng,n),f=t.project(c.lng,n),_=_n.fromLngLat(o),x=_n.fromLngLat(c),b=f.x-u.x,T=f.y-u.y,I=x.x-_.x,M=x.y-_.y,P=Math.sqrt((I*I+M*M)/(b*b+T*T));return Math.log(P)/Math.LN2}function ZI(t,e,n){let o=Math.cos(n),c=Math.sin(n);return{x:t*o-e*c,y:t*c+e*o}}function XI(t,e,n){i.a6.identity(t),i.a6.rotateZ(t,t,an(e[2])),i.a6.rotateX(t,t,an(e[0])),i.a6.rotateY(t,t,an(e[1])),i.a6.scale(t,t,n),i.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function t_(t,e,n,o,c,u,f,_){let x=[n[0]-e[0],n[1]-e[1],0],b=[o[0]-e[0],o[1]-e[1],0];if(i.N.length(x)<1e-12||i.N.length(b)<1e-12)return i.bi.identity(t);let T=i.N.cross([],x,b);i.N.normalize(T,T),i.N.subtract(b,o,e),x[2]=(u-c)*_,b[2]=(f-c)*_;let I=x;return i.N.cross(I,x,b),i.N.normalize(I,I),i.bi.rotationTo(t,T,I)}function Fv(t,e,n=!1){let o=Tl(e.zoom),c=function(u,f,_){let x=f.worldSize,b=[u[12],u[13],u[14]],T=dn(b[1]/x),I=kt(b[0]/x),M=i.a6.identity([]),P=zt(1,T)*x,L=zt(1,0)*x*tn(T,f.zoom),N=1/av(x),z=L*N;if(_){let K=e_(f.projection,f.zoom,f.width,f.height,1024);z=N*f.projection.pixelSpaceConversion(f.center.lat,x,K)}let V=De(T,I);i.N.add(V,V,i.N.scale([],i.N.normalize([],V),P*z*b[2]));let W=function(K){let ie=[K[0],K[1],K[2]],ne=[0,1,0],le=i.N.cross([],ne,ie);return i.N.cross(ne,ie,le),i.N.squaredLength(ne)===0&&(ne=[0,1,0],i.N.cross(le,ie,ne)),i.N.normalize(le,le),i.N.normalize(ne,ne),i.N.normalize(ie,ie),[le[0],le[1],le[2],0,ne[0],ne[1],ne[2],0,ie[0],ie[1],ie[2],0,K[0],K[1],K[2],1]}(V);i.a6.scale(M,M,[z,z,z*P]),i.a6.translate(M,M,[-b[0],-b[1],-b[2]]);let J=i.a6.multiply([],f.globeMatrix,W);return i.a6.multiply(J,J,M),i.a6.multiply(J,J,u),J}(t,e,n);if(o>0){let u=function(f,_){let x=_.worldSize,b=zt(1,0)*x*tn(_.center.lat,_.zoom)/av(x),T=zt(1,_.center.lat)*x,I=i.a6.identity([]);return i.a6.rotateY(I,I,an(_.center.lng)),i.a6.rotateX(I,I,an(_.center.lat)),i.a6.translate(I,I,[0,0,X]),i.a6.scale(I,I,[b,b,b*T]),i.a6.translate(I,I,[_.point.x-.5*x,_.point.y-.5*x,0]),i.a6.multiply(I,I,f),i.a6.multiply(I,_.globeMatrix,I)}(t,e);return function(f,_,x){let b=(L,N,z)=>{let V=i.N.length(L),W=i.N.length(N),J=Sa(L,N,z);return i.N.scale(J,J,1/i.N.length(J)*cn(V,W,z))},T=b([f[0],f[1],f[2]],[_[0],_[1],_[2]],x),I=b([f[4],f[5],f[6]],[_[4],_[5],_[6]],x),M=b([f[8],f[9],f[10]],[_[8],_[9],_[10]],x),P=Sa([f[12],f[13],f[14]],[_[12],_[13],_[14]],x);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,M[0],M[1],M[2],0,P[0],P[1],P[2],1]}(c,u,o)}return c}function YI(t,e,n,o){let c=mr.projectAabbCorners(o,n),u=Number.MAX_VALUE,f=-1;for(let b=0;b<c.length;++b){let T=c[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<u&&(f=b,u=T[2])}let _=b=>new Ge(c[b][0],c[b][1]),x;switch(f){case 0:case 6:x=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:x=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:x=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:x=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(Fo(t,x))return u}let jL=Rn([{name:"a_pos_3f",components:3,type:"Float32"}]),VL=Rn([{name:"a_color_3f",components:3,type:"Float32"}]),UL=Rn([{name:"a_color_4f",components:4,type:"Float32"}]),$L=Rn([{name:"a_uv_2f",components:2,type:"Float32"}]),GL=Rn([{name:"a_normal_3f",components:3,type:"Float32"}]),HL=Rn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qL=Rn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class KI{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class JI{constructor(){this.instancedDataArray=new Nf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class zv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,o,c){this.tileToMeter=nn(o);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:f,id:_,index:x,sourceLayerIndex:b}of e){let T=Lr(f,u);if(!this.layers[0]._featureFilter.filter(new ar(this.zoom),T,o))continue;let I={id:_,sourceLayerIndex:b,index:x,geometry:u?T.geometry:$r(f,o,c),properties:f.properties,type:f.type,patterns:{}},M=this.addFeature(I,I.geometry,T);M&&n.featureIndex.insert(f,I.geometry,x,b,this.index,this.instancesPerModel[M].instancedDataArray.length,rt/32)}this.lookup=null}update(e,n,o,c){for(let u in this.instancesPerModel){let f=this.instancesPerModel[u];for(let _ in e)f.idToFeaturesIndex.hasOwnProperty(_)&&this.evaluate(f.features[f.idToFeaturesIndex[_]],e[_],f,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];for(let c of o.features){let u=this.layers[0],f=c.feature,_=this.canonical,x=u.paint.get("model-rotation").evaluate(f,{},_),b=u.paint.get("model-scale").evaluate(f,{},_),T=u.paint.get("model-translation").evaluate(f,{},_);i.N.exactEquals(c.rotation,x)&&i.N.exactEquals(c.scale,b)&&i.N.exactEquals(c.translation,T)||(this.evaluate(c,c.featureStates,o,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,HL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let n=this.instancesPerModel[e];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,o){let c=this.layers[0],u=c.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return _r(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new JI);let f=this.instancesPerModel[u],_=f.instancedDataArray,x=new KI(o,_.length);for(let b of n)for(let T of b){if(T.x<0||T.x>=rt||T.y<0||T.y>=rt)continue;let I=(this.lookupDim-1)/rt,M=this.lookupDim*(T.y*I|0)+T.x*I|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;let P=_.length;_.resize(P+1),f.instancesEvaluatedElevation.push(0),_.float32[16*P]=T.x,_.float32[16*P+1]=T.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),u}evaluate(e,n,o,c){let u=this.layers[0],f=e.feature,_=this.canonical,x=e.rotation=u.paint.get("model-rotation").evaluate(f,n,_),b=e.scale=u.paint.get("model-scale").evaluate(f,n,_),T=e.translation=u.paint.get("model-translation").evaluate(f,n,_),I=u.paint.get("model-color").evaluate(f,n,_);I.a=u.paint.get("model-color-mix-intensity").evaluate(f,n,_);let M=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),XI(M,x,b);let P=Math.round(100*I.a)+I.b/1.05;for(let L=0;L<e.instancedDataCount;++L){let N=e.instancedDataOffset+L,z=16*N,V=o.instancedDataArray.float32,W=0;c&&(W=V[z+6]-o.instancesEvaluatedElevation[N]);let J=0|V[z+1];V[z]=(0|V[z])+I.r/1.05,V[z+1]=J+I.g/1.05,V[z+2]=P,V[z+3]=1/(_.z>10?this.tileToMeter:nn(_,J)),V[z+4]=T[0],V[z+5]=T[1],V[z+6]=T[2]+W,V[z+7]=M[0],V[z+8]=M[1],V[z+9]=M[2],V[z+10]=M[4],V[z+11]=M[5],V[z+12]=M[6],V[z+13]=M[8],V[z+14]=M[9],V[z+15]=M[10],o.instancesEvaluatedElevation[N]=T[2]}}}ut(zv,"ModelBucket",{omit:["layers"]}),ut(JI,"PerModelAttributes"),ut(KI,"ModelFeature");let WL=new lr({visibility:new Xe(ye.layout_model.visibility),"model-id":new Et(ye.layout_model["model-id"])});var ZL={paint:new lr({"model-opacity":new Xe(ye.paint_model["model-opacity"]),"model-rotation":new Et(ye.paint_model["model-rotation"]),"model-scale":new Et(ye.paint_model["model-scale"]),"model-translation":new Et(ye.paint_model["model-translation"]),"model-color":new Et(ye.paint_model["model-color"]),"model-color-mix-intensity":new Et(ye.paint_model["model-color-mix-intensity"]),"model-type":new Xe(ye.paint_model["model-type"]),"model-cast-shadows":new Xe(ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xe(ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xe(ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Et(ye.paint_model["model-emissive-strength"]),"model-roughness":new Et(ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Et(ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xe(ye.paint_model["model-cutoff-fade-range"])}),layout:WL};let qc=64,gh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function QI(t,e,n,o,c,u,f,_,x,b=!1){let T=n.zoom,I=n.project(o),M=tn(o.lat,T),P=1/M;i.a6.identity(t),i.a6.translate(t,t,[I.x+f[0]*P,I.y+f[1]*P,f[2]]);let L=1,N=1,z=n.worldSize;if(b){if(n.projection.name==="mercator"){let K=0;n.elevation&&(K=n.elevation.getAtPointOrZero(new _n(I.x/z,I.y/z),0));let ie=i.a7.transformMat4([],[I.x,I.y,K,1],n.projMatrix)[3]/n.cameraToCenterDistance;L=ie,N=ie*tn(n.center.lat,T)}else if(n.projection.name==="globe"){let K=Fv(t,n),ie=i.a6.multiply([],n.projMatrix,K),ne=[0,0,0,1];i.a7.transformMat4(ne,ne,ie);let le=ne[3]/n.cameraToCenterDistance,de=Tl(T),me=n.projection.pixelsPerMeter(o.lat,z)*tn(o.lat,T),be=n.projection.pixelsPerMeter(n.center.lat,z)*tn(n.center.lat,T);L=le/cn(me,cr(n.center.lat),de),N=le*M/me,L*=be,N*=be}}else L=P;i.a6.scale(t,t,[L,L,N]);let V=[...t],W=e.orientation,J=[];if(XI(J,[W[0]+c[0],W[1]+c[1],W[2]+c[2]],u),i.a6.multiply(t,V,J),_&&n.elevation){let K=0,ie=[];if(x&&n.elevation){K=function(de,me,be,ge,Me){let Ne=me.elevation;if(!Ne)return 0;let Ie=mr.projectAabbCorners(be,ge),Le=zt(1,Me.lat)*me.worldSize,Te=function(It,Ht){let St=[0,0,1],qt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Ot of qt){let un=It[Ot.corners[0]],Bt=It[Ot.corners[1]],Gn=It[Ot.corners[2]],vn=[Bt[0]-un[0],Bt[1]-un[1],Ht*(Bt[2]-un[2])],wn=i.N.cross(vn,vn,[Gn[0]-un[0],Gn[1]-un[1],Ht*(Gn[2]-un[2])]);i.N.normalize(wn,wn),Ot.dotProductWithUp=i.N.dot(wn,St)}return qt.sort((Ot,un)=>Ot.dotProductWithUp-un.dotProductWithUp),qt[0].corners}(Ie,Le),Re=Ie[Te[0]],Ke=Ie[Te[1]],Fe=Ie[Te[2]],dt=Ie[Te[3]],st=Ne.getAtPointOrZero(new _n(Re[0]/me.worldSize,Re[1]/me.worldSize),0),Ve=Ne.getAtPointOrZero(new _n(Ke[0]/me.worldSize,Ke[1]/me.worldSize),0),Ct=Ne.getAtPointOrZero(new _n(Fe[0]/me.worldSize,Fe[1]/me.worldSize),0),vt=Ne.getAtPointOrZero(new _n(dt[0]/me.worldSize,dt[1]/me.worldSize),0),ht=(st+vt)/2,Ue=(Ve+Ct)/2;return ht>Ue?Ve<Ct?t_(de,Ke,dt,Re,Ve,vt,st,Le):t_(de,Fe,Re,dt,Ct,st,vt,Le):st<vt?t_(de,Re,Ke,Fe,st,Ve,Ct,Le):t_(de,dt,Fe,Ke,vt,Ct,Ve,Le),Math.max(ht,Ue)}(ie,n,e.aabb,t,o);let ne=i.a6.fromQuat([],ie),le=i.a6.multiply([],ne,J);i.a6.multiply(t,V,le)}else K=n.elevation.getAtPointOrZero(new _n(I.x/z,I.y/z),0);K!==0&&(t[14]+=K)}}function sp(t,e,n=!1){t.uploaded||(t.gfxTexture=new Nv(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function XL(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,jL.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,GL.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,$L.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?VL:UL).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,qL.members,!0)),t.segments=yr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&sp(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&sp(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&sp(o.normalTexture,e),o.occlusionTexture&&sp(o.occlusionTexture,e,n),o.emissionTexture&&sp(o.emissionTexture,e)}function Bv(t,e,n){if(t.meshes)for(let o of t.meshes)XL(o,e,n);if(t.children)for(let o of t.children)Bv(o,e,n)}function n_(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)n_(e)}function jv(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)jv(n)}class YL{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class KL{constructor(){this.tasks={},this.taskQueue=[],sa(["process"],this),this.invoker=new YL(this.process),this.nextId=0}add(e,n){let o=this.nextId++,c=function({type:u,isSymbolTile:f,zoom:_}){return _=_||0,u==="message"?0:u!=="maybePrepare"||f?u!=="parseTile"||f?u==="parseTile"&&f?300-_:u==="maybePrepare"&&f?400-_:500:200-_:100-_}(n);if(c===0){Lo();try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:n,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Lo();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let u=this.tasks[this.taskQueue[c]];u.priority<n&&(n=u.priority,e=c)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class eD{constructor(e,n,o){this.target=e,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},sa(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new KL}send(e,n,o,c,u=!1,f){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[_]=o);let x=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!o,targetMapId:c,mustQueue:u,sourceMapId:this.mapId,data:Ls(n,x)},x),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(n.mustQueue||Lo()){let c=this.callbacks[o],u=this.scheduler.add(()=>this.processTask(o,n),c&&c.metadata||{type:"message"});u&&(this.cancelCallbacks[o]=u)}else this.processTask(o,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(n.error?o(xa(n.error)):o(null,xa(n.data)))}else{let o=new Set,c=n.hasCallback?(f,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Ls(f):null,data:Ls(_,o)},o)}:f=>{},u=xa(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,c);else if(this.parent.getWorkerSource){let f=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,f[0],u.source,u.scope)[f[1]](u,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Vv=(()=>{class t{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Wa();let c=this.workerPool.acquire(this.id);for(let u=0;u<c.length;u++){let f=new t.Actor(c[u],o,this.id);f.name=`Worker ${u}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,c){fo(this.actors,(u,f)=>{u.send(n,o,f)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=eD,t})();var ap={workerUrl:"",workerClass:null,workerParams:void 0};function JL(){return ap.workerClass!=null?new ap.workerClass:new self.Worker(ap.workerUrl,ap.workerParams)}let Uv="mapboxgl_preloaded_worker_pool";class lp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<lp.workerCount;)this.workers.push(new JL);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uv]}numActive(){return Object.keys(this.active).length}}let cp;function r_(){return cp||(cp=new lp),cp}lp.workerCount=2;let i_,$v,os,_h,Gv,yh=null;function tD(){return Lo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:$v||j.DRACO_URL}function nD(){if(Lo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(_h)return _h;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return _h=WebAssembly.validate(t)?j.MESHOPT_SIMD_URL:j.MESHOPT_URL,_h}let o_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},QL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},up={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function rD(t,e,n){let o=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=o,n.json.bufferViews[o]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}let Hv="KHR_draco_mesh_compression";function eO(t,e){let n=t.extensions&&t.extensions[Hv];if(!n)return;let o=new os.Decoder,c=aD(e,n.bufferView),u=new os.Mesh;if(!o.DecodeArrayToMesh(c,c.byteLength,u))throw new Error("Failed to decode Draco mesh");let f=e.json.accessors[t.indices],_=o_[f.componentType],x=f.count*_.BYTES_PER_ELEMENT,b=os._malloc(x);_===Uint16Array?o.GetTrianglesUInt16Array(u,x,b):o.GetTrianglesUInt32Array(u,x,b),rD(os.memory.buffer.slice(b,b+x),f,e),os._free(b);for(let T of Object.keys(n.attributes)){let I=o.GetAttributeByUniqueId(u,n.attributes[T]),M=e.json.accessors[t.attributes[T]],P=QL[M.componentType],L=M.count*up[M.type]*o_[M.componentType].BYTES_PER_ELEMENT,N=os._malloc(L);o.GetAttributeDataArrayForAllPoints(u,I,os[P],L,N),rD(os.memory.buffer.slice(N,N+L),M,e),os._free(N)}o.destroy(),u.destroy(),delete t.extensions[Hv]}let s_="EXT_meshopt_compression";function tO(t,e){if(!t.extensions||!t.extensions[s_])return;let n=t.extensions[s_],o=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);Gv.decodeGltfBuffer(c,n.count,n.byteStride,o,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[s_]}let iD=1179937895,oD=new TextDecoder("utf8");function sD(t,e){return new URL(t,e).href}function nO(t,e,n,o){return fetch(sD(t.uri,o)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function aD(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function rO(t,e,n,o){if(t.uri){let c=sD(t.uri,o);return fetch(c).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(t.bufferView!==void 0){let c=aD(e,t.bufferView),u=new Blob([c],{type:t.mimeType});return createImageBitmap(u).then(f=>{e.images[n]=f})}}function lD(t,e=0,n){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===iD){let T=new Uint32Array(t,e),I=2,M=(T[I++]>>2)-3,P=T[I++]>>2;if(I++,o.json=JSON.parse(oD.decode(T.subarray(I,I+P))),I+=P,I<M){let L=T[I++];I++;let N=e+(I<<2);o.buffers[0]=t.slice(N,N+L)}}else o.json=JSON.parse(oD.decode(new Uint8Array(t,e)));let{buffers:c,images:u,meshes:f,extensionsUsed:_,bufferViews:x}=o.json,b=Promise.resolve();if(c){let T=[];for(let I=0;I<c.length;I++){let M=c[I];M.uri?T.push(nO(M,o,I,n)):o.buffers[I]||(o.buffers[I]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],I=_&&_.includes(Hv),M=_&&_.includes(s_);if(I&&T.push(function(){if(!os)return i_||(i_=function(P){let L,N=null;function z(){L=new Uint8Array(N.buffer)}function V(){throw new Error("Unexpected Draco error.")}let W={a:{a:V,d:function(J,K,ie){return L.copyWithin(J,K,K+ie)},c:function(J){let K=L.length,ie=Math.max(J>>>0,Math.ceil(1.2*K)),ne=Math.ceil((ie-K)/65536);try{return N.grow(ne),z(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,W):P.then(J=>J.arrayBuffer()).then(J=>WebAssembly.instantiate(J,W))).then(J=>{let{Rb:K,Qb:ie,P:ne,T:le,X:de,Ja:me,La:be,Qa:ge,Va:Me,Wa:Ne,eb:Ie,jb:Le,f:Te,e:Re,yb:Ke,zb:Fe,Ab:dt,Bb:st,Db:Ve,Gb:Ct}=J.instance.exports;N=Re;let vt=(()=>{let ht=0,Ue=0,It=0,Ht=0;return St=>{It&&(K(Ht),K(ht),Ue+=It,It=ht=0),ht||(Ue+=128,ht=ie(Ue));let qt=St.length+7&-8,Ot=ht;qt>=Ue&&(It=qt,Ot=Ht=ie(qt));for(let un=0;un<St.length;un++)L[Ot+un]=St[un];return Ot}})();return z(),Te(),{memory:Re,_free:K,_malloc:ie,Mesh:class{constructor(){this.ptr=ne()}destroy(){le(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){Le(this.ptr)}DecodeArrayToMesh(ht,Ue,It){let Ht=vt(ht),St=be(this.ptr,Ht,Ue,It.ptr);return!!de(St)}GetAttributeByUniqueId(ht,Ue){return{ptr:ge(this.ptr,ht.ptr,Ue)}}GetTrianglesUInt16Array(ht,Ue,It){Me(this.ptr,ht.ptr,Ue,It)}GetTrianglesUInt32Array(ht,Ue,It){Ne(this.ptr,ht.ptr,Ue,It)}GetAttributeDataArrayForAllPoints(ht,Ue,It,Ht,St){Ie(this.ptr,ht.ptr,Ue.ptr,It,Ht,St)}},DT_INT8:Ke(),DT_UINT8:Fe(),DT_INT16:dt(),DT_UINT16:st(),DT_UINT32:Ve(),DT_FLOAT32:Ct()}})}(fetch(tD())),i_.then(P=>{os=P,i_=void 0}))}()),M&&T.push(function(){if(Gv)return;let P=function(L){let N,z=WebAssembly.instantiateStreaming(L,{}).then(J=>{N=J.instance,N.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(J,K,ie,ne,le,de){(function(me,be,ge,Me,Ne,Ie,Le){let Te=me.exports.sbrk,Re=Me+3&-4,Ke=Te(Re*Ne),Fe=Te(Ie.length),dt=new Uint8Array(me.exports.memory.buffer);dt.set(Ie,Fe);let st=be(Ke,Me,Ne,Fe,Ie.length);if(st===0&&Le&&Le(Ke,Re,Ne),ge.set(dt.subarray(Ke,Ke+Me*Ne)),Te(Ke-Te(0)),st!==0)throw new Error(`Malformed buffer data: ${st}`)})(N,N.exports[W[le]],J,K,ie,ne,N.exports[V[de]])}}}(fetch(nD()));return P.ready.then(()=>{Gv=P})}()),u)for(let P=0;P<u.length;P++)T.push(rO(u[P],o,P,n));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&f)for(let{primitives:P}of f)for(let L of P)eO(L,o);if(M&&f&&x)for(let P of x)tO(P,o);return o})})}class cD{constructor(e,n,o){if(this.triangleCount=n.length/3,this.min=new Ge(0,0),this.max=new Ge(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||o===0)return;let c=e.map(T=>T.x),u=e.map(T=>T.y);this.min=new Ge(Math.min(...c),Math.min(...u)),this.max=new Ge(Math.max(...c),Math.max(...u));let f=this.max.sub(this.min);f.x=Math.max(f.x,1),f.y=Math.max(f.y,1);let _=Math.max(f.x,f.y)/o;this.cellsX=Math.max(1,Math.ceil(f.x/_)),this.cellsY=Math.max(1,Math.ceil(f.y/_)),this.xScale=1/_,this.yScale=1/_;let x=[];for(let T=0;T<this.triangleCount;T++){let I=e[n[3*T+0]].sub(this.min),M=e[n[3*T+1]].sub(this.min),P=e[n[3*T+2]].sub(this.min),L=Pl(Math.floor(Math.min(I.x,M.x,P.x)),this.xScale,this.cellsX),N=Pl(Math.floor(Math.max(I.x,M.x,P.x)),this.xScale,this.cellsX),z=Pl(Math.floor(Math.min(I.y,M.y,P.y)),this.yScale,this.cellsY),V=Pl(Math.floor(Math.max(I.y,M.y,P.y)),this.yScale,this.cellsY),W=new Ge(0,0),J=new Ge(0,0),K=new Ge(0,0),ie=new Ge(0,0);for(let ne=z;ne<=V;++ne){W.y=J.y=ne*_,K.y=ie.y=(ne+1)*_;for(let le=L;le<=N;++le)W.x=K.x=le*_,J.x=ie.x=(le+1)*_,(B0(I,M,P,W,J,ie)||B0(I,M,P,W,ie,K))&&x.push({cellIdx:ne*this.cellsX+le,triIdx:T})}}if(x.length===0)return;x.sort((T,I)=>T.cellIdx-I.cellIdx||T.triIdx-I.triIdx);let b=0;for(;b<x.length;){let T=x[b].cellIdx,I={start:this.payload.length,len:0};for(;b<x.length&&x[b].cellIdx===T;)++I.len,this.payload.push(x[b++].triIdx);this.cells[T]=I}}query(e,n,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let x=0;x<this.lookup.length;x++)this.lookup[x]=0;let c=Pl(e.x-this.min.x,this.xScale,this.cellsX),u=Pl(n.x-this.min.x,this.xScale,this.cellsX),f=Pl(e.y-this.min.y,this.yScale,this.cellsY),_=Pl(n.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=_;x++)for(let b=c;b<=u;b++){let T=this.cells[x*this.cellsX+b];if(T)for(let I=0;I<T.len;I++){let M=this.payload[T.start+I],P=Math.floor(M/8),L=1<<M%8;if(!(this.lookup[P]&L)&&(this.lookup[P]|=L,o.push(M),o.length===this.triangleCount))return}}}}function Pl(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function Wc(t,e){let n=t.json.bufferViews[e.bufferView],o=o_[e.componentType];return new o(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==up[e.type]*o.BYTES_PER_ELEMENT?n.byteStride/o.BYTES_PER_ELEMENT:up[e.type]))}function qv(t,e,n,o){let c=o_[e.componentType],u=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),f=t.json.bufferViews[e.bufferView],_=f.byteStride?f.byteStride/c.BYTES_PER_ELEMENT:up[e.type],x=n.float32,b=x.length/n.capacity;for(let T=0,I=0;T<e.count*_;T+=_,I+=b)for(let M=0;M<b;M++)x[I+M]=o[T+M]*u;n._trim()}function iO(t,e,n){let o=t.indices,c=t.attributes,u={};u.indexArray=new Vr;let f=e.json.accessors[o],_=f.count/3;u.indexArray.reserve(_);let x=Wc(e,f);for(let M=0;M<_;M++)u.indexArray.emplaceBack(x[3*M],x[3*M+1],x[3*M+2]);u.indexArray._trim(),u.vertexArray=new Ta;let b=e.json.accessors[c.POSITION];u.vertexArray.reserve(b.count);let T=Wc(e,b);for(let M=0;M<b.count;M++)u.vertexArray.emplaceBack(T[3*M],T[3*M+1],T[3*M+2]);if(u.vertexArray._trim(),u.aabb=new mr(b.min,b.max),u.centroid=function(M,P){let L=[0,0,0],N=M.length;if(N>0){for(let z=0;z<N;z++){let V=3*M[z];L[0]+=P[V],L[1]+=P[V+1],L[2]+=P[V+2]}L[0]/=N,L[1]/=N,L[2]/=N}return L}(x,T),c.COLOR_0!==void 0){let M=e.json.accessors[c.COLOR_0],P=up[M.type],L=Wc(e,M);u.colorArray=P===3?new Ta:new Fs,u.colorArray.resize(M.count),qv(e,M,u.colorArray,L)}if(c.NORMAL!==void 0){u.normalArray=new Ta;let M=e.json.accessors[c.NORMAL];u.normalArray.resize(M.count);let P=Wc(e,M);qv(e,M,u.normalArray,P)}if(c.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new Oc;let M=e.json.accessors[c.TEXCOORD_0];u.texcoordArray.resize(M.count);let P=Wc(e,M);qv(e,M,u.texcoordArray,P)}if(c._FEATURE_ID_RGBA4444!==void 0){let M=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Wc(e,M))}c._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Wc(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let I=t.material;return u.material=function(M,P){let{emissiveFactor:L=[0,0,0],alphaMode:N="OPAQUE",alphaCutoff:z=.5,normalTexture:V,occlusionTexture:W,emissiveTexture:J,doubleSided:K}=M,{baseColorFactor:ie=[1,1,1,1],metallicFactor:ne=1,roughnessFactor:le=1,baseColorTexture:de,metallicRoughnessTexture:me}=M.pbrMetallicRoughness||{},be=W?P[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&be){let ge=W.extensions.KHR_texture_transform;be.offsetScale=[ge.offset[0],ge.offset[1],ge.scale[0],ge.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Mr(...ie),metallicFactor:ne,roughnessFactor:le,baseColorTexture:de?P[de.index]:void 0,metallicRoughnessTexture:me?P[me.index]:void 0},doubleSided:K,emissiveFactor:L,alphaMode:N,alphaCutoff:z,normalTexture:V?P[V.index]:void 0,occlusionTexture:be,emissionTexture:J?P[J.index]:void 0,defined:M.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),u}function uD(t,e,n){let{matrix:o,rotation:c,translation:u,scale:f,mesh:_,extras:x,children:b}=t,T={};if(T.matrix=o||i.a6.fromRotationTranslationScale([],c||[0,0,0,1],u||[0,0,0],f||[1,1,1]),_!==void 0){T.meshes=n[_];let I=T.anchor=[0,0];for(let M of T.meshes){let{min:P,max:L}=M.aabb;I[0]+=P[0]+L[0],I[1]+=P[1]+L[1]}I[0]=Math.floor(I[0]/T.meshes.length/2),I[1]=Math.floor(I[1]/T.meshes.length/2)}if(x&&(x.id&&(T.id=x.id),x.lights&&(T.lights=function(I){if(!I.length)return[];let M=function(V){let W=atob(V),J=new Uint8Array(W.length);for(let K=0;K<W.length;K++)J[K]=W.codePointAt(K);return J}(I),P=[],L=M.length/24,N=new Uint16Array(M.buffer),z=new Float32Array(M.buffer);for(let V=0;V<L;V++){let W=N[2*V*6]/30,J=N[2*V*6+1]/30,K=N[2*V*6+10]/100,ie=z[6*V+1],ne=z[6*V+2],le=z[6*V+3],de=z[6*V+4],me=le-ie,be=de-ne,ge=Math.hypot(me,be);P.push({pos:[ie+.5*me,ne+.5*be,J],normal:[be/ge,-me/ge,0],width:ge,height:W,depth:K,points:[ie,ne,le,de]})}return P}(x.lights))),b){let I=[];for(let M of b)I.push(uD(e.json.nodes[M],e,n));T.children=I}return T}function oO(t){if(t.vertices.length===0||t.indices.length===0)return null;let[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let f=1;f<t.vertices.length;++f){let _=t.vertices[f];e.x=Math.min(e.x,_.x),e.y=Math.min(e.y,_.y),n.x=Math.max(n.x,_.x),n.y=Math.max(n.y,_.y)}let o=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),c=Math.max(8,o),u=new cD(t.vertices,t.indices,c);return{vertices:t.vertices,indices:t.indices,grid:u,min:e,max:n}}function sO(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let o=[];for(let f of n){if(!Array.isArray(f)||f.length!==2)continue;let _=f[0],x=f[1];typeof _=="number"&&typeof x=="number"&&o.push(new Ge(_,x))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let c=0;for(let f=0;f<o.length;f++){let _=o[f],x=o[(f+1)%o.length],b=o[(f+2)%o.length];c+=(_.x-x.x)*(b.y-x.y)-(b.x-x.x)*(_.y-x.y)}c>0&&o.reverse();let u=Mg(o.flatMap(f=>[f.x,f.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function aO(t){let e=[],n=[],o=0;for(let c of t){o=e.length;let u=c.vertexArray.float32,f=c.indexArray.uint16;for(let _=0;_<c.vertexArray.length;_++)e.push(new Ge(u[3*_+0],u[3*_+1]));for(let _=0;_<3*c.indexArray.length;_++)n.push(f[_]+o)}if(n.length%3!=0)return null;for(let c=0;c<n.length;c+=3){let u=e[n[c+0]],f=e[n[c+1]],_=e[n[c+2]];(u.x-f.x)*(_.y-f.y)-(_.x-f.x)*(u.y-f.y)>0&&([n[c+1],n[c+2]]=[n[c+2],n[c+1]])}return{vertices:e,indices:n}}function hD(t){let e=function(x,b){let T=[],I=WebGL2RenderingContext;if(x.json.textures)for(let M of x.json.textures){let P={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};M.sampler!==void 0&&Object.assign(P,x.json.samplers[M.sampler]),T.push({image:b[M.source],sampler:P,uploaded:!1})}return T}(t,t.images),n=function(x,b){let T=[];for(let I of x.json.meshes){let M=[];for(let P of I.primitives)M.push(iO(P,x,b));T.push(M)}return T}(t,e),{scenes:o,scene:c,nodes:u}=t.json,f=o?o[c||0].nodes:u,_=[];for(let x of f)_.push(uD(u[x],t,n));return function(x,b,T){let I={},M=new Set;for(let P=0;P<x.length;P++){let L=T[b[P]];if(!L.extras)continue;let N=L.extras["mapbox:footprint:version"],z=L.extras["mapbox:footprint:id"];(N||z)&&M.add(P),N==="1.0.0"&&z&&(I[z]=P)}for(let P=0;P<x.length;P++){if(M.has(P))continue;let L=x[P],N=T[b[P]];if(!N.extras)continue;let z=null;L.id in I&&(z=aO(x[I[L.id]].meshes)),z||(z=sO(N)),z&&(L.footprint=oO(z))}if(M.size>0){let P=Array.from(M.values()).sort((L,N)=>L-N);for(let L=P.length-1;L>=0;L--)x.splice(P[L],1)}}(_,f,t.json.nodes),_}function lO(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,o=t.aabb.min[1]-1,c=qc/(t.aabb.max[0]-n+2),u=qc/(t.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){let _=e[f+2],x=(e[f+0]-n)*c|0,b=(e[f+1]-o)*u|0;_>t.heightmap[b*qc+x]&&(t.heightmap[b*qc+x]=_)}}function cO(t,e){let n={};n.indexArray=new Vr,n.indexArray.reserve(4*t.length),n.vertexArray=new Ta,n.vertexArray.reserve(10*t.length),n.colorArray=new Fs,n.vertexArray.reserve(10*t.length);let o=0;for(let f of t){let _=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],b=Math.min(.29,.1*f.width/f.depth),T=f.width-2*f.depth*e*(b+.01),I=i.N.scaleAndAdd([],f.pos,x,T/2),M=i.N.scaleAndAdd([],f.pos,x,-T/2),P=[I[0],I[1],I[2]+f.height],L=[M[0],M[1],M[2]+f.height],N=i.N.scaleAndAdd([],f.normal,x,b);i.N.scale(N,N,_);let z=i.N.scaleAndAdd([],f.normal,x,-b);i.N.scale(z,z,_),i.N.add(N,I,N),i.N.add(z,M,z),I[2]+=.1,M[2]+=.1,n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]);let V=T/_/2;n.colorArray.emplaceBack(-V-b,-1,V,.8),n.colorArray.emplaceBack(V+b,-1,V,.8),n.colorArray.emplaceBack(-V,0,V,1.3),n.colorArray.emplaceBack(V,0,V,1.3),n.colorArray.emplaceBack(V+b,-.8,V,.7),n.colorArray.emplaceBack(V+b,-.8,V,.7),n.colorArray.emplaceBack(0,0,V,1.3),n.colorArray.emplaceBack(0,0,V,1.3),n.colorArray.emplaceBack(V+b,-1.2,V,.8),n.colorArray.emplaceBack(V+b,-1.2,V,.8),n.indexArray.emplaceBack(6+o,4+o,8+o),n.indexArray.emplaceBack(7+o,9+o,5+o),n.indexArray.emplaceBack(0+o,1+o,2+o),n.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let c={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Mr.white,c.pbrMetallicRoughness=u,n.material=c,n.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}ut(cD,"TriangleGridIndex");class dD{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let uO=["tile","layer","source","sourceLayer","state"];class fD{constructor(e,n,o,c,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=c,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of uO)this[n]!==void 0&&(e[n]=this[n]);return e}}class pD{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Yo(rt,16,0),this.featureIndexArray=new og,this.promoteId=n,this.is3DTile=!1}insert(e,n,o,c,u,f=0,_=0){let x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,u,f);let b=this.grid;for(let T=0;T<n.length;T++){let I=n[T],M=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){let L=I[P];M[0]=Math.min(M[0],L.x),M[1]=Math.min(M[1],L.y),M[2]=Math.max(M[2],L.x),M[3]=Math.max(M[3],L.y)}_!==0&&(M[0]-=_,M[1]-=_,M[2]+=_,M[3]+=_),M[0]<rt&&M[1]<rt&&M[2]>=0&&M[3]>=0&&b.insert(x,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new yv(new hh(this.rawTileData)).layers,this.sourceLayerCoder=new dD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,c){this.loadVTLayers();let u=e.params||{},f=$i(u.filter),_=e.tileResult,x=e.transform,b=_.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(L,N,z,V)=>Nw(_.bufferedTilespaceGeometry,L,N,z,V));T.sort(hO);let I=null;x.elevation&&T.length>0&&(I=sh.create(x.elevation,this.tileID));let M={},P;for(let L=0;L<T.length;L++){let N=T[L];if(N===P)continue;P=N;let z=this.featureIndexArray.get(N),V=null;if(this.is3DTile){let W=this.bucketLayerIDs[0][0],J=n[W];if(J.type!=="model")continue;let{queryFeature:K,intersectionZ:ie}=J.queryIntersectsMatchingFeature(_,z.featureIndex,f,x);K&&this.appendToResult(M,W,z.featureIndex,K,ie)}else this.loadMatchingFeature(M,z,f,u.layers,u.availableImages,n,o,c,(W,J,K,ie=0)=>(V||(V=$r(W,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(_,W,K,V,this.z,e.transform,e.pixelPosMatrix,I,ie)))}return M}loadMatchingFeature(e,n,o,c,u,f,_,x,b){let{featureIndex:T,bucketIndex:I,sourceLayerIndex:M,layoutVertexArrayOffset:P}=n,L=this.bucketLayerIDs[I];if(c&&!function(W,J){for(let K=0;K<W.length;K++)if(J.indexOf(W[K])>=0)return!0;return!1}(c,L))return;let N=this.sourceLayerCoder.decode(M),z=this.vtLayers[N].feature(T);if(o.needGeometry){let W=Lr(z,!0);if(!o.filter(new ar(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!o.filter(new ar(this.tileID.overscaledZ),z))return;let V=this.getId(z,N);for(let W=0;W<L.length;W++){let J=L[W];if(c&&c.indexOf(J)<0)continue;let K=f[J];if(!K)continue;let ie={};V!==void 0&&x&&(ie=x.getState(K.sourceLayer||"_geojsonTileLayer",V));let ne=!b||b(z,K,ie,P);if(!ne)continue;let le=new fD(z,this.z,this.x,this.y,V),de=ii({},_[J]);de.paint=mD(de.paint,K.paint,z,ie,u),de.layout=mD(de.layout,K.layout,z,ie,u),le.layer=de,this.appendToResult(e,J,T,le,ne)}}appendToResult(e,n,o,c,u){let f=e[n];f===void 0&&(f=e[n]=[]),f.push({featureIndex:o,feature:c,intersectionZ:u})}lookupSymbolFeatures(e,n,o,c,u,f,_,x){let b={};this.loadVTLayers();let T=$i(u);for(let I of e)this.loadMatchingFeature(b,{bucketIndex:o,sourceLayerIndex:c,featureIndex:I,layoutVertexArrayOffset:0},T,f,_,x,n);return b}loadFeature(e){let{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(o),u=this.vtFeatures[c];if(u[n])return u[n];let f=this.vtLayers[c].feature(n);return u[n]=f,f}hasLayer(e){for(let n of this.bucketLayerIDs)for(let o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(o=e.properties[c]),typeof o=="boolean"&&(o=Number(o))}return o}}function mD(t,e,n,o,c){return oi(t,(u,f)=>{let _=e instanceof wc?e.get(f):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function hO(t,e){return e-t}ut(pD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let Wv=new Float32Array(262144),Zc=new Uint8Array(262144);function gD(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,gD(n));return e}function _D(t,e,n){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&n.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)_D(o,e,n)}let yD=["","wall","door","roof","window","lamp","logo"];class vD{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:gD(e)}}}getLocalBounds(){if(!this.node.meshes)return new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&n.encapsulate(o.aabb),e++;this.aabb=n}return this.aabb}}class a_{constructor(e,n,o,c,u,f){this.id=n,this.modelTraits|=gh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=gh.HasMapboxMeshFeatures),c&&(this.modelTraits|=gh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=u,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new vD(_)),_D(_,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let o of n){let c=o.node;this.uploaded?this.updatePbrBuffer(c):Bv(c,e,!0)}for(let o of n)n_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),n=!0);return n}needsReEvaluation(e,n,o){let c=e.transform.projectionOptions,u=e.style.getBrightness(),f=this.brightness!==u;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||hp(o.paint.get("model-color").value,f)||hp(o.paint.get("model-color-mix-intensity").value,f)||hp(o.paint.get("model-roughness").value,f)||hp(o.paint.get("model-emissive-strength").value,f)||hp(o.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=c,this.brightness=u,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),c=this.id.canonical;for(let u of o){let f=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(f,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let o of n){if(!o.node.meshes)continue;let c=o.feature,u=o.node.meshes&&o.node.meshes[0].featureData,f=o.evaluatedColor[2],_=o.evaluatedRMEA[2],x=this.id.canonical;if(o.hasTranslucentParts=!1,u){for(let b=0;b<yD.length;b++){let T=yD[b];T.length&&(c.properties.part=T);let I=e.paint.get("model-color").evaluate(c,{},x),M=e.paint.get("model-color-mix-intensity").evaluate(c,{},x);o.evaluatedColor[b]=[I.r,I.g,I.b,M],o.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(c,{},x),o.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x),o.evaluatedRMEA[b][3]=I.a,o.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},x),!o.hasTranslucentParts&&I.a<1&&(o.hasTranslucentParts=!0)}delete c.properties.part,fO(o,f!==o.evaluatedColor[2]||_!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x);o.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},x),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,o,c){let u=e.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let f=sh.create(e,o,u);if(!f)return;this.modelTraits&gh.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,c);for(let _ of this.getNodesInfo()){let x=_.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;let b=x.footprint.vertices,T=f.getElevationAt(b[0].x,b[0].y,!0,!0);for(let I=1;I<b.length;I++)T=Math.min(T,f.getElevationAt(b[I].x,b[I].y,!0,!0));x.elevation=T}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,o,c){let u=n._dem._modifiedForSources[c];if(u===void 0&&(n._dem._modifiedForSources[c]=[],u=n._dem._modifiedForSources[c]),u.includes(o.canonical))return;let f=n._dem.dim;u.push(o.canonical);let _=!1;for(let x of this.getNodesInfo()){let b=x.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,I=n.tileCoordToPixel(T.min.x,T.min.y),M=n.tileCoordToPixel(T.max.x,T.max.y),P=Math.min(Math.min(f-M.y,I.x),Math.min(I.y,f-M.x));if(P<0)continue;let L=Xt(P,2,5),N=Math.max(0,I.x-L),z=Math.max(0,I.y-L),V=Math.min(M.x+L,f-1),W=Math.min(M.y+L,f-1);for(let ne=z;ne<=W;++ne)for(let le=N;le<=V;++le)Zc[ne*f+le]=255;let J=0,K=0;for(let ne=0;ne<T.cellsY;++ne)for(let le=0;le<T.cellsX;++le){if(!T.cells[ne*T.cellsX+le])continue;let de=n.tileCoordToPixel(T.min.x+le/T.xScale,T.min.y+ne/T.yScale),me=n.tileCoordToPixel(T.min.x+(le+1)/T.xScale,T.min.y+(ne+1)/T.yScale);for(let be=de.y;be<=Math.min(me.y+1,f-1);++be)for(let ge=de.x;ge<=Math.min(me.x+1,f-1);++ge)Zc[be*f+ge]===255&&(Zc[be*f+ge]=0,J+=n.getElevationAtPixel(ge,be),K++)}let ie=J/K;N=Math.max(1,I.x-L),z=Math.max(1,I.y-L),V=Math.min(M.x+L,f-2),W=Math.min(M.y+L,f-2),_=!0;for(let ne=z;ne<=W;++ne)for(let le=N;le<=V;++le)Zc[ne*f+le]===0&&(Wv[ne*f+le]=n._dem.set(le,ne,ie));for(let ne=1;ne<L;++ne){N=Math.max(1,I.x-ne),z=Math.max(1,I.y-ne),V=Math.min(M.x+ne,f-2),W=Math.min(M.y+ne,f-2);for(let le=z;le<=W;++le)for(let de=N;de<=V;++de){let me=le*f+de;if(Zc[me]===255){let be=0,ge=0,Me=-1,Ne=-1;for(let Ie=-1;Ie<=1;++Ie)for(let Le=-1;Le<=1;++Le){let Te=(le+Ie)*f+de+Le;if(Zc[Te]>=ne)continue;let Re=Wv[Te],Ke=Math.abs(Re);Ke>ge&&(be=Re,ge=Ke,Me=Le,Ne=Ie)}if(ge>.1){let Ie=1-(ne+.5*Math.abs(Me*Ne))/L,Le=n._dem.get(de,le)+be*Ie,Te=n._dem.get(de+Me,le+Ne),Re=n._dem.get(de-Me,le-Ne,!0);(Le-Te)*(Le-Re)>0&&(Le=(Te+Re)/2),Wv[me]=n._dem.set(de,le,Le),Zc[me]=ne}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=$e.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)n_(n.node),jv(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let f=c[u].node;c[u].hiddenByReplacement=!!f.footprint&&!o.find(_=>_.footprint===f.footprint)}}getHeightAtTileCoord(e,n){let o=this.getNodesInfo(),c=[];for(let u=0;u<this.nodesInfo.length;u++){let f=o[u],_=f.node.meshes[0];if(e<_.aabb.min[0]||n<_.aabb.min[1]||e>_.aabb.max[0]||n>_.aabb.max[1])continue;let x=(e-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*qc|0,b=Math.min(63,(n-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*qc|0)*qc+Math.min(63,x);if(!(_.heightmap[b]<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:_.heightmap[b],maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new Ge(e,n),new Ge(e,n),c),c.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function hp(t,e){return!t.isLightConstant&&e}function dO(t,e,n,o,c,u,f,_){let x=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;n[3]>0&&(x=cn(x,255*n[0],n[3]),b=cn(b,255*n[1],n[3]),T=cn(T,255*n[2],n[3]));let I=x<<8|b,M=T<<8|Math.floor(255*o[3]),P=function(ne){let le=Xt(ne,0,2);return Math.min(Math.round(.5*le*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],L=Xt(c[0],0,1),N=Xt(c[1],0,1),z=Xt(c[2],0,1),V=Xt(c[3],0,1),W,J,K,ie;if(L!==N&&f!==u&&N!==L){let ne=f-u;J=1/(ne*(N-L)),K=-(u+ne*L)/(ne*(N-L));let le=Xt(c[4],-1,1);ie=Math.pow(10,le),W=255*z<<8|255*V}else W=65535,J=0,K=1,ie=1;if(t.emplaceBack(I,M,P,W,J,K,ie),_){let ne=_.length;_.clear();for(let le=0;le<ne;le++)_.emplaceBack(I,M,P,W,J,K,ie)}}function fO(t,e,n){let o=t.node,c=0,u=n&gh.HasMeshoptCompression;for(let f of o.meshes){if(o.lights&&o.lightMeshIndex===c||!f.featureData)continue;f.featureArray=new Nc,f.featureArray.reserve(f.featureData.length);let _=e;for(let x of f.featureData){let b=u?65535&x:x>>16&65535,T=u?x>>16&65535:65535&x,I=(15&T)<8?15&T:0,M=t.evaluatedRMEA[I],P=t.evaluatedColor[I],L=t.emissionHeightBasedParams[I],N;if(_&&I===2&&o.lights&&(N=new Nc,N.resize(10*o.lights.length)),dO(f.featureArray,b,P,M,L,f.aabb.min[2],f.aabb.max[2],N),N&&_){_=!1;let z=o.meshes[o.lightMeshIndex];z.featureArray=N,z.featureArray._trim()}}f.featureArray._trim(),c++}}function xD(t,e,n,o){let c=1<<t.z;e.lat=dn((o/rt+t.y)/c),e.lng=kt((n/rt+t.x)/c)}ut(a_,"Tiled3dModelBucket",{omit:["layers"]}),ut(vD,"Tiled3dModelFeature");let pO={circle:class extends Pi{constructor(t,e,n){super(t,sP,e,n)}createBucket(t){return new Oi(t)}queryRadius(t){let e=t;return rh("circle-radius",this,e)+rh("circle-stroke-width",this,e)+pg(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,c,u,f,_){let x=Fw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return uE(t,o,u,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=cE(this);return{config:new F(this,e),defines:n,overrideFog:!1}}},heatmap:class extends Pi{createBucket(t){return new dE(t)}constructor(t,e,n){super(t,FP,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return rh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,c,u,f,_){let x=this.paint.get("heatmap-radius").evaluate(e,n);return uE(t,o,u,f,_,!0,!0,new Ge(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new F(this,e),overrideFog:!1}:{}}},hillshade:class extends Pi{constructor(t,e,n){super(t,BP,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Pi{constructor(t,e,n){super(t,QP,e,n)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new F(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _v(t)}queryRadius(){return pg(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,c,u){return!t.queryGeometry.isAboveHorizon&&Ea(kw(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Pi{constructor(t,e,n){super(t,MR,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Og(t)}queryRadius(){return pg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,o,c,u,f,_,x){let b=Fw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),M=[0,0],P=_&&u.elevation,L=u.elevation?u.elevation.exaggeration():1,N=t.tile.getBucket(this);if(P&&N instanceof Og){let K=N.centroidVertexArray,ie=x+1;ie<K.length&&(M[0]=K.geta_centroid_pos0(ie),M[1]=K.geta_centroid_pos1(ie))}if(M[0]===0&&M[1]===1)return!1;u.projection.name==="globe"&&(o=WE([o],[new Ge(0,0),new Ge(rt,rt)],t.tileID.canonical).map(K=>K.polygon).flat());let z=P?_:null,[V,W]=function(K,ie,ne,le,de,me,be,ge,Me,Ne,Ie){return K.projection.name==="globe"?function(Le,Te,Re,Ke,Fe,dt,st,Ve,Ct,vt,ht){let Ue=[],It=[],Ht=Le.projection.upVectorScale(ht,Le.center.lat,Le.worldSize).metersToTile,St=[0,0,0,1],qt=[0,0,0,1],Ot=(Bt,Gn,vn,wn)=>{Bt[0]=Gn,Bt[1]=vn,Bt[2]=wn,Bt[3]=1},un=qE();Re>0&&(Re+=un),Ke+=un;for(let Bt of Te){let Gn=[],vn=[];for(let wn of Bt){let Cn=wn.x+Fe.x,xn=wn.y+Fe.y,ir=Le.projection.projectTilePoint(Cn,xn,ht),Nn=Le.projection.upVector(ht,wn.x,wn.y),vr=Re,Nr=Ke;if(st){let ni=XE(Cn,xn,Re,Ke,st,Ve,Ct,vt);vr+=ni.base,Nr+=ni.top}Re!==0?Ot(St,ir.x+Nn[0]*Ht*vr,ir.y+Nn[1]*Ht*vr,ir.z+Nn[2]*Ht*vr):Ot(St,ir.x,ir.y,ir.z),Ot(qt,ir.x+Nn[0]*Ht*Nr,ir.y+Nn[1]*Ht*Nr,ir.z+Nn[2]*Ht*Nr),i.N.transformMat4(St,St,dt),i.N.transformMat4(qt,qt,dt),Gn.push(new ah(St[0],St[1],St[2])),vn.push(new ah(qt[0],qt[1],qt[2]))}Ue.push(Gn),It.push(vn)}return[Ue,It]}(K,ie,ne,le,de,me,be,ge,Me,Ne,Ie):be?function(Le,Te,Re,Ke,Fe,dt,st,Ve,Ct){let vt=[],ht=[],Ue=[0,0,0,1];for(let It of Le){let Ht=[],St=[];for(let qt of It){let Ot=qt.x+Ke.x,un=qt.y+Ke.y,Bt=XE(Ot,un,Te,Re,dt,st,Ve,Ct);Ue[0]=Ot,Ue[1]=un,Ue[2]=Bt.base,Ue[3]=1,i.a7.transformMat4(Ue,Ue,Fe),Ue[3]=Math.max(Ue[3],1e-5);let Gn=new ah(Ue[0]/Ue[3],Ue[1]/Ue[3],Ue[2]/Ue[3]);Ue[0]=Ot,Ue[1]=un,Ue[2]=Bt.top,Ue[3]=1,i.a7.transformMat4(Ue,Ue,Fe),Ue[3]=Math.max(Ue[3],1e-5);let vn=new ah(Ue[0]/Ue[3],Ue[1]/Ue[3],Ue[2]/Ue[3]);Ht.push(Gn),St.push(vn)}vt.push(Ht),ht.push(St)}return[vt,ht]}(ie,ne,le,de,me,be,ge,Me,Ne):function(Le,Te,Re,Ke,Fe){let dt=[],st=[],Ve=Fe[8]*Te,Ct=Fe[9]*Te,vt=Fe[10]*Te,ht=Fe[11]*Te,Ue=Fe[8]*Re,It=Fe[9]*Re,Ht=Fe[10]*Re,St=Fe[11]*Re;for(let qt of Le){let Ot=[],un=[];for(let Bt of qt){let Gn=Bt.x+Ke.x,vn=Bt.y+Ke.y,wn=Fe[0]*Gn+Fe[4]*vn+Fe[12],Cn=Fe[1]*Gn+Fe[5]*vn+Fe[13],xn=Fe[2]*Gn+Fe[6]*vn+Fe[14],ir=Fe[3]*Gn+Fe[7]*vn+Fe[15],Nn=wn+Ve,vr=Cn+Ct,Nr=xn+vt,ni=Math.max(ir+ht,1e-5),tr=wn+Ue,hr=Cn+It,Zr=xn+Ht,Xr=Math.max(ir+St,1e-5);Ot.push(new ah(Nn/ni,vr/ni,Nr/ni)),un.push(new ah(tr/Xr,hr/Xr,Zr/Xr))}dt.push(Ot),st.push(un)}return[dt,st]}(ie,ne,le,de,me)}(u,o,I,T,b,f,z,M,L,u.center.lat,t.tileID.canonical),J=t.queryGeometry;return function(K,ie,ne){let le=1/0;Ea(ne,ie)&&(le=ZE(ne,ie[0]));for(let de=0;de<ie.length;de++){let me=ie[de],be=K[de];for(let ge=0;ge<me.length-1;ge++){let Me=me[ge],Ne=[Me,me[ge+1],be[ge+1],be[ge],Me];Fo(ne,Ne)&&(le=Math.min(le,ZE(ne,Ne)))}}return le!==1/0&&le}(V,W,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends Pi{constructor(t,e,n){super(t,KE,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof fc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=rI.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new xv(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=tI(this);return{config:new F(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=iI(rh("line-width",this,e),rh("line-gap-width",this,e)),o=rh("line-offset",this,e);return n/2+Math.abs(o)+pg(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,c,u){if(t.queryGeometry.isAboveHorizon)return!1;let f=kw(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*iI(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(o=function(b,T){let I=[],M=new Ge(0,0);for(let P=0;P<b.length;P++){let L=b[P],N=[];for(let z=0;z<L.length;z++){let V=L[z],W=L[z+1],J=z===0?M:V.sub(L[z-1])._unit()._perp(),K=z===L.length-1?M:W.sub(V)._unit()._perp(),ie=J._add(K)._unit();ie._mult(1/(ie.x*K.x+ie.y*K.y)),N.push(ie._mult(T)._add(V))}I.push(N)}return I}(o,x*t.pixelToTileUnitsFactor)),function(b,T,I){for(let M=0;M<T.length;M++){let P=T[M];if(b.length>=3){for(let L=0;L<P.length;L++)if(es(b,P[L]))return!0}if(jc(b,P,I))return!0}return!1}(f,o,_)}isTileClipped(){return!0}},symbol:Yg,background:class extends Pi{constructor(t,e,n){super(t,AL,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:$I,"raster-particle":GI,sky:class extends Pi{constructor(t,e,n){super(t,zL,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),c=!o,u=t.style.light,f=u.properties.get("position");return c&&u.properties.get("anchor")==="viewport"&&_r("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?kv(f.azimuthal,90-f.polar,e):kv(o[0],90-o[1],e)}let n=this.paint.get("sky-gradient-center");return kv(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Pi{constructor(t,e,n){super(t,BL,e)}},model:class extends Pi{constructor(t,e,n){super(t,ZL,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new zv(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof a_?rt-1:0}queryIntersectsFeature(t,e,n,o,c,u){if(!this.modelManager)return!1;let f=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof zv))return!1;let x=_;for(let b in x.instancesPerModel){let T=x.instancesPerModel[b];if(T.idToFeaturesIndex.hasOwnProperty(e.id)){let I=T.features[T.idToFeaturesIndex[e.id]],M=f.getModel(b,this.scope);if(!M)return!1;let P=i.a6.create(),L=new pe(0,0),N=x.canonical,z=Number.MAX_VALUE;for(let V=0;V<I.instancedDataCount;++V){let W=16*(I.instancedDataOffset+V),J=T.instancedDataArray.float32,K=[J[W+4],J[W+5],J[W+6]];xD(N,L,J[W],0|J[W+1]),QI(P,M,u,L,I.rotation,I.scale,K,!1,!1,!1),u.projection.name==="globe"&&(P=Fv(P,u));let ie=i.a6.multiply([],u.projMatrix,P),ne=t.queryGeometry,le=YI(ne.isPointQuery()?ne.screenBounds:ne.screenGeometry,u,ie,M.aabb);le!=null&&(z=Math.min(le,z))}return z!==Number.MAX_VALUE&&z}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof yc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,o){let c=t.tile,u=c.getBucket(this),f=null,_=Number.MAX_VALUE;if(!(u&&u instanceof a_))return{queryFeature:f,intersectionZ:_};let x=u.getNodesInfo()[e];if(x.hiddenByReplacement||!x.node.meshes||!n.filter(new ar(c.tileID.overscaledZ),x.feature,c.tileID.canonical))return{queryFeature:f,intersectionZ:_};let b=x.node,T=o.calculatePosMatrix(c.tileID.toUnwrapped(),o.worldSize),I=x.evaluatedScale,M=0;o.elevation&&b.elevation&&(M=b.elevation*o.elevation.exaggeration()),i.a6.translate(T,T,[(b.anchor?b.anchor[0]:0)*(I[0]-1),(b.anchor?b.anchor[1]:0)*(I[1]-1),M]),i.a6.scale(T,T,I),i.a6.multiply(T,T,b.matrix);let P=t.queryGeometry,L=P.isPointQuery()?P.screenBounds:P.screenGeometry,N=function(V){let W=i.a6.multiply([],T,V.matrix),J=i.a6.multiply(W,o.expandedFarZProjMatrix,W);for(let K=0;K<V.meshes.length;++K){let ie=V.meshes[K];if(K===V.lightMeshIndex)continue;let ne=YI(L,o,J,ie.aabb);ne!=null&&(_=Math.min(ne,_))}if(V.children)for(let K of V.children)N(K)};if(N(b),_===Number.MAX_VALUE)return{queryFeature:f,intersectionZ:_};let z=new pe(0,0);return xD(c.tileID.canonical,z,x.node.anchor[0],x.node.anchor[1]),f={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:x.feature.properties,id:x.feature.id,state:{},layer:this.serialize()},{queryFeature:f,intersectionZ:_}}}},Vt={read:function(t,e){return t.readFields(Vt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(Vt.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Vt.Filter.read=function(t,e){return t.readFields(Vt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Vt.Filter._readField=function(t,e,n){t===1?(e.delta_filter=Vt.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Vt.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Vt.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Vt.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Vt.Filter.Delta={},Vt.Filter.Delta.read=function(t,e){return t.readFields(Vt.Filter.Delta._readField,{block_size:0},e)},Vt.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},Vt.Filter.Zigzag={},Vt.Filter.Zigzag.read=function(t,e){return t.readFields(Vt.Filter.Zigzag._readField,{},e)},Vt.Filter.Zigzag._readField=function(t,e,n){},Vt.Filter.BitShuffle={},Vt.Filter.BitShuffle.read=function(t,e){return t.readFields(Vt.Filter.BitShuffle._readField,{},e)},Vt.Filter.BitShuffle._readField=function(t,e,n){},Vt.Filter.ByteShuffle={},Vt.Filter.ByteShuffle.read=function(t,e){return t.readFields(Vt.Filter.ByteShuffle._readField,{},e)},Vt.Filter.ByteShuffle._readField=function(t,e,n){},Vt.Codec={},Vt.Codec.read=function(t,e){return t.readFields(Vt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Vt.Codec._readField=function(t,e,n){t===1?(e.gzip_data=Vt.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Vt.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Vt.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=Vt.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Vt.Codec.GzipData={},Vt.Codec.GzipData.read=function(t,e){return t.readFields(Vt.Codec.GzipData._readField,{},e)},Vt.Codec.GzipData._readField=function(t,e,n){},Vt.Codec.JpegImage={},Vt.Codec.JpegImage.read=function(t,e){return t.readFields(Vt.Codec.JpegImage._readField,{},e)},Vt.Codec.JpegImage._readField=function(t,e,n){},Vt.Codec.WebpImage={},Vt.Codec.WebpImage.read=function(t,e){return t.readFields(Vt.Codec.WebpImage._readField,{},e)},Vt.Codec.WebpImage._readField=function(t,e,n){},Vt.Codec.PngImage={},Vt.Codec.PngImage.read=function(t,e){return t.readFields(Vt.Codec.PngImage._readField,{},e)},Vt.Codec.PngImage._readField=function(t,e,n){},Vt.DataIndexEntry={},Vt.DataIndexEntry.read=function(t,e){return t.readFields(Vt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Vt.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(Vt.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=Vt.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},Vt.Layer={},Vt.Layer.read=function(t,e){return t.readFields(Vt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Vt.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(Vt.DataIndexEntry.read(n,n.readVarint()+n.pos))};let ss={read:function(t,e){return t.readFields(ss._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=ss.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=ss.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};ss.Uint32Values.read=function(t,e){return t.readFields(ss.Uint32Values._readField,{values:[]},e)},ss.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(o){if(o.type!==2)throw new Error(`Unsupported pbf type "${o.type}"`);let c=function(f){return f.type===2?f.readVarint()+f.pos:f.pos+1}(o),u=o.pos;return o.pos=c,function(f){o.pos=u;let _=0;for(;o.pos<c;){let x=o.readVarint();f[_++]=x}return f}}(n))},ss.Fixed32Values={},ss.Fixed32Values.read=function(t,e){return t.readFields(ss.Fixed32Values._readField,{values:[]},e)},ss.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class mO{constructor(e=0,n=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(n=o.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,o=!1,c=this.resetTtl){let u;if(o||this.has(e)){if(u=this.items[e],u.value=n,o===!1&&c&&(u.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==u){let f=this.last,_=u.next,x=u.prev;this.first===u&&(this.first=u.next),u.next=null,u.prev=this.last,f.next=u,x!==null&&(x.next=_),_!==null&&(_.prev=x)}}else this.max>0&&this.size===this.max&&this.evict(!0),u=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=u:this.last.next=u;return this.last=u,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function gO(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let o=2;o>=1;o--){let c=o===1?1:0,u=o===2?1:0;for(let f=0;f<e[0];f++){let _=e[1]*f;for(let x=c;x<e[1];x++){let b=e[2]*(x+_);for(let T=u;T<e[2];T++){let I=e[3]*(T+b);for(let M=0;M<e[3];M++){let P=I+M;t[P]+=t[P-n]}}}}n*=e[o]}return t}function _O(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function yO(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let o=t[n],c=t[n+1];t[n]=(240&o)>>4|(61440&o)>>8|(240&c)<<4|61440&c,t[n+1]=15&o|(3840&o)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let o=t[n],c=t[n+1],u=t[n+2],f=t[n+3];t[n+0]=(192&o)>>6|(192&c)>>4|(192&u)>>2|192&f,t[n+1]=(48&o)>>4|(48&c)>>2|48&u|(48&f)<<2,t[n+2]=(12&o)>>2|12&c|(12&u)<<2|(12&f)<<4,t[n+3]=3&o|(3&c)<<2|(3&u)<<4|(3&f)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Rl extends Error{constructor(e){super(e),this.name="MRTError"}}var Io=Uint8Array,vh=Uint16Array,vO=Int32Array,bD=new Io([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wD=new Io([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xO=new Io([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),TD=function(t,e){for(var n=new vh(31),o=0;o<31;++o)n[o]=e+=1<<t[o-1];var c=new vO(n[30]);for(o=1;o<30;++o)for(var u=n[o];u<n[o+1];++u)c[u]=u-n[o]<<5|o;return{b:n,r:c}},ED=TD(bD,2),ID=ED.b,bO=ED.r;ID[28]=258,bO[258]=28;for(var wO=TD(wD,0).b,Zv=new vh(32768),Cr=0;Cr<32768;++Cr){var xh=(43690&Cr)>>1|(21845&Cr)<<1;Zv[Cr]=((65280&(xh=(61680&(xh=(52428&xh)>>2|(13107&xh)<<2))>>4|(3855&xh)<<4))>>8|(255&xh)<<8)>>1}var dp=function(t,e,n){for(var o=t.length,c=0,u=new vh(e);c<o;++c)t[c]&&++u[t[c]-1];var f,_=new vh(e);for(c=1;c<e;++c)_[c]=_[c-1]+u[c-1]<<1;if(n){f=new vh(1<<e);var x=15-e;for(c=0;c<o;++c)if(t[c])for(var b=c<<4|t[c],T=e-t[c],I=_[t[c]-1]++<<T,M=I|(1<<T)-1;I<=M;++I)f[Zv[I]>>x]=b}else for(f=new vh(o),c=0;c<o;++c)t[c]&&(f[c]=Zv[_[t[c]-1]++]>>15-t[c]);return f},fp=new Io(288);for(Cr=0;Cr<144;++Cr)fp[Cr]=8;for(Cr=144;Cr<256;++Cr)fp[Cr]=9;for(Cr=256;Cr<280;++Cr)fp[Cr]=7;for(Cr=280;Cr<288;++Cr)fp[Cr]=8;var DD=new Io(32);for(Cr=0;Cr<32;++Cr)DD[Cr]=5;var TO=dp(fp,9,1),EO=dp(DD,5,1),Xv=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},as=function(t,e,n){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&n},Yv=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},IO=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ls=function(t,e,n){var o=new Error(e||IO[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,ls),!n)throw o;return o},DO=new Io(0),MO=typeof TextDecoder<"u"&&new TextDecoder;try{MO.decode(DO,{stream:!0})}catch{}let CO={gzip_data:"gzip"},SO={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},AO={uint32:1,uint16:2,uint8:4},PO={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class MD{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),o=new DataView(e);if(n[0]!==13)throw new Rl("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),o=this.getHeaderLength(e);if(n.length<o)throw new Rl(`Expected header with length >= ${o} but got buffer of length ${n.length}`);let c=new hh(n.subarray(0,o)),u=Vt.read(c);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Rl(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(let f of u.layers)this.layers[f.name]=new RO(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],o=this.getLayer(e.layerName);for(let c=0;c<o.dataIndex.length;c++){let u=o.dataIndex[c],f=u.first_byte-e.firstByte,_=u.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||o._blocksInProgress.has(c))continue;let x={layerName:o.name,firstByte:f,lastByte:_,pixelFormat:o.pixelFormat,blockIndex:c,blockShape:[u.bands.length].concat(o.bandShape),buffer:o.buffer,codec:u.codec.codec,filters:u.filters.map(b=>b.filter)};o._blocksInProgress.add(c),n.push(x)}return new CD(n,()=>{n.forEach(c=>o._blocksInProgress.delete(c.blockIndex))},(c,u)=>{if(n.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),c)throw c;u.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class RO{constructor({version:e,name:n,units:o,tilesize:c,pixel_format:u,buffer:f,data_index:_},x){if(this.version=e,this.version!==1)throw new Rl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=o,this.tileSize=c,this.buffer=f,this.pixelFormat=SO[u],this.dataIndex=_,this.bandShape=[c+2*f,c+2*f,AO[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,I=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new mO(b,T,I)}(x?x.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[o,c]of this.dataIndex.entries()){for(let[u,f]of c.bands.entries())if(f===e)return{bandIndex:n+u,blockIndex:o,blockBandIndex:u};n+=c.bands.length}break;case"number":for(let[o,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new Rl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Rl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,o=-1/0,c=1/0,u=-1/0;for(let f of e){let{blockIndex:_}=this.getBlockForBand(f);if(_<0)throw new Rl(`Invalid band: ${JSON.stringify(f)}`);let x=this.dataIndex[_];c=Math.min(c,_),u=Math.max(u,_),n=Math.min(n,x.first_byte),o=Math.max(o,x.last_byte)}return{layerName:this.name,firstByte:n,lastByte:o,firstBlock:c,lastBlock:u}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:o}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new Rl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[n],f=this.bandShape.reduce((b,T)=>b*T,1),_=o*f,x=c.subarray(_,_+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:u.offset,scale:u.scale}}}class CD{constructor(e,n,o){this.tasks=e,this._onCancel=n,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}MD.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:o,firstByte:c,lastByte:u,pixelFormat:f,blockShape:_,blockIndex:x,filters:b,codec:T}=n,I=new Uint8Array(t).subarray(c,u+1),M=new Uint32Array(_[0]*_[1]*_[2]),P;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return P=function(L,N){if(!globalThis.DecompressionStream&&N==="gzip_data")return Promise.resolve(((J=function(ne){ne[0]==31&&ne[1]==139&&ne[2]==8||ls(6,"invalid gzip data");var le=ne[3],de=10;4&le&&(de+=2+(ne[10]|ne[11]<<8));for(var me=(le>>3&1)+(le>>4&1);me>0;me-=!ne[de++]);return de+(2&le)}(W=L))+8>W.length&&ls(6,"invalid gzip data"),function(ne,le,de,me){var be=ne.length;if(!be||le.f&&!le.l)return de||new Io(0);var ge=!de,Me=ge||le.i!=2,Ne=le.i;ge&&(de=new Io(3*be));var Ie=function(Ni){var wi=de.length;if(Ni>wi){var Do=new Io(Math.max(2*wi,Ni));Do.set(de),de=Do}},Le=le.f||0,Te=le.p||0,Re=le.b||0,Ke=le.l,Fe=le.d,dt=le.m,st=le.n,Ve=8*be;do{if(!Ke){Le=as(ne,Te,1);var Ct=as(ne,Te+1,3);if(Te+=3,!Ct){var vt=ne[(vn=4+((Te+7)/8|0))-4]|ne[vn-3]<<8,ht=vn+vt;if(ht>be){Ne&&ls(0);break}Me&&Ie(Re+vt),de.set(ne.subarray(vn,ht),Re),le.b=Re+=vt,le.p=Te=8*ht,le.f=Le;continue}if(Ct==1)Ke=TO,Fe=EO,dt=9,st=5;else if(Ct==2){var Ue=as(ne,Te,31)+257,It=as(ne,Te+10,15)+4,Ht=Ue+as(ne,Te+5,31)+1;Te+=14;for(var St=new Io(Ht),qt=new Io(19),Ot=0;Ot<It;++Ot)qt[xO[Ot]]=as(ne,Te+3*Ot,7);Te+=3*It;var un=Xv(qt),Bt=(1<<un)-1,Gn=dp(qt,un,1);for(Ot=0;Ot<Ht;){var vn,wn=Gn[as(ne,Te,Bt)];if(Te+=15&wn,(vn=wn>>4)<16)St[Ot++]=vn;else{var Cn=0,xn=0;for(vn==16?(xn=3+as(ne,Te,3),Te+=2,Cn=St[Ot-1]):vn==17?(xn=3+as(ne,Te,7),Te+=3):vn==18&&(xn=11+as(ne,Te,127),Te+=7);xn--;)St[Ot++]=Cn}}var ir=St.subarray(0,Ue),Nn=St.subarray(Ue);dt=Xv(ir),st=Xv(Nn),Ke=dp(ir,dt,1),Fe=dp(Nn,st,1)}else ls(1);if(Te>Ve){Ne&&ls(0);break}}Me&&Ie(Re+131072);for(var vr=(1<<dt)-1,Nr=(1<<st)-1,ni=Te;;ni=Te){var tr=(Cn=Ke[Yv(ne,Te)&vr])>>4;if((Te+=15&Cn)>Ve){Ne&&ls(0);break}if(Cn||ls(2),tr<256)de[Re++]=tr;else{if(tr==256){ni=Te,Ke=null;break}var hr=tr-254;tr>264&&(hr=as(ne,Te,(1<<(Yr=bD[Ot=tr-257]))-1)+ID[Ot],Te+=Yr);var Zr=Fe[Yv(ne,Te)&Nr],Xr=Zr>>4;if(Zr||ls(3),Te+=15&Zr,Nn=wO[Xr],Xr>3){var Yr=wD[Xr];Nn+=Yv(ne,Te)&(1<<Yr)-1,Te+=Yr}if(Te>Ve){Ne&&ls(0);break}Me&&Ie(Re+131072);var Xn=Re+hr;if(Re<Nn){var oo=0-Nn,Ll=Math.min(Nn,Xn);for(oo+Re<0&&ls(3);Re<Ll;++Re)de[Re]=me[oo+Re]}for(;Re<Xn;++Re)de[Re]=de[Re-Nn]}}le.l=Ke,le.p=ni,le.b=Re,le.f=Le,Ke&&(Le=1,le.m=dt,le.d=Fe,le.n=st)}while(!Le);return Re!=de.length&&ge?function(Ni,wi,Do){return(wi==null||wi<0)&&(wi=0),(Do==null||Do>Ni.length)&&(Do=Ni.length),new Io(Ni.subarray(wi,Do))}(de,0,Re):de.subarray(0,Re)}(W.subarray(J,-8),{i:2},new Io(((z=W)[(V=z.length)-4]|z[V-3]<<8|z[V-2]<<16|z[V-1]<<24)>>>0),void 0)));var z,V,W,J;let K=CO[N];if(!K)throw new Error(`Unhandled codec: ${N}`);let ie=new globalThis.DecompressionStream(K);return new Response(new Blob([L]).stream().pipeThrough(ie)).arrayBuffer().then(ne=>new Uint8Array(ne))}(I,T).then(L=>{let N=ss.read(new hh(L));if(N.values==="uint32_values")return N.uint32_values.readValuesInto(M),new PO[f](M.buffer);throw new Error(`Unhandled numeric data "${N.values}"`)}),P.then(L=>{for(let N=b.length-1;N>=0;N--)switch(b[N]){case"delta_filter":gO(L,_);break;case"zigzag_filter":_O(L);break;case"bitshuffle_filter":yO(L,f);break;default:throw new Error(`Unhandled filter "${b[N]}"`)}return{layerName:o,blockIndex:x,data:L}}).catch(L=>{throw L})}))},ut(CD,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let SD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let u=SD[15&o];if(!u)throw new Error("Unrecognized array type.");let[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Kv(_,f,u,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=SD.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Jv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:f,nodeSize:_}=this,x=[0,u.length-1,0],b=[];for(;x.length;){let T=x.pop()||0,I=x.pop()||0,M=x.pop()||0;if(I-M<=_){for(let z=M;z<=I;z++){let V=f[2*z],W=f[2*z+1];V>=e&&V<=o&&W>=n&&W<=c&&b.push(u[z])}continue}let P=M+I>>1,L=f[2*P],N=f[2*P+1];L>=e&&L<=o&&N>=n&&N<=c&&b.push(u[P]),(T===0?e<=L:n<=N)&&(x.push(M),x.push(P-1),x.push(1-T)),(T===0?o>=L:c>=N)&&(x.push(P+1),x.push(I),x.push(1-T))}return b}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:u,nodeSize:f}=this,_=[0,c.length-1,0],x=[],b=o*o;for(;_.length;){let T=_.pop()||0,I=_.pop()||0,M=_.pop()||0;if(I-M<=f){for(let z=M;z<=I;z++)PD(u[2*z],u[2*z+1],e,n)<=b&&x.push(c[z]);continue}let P=M+I>>1,L=u[2*P],N=u[2*P+1];PD(L,N,e,n)<=b&&x.push(c[P]),(T===0?e-o<=L:n-o<=N)&&(_.push(M),_.push(P-1),_.push(1-T)),(T===0?e+o>=L:n+o>=N)&&(_.push(P+1),_.push(I),_.push(1-T))}return x}}function Jv(t,e,n,o,c,u){if(c-o<=n)return;let f=o+c>>1;AD(t,e,f,o,c,u),Jv(t,e,n,o,f-1,1-u),Jv(t,e,n,f+1,c,1-u)}function AD(t,e,n,o,c,u){for(;c>o;){if(c-o>600){let b=c-o+1,T=n-o+1,I=Math.log(b),M=.5*Math.exp(2*I/3),P=.5*Math.sqrt(I*M*(b-M)/b)*(T-b/2<0?-1:1);AD(t,e,n,Math.max(o,Math.floor(n-T*M/b+P)),Math.min(c,Math.floor(n+(b-T)*M/b+P)),u)}let f=e[2*n+u],_=o,x=c;for(pp(t,e,o,n),e[2*c+u]>f&&pp(t,e,o,c);_<x;){for(pp(t,e,_,x),_++,x--;e[2*_+u]<f;)_++;for(;e[2*x+u]>f;)x--}e[2*o+u]===f?pp(t,e,o,x):(x++,pp(t,e,x,c)),x<=n&&(o=x+1),n<=x&&(c=x-1)}}function pp(t,e,n,o){Qv(t,n,o),Qv(e,2*n,2*o),Qv(e,2*n+1,2*o+1)}function Qv(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}function PD(t,e,n,o){let c=t-n,u=e-o;return c*c+u*u}i.$=OI,i.A=Vu,i.B=lf,i.C=hn,i.D=ye,i.E=Ka,i.F=lr,i.G=Xe,i.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Go(t.expression.evaluate(e))}interpolate(t,e,n){return{x:cn(t.x,e.x,n),y:cn(t.y,e.y,n),z:cn(t.z,e.z,n),azimuthal:cn(t.azimuthal,e.azimuthal,n),polar:cn(t.polar,e.polar,n)}}},i.I=Dv,i.J=Ko,i.K=ar,i.L=_n,i.M=class{constructor(t,e,n,o){this.id=t,this.position=e!=null?new pe(e[0],e[1]):new pe(0,0),this.orientation=n??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(i.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let o=mr.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=i.a6.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,o,c,u,f=!1){QI(this.matrix,this,t.transform,this.position,e,n,o,c,u,f)}upload(t){if(!this.uploaded){for(let e of this.nodes)Bv(e,t);for(let e of this.nodes)n_(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)jv(t)}},i.O=qa,i.P=Ge,i.Q=wc,i.R=Mi,i.S=Tl,i.T=Nv,i.U=cn,i.V=rt,i.W=ym,i.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,o]){let c=Go([1,n,o]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:cn(t.x,e.x,n),y:cn(t.y,e.y,n),z:cn(t.z,e.z,n)}}},i.Y=function(t,e,n=0,o=!0){let c=new Ge(n,n),u=t.sub(c),f=e.add(c),_=[u,new Ge(f.x,u.y),f,new Ge(u.x,f.y)];return o&&_.push(u.clone()),_},i.Z=yc,i._=function(t,e){let n=[];for(let o=0;o<t.length;o++){let c=xs(o-1,-1,t.length-1),u=xs(o+1,-1,t.length-1),f=t[o],_=t[u],x=t[c].sub(f).unit(),b=_.sub(f).unit(),T=b.angleWithSep(x.x,x.y),I=x.add(b).unit().mult(-1*e/Math.sin(T/2));n.push(f.add(I))}return n},i.a=pd,i.a$=function(t){let e=[];for(let n in t)e.push(t[n]);return e},i.a0=Nw,i.a1=function(t,e,n=0){return i.N.fromValues(((e.x-n)*t.scale-t.x)*rt,(e.y*t.scale-t.y)*rt,Hn(e.z,e.y))},i.a2=tv,i.a3=JE,i.a4=function(t){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(let u of t)e=Math.min(e,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),c=Math.max(c,u.y);return{min:new Ge(e,n),max:new Ge(o,c)}},i.a5=Ut,i.a8=es,i.a9=En,i.aA=km,i.aB=yr,i.aC=Wa,i.aD=Jm,i.aE=Xg,i.aF=function(){Ui.isLoading()||Ui.isLoaded()||ks()!=="deferred"||xf()},i.aG=$i,i.aH=Lr,i.aI=fD,i.aJ=la,i.aK=xv,i.aL=_v,i.aM=$r,i.aN=xo,i.aO=Of,i.aP=eE,i.aQ=Mg,i.aR=Ov,i.aS=function(t,e){let n=Tl(e.zoom);if(n===0)return Gs(t);let o=xg(t),c=ov(o),u=Ut(o.getWest())*e.worldSize,f=Ut(o.getEast())*e.worldSize,_=Rt(o.getNorth())*e.worldSize,x=Rt(o.getSouth())*e.worldSize,b=[u,_,0],T=[f,_,0],I=[u,x,0],M=[f,x,0],P=i.a6.invert([],e.globeMatrix);return i.N.transformMat4(b,b,P),i.N.transformMat4(T,T,P),i.N.transformMat4(I,I,P),i.N.transformMat4(M,M,P),c[0]=Sa(c[0],I,n),c[1]=Sa(c[1],M,n),c[2]=Sa(c[2],T,n),c[3]=Sa(c[3],b,n),mr.fromPoints(c)},i.aT=wg,i.aU=$f,i.aV=Sa,i.aW=xi,i.aX=MP,i.aY=sa,i.aZ=MD,i.a_=Pe,i.aa=Xt,i.ab=X,i.ac=function(t,e){let n={};for(let o=0;o<e.length;o++){let c=e[o];c in t&&(n[c]=t[c])}return n},i.ad=we,i.ae=Rt,i.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,o){let c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){let[u,f]=c.result;return this.scheduler?this.scheduler.add(()=>{o(u,f)},e):o(u,f),()=>{}}return c.callbacks.push(o),c.cancel||(c.cancel=n((u,f)=>{c.result=[u,f];for(let _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(u,f)},e):_(u,f);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(u=>u!==o),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},i.ag=Df,i.ah=function(t,e,n){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let u=Pe(t.request,(f,_,x,b)=>{f?c(f):_&&c(null,{vectorTile:n?void 0:new yv(new hh(_)),rawData:_,cacheControl:x,expires:b})});return()=>{u.cancel(),c()}},e)},i.ai=function(t){Sn++,Sn>gt&&(t.getActor().send("enforceCacheSizeLimit",Ae),Sn=0)},i.aj=Ar,i.ak=ke,i.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},i.am=qe,i.an=$I,i.ao=GI,i.ap=UI,i.aq=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<t.length;o++){let c=document.createElement("source");He(t[o])||(n.crossOrigin="Anonymous"),c.src=t[o],n.appendChild(c)}return{cancel:()=>{}}},i.ar=Kg,i.as=tp,i.at=kt,i.au=dn,i.av=Jo,i.aw=Vr,i.ax=Mr,i.ay=Rn,i.az=Ta,i.b=ca,i.b$=Wm,i.b0=function(t,e){let n=[];for(let o in t)o in e||n.push(o);return n},i.b1=fo,i.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.b3=function(t,e){let{x:n,y:o}=t.point,c=sE(n,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return i.a6.multiply(c,c,sv(Gs(e)))},i.b5=lh,i.b6=Eo,i.b7=Ng,i.b8=function(t,e,n,o,c){let u=5*e+2;t.float32[u+0]=n,t.float32[u+1]=o,t.float32[u+2]=c},i.b9=Zg,i.bA=e_,i.bB=HI,i.bC=function(t){let e=HI(t,!0);return i.b4.invert([],[e[0],e[1],e[4],e[5]])},i.bD=nv,i.bE=function(t){let{x:e,y:n}=t.point,{lng:o,lat:c}=t._center;return sE(e,n,t.worldSize,o,c)},i.bF=Hr,i.bG=ee,i.bH=function(t){let e=Math.round((t+45+360)%360/90)%4;return yu[e]},i.bI=45,i.bJ=xt,i.bK=d,i.bL=js,i.bM=fg,i.bN=hi,i.bO=eh,i.bP=h,i.bQ=function(t,e,n){let o=Math.sqrt(t*t+e*e+n*n),c=o>0?Math.acos(n/o)*Uo:0,u=t!==0||e!==0?Math.atan2(-e,-t)*Uo+90:0;return u<0&&(u+=360),[o,u,c]},i.bR=nn,i.bS=mr,i.bT=Go,i.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},i.bV=function(t){return t({pluginStatus:Ai,pluginURL:Ns}),vf.on("pluginStateChange",t),t},i.bW=Vv,i.bX=r_,i.bY=fh,i.bZ=Mv,i.b_=Dr,i.ba=TI,i.bb=Fo,i.bc=si,i.bd=AI,i.be=Sv,i.bf=Iv,i.bg=Kv,i.bh=xs,i.bj=an,i.bk=re,i.bl=zt,i.bm=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},i.bn=pe,i.bo=BI,i.bp=We,i.bq=rv,i.br=qI,i.bs=je,i.bt=rE,i.bu=function(t,e,n,o,c,u,f,_,x){if(x.name==="globe")return rE(t,e,new je(n,o,c),!1);let b=tp({z:n,x:o,y:c},x);return new mr([(u+b.x/b.scale)*e,e*(b.y/b.scale),f],[(u+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},i.bv=function(t,e,n){let o=0;for(let c=0;c<2;++c){let u=n?n[c]:0;t[c]>u&&(o+=(t[c]-u)*(t[c]-u)),e[c]<u&&(o+=(u-e[c])*(u-e[c]))}return o},i.bw=en,i.bx=H,i.by=function(t){let e=i.a6.identity(new Float64Array(16));i.a6.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,ue,0],o=[0,xe,0];return i.N.transformMat4(n,n,e),i.N.transformMat4(o,o,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!lv(t,new pe(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!lv(t,new pe(t.center.lat,-90))]},i.bz=function(t,e){let{scale:n}=t.tileTransform,o=n*rt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return i.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},i.c=hD,i.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.c0=se,i.c1=Bi,i.c2=function(t,e,n){return t.type==="custom"?new kL(t,e):new pO[t.type](t,e,n)},i.c3=function(t){let e=t.indexOf(Wu);return e>=0?t.slice(0,e):t},i.c4=function(t){return t.indexOf(Wu)>=0},i.c5=function(t){let e=t.indexOf(Wu);return e>=0?t.slice(e+1):""},i.c6=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.c7=Ki,i.c8=vf,i.c9=Ce,i.cA=tI,i.cB=(t,e,n,o,c,u)=>{let f=t.transform;return{u_matrix:eI(t,e,n,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:QE(e,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u}},i.cC=(t,e,n,o,c,u,f)=>{let _=t.transform,x=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:eI(t,e,n,o),u_pixels_to_tile_units:x,u_device_pixel_ratio:u,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:nI(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:QE(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_emissive_strength:n.paint.get("line-emissive-strength")}},i.cD=Ql,i.cE=Gf,i.cF=qE,i.cG=ft,i.cH=Og,i.cI=Dl,i.cJ=450,i.cK=7,i.cL=LL,i.cM=256,i.cN=sv,i.cO=Bs,i.cP=Lf,i.cQ=function(t,e,n,o,c){return Xt((t-e)/(n-e)*(c-o)+o,o,c)},i.cR=tn,i.cS=Fv,i.cT=[1,1,1],i.cU=sh,i.cV=gh,i.cW=No,i.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=IE(new Ge(0,0),new Ge(rt,rt),t),n=[];for(let o of this._activeRegions){if(o.hiddenByOverlap||!EE(e,o))continue;let c=fR(o.min,o.max,t);n.push({min:c.min,max:c.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let o of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(o).buckets[e.layer];if(c)for(let u of c.getNodesInfo()){let f=u.node;f.footprint&&n.push({footprint:f.footprint,id:o.toUnwrapped()})}}return n}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let n of e){if(!n.footprint)continue;let o=IE(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:o.min,max:o.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Pg(e.min,n.min)||Pg(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){let o=this._activeRegions[e],c=this._prevRegions[n];t=o.priority!==c.priority||!TE(o,c),++e,++n}}if(t){++this._updateTime;let e=n=>{let o=this._activeRegions;if(n>=o.length)return n;let c=o[n].priority;for(;n<o.length&&o[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,o=e(n);for(;n!==o;){let c=n,u=n;for(;c!==o;){let f=this._activeRegions[c];f.hiddenByOverlap=!1;for(let _=0;_<u;_++){let x=this._activeRegions[_];if(!x.hiddenByOverlap&&EE(f,x)&&(f.hiddenByOverlap=ME(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++c}n=o,o=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},i.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new xo,o=new Vr,c=[],u=t+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),x=(b,T,I)=>{let M=b===u-1?b-2:b===0?b:b-1;return M+=I?24575:0,[M,T]};for(let b=0;b<u;++b)n.emplaceBack(...x(b,0,!0));for(let b=0;b<f;++b)for(let T=0;T<u;++T)n.emplaceBack(...x(T,b,(T===0||T===u-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let I=0;I<u;++I)n.emplaceBack(...x(I,T,!0))}for(let b=0;b<e.length;++b){let T=o.length,I=e[b]+1+2,M=new Vr;for(let N=0;N<I-1;N++){let z=N===I-2,V=z?u*(_-e.length+b-N):u;for(let W=0;W<u-1;W++){let J=N*u+W;N===0||z||W===0||W===u-2?(M.emplaceBack(J+1,J,J+V),M.emplaceBack(J+V,J+V+1,J+1)):(o.emplaceBack(J+1,J,J+V),o.emplaceBack(J+V,J+V+1,J+1))}}let P=yr.simpleSegment(0,T,n.length,o.length-T);for(let N=0;N<M.uint16.length;N+=3)o.emplaceBack(M.uint16[N],M.uint16[N+1],M.uint16[N+2]);let L=yr.simpleSegment(0,T,n.length,o.length-T);c.push({withoutSkirts:P,withSkirts:L})}return{vertices:n,indices:o,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(oe,ae);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,eE.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Vr;for(let f=0;f<=oe;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new Bs,o=new Bs,c=new Bs,u=new Bs;this._poleSegments=[];for(let f=0,_=0;f<ee;f++){let x=360/(1<<f);n.emplaceBack(0,-X,0,.5,0),o.emplaceBack(0,-X,0,.5,1),c.emplaceBack(0,-X,0,.5,.5),u.emplaceBack(0,-X,0,.5,.5);for(let b=0;b<=oe;b++){let T=b/oe,I=0,M=cn(0,x,T),[P,L,N]=fe(AP,PP,M,X);n.emplaceBack(P,L,N,T,I),o.emplaceBack(P,L,N,T,1-I);let z=an(M);T=.5+.5*Math.sin(z),I=.5+.5*Math.cos(z),c.emplaceBack(P,L,N,T,I),u.emplaceBack(P,L,N,T,1-I)}this._poleSegments.push(yr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,yg,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,yg,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,yg,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,yg,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},i.cZ=function(t){return ws.has(t)},i.c_=ho,i.ca=r,i.cb=class extends Qo{constructor(t){super(t),this.current=g}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.cc=it,i.cd=function(t,e,n){let o=Tl(n.zoom),c=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!c&&!u},i.ce=function(t){let e=t.pixelsPerMeter,n=e/zt(1,t.center.lat),o=i.a6.identity(new Float64Array(16));return i.a6.translate(o,o,[t.point.x,t.point.y,0]),i.a6.scale(o,o,[n,n,e]),Float32Array.from(o)},i.cf=xg,i.cg=function(t){let e=en-5;t=Xt(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(an(t))),3);return Math.round(n*(ae.length-1))},i.ch=function(t,e,n,o){let c=e.getNorth(),u=e.getSouth(),f=e.getWest(),_=e.getEast(),x=1<<t.z,b=_-f,T=c-u,I=b/oe,M=-T/ae[n],P=[0,I,0,M,0,0,c,f,0];if(t.z>0){let L=180/o;i.co.multiply(P,P,[L/b+1,0,0,0,L/T+1,0,-.5*L/I,.5*L/M,1])}return P[2]=x,P[5]=t.x,P[8]=t.y,P},i.ci=Gs,i.cj=function(t,e,n){let o=i.a6.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return i.a6.rotateY(o,n.globeMatrix,c),Float32Array.from(o)},i.ck=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,o=1<<n,c=Math.floor(t.x),u=Math.floor((t.x-c)*o),f=Math.floor(t.y*o),_=this.findDEMTileFor(new qe(n,c,n,u,f));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let c=o.getSource().maxzoom,u=1<<c,f=Math.floor(t.x),_=t.x-f,x=new qe(c,f,c,Math.floor(_*u),Math.floor(t.y*u)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;let T=b.dem,I=1<<b.tileID.canonical.z,M=(_*I-b.tileID.canonical.x)*T.dim,P=(t.y*I-b.tileID.canonical.y)*T.dim,L=Math.floor(M),N=Math.floor(P);return(n?this.exaggeration():1)*cn(cn(T.get(L,N),T.get(L,N+1),P-N),cn(T.get(L+1,N),T.get(L+1,N+1),P-N),M-L)}getAtTileOffset(t,e,n){let o=1<<t.canonical.z;return this.getAtPointOrZero(new _n(t.wrap+(t.canonical.x+e/rt)/o,(t.canonical.y+n/rt)/o))}getAtTileOffsetFunc(t,e,n,o){return c=>{let u=this.getAtTileOffset(t,c.x,c.y),f=o.upVector(t.canonical,c.x,c.y),_=o.upVectorScale(t.canonical,e,n).metersToTile;return i.N.scale(f,f,u*_),f}}getForTilePoints(t,e,n,o){if(this.isUsingMockSource())return!1;let c=sh.create(this,t,o);return!!c&&(e.forEach(u=>{u[2]=this.exaggeration()*c.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,o=e.tileID,c=1<<t.canonical.z-o.canonical.z,u=t.canonical.x/c-o.canonical.x,f=t.canonical.y/c-o.canonical.y,_=0;for(let x=0;x<t.canonical.z-o.canonical.z&&!n.leaves[_];x++){u*=2,f*=2;let b=2*Math.floor(f)+Math.floor(u);_=n.childOffsets[_]+b,u%=1,f%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let c of t){let u=this.getMinMaxForTile(c.tileID);u&&(n=Math.min(n,u.min),o=Math.max(o,u.max),e=!0)}return e?{min:n,max:o}:null}},i.cl=vg,i.cm=mE,i.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},i.cp=oE,i.cq=256,i.cr=function(t,e){let n=[0,0,0],o=wg(Gs(e.canonical));return i.N.transformMat4(n,n,o),i.N.transformMat4(n,n,t),n},i.cs=t=>({u_camera_to_center_distance:new hi(t),u_extrude_scale:new w(t),u_device_pixel_ratio:new hi(t),u_matrix:new d(t),u_inv_rot_matrix:new d(t),u_merc_center:new js(t),u_tile_id:new fg(t),u_zoom_transition:new hi(t),u_up_dir:new fg(t),u_emissive_strength:new hi(t)}),i.ct=t=>({u_matrix:new d(t),u_pixels_to_tile_units:new w(t),u_device_pixel_ratio:new hi(t),u_units_to_pixels:new js(t),u_dash_image:new eh(t),u_gradient_image:new eh(t),u_image_height:new hi(t),u_texsize:new js(t),u_tile_units_to_pixels:new hi(t),u_alpha_discard_threshold:new hi(t),u_trim_offset:new js(t),u_emissive_strength:new hi(t)}),i.cu=t=>({u_matrix:new d(t),u_texsize:new js(t),u_pixels_to_tile_units:new w(t),u_device_pixel_ratio:new hi(t),u_image:new eh(t),u_units_to_pixels:new js(t),u_tile_units_to_pixels:new hi(t),u_alpha_discard_threshold:new hi(t),u_trim_offset:new js(t)}),i.cv=Yu,i.cw=UR,i.cx=$R,i.cy=cE,i.cz=(t,e,n,o,c,u)=>{let f=t.transform,_=f.projection.name==="globe",x;if(u.paint.get("circle-pitch-alignment")==="map")if(_){let T=oE(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([T,0,0,T])}else x=f.calculatePixelsToTileUnitsMatrix(n);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(f.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:$e.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:RP,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=o,b.u_merc_center=c,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=Tl(f.zoom);let T=c[0]*rt,I=c[1]*rt;b.u_up_dir=f.projection.upVector(new je(0,0,0),T,I)}return b},i.d=nt,i.d0=_i,i.d1=yn,i.d2=De,i.d3=function([t,e,n]){let o=Math.hypot(t,e,n),c=Math.atan2(t,n),u=.5*Math.PI-Math.acos(-e/o);return new pe(Hr(c),Hr(u))},i.d4=Ee,i.d5=j,i.d6=lv,i.d7=aE,i.d8=function(t){let e=[0,0,0],n=i.a6.identity(new Float64Array(16));return i.a6.multiply(n,t.pixelMatrix,t.globeMatrix),i.N.transformMat4(e,e,n),new Ge(e[0],e[1])},i.d9=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(Oe==null){let o=n.navigator?n.navigator.userAgent:null;Oe=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Oe}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dA=is,i.dB=dD,i.dC=pD,i.dD=YE,i.dE=oi,i.dF=II,i.dG=function(t,e,n,o,c,u,f,_,x,b,T){t.createArrays(),t.tilePixelRatio=rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){let{minZoom:V,maxZoom:W}=t.textSizeData;P.compositeTextSizes=[M["text-size"].possiblyEvaluate(new ar(V),_),M["text-size"].possiblyEvaluate(new ar(W),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:V,maxZoom:W}=t.iconSizeData;P.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new ar(V),_),M["icon-size"].possiblyEvaluate(new ar(W),_)]}P.layoutTextSize=M["text-size"].possiblyEvaluate(new ar(x+1),_),P.layoutIconSize=M["icon-size"].possiblyEvaluate(new ar(x+1),_),P.textMaxSize=M["text-size"].possiblyEvaluate(new ar(18),_);let L=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",N=I.get("text-size"),z=!1;for(let V of t.features)if(V.icon&&V.icon.nameSecondary){z=!0;break}for(let V of t.features){let W=I.get("text-font").evaluate(V,{},_).join(","),J=N.evaluate(V,{},_),K=P.layoutTextSize.evaluate(V,{},_),ie=(P.layoutIconSize.evaluate(V,{},_),{horizontal:{},vertical:void 0}),ne=V.text,le,de=[0,0];if(ne){let ge=ne.toString(),Me=I.get("text-letter-spacing").evaluate(V,{},_)*si,Ne=I.get("text-line-height").evaluate(V,{},_)*si,Ie=R0(ge)?Me:0,Le=I.get("text-anchor").evaluate(V,{},_),Te=I.get("text-variable-anchor");if(!Te){let st=I.get("text-radial-offset").evaluate(V,{},_);de=st?AI(Le,[st*si,Cv]):I.get("text-offset").evaluate(V,{},_).map(Ve=>Ve*si)}let Re=L?"center":I.get("text-justify").evaluate(V,{},_),Ke=I.get("symbol-placement")==="point",Fe=Ke?I.get("text-max-width").evaluate(V,{},_)*si:1/0,dt=st=>{t.allowVerticalPlacement&&Os(ge)&&(ie.vertical=Ev(ne,e,n,c,W,Fe,Ne,Le,st,Ie,de,Eo.vertical,!0,K,J))};if(!L&&Te){let st=Re==="auto"?Te.map(Ct=>Sv(Ct)):[Re],Ve=!1;for(let Ct=0;Ct<st.length;Ct++){let vt=st[Ct];if(!ie.horizontal[vt])if(Ve)ie.horizontal[vt]=ie.horizontal[0];else{let ht=Ev(ne,e,n,c,W,Fe,Ne,"center",vt,Ie,de,Eo.horizontal,!1,K,J);ht&&(ie.horizontal[vt]=ht,Ve=ht.positionedLines.length===1)}}dt("left")}else{if(Re==="auto"&&(Re=Sv(Le)),Ke||I.get("text-writing-mode").indexOf("horizontal")>=0||!Os(ge)){let st=Ev(ne,e,n,c,W,Fe,Ne,Le,Re,Ie,de,Eo.horizontal,!1,K,J);st&&(ie.horizontal[Re]=st)}dt(Ke?"left":Re)}}let me=!1;if(V.icon&&V.icon.namePrimary){let ge=o[V.icon.namePrimary];ge&&(le=lL(c[V.icon.namePrimary],V.icon.nameSecondary?c[V.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(V,{},_),I.get("icon-anchor").evaluate(V,{},_)),me=ge.sdf,t.sdfIcons===void 0?t.sdfIcons=ge.sdf:t.sdfIcons!==ge.sdf&&_r("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let be=RI(ie.horizontal)||ie.vertical;t.iconsInText||(t.iconsInText=!!be&&be.iconsInText),(be||le)&&mL(t,V,ie,le,o,P,K,0,de,me,f,_,b,T,z)}u&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)},i.dH=yv,i.dI=hh,i.dJ=Rg,i.dK=Zt,i.dL=Sg,i.dM=Cg,i.dN=qn,i.dO=sI,i.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==iD){let n=new Uint32Array(t,0,7),[,,o,c,u,f]=n;e=n.byteLength+c+u+f+u,(o!==t.byteLength||e>=t.byteLength)&&_r("Invalid b3dm header information.")}return lD(t,e)},i.dQ=function(t,e){let n=hD(t);for(let o of n){for(let c of o.meshes)lO(c);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(cO(o.lights,e)))}return n},i.dR=a_,i.dS=eD,i.dT=Ui,i.dU=function(t){Fn(),ct&&ct.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},i.da=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ye,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!se(t))return t;let n=At(t);return n.params.push(`sdk=js-${C}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!se(t))return t;let n=At(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!se(t))return t;let n=At(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,o){if(!se(t))return t;let c=At(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),o&&c.params.push(`worldview=${o}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,o){let c=At(t);return se(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${n}`,ln(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!se(t))return t;let o=At(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${In.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${j.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${j.RASTERARRAYS_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${j.TILE_URL_VERSION}${o.path}`);let c=this._customAccessToken||function(u){for(let f of u){let _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(o.params)||j.ACCESS_TOKEN;return j.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,c)}canonicalizeTileURL(t,e){let n=At(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${j.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${n.path.replace(`/${j.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${j.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(u=>!u.match(/^access_token=/))),c.length&&(o+=`?${c.join("&")}`),o}canonicalizeTileset(t,e){let n=!!e&&se(e),o=[];for(let c of t.tiles||[])Z(c)?o.push(this.canonicalizeTileURL(c,n)):o.push(c);return o}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=At(j.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!j.REQUIRE_ACCESS_TOKEN)return ln(t);if(e=e||j.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ln(t)}},i.db=function(t,e){e?ws.add(t):ws.delete(t)},i.dc=In,i.dd=po,i.de=tc,i.df=ot,i.dg=Tn,i.dh=function(t){ws.delete(t)},i.di=Jr,i.dj=Kr,i.dk=C,i.dl=function(t,e){Ae=t,gt=e},i.dm=function(t,e,n=!1){if(Ai===pf||Ai===mf||Ai===gf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ns=$e.resolveURL(t),Ai=pf,_f=e,yf(),n||xf()},i.dn=ks,i.dp=function(){r_().acquire(Uv)},i.dq=function(){let t=cp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Uv),cp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dr=lp,i.ds=function(t){let e=Yt();if(!e)return;let n=e.delete(pt);t&&n.catch(t).then(()=>t())},i.dt=ap,i.du=tD,i.dv=function(t){$v=$e.resolveURL(t),yh||(yh=new Vv(r_(),new Ka)),yh.broadcast("setDracoUrl",$v)},i.dw=nD,i.dx=function(t){_h=$e.resolveURL(t),yh||(yh=new Vv(r_(),new Ka)),yh.broadcast("setMeshoptUrl",_h)},i.dy=ut,i.dz=El,i.e=ii,i.f=$e,i.g=function(t,e){return Ce(ii(t,{type:"json"}),e)},i.h=To,i.i=rl,i.j=_d,i.k=ju,i.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>lD(e,0,t))},i.m=Bm,i.n=_c,i.o=Ec,i.p=EI,i.q=Gu,i.r=$u,i.s=cf,i.t=hc,i.u=Tc,i.v=ei,i.w=_r,i.x=ll,i.z=Tf}),p(["./shared"],function(i){"use strict";function C(Oe){let Y=Oe?Oe.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function O(Oe){if(typeof Oe=="number"||typeof Oe=="boolean"||typeof Oe=="string"||Oe==null)return JSON.stringify(Oe);if(Array.isArray(Oe)){let re="[";for(let he of Oe)re+=`${O(he)},`;return`${re}]`}let Y="{";for(let re of Object.keys(Oe).sort())Y+=`${re}:${O(Oe[re])},`;return`${Y}}`}function j(Oe){let Y="";for(let re of i.b2)Y+=`/${O(Oe[re])}`;return Y}class Z{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,re){this._layerConfigs={},this._layers={},this.update(Y,[],re)}update(Y,re,he){this._options=he;for(let ke of Y)this._layerConfigs[ke.id]=ke,(this._layers[ke.id]=i.c2(ke,this.scope,this._options)).compileFilter(),this.keyCache[ke.id]&&delete this.keyCache[ke.id];for(let ke of re)delete this.keyCache[ke],delete this._layerConfigs[ke],delete this._layers[ke];this.familiesBySource={};let Se=function(ke,$e){let pt={};for(let gt=0;gt<ke.length;gt++){let ct=$e&&$e[ke[gt].id]||j(ke[gt]);$e&&($e[ke[gt].id]=ct);let yt=pt[ct];yt||(yt=pt[ct]=[]),yt.push(ke[gt])}let Ae=[];for(let gt in pt)Ae.push(pt[gt]);return Ae}(i.a$(this._layerConfigs),this.keyCache);for(let ke of Se){let $e=ke.map(Yt=>this._layers[Yt.id]),pt=$e[0];if(pt.visibility==="none")continue;let Ae=pt.source||"",gt=this.familiesBySource[Ae];gt||(gt=this.familiesBySource[Ae]={});let ct=pt.sourceLayer||"_geojsonTileLayer",yt=gt[ct];yt||(yt=gt[ct]=[]),yt.push($e)}}}let se=1*i.dA;class ve{constructor(Y){let re={},he=[];for(let pt in Y){let Ae=Y[pt],gt=re[pt]={};for(let ct in Ae.glyphs){let yt=Ae.glyphs[+ct];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;let Yt=yt.metrics.localGlyph?se:1,Fn={x:0,y:0,w:yt.bitmap.width+2*Yt,h:yt.bitmap.height+2*Yt};he.push(Fn),gt[ct]=Fn}}let{w:Se,h:ke}=i.p(he),$e=new i.dz({width:Se||1,height:ke||1});for(let pt in Y){let Ae=Y[pt];for(let gt in Ae.glyphs){let ct=Ae.glyphs[+gt];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;let yt=re[pt][gt],Yt=ct.metrics.localGlyph?se:1;i.dz.copy(ct.bitmap,$e,{x:0,y:0},{x:yt.x+Yt,y:yt.y+Yt},ct.bitmap)}}this.image=$e,this.positions=re}}i.dy(ve,"GlyphAtlas");class ze{constructor(Y){this.tileID=new i.am(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=i.as(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster}parse(Y,re,he,Se,ke){this.status="parsing",this.data=Y,this.collisionBoxArray=new i.aD;let $e=new i.dB(Object.keys(Y.layers).sort()),pt=new i.dC(this.tileID,this.promoteId);pt.bucketLayerIDs=[];let Ae={},gt=new i.dD(256,256),ct={featureIndex:pt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:gt,availableImages:he,brightness:this.brightness},yt=re.familiesBySource[this.source];for(let On in yt){let Wn=Y.layers[On];if(!Wn)continue;let jr=!1,Jn=!1,yi=!1;for(let Sr of yt[On])Sr[0].type==="symbol"?jr=!0:Jn=!0,Sr[0].is3D()&&Sr[0].type!=="model"&&(yi=!0);if(this.extraShadowCaster&&!yi||this.isSymbolTile===!0&&!jr||this.isSymbolTile===!1&&!Jn)continue;Wn.version===1&&i.w(`Vector tile source "${this.source}" layer "${On}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ui=$e.encode(On),Mi=[];for(let Sr=0;Sr<Wn.length;Sr++){let Dr=Wn.feature(Sr),Ce=pt.getId(Dr,On);Mi.push({feature:Dr,id:Ce,index:Sr,sourceLayerIndex:ui})}for(let Sr of yt[On]){let Dr=Sr[0];(!this.extraShadowCaster||Dr.is3D()&&Dr.type!=="model")&&(this.isSymbolTile!==void 0&&Dr.type==="symbol"!==this.isSymbolTile||Dr.minzoom&&this.zoom<Math.floor(Dr.minzoom)||Dr.maxzoom&&this.zoom>=Dr.maxzoom||Dr.visibility!=="none"&&(at(Sr,this.zoom,ct.brightness,he),(Ae[Dr.id]=Dr.createBucket({index:pt.bucketLayerIDs.length,layers:Sr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ui,sourceID:this.source,projection:this.projection.spec})).populate(Mi,ct,this.tileID.canonical,this.tileTransform),pt.bucketLayerIDs.push(Sr.map(Ce=>Ce.id))))}}let Yt,Fn,Qn,zn;gt.trim();let Sn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},In=()=>{if(Yt)return this.status="done",ke(Yt);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:i.a$(Ae).filter(On=>!On.isEmpty()),featureIndex:pt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ct.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Fn&&Qn&&zn){let On=new ve(Fn),Wn=new i.dF(Qn,zn);for(let jr in Ae){let Jn=Ae[jr];Jn instanceof i.aE?(at(Jn.layers,this.zoom,ct.brightness,he),i.dG(Jn,Fn,On.positions,Qn,Wn.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Jn.hasPattern&&(Jn instanceof i.aK||Jn instanceof i.aL||Jn instanceof i.cH)&&(at(Jn.layers,this.zoom,ct.brightness,he),Jn.addFeatures(ct,this.tileID.canonical,Wn.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",ke(null,{buckets:i.a$(Ae).filter(jr=>!jr.isEmpty()),featureIndex:pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:On.image,lineAtlas:gt,imageAtlas:Wn,brightness:ct.brightness})}};if(!this.extraShadowCaster){let On=i.dE(ct.glyphDependencies,Jn=>Object.keys(Jn).map(Number));Object.keys(On).length?Se.send("getGlyphs",{uid:this.uid,stacks:On,scope:this.scope},(Jn,yi)=>{Yt||(Yt=Jn,Fn=yi,In())},void 0,!1,Sn):Fn={};let Wn=Object.keys(ct.iconDependencies);Wn.length?Se.send("getImages",{icons:Wn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Jn,yi)=>{Yt||(Yt=Jn,Qn=yi,In())},void 0,!1,Sn):Qn={};let jr=Object.keys(ct.patternDependencies);jr.length?Se.send("getImages",{icons:jr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Jn,yi)=>{Yt||(Yt=Jn,zn=yi,In())},void 0,!1,Sn):zn={}}In()}}function at(Oe,Y,re,he){let Se=new i.K(Y,{brightness:re});for(let ke of Oe)ke.recalculate(Se,he)}class Wt extends i.E{constructor(Y,re,he,Se,ke,$e){super(),this.actor=Y,this.layerIndex=re,this.availableImages=he,this.loadVectorData=ke||i.ah,this.loading={},this.loaded={},this.deduped=new i.af(Y.scheduler),this.isSpriteLoaded=Se,this.scheduler=Y.scheduler,this.brightness=$e}loadTile(Y,re){let he=Y.uid,Se=Y&&Y.request,ke=Se&&Se.collectResourceTiming,$e=this.loading[he]=new ze(Y);$e.abort=this.loadVectorData(Y,(pt,Ae)=>{let gt=!this.loading[he];if(delete this.loading[he],gt||pt||!Ae)return $e.status="done",gt||(this.loaded[he]=$e),re(pt);let ct=Ae.rawData,yt={};Ae.expires&&(yt.expires=Ae.expires),Ae.cacheControl&&(yt.cacheControl=Ae.cacheControl),$e.vectorTile=Ae.vectorTile||new i.dH(new i.dI(ct));let Yt=()=>{$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,(Fn,Qn)=>{if(Fn||!Qn)return re(Fn);let zn={};if(ke){let Sn=C(Se);Sn.length>0&&(zn.resourceTiming=JSON.parse(JSON.stringify(Sn)))}re(null,i.e({rawTileData:ct.slice(0)},Qn,yt,zn))})};this.isSpriteLoaded?Yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Yt,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Yt()}),this.loaded=this.loaded||{},this.loaded[he]=$e})}reloadTile(Y,re){let he=this.loaded,Se=Y.uid,ke=this;if(he&&he[Se]){let $e=he[Se];$e.showCollisionBoxes=Y.showCollisionBoxes,$e.projection=Y.projection,$e.brightness=Y.brightness,$e.tileTransform=i.as(Y.tileID.canonical,Y.projection),$e.extraShadowCaster=Y.extraShadowCaster;let pt=(Ae,gt)=>{let ct=$e.reloadCallback;ct&&(delete $e.reloadCallback,$e.parse($e.vectorTile,ke.layerIndex,this.availableImages,ke.actor,ct)),re(Ae,gt)};$e.status==="parsing"?$e.reloadCallback=pt:$e.status==="done"&&($e.vectorTile?$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,pt):pt())}else re(null,void 0)}abortTile(Y,re){let he=Y.uid,Se=this.loading[he];Se&&(Se.abort&&Se.abort(),delete this.loading[he]),re()}removeTile(Y,re){let he=this.loaded,Se=Y.uid;he&&he[Se]&&delete he[Se],re()}}class Pn{loadTile(Y,re){let{uid:he,encoding:Se,rawImageData:ke,padding:$e}=Y,pt=ImageBitmap&&ke instanceof ImageBitmap?this.getImageData(ke,$e):ke;re(null,new i.dJ(he,pt,Se,$e<1))}getImageData(Y,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);let he=this.offscreenCanvasContext.getImageData(-re,-re,Y.width+2*re,Y.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}class Zt{decodeRasterArray({task:Y,buffer:re},he){i.aZ.performDecoding(re,Y).then(Se=>{he(null,Se)},Se=>{he(Se)})}}function Qt(Oe,Y){if(Oe.length!==0){Tr(Oe[0],Y);for(var re=1;re<Oe.length;re++)Tr(Oe[re],!Y)}}function Tr(Oe,Y){for(var re=0,he=0,Se=0,ke=Oe.length,$e=ke-1;Se<ke;$e=Se++){var pt=(Oe[Se][0]-Oe[$e][0])*(Oe[$e][1]+Oe[Se][1]),Ae=re+pt;he+=Math.abs(re)>=Math.abs(pt)?re-Ae+pt:pt-Ae+re,re=Ae}re+he>=0!=!!Y&&Oe.reverse()}var gr=i.dK(function Oe(Y,re){var he,Se=Y&&Y.type;if(Se==="FeatureCollection")for(he=0;he<Y.features.length;he++)Oe(Y.features[he],re);else if(Se==="GeometryCollection")for(he=0;he<Y.geometries.length;he++)Oe(Y.geometries[he],re);else if(Se==="Feature")Oe(Y.geometry,re);else if(Se==="Polygon")Qt(Y.coordinates,re);else if(Se==="MultiPolygon")for(he=0;he<Y.coordinates.length;he++)Qt(Y.coordinates[he],re);return Y});let qn=i.dL.prototype.toGeoJSON,Br=class{constructor(Oe){this._feature=Oe,this.extent=i.V,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){let Oe=[];for(let Y of this._feature.geometry)Oe.push([new i.P(Y[0],Y[1])]);return Oe}{let Oe=[];for(let Y of this._feature.geometry){let re=[];for(let he of Y)re.push(new i.P(he[0],he[1]));Oe.push(re)}return Oe}}toGeoJSON(Oe,Y,re){return qn.call(this,Oe,Y,re)}},Ge=class{constructor(Oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.V,this.length=Oe.length,this._features=Oe}feature(Oe){return new Br(this._features[Oe])}};var ci={exports:{}},Uo=i.dN,an=i.dM.VectorTileFeature,Hr=yu;function yu(Oe,Y){this.options=Y||{},this.features=Oe,this.length=Oe.length}function it(Oe,Y){this.id=typeof Oe.id=="number"?Oe.id:void 0,this.type=Oe.type,this.rawGeometry=Oe.type===1?[Oe.geometry]:Oe.geometry,this.properties=Oe.tags,this.extent=Y||4096}yu.prototype.feature=function(Oe){return new it(this.features[Oe],this.options.extent)},it.prototype.loadGeometry=function(){var Oe=this.rawGeometry;this.geometry=[];for(var Y=0;Y<Oe.length;Y++){for(var re=Oe[Y],he=[],Se=0;Se<re.length;Se++)he.push(new Uo(re[Se][0],re[Se][1]));this.geometry.push(he)}return this.geometry},it.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Oe=this.geometry,Y=1/0,re=-1/0,he=1/0,Se=-1/0,ke=0;ke<Oe.length;ke++)for(var $e=Oe[ke],pt=0;pt<$e.length;pt++){var Ae=$e[pt];Y=Math.min(Y,Ae.x),re=Math.max(re,Ae.x),he=Math.min(he,Ae.y),Se=Math.max(Se,Ae.y)}return[Y,he,re,Se]},it.prototype.toGeoJSON=an.prototype.toGeoJSON;var ho=i.dO,_i=Hr;function Xt(Oe){var Y=new ho;return function(re,he){for(var Se in re.layers)he.writeMessage(3,qa,re.layers[Se])}(Oe,Y),Y.finish()}function qa(Oe,Y){var re;Y.writeVarintField(15,Oe.version||1),Y.writeStringField(1,Oe.name||""),Y.writeVarintField(5,Oe.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<Oe.length;re++)he.feature=Oe.feature(re),Y.writeMessage(2,xs,he);var Se=he.keys;for(re=0;re<Se.length;re++)Y.writeStringField(3,Se[re]);var ke=he.values;for(re=0;re<ke.length;re++)Y.writeMessage(4,Jl,ke[re])}function xs(Oe,Y){var re=Oe.feature;re.id!==void 0&&Y.writeVarintField(1,re.id),Y.writeMessage(2,fo,Oe),Y.writeVarintField(3,re.type),Y.writeMessage(4,Wa,re)}function fo(Oe,Y){var re=Oe.feature,he=Oe.keys,Se=Oe.values,ke=Oe.keycache,$e=Oe.valuecache;for(var pt in re.properties){var Ae=re.properties[pt],gt=ke[pt];if(Ae!==null){gt===void 0&&(he.push(pt),ke[pt]=gt=he.length-1),Y.writeVarint(gt);var ct=typeof Ae;ct!=="string"&&ct!=="boolean"&&ct!=="number"&&(Ae=JSON.stringify(Ae));var yt=ct+":"+Ae,Yt=$e[yt];Yt===void 0&&(Se.push(Ae),$e[yt]=Yt=Se.length-1),Y.writeVarint(Yt)}}}function ii(Oe,Y){return(Y<<3)+(7&Oe)}function oa(Oe){return Oe<<1^Oe>>31}function Wa(Oe,Y){for(var re=Oe.loadGeometry(),he=Oe.type,Se=0,ke=0,$e=re.length,pt=0;pt<$e;pt++){var Ae=re[pt],gt=1;he===1&&(gt=Ae.length),Y.writeVarint(ii(1,gt));for(var ct=he===3?Ae.length-1:Ae.length,yt=0;yt<ct;yt++){yt===1&&he!==1&&Y.writeVarint(ii(2,ct-1));var Yt=Ae[yt].x-Se,Fn=Ae[yt].y-ke;Y.writeVarint(oa(Yt)),Y.writeVarint(oa(Fn)),Se+=Yt,ke+=Fn}he===3&&Y.writeVarint(ii(7,1))}}function Jl(Oe,Y){var re=typeof Oe;re==="string"?Y.writeStringField(1,Oe):re==="boolean"?Y.writeBooleanField(7,Oe):re==="number"&&(Oe%1!=0?Y.writeDoubleField(3,Oe):Oe<0?Y.writeSVarintField(6,Oe):Y.writeVarintField(5,Oe))}ci.exports=Xt,ci.exports.fromVectorTileJs=Xt,ci.exports.fromGeojsonVt=function(Oe,Y){Y=Y||{};var re={};for(var he in Oe)re[he]=new _i(Oe[he].features,Y),re[he].name=he,re[he].version=Y.version,re[he].extent=Y.extent;return Xt({layers:re})},ci.exports.GeoJSONWrapper=_i;var Ql=i.dK(ci.exports);let ec={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},sa=Math.fround||($o=new Float32Array(1),Oe=>($o[0]=+Oe,$o[0]));var $o;let oi=3,Ki=5,Bi=6;class vu{constructor(Y){this.options=Object.assign(Object.create(ec),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){let{log:re,minZoom:he,maxZoom:Se}=this.options;re&&console.time("total time");let ke=`prepare ${Y.length} points`;re&&console.time(ke),this.points=Y;let $e=[];for(let Ae=0;Ae<Y.length;Ae++){let gt=Y[Ae];if(!gt.geometry)continue;let[ct,yt]=gt.geometry.coordinates,Yt=sa(aa(ct)),Fn=sa(Go(yt));$e.push(Yt,Fn,1/0,Ae,-1,1),this.options.reduce&&$e.push(0)}let pt=this.trees[Se+1]=this._createTree($e);re&&console.timeEnd(ke);for(let Ae=Se;Ae>=he;Ae--){let gt=+Date.now();pt=this.trees[Ae]=this._createTree(this._cluster(pt,Ae)),re&&console.log("z%d: %d clusters in %dms",Ae,pt.numItems,+Date.now()-gt)}return re&&console.timeEnd("total time"),this}getClusters(Y,re){let he=((Y[0]+180)%360+360)%360-180,Se=Math.max(-90,Math.min(90,Y[1])),ke=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,$e=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)he=-180,ke=180;else if(he>ke){let yt=this.getClusters([he,Se,180,$e],re),Yt=this.getClusters([-180,Se,ke,$e],re);return yt.concat(Yt)}let pt=this.trees[this._limitZoom(re)],Ae=pt.range(aa(he),Go($e),aa(ke),Go(Se)),gt=pt.data,ct=[];for(let yt of Ae){let Yt=this.stride*yt;ct.push(gt[Yt+Ki]>1?_r(gt,Yt,this.clusterProps):this.points[gt[Yt+oi]])}return ct}getChildren(Y){let re=this._getOriginId(Y),he=this._getOriginZoom(Y),Se="No cluster with the specified id.",ke=this.trees[he];if(!ke)throw new Error(Se);let $e=ke.data;if(re*this.stride>=$e.length)throw new Error(Se);let pt=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Ae=ke.within($e[re*this.stride],$e[re*this.stride+1],pt),gt=[];for(let ct of Ae){let yt=ct*this.stride;$e[yt+4]===Y&&gt.push($e[yt+Ki]>1?_r($e,yt,this.clusterProps):this.points[$e[yt+oi]])}if(gt.length===0)throw new Error(Se);return gt}getLeaves(Y,re,he){let Se=[];return this._appendLeaves(Se,Y,re=re||10,he=he||0,0),Se}getTile(Y,re,he){let Se=this.trees[this._limitZoom(Y)],ke=Math.pow(2,Y),{extent:$e,radius:pt}=this.options,Ae=pt/$e,gt=(he-Ae)/ke,ct=(he+1+Ae)/ke,yt={features:[]};return this._addTileFeatures(Se.range((re-Ae)/ke,gt,(re+1+Ae)/ke,ct),Se.data,re,he,ke,yt),re===0&&this._addTileFeatures(Se.range(1-Ae/ke,gt,1,ct),Se.data,ke,he,ke,yt),re===ke-1&&this._addTileFeatures(Se.range(0,gt,Ae/ke,ct),Se.data,-1,he,ke,yt),yt.features.length?yt:null}getClusterExpansionZoom(Y){let re=this._getOriginZoom(Y)-1;for(;re<=this.options.maxZoom;){let he=this.getChildren(Y);if(re++,he.length!==1)break;Y=he[0].properties.cluster_id}return re}_appendLeaves(Y,re,he,Se,ke){let $e=this.getChildren(re);for(let pt of $e){let Ae=pt.properties;if(Ae&&Ae.cluster?ke+Ae.point_count<=Se?ke+=Ae.point_count:ke=this._appendLeaves(Y,Ae.cluster_id,he,Se,ke):ke<Se?ke++:Y.push(pt),Y.length===he)break}return ke}_createTree(Y){let re=new i.bg(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Y.length;he+=this.stride)re.add(Y[he],Y[he+1]);return re.finish(),re.data=Y,re}_addTileFeatures(Y,re,he,Se,ke,$e){for(let pt of Y){let Ae=pt*this.stride,gt=re[Ae+Ki]>1,ct,yt,Yt;if(gt)ct=Ji(re,Ae,this.clusterProps),yt=re[Ae],Yt=re[Ae+1];else{let zn=this.points[re[Ae+oi]];ct=zn.properties;let[Sn,In]=zn.geometry.coordinates;yt=aa(Sn),Yt=Go(In)}let Fn={type:1,geometry:[[Math.round(this.options.extent*(yt*ke-he)),Math.round(this.options.extent*(Yt*ke-Se))]],tags:ct},Qn;Qn=gt||this.options.generateId?re[Ae+oi]:this.points[re[Ae+oi]].id,Qn!==void 0&&(Fn.id=Qn),$e.features.push(Fn)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,re){let{radius:he,extent:Se,reduce:ke,minPoints:$e}=this.options,pt=he/(Se*Math.pow(2,re)),Ae=Y.data,gt=[],ct=this.stride;for(let yt=0;yt<Ae.length;yt+=ct){if(Ae[yt+2]<=re)continue;Ae[yt+2]=re;let Yt=Ae[yt],Fn=Ae[yt+1],Qn=Y.within(Ae[yt],Ae[yt+1],pt),zn=Ae[yt+Ki],Sn=zn;for(let In of Qn){let On=In*ct;Ae[On+2]>re&&(Sn+=Ae[On+Ki])}if(Sn>zn&&Sn>=$e){let In,On=Yt*zn,Wn=Fn*zn,jr=-1,Jn=(yt/ct<<5)+(re+1)+this.points.length;for(let yi of Qn){let ui=yi*ct;if(Ae[ui+2]<=re)continue;Ae[ui+2]=re;let Mi=Ae[ui+Ki];On+=Ae[ui]*Mi,Wn+=Ae[ui+1]*Mi,Ae[ui+4]=Jn,ke&&(In||(In=this._map(Ae,yt,!0),jr=this.clusterProps.length,this.clusterProps.push(In)),ke(In,this._map(Ae,ui)))}Ae[yt+4]=Jn,gt.push(On/Sn,Wn/Sn,1/0,Jn,-1,Sn),ke&&gt.push(jr)}else{for(let In=0;In<ct;In++)gt.push(Ae[yt+In]);if(Sn>1)for(let In of Qn){let On=In*ct;if(!(Ae[On+2]<=re)){Ae[On+2]=re;for(let Wn=0;Wn<ct;Wn++)gt.push(Ae[On+Wn])}}}}return gt}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,re,he){if(Y[re+Ki]>1){let $e=this.clusterProps[Y[re+Bi]];return he?Object.assign({},$e):$e}let Se=this.points[Y[re+oi]].properties,ke=this.options.map(Se);return he&&ke===Se?Object.assign({},ke):ke}}function _r(Oe,Y,re){return{type:"Feature",id:Oe[Y+oi],properties:Ji(Oe,Y,re),geometry:{type:"Point",coordinates:[(he=Oe[Y],360*(he-.5)),Lo(Oe[Y+1])]}};var he}function Ji(Oe,Y,re){let he=Oe[Y+Ki],Se=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,ke=Oe[Y+Bi],$e=ke===-1?{}:Object.assign({},re[ke]);return Object.assign($e,{cluster:!0,cluster_id:Oe[Y+oi],point_count:he,point_count_abbreviated:Se})}function aa(Oe){return Oe/360+.5}function Go(Oe){let Y=Math.sin(Oe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Lo(Oe){let Y=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}var la={exports:{}};la.exports=function(){function Oe(Ce,Pe,He,Je){for(var Ze,tt=Je,nt=He-Pe>>1,Ye=He-Pe,ot=Ce[Pe],Qe=Ce[Pe+1],At=Ce[He],ln=Ce[He+1],bt=Pe+3;bt<He;bt+=3){var Un=Y(Ce[bt],Ce[bt+1],ot,Qe,At,ln);if(Un>tt)Ze=bt,tt=Un;else if(Un===tt){var nr=Math.abs(bt-nt);nr<Ye&&(Ze=bt,Ye=nr)}}tt>Je&&(Ze-Pe>3&&Oe(Ce,Pe,Ze,Je),Ce[Ze+2]=tt,He-Ze>3&&Oe(Ce,Ze,He,Je))}function Y(Ce,Pe,He,Je,Ze,tt){var nt=Ze-He,Ye=tt-Je;if(nt!==0||Ye!==0){var ot=((Ce-He)*nt+(Pe-Je)*Ye)/(nt*nt+Ye*Ye);ot>1?(He=Ze,Je=tt):ot>0&&(He+=nt*ot,Je+=Ye*ot)}return(nt=Ce-He)*nt+(Ye=Pe-Je)*Ye}function re(Ce,Pe,He,Je){var Ze={id:Ce===void 0?null:Ce,type:Pe,geometry:He,tags:Je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(tt){var nt=tt.geometry,Ye=tt.type;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")he(tt,nt);else if(Ye==="Polygon"||Ye==="MultiLineString")for(var ot=0;ot<nt.length;ot++)he(tt,nt[ot]);else if(Ye==="MultiPolygon")for(ot=0;ot<nt.length;ot++)for(var Qe=0;Qe<nt[ot].length;Qe++)he(tt,nt[ot][Qe])}(Ze),Ze}function he(Ce,Pe){for(var He=0;He<Pe.length;He+=3)Ce.minX=Math.min(Ce.minX,Pe[He]),Ce.minY=Math.min(Ce.minY,Pe[He+1]),Ce.maxX=Math.max(Ce.maxX,Pe[He]),Ce.maxY=Math.max(Ce.maxY,Pe[He+1])}function Se(Ce,Pe,He,Je){if(Pe.geometry){var Ze=Pe.geometry.coordinates,tt=Pe.geometry.type,nt=Math.pow(He.tolerance/((1<<He.maxZoom)*He.extent),2),Ye=[],ot=Pe.id;if(He.promoteId?ot=Pe.properties[He.promoteId]:He.generateId&&(ot=Je||0),tt==="Point")ke(Ze,Ye);else if(tt==="MultiPoint")for(var Qe=0;Qe<Ze.length;Qe++)ke(Ze[Qe],Ye);else if(tt==="LineString")$e(Ze,Ye,nt,!1);else if(tt==="MultiLineString"){if(He.lineMetrics){for(Qe=0;Qe<Ze.length;Qe++)$e(Ze[Qe],Ye=[],nt,!1),Ce.push(re(ot,"LineString",Ye,Pe.properties));return}pt(Ze,Ye,nt,!1)}else if(tt==="Polygon")pt(Ze,Ye,nt,!0);else{if(tt!=="MultiPolygon"){if(tt==="GeometryCollection"){for(Qe=0;Qe<Pe.geometry.geometries.length;Qe++)Se(Ce,{id:ot,geometry:Pe.geometry.geometries[Qe],properties:Pe.properties},He,Je);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Qe=0;Qe<Ze.length;Qe++){var At=[];pt(Ze[Qe],At,nt,!0),Ye.push(At)}}Ce.push(re(ot,tt,Ye,Pe.properties))}}function ke(Ce,Pe){Pe.push(Ae(Ce[0])),Pe.push(gt(Ce[1])),Pe.push(0)}function $e(Ce,Pe,He,Je){for(var Ze,tt,nt=0,Ye=0;Ye<Ce.length;Ye++){var ot=Ae(Ce[Ye][0]),Qe=gt(Ce[Ye][1]);Pe.push(ot),Pe.push(Qe),Pe.push(0),Ye>0&&(nt+=Je?(Ze*Qe-ot*tt)/2:Math.sqrt(Math.pow(ot-Ze,2)+Math.pow(Qe-tt,2))),Ze=ot,tt=Qe}var At=Pe.length-3;Pe[2]=1,Oe(Pe,0,At,He),Pe[At+2]=1,Pe.size=Math.abs(nt),Pe.start=0,Pe.end=Pe.size}function pt(Ce,Pe,He,Je){for(var Ze=0;Ze<Ce.length;Ze++){var tt=[];$e(Ce[Ze],tt,He,Je),Pe.push(tt)}}function Ae(Ce){return Ce/360+.5}function gt(Ce){var Pe=Math.sin(Ce*Math.PI/180),He=.5-.25*Math.log((1+Pe)/(1-Pe))/Math.PI;return He<0?0:He>1?1:He}function ct(Ce,Pe,He,Je,Ze,tt,nt,Ye){if(Je/=Pe,tt>=(He/=Pe)&&nt<Je)return Ce;if(nt<He||tt>=Je)return null;for(var ot=[],Qe=0;Qe<Ce.length;Qe++){var At=Ce[Qe],ln=At.geometry,bt=At.type,Un=Ze===0?At.minX:At.minY,nr=Ze===0?At.maxX:At.maxY;if(Un>=He&&nr<Je)ot.push(At);else if(!(nr<He||Un>=Je)){var fr=[];if(bt==="Point"||bt==="MultiPoint")yt(ln,fr,He,Je,Ze);else if(bt==="LineString")Yt(ln,fr,He,Je,Ze,!1,Ye.lineMetrics);else if(bt==="MultiLineString")Qn(ln,fr,He,Je,Ze,!1);else if(bt==="Polygon")Qn(ln,fr,He,Je,Ze,!0);else if(bt==="MultiPolygon")for(var Ar=0;Ar<ln.length;Ar++){var Kr=[];Qn(ln[Ar],Kr,He,Je,Ze,!0),Kr.length&&fr.push(Kr)}if(fr.length){if(Ye.lineMetrics&&bt==="LineString"){for(Ar=0;Ar<fr.length;Ar++)ot.push(re(At.id,bt,fr[Ar],At.tags));continue}bt!=="LineString"&&bt!=="MultiLineString"||(fr.length===1?(bt="LineString",fr=fr[0]):bt="MultiLineString"),bt!=="Point"&&bt!=="MultiPoint"||(bt=fr.length===3?"Point":"MultiPoint"),ot.push(re(At.id,bt,fr,At.tags))}}}return ot.length?ot:null}function yt(Ce,Pe,He,Je,Ze){for(var tt=0;tt<Ce.length;tt+=3){var nt=Ce[tt+Ze];nt>=He&&nt<=Je&&(Pe.push(Ce[tt]),Pe.push(Ce[tt+1]),Pe.push(Ce[tt+2]))}}function Yt(Ce,Pe,He,Je,Ze,tt,nt){for(var Ye,ot,Qe=Fn(Ce),At=Ze===0?Sn:In,ln=Ce.start,bt=0;bt<Ce.length-3;bt+=3){var Un=Ce[bt],nr=Ce[bt+1],fr=Ce[bt+2],Ar=Ce[bt+3],Kr=Ce[bt+4],Tn=Ze===0?Un:nr,ji=Ze===0?Ar:Kr,po=!1;nt&&(Ye=Math.sqrt(Math.pow(Un-Ar,2)+Math.pow(nr-Kr,2))),Tn<He?ji>He&&(ot=At(Qe,Un,nr,Ar,Kr,He),nt&&(Qe.start=ln+Ye*ot)):Tn>Je?ji<Je&&(ot=At(Qe,Un,nr,Ar,Kr,Je),nt&&(Qe.start=ln+Ye*ot)):zn(Qe,Un,nr,fr),ji<He&&Tn>=He&&(ot=At(Qe,Un,nr,Ar,Kr,He),po=!0),ji>Je&&Tn<=Je&&(ot=At(Qe,Un,nr,Ar,Kr,Je),po=!0),!tt&&po&&(nt&&(Qe.end=ln+Ye*ot),Pe.push(Qe),Qe=Fn(Ce)),nt&&(ln+=Ye)}var Jr=Ce.length-3;Un=Ce[Jr],nr=Ce[Jr+1],fr=Ce[Jr+2],(Tn=Ze===0?Un:nr)>=He&&Tn<=Je&&zn(Qe,Un,nr,fr),Jr=Qe.length-3,tt&&Jr>=3&&(Qe[Jr]!==Qe[0]||Qe[Jr+1]!==Qe[1])&&zn(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&Pe.push(Qe)}function Fn(Ce){var Pe=[];return Pe.size=Ce.size,Pe.start=Ce.start,Pe.end=Ce.end,Pe}function Qn(Ce,Pe,He,Je,Ze,tt){for(var nt=0;nt<Ce.length;nt++)Yt(Ce[nt],Pe,He,Je,Ze,tt,!1)}function zn(Ce,Pe,He,Je){Ce.push(Pe),Ce.push(He),Ce.push(Je)}function Sn(Ce,Pe,He,Je,Ze,tt){var nt=(tt-Pe)/(Je-Pe);return Ce.push(tt),Ce.push(He+(Ze-He)*nt),Ce.push(1),nt}function In(Ce,Pe,He,Je,Ze,tt){var nt=(tt-He)/(Ze-He);return Ce.push(Pe+(Je-Pe)*nt),Ce.push(tt),Ce.push(1),nt}function On(Ce,Pe){for(var He=[],Je=0;Je<Ce.length;Je++){var Ze,tt=Ce[Je],nt=tt.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Ze=Wn(tt.geometry,Pe);else if(nt==="MultiLineString"||nt==="Polygon"){Ze=[];for(var Ye=0;Ye<tt.geometry.length;Ye++)Ze.push(Wn(tt.geometry[Ye],Pe))}else if(nt==="MultiPolygon")for(Ze=[],Ye=0;Ye<tt.geometry.length;Ye++){for(var ot=[],Qe=0;Qe<tt.geometry[Ye].length;Qe++)ot.push(Wn(tt.geometry[Ye][Qe],Pe));Ze.push(ot)}He.push(re(tt.id,nt,Ze,tt.tags))}return He}function Wn(Ce,Pe){var He=[];He.size=Ce.size,Ce.start!==void 0&&(He.start=Ce.start,He.end=Ce.end);for(var Je=0;Je<Ce.length;Je+=3)He.push(Ce[Je]+Pe,Ce[Je+1],Ce[Je+2]);return He}function jr(Ce,Pe){if(Ce.transformed)return Ce;var He,Je,Ze,tt=1<<Ce.z,nt=Ce.x,Ye=Ce.y;for(He=0;He<Ce.features.length;He++){var ot=Ce.features[He],Qe=ot.geometry,At=ot.type;if(ot.geometry=[],At===1)for(Je=0;Je<Qe.length;Je+=2)ot.geometry.push(Jn(Qe[Je],Qe[Je+1],Pe,tt,nt,Ye));else for(Je=0;Je<Qe.length;Je++){var ln=[];for(Ze=0;Ze<Qe[Je].length;Ze+=2)ln.push(Jn(Qe[Je][Ze],Qe[Je][Ze+1],Pe,tt,nt,Ye));ot.geometry.push(ln)}}return Ce.transformed=!0,Ce}function Jn(Ce,Pe,He,Je,Ze,tt){return[Math.round(He*(Ce*Je-Ze)),Math.round(He*(Pe*Je-tt))]}function yi(Ce,Pe,He,Je,Ze){for(var tt=Pe===Ze.maxZoom?0:Ze.tolerance/((1<<Pe)*Ze.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:He,y:Je,z:Pe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ye=0;Ye<Ce.length;Ye++){nt.numFeatures++,ui(nt,Ce[Ye],tt,Ze);var ot=Ce[Ye].minX,Qe=Ce[Ye].minY,At=Ce[Ye].maxX,ln=Ce[Ye].maxY;ot<nt.minX&&(nt.minX=ot),Qe<nt.minY&&(nt.minY=Qe),At>nt.maxX&&(nt.maxX=At),ln>nt.maxY&&(nt.maxY=ln)}return nt}function ui(Ce,Pe,He,Je){var Ze=Pe.geometry,tt=Pe.type,nt=[];if(tt==="Point"||tt==="MultiPoint")for(var Ye=0;Ye<Ze.length;Ye+=3)nt.push(Ze[Ye]),nt.push(Ze[Ye+1]),Ce.numPoints++,Ce.numSimplified++;else if(tt==="LineString")Mi(nt,Ze,Ce,He,!1,!1);else if(tt==="MultiLineString"||tt==="Polygon")for(Ye=0;Ye<Ze.length;Ye++)Mi(nt,Ze[Ye],Ce,He,tt==="Polygon",Ye===0);else if(tt==="MultiPolygon")for(var ot=0;ot<Ze.length;ot++){var Qe=Ze[ot];for(Ye=0;Ye<Qe.length;Ye++)Mi(nt,Qe[Ye],Ce,He,!0,Ye===0)}if(nt.length){var At=Pe.tags||null;if(tt==="LineString"&&Je.lineMetrics){for(var ln in At={},Pe.tags)At[ln]=Pe.tags[ln];At.mapbox_clip_start=Ze.start/Ze.size,At.mapbox_clip_end=Ze.end/Ze.size}var bt={geometry:nt,type:tt==="Polygon"||tt==="MultiPolygon"?3:tt==="LineString"||tt==="MultiLineString"?2:1,tags:At};Pe.id!==null&&(bt.id=Pe.id),Ce.features.push(bt)}}function Mi(Ce,Pe,He,Je,Ze,tt){var nt=Je*Je;if(Je>0&&Pe.size<(Ze?nt:Je))He.numPoints+=Pe.length/3;else{for(var Ye=[],ot=0;ot<Pe.length;ot+=3)(Je===0||Pe[ot+2]>nt)&&(He.numSimplified++,Ye.push(Pe[ot]),Ye.push(Pe[ot+1])),He.numPoints++;Ze&&function(Qe,At){for(var ln=0,bt=0,Un=Qe.length,nr=Un-2;bt<Un;nr=bt,bt+=2)ln+=(Qe[bt]-Qe[nr])*(Qe[bt+1]+Qe[nr+1]);if(ln>0===At)for(bt=0,Un=Qe.length;bt<Un/2;bt+=2){var fr=Qe[bt],Ar=Qe[bt+1];Qe[bt]=Qe[Un-2-bt],Qe[bt+1]=Qe[Un-1-bt],Qe[Un-2-bt]=fr,Qe[Un-1-bt]=Ar}}(Ye,tt),Ce.push(Ye)}}function Sr(Ce,Pe){var He=(Pe=this.options=function(Ze,tt){for(var nt in tt)Ze[nt]=tt[nt];return Ze}(Object.create(this.options),Pe)).debug;if(He&&console.time("preprocess data"),Pe.maxZoom<0||Pe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Pe.promoteId&&Pe.generateId)throw new Error("promoteId and generateId cannot be used together.");var Je=function(Ze,tt){var nt=[];if(Ze.type==="FeatureCollection")for(var Ye=0;Ye<Ze.features.length;Ye++)Se(nt,Ze.features[Ye],tt,Ye);else Se(nt,Ze.type==="Feature"?Ze:{geometry:Ze},tt);return nt}(Ce,Pe);this.tiles={},this.tileCoords=[],He&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Pe.indexMaxZoom,Pe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Je=function(Ze,tt){var nt=tt.buffer/tt.extent,Ye=Ze,ot=ct(Ze,1,-1-nt,nt,0,-1,2,tt),Qe=ct(Ze,1,1-nt,2+nt,0,-1,2,tt);return(ot||Qe)&&(Ye=ct(Ze,1,-nt,1+nt,0,-1,2,tt)||[],ot&&(Ye=On(ot,1).concat(Ye)),Qe&&(Ye=Ye.concat(On(Qe,-1)))),Ye}(Je,Pe)).length&&this.splitTile(Je,0,0,0),He&&(Je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Dr(Ce,Pe,He){return 32*((1<<Ce)*He+Pe)+Ce}return Sr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sr.prototype.splitTile=function(Ce,Pe,He,Je,Ze,tt,nt){for(var Ye=[Ce,Pe,He,Je],ot=this.options,Qe=ot.debug;Ye.length;){Je=Ye.pop(),He=Ye.pop(),Pe=Ye.pop(),Ce=Ye.pop();var At=1<<Pe,ln=Dr(Pe,He,Je),bt=this.tiles[ln];if(!bt&&(Qe>1&&console.time("creation"),bt=this.tiles[ln]=yi(Ce,Pe,He,Je,ot),this.tileCoords.push({z:Pe,x:He,y:Je}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Pe,He,Je,bt.numFeatures,bt.numPoints,bt.numSimplified),console.timeEnd("creation"));var Un="z"+Pe;this.stats[Un]=(this.stats[Un]||0)+1,this.total++}if(bt.source=Ce,Ze){if(Pe===ot.maxZoom||Pe===Ze)continue;var nr=1<<Ze-Pe;if(He!==Math.floor(tt/nr)||Je!==Math.floor(nt/nr))continue}else if(Pe===ot.indexMaxZoom||bt.numPoints<=ot.indexMaxPoints)continue;if(bt.source=null,Ce.length!==0){Qe>1&&console.time("clipping");var fr,Ar,Kr,Tn,ji,po,Jr=.5*ot.buffer/ot.extent,tc=.5-Jr,ws=.5+Jr,Ya=1+Jr;fr=Ar=Kr=Tn=null,ji=ct(Ce,At,He-Jr,He+ws,0,bt.minX,bt.maxX,ot),po=ct(Ce,At,He+tc,He+Ya,0,bt.minX,bt.maxX,ot),Ce=null,ji&&(fr=ct(ji,At,Je-Jr,Je+ws,1,bt.minY,bt.maxY,ot),Ar=ct(ji,At,Je+tc,Je+Ya,1,bt.minY,bt.maxY,ot),ji=null),po&&(Kr=ct(po,At,Je-Jr,Je+ws,1,bt.minY,bt.maxY,ot),Tn=ct(po,At,Je+tc,Je+Ya,1,bt.minY,bt.maxY,ot),po=null),Qe>1&&console.timeEnd("clipping"),Ye.push(fr||[],Pe+1,2*He,2*Je),Ye.push(Ar||[],Pe+1,2*He,2*Je+1),Ye.push(Kr||[],Pe+1,2*He+1,2*Je),Ye.push(Tn||[],Pe+1,2*He+1,2*Je+1)}}},Sr.prototype.getTile=function(Ce,Pe,He){var Je=this.options,Ze=Je.extent,tt=Je.debug;if(Ce<0||Ce>24)return null;var nt=1<<Ce,Ye=Dr(Ce,Pe=(Pe%nt+nt)%nt,He);if(this.tiles[Ye])return jr(this.tiles[Ye],Ze);tt>1&&console.log("drilling down to z%d-%d-%d",Ce,Pe,He);for(var ot,Qe=Ce,At=Pe,ln=He;!ot&&Qe>0;)Qe--,At=Math.floor(At/2),ln=Math.floor(ln/2),ot=this.tiles[Dr(Qe,At,ln)];return ot&&ot.source?(tt>1&&console.log("found parent tile z%d-%d-%d",Qe,At,ln),tt>1&&console.time("drilling down"),this.splitTile(ot.source,Qe,At,ln,Ce,Pe,He),tt>1&&console.timeEnd("drilling down"),this.tiles[Ye]?jr(this.tiles[Ye],Ze):null):null},function(Ce,Pe){return new Sr(Ce,Pe)}}();var Ir=i.dK(la.exports);function Za(Oe,Y){let re=Oe.tileID.canonical;if(!this._geoJSONIndex)return Y(null,null);let he=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!he)return Y(null,null);let Se=new Ge(he.features),ke=Ql(Se);ke.byteOffset===0&&ke.byteLength===ke.buffer.byteLength||(ke=new Uint8Array(ke)),Y(null,{vectorTile:Se,rawData:ke.buffer})}class Xa extends Wt{constructor(Y,re,he,Se,ke,$e){super(Y,re,he,Se,Za,$e),ke&&(this.loadGeoJSON=ke)}loadData(Y,re){let he=Y&&Y.request,Se=he&&he.collectResourceTiming;this.loadGeoJSON(Y,(ke,$e)=>{if(ke||!$e)return re(ke);if(typeof $e!="object")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{gr($e,!0);try{if(Y.filter){let Ae=i.r(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(ct=>`${ct.key}: ${ct.message}`).join(", "));$e={type:"FeatureCollection",features:$e.features.filter(ct=>Ae.value.evaluate({zoom:0},ct))}}this._geoJSONIndex=Y.cluster?new vu(function({superclusterOptions:Ae,clusterProperties:gt}){if(!gt||!Ae)return Ae;let ct={},yt={},Yt={accumulated:null,zoom:0},Fn={properties:null},Qn=Object.keys(gt);for(let zn of Qn){let[Sn,In]=gt[zn],On=i.r(In),Wn=i.r(typeof Sn=="string"?[Sn,["accumulated"],["get",zn]]:Sn);ct[zn]=On.value,yt[zn]=Wn.value}return Ae.map=zn=>{Fn.properties=zn;let Sn={};for(let In of Qn)Sn[In]=ct[In].evaluate(Yt,Fn);return Sn},Ae.reduce=(zn,Sn)=>{Fn.properties=Sn;for(let In of Qn)Yt.accumulated=zn[In],zn[In]=yt[In].evaluate(Yt,Fn)},Ae}(Y)).load($e.features):Ir($e,Y.geojsonVtOptions)}catch(Ae){return re(Ae)}this.loaded={};let pt={};if(Se){let Ae=C(he);Ae&&(pt.resourceTiming={},pt.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ae)))}re(null,pt)}})}reloadTile(Y,re){let he=this.loaded;return he&&he[Y.uid]?super.reloadTile(Y,re):this.loadTile(Y,re)}loadGeoJSON(Y,re){if(Y.request)i.g(Y.request,re);else{if(typeof Y.data!="string")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(Y.data))}catch{return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(he){re(he)}}getClusterChildren(Y,re){try{re(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(he){re(he)}}getClusterLeaves(Y,re){try{re(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(he){re(he)}}}class Qi{constructor(Y,re){this.tileID=new i.am(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=re}parse(Y,re,he,Se){this.status="parsing";let ke=new i.am(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),$e={},pt=re.familiesBySource[he.source],Ae=new i.dC(ke,he.promoteId);return Ae.bucketLayerIDs=[],Ae.is3DTile=!0,i.dP(Y).then(gt=>{if(!gt)return Se(new Error("Could not parse tile"));let ct=i.dQ(gt,1/i.bR(he.tileID.canonical)),yt=gt.json.extensionsUsed&&gt.json.extensionsUsed.includes("MAPBOX_mesh_features")||gt.json.asset.extras&&gt.json.asset.extras.MAPBOX_mesh_features,Yt=gt.json.extensionsUsed&&gt.json.extensionsUsed.includes("EXT_meshopt_compression"),Fn=new i.K(this.zoom,{brightness:this.brightness});for(let Qn in pt)for(let zn of pt[Qn]){let Sn=zn[0];Ae.bucketLayerIDs.push(zn.map(On=>On.id)),Sn.recalculate(Fn,[]);let In=new i.dR(ct,ke,yt,Yt,this.brightness,Ae);yt||(In.needsUpload=!0),$e[Sn.fqid]=In,In.evaluate(Sn)}this.status="done",Se(null,{buckets:$e,featureIndex:Ae})}).catch(gt=>Se(new Error(gt.message)))}}class Ho{constructor(Y,re,he,Se,ke,$e){this.actor=Y,this.layerIndex=re,this.brightness=$e,this.loading={},this.loaded={}}loadTile(Y,re){let he=Y.uid,Se=this.loading[he]=new Qi(Y,this.brightness);i.a_(Y.request,(ke,$e)=>{let pt=!this.loading[he];return delete this.loading[he],pt||ke?(Se.status="done",pt||(this.loaded[he]=Se),re(ke)):$e&&$e.byteLength!==0?void Se.parse($e,this.layerIndex,Y,(Ae,gt)=>{Se.status="done",this.loaded=this.loaded||{},this.loaded[he]=Se,Ae||!gt?re(Ae):re(null,gt)}):(Se.status="done",this.loaded[he]=Se,re())})}reloadTile(Y,re){let he=this.loaded,Se=Y.uid;if(he&&he[Se]){let ke=he[Se];ke.projection=Y.projection,ke.brightness=Y.brightness;let $e=(pt,Ae)=>{ke.reloadCallback&&(delete ke.reloadCallback,this.loadTile(Y,re)),re(pt,Ae)};ke.status==="parsing"?ke.reloadCallback=$e:ke.status==="done"&&this.loadTile(Y,re)}}abortTile(Y,re){let he=Y.uid;this.loading[he]&&delete this.loading[he],re()}removeTile(Y,re){let he=this.loaded,Se=Y.uid;he&&he[Se]&&delete he[Se],re()}}class bs{constructor(Y){this.self=Y,this.actor=new i.dS(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.bo({name:"mercator"}),this.workerSourceTypes={vector:Wt,geojson:Xa,"batched-model":Ho},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,he)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=he},this.self.registerRTLTextPlugin=re=>{if(i.dT.isParsed())throw new Error("RTL text plugin already registered.");i.dT.applyArabicShaping=re.applyArabicShaping,i.dT.processBidirectionalText=re.processBidirectionalText,i.dT.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(Y,re,he){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,he()}checkIfReady(Y,re,he){he()}setReferrer(Y,re){this.referrer=re}spriteLoaded(Y,{scope:re,isLoaded:he}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][re]=he,this.workerSources[Y]&&this.workerSources[Y][re])for(let Se in this.workerSources[Y][re]){let ke=this.workerSources[Y][re][Se];for(let $e in ke)ke[$e]instanceof Wt&&(ke[$e].isSpriteLoaded=he,ke[$e].fire(new i.b("isSpriteLoaded")))}}setImages(Y,{scope:re,images:he},Se){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][re]=he,this.workerSources[Y]&&this.workerSources[Y][re]){for(let ke in this.workerSources[Y][re]){let $e=this.workerSources[Y][re][ke];for(let pt in $e)$e[pt].availableImages=he}Se()}else Se()}setProjection(Y,re){this.projections[Y]=i.bo(re)}setBrightness(Y,re,he){this.brightness=re,he()}setLayers(Y,re,he){this.getLayerIndex(Y,re.scope).replace(re.layers,re.options),he()}updateLayers(Y,re,he){this.getLayerIndex(Y,re.scope).update(re.layers,re.removedIds,re.options),he()}loadTile(Y,re,he){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).loadTile(re,he)}loadDEMTile(Y,re,he){this.getDEMWorkerSource(Y,re.source,re.scope).loadTile(re,he)}decodeRasterArray(Y,re,he){this.getRasterArrayWorkerSource().decodeRasterArray(re,he)}reloadTile(Y,re,he){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).reloadTile(re,he)}abortTile(Y,re,he){this.getWorkerSource(Y,re.type,re.source,re.scope).abortTile(re,he)}removeTile(Y,re,he){this.getWorkerSource(Y,re.type,re.source,re.scope).removeTile(re,he)}removeSource(Y,re,he){if(!(this.workerSources[Y]&&this.workerSources[Y][re.scope]&&this.workerSources[Y][re.scope][re.type]&&this.workerSources[Y][re.scope][re.type][re.source]))return;let Se=this.workerSources[Y][re.scope][re.type][re.source];delete this.workerSources[Y][re.scope][re.type][re.source],Se.removeSource!==void 0?Se.removeSource(re,he):he()}loadWorkerSource(Y,re,he){try{this.self.importScripts(re.url),he()}catch(Se){he(Se.toString())}}syncRTLPluginState(Y,re,he){try{i.dT.setState(re);let Se=i.dT.getPluginURL();if(i.dT.isLoaded()&&!i.dT.isParsed()&&Se!=null){this.self.importScripts(Se);let ke=i.dT.isParsed();he(ke?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Se}`),ke)}}catch(Se){he(Se.toString())}}setDracoUrl(Y,re){this.dracoUrl=re}getAvailableImages(Y,re){this.availableImages[Y]||(this.availableImages[Y]={});let he=this.availableImages[Y][re];return he||(he=[]),he}getLayerIndex(Y,re){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let he=this.layerIndexes[Y][re];return he||(he=this.layerIndexes[Y][re]=new Z,he.scope=re),he}getWorkerSource(Y,re,he,Se){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][Se]||(this.workerSources[Y][Se]={}),this.workerSources[Y][Se][re]||(this.workerSources[Y][Se][re]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),!this.workerSources[Y][Se][re][he]){let ke={send:($e,pt,Ae,gt,ct,yt)=>{this.actor.send($e,pt,Ae,Y,ct,yt)},scheduler:this.actor.scheduler};this.workerSources[Y][Se][re][he]=new this.workerSourceTypes[re](ke,this.getLayerIndex(Y,Se),this.getAvailableImages(Y,Se),this.isSpriteLoaded[Y][Se],void 0,this.brightness)}return this.workerSources[Y][Se][re][he]}getDEMWorkerSource(Y,re,he){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][he]||(this.demWorkerSources[Y][he]={}),this.demWorkerSources[Y][he][re]||(this.demWorkerSources[Y][he][re]=new Pn),this.demWorkerSources[Y][he][re]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Zt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,re){i.dU(re)}getWorkerPerformanceMetrics(Y,re,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bs(self)),bs}),p(["./shared"],function(i){"use strict";function C(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let a=0;a<h.length;a++)if(!C(h[a],r[a]))return!1;return!0}if(typeof h=="object"&&h!==null&&r!==null){if(typeof r!="object"||Object.keys(h).length!==Object.keys(r).length)return!1;for(let a in h)if(!C(h[a],r[a]))return!1;return!0}return h===r}var O=j;function j(h){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,g,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{g=new Worker(w),d=!0}catch{d=!1}return g&&g.terminate(),URL.revokeObjectURL(w),d}()?function(){var d=document.createElement("canvas");d.width=d.height=1;var g=d.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===d.width}()?(Z[a=r&&r.failIfMajorPerformanceCaveat]===void 0&&(Z[a]=function(d){var g,v=function(w){var E=document.createElement("canvas"),D=Object.create(j.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=w,E.getContext("webgl2",D)}(d);if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),v.getShaderParameter(g,v.COMPILE_STATUS)===!0)}(a)),Z[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(h)}var Z={};function se(h,r,a){let d=document.createElement(h);return r!=null&&(d.className=r),a&&a.appendChild(d),d}function ve(h,r,a){let d=document.createElementNS("http://www.w3.org/2000/svg",h);for(let g of Object.keys(r))d.setAttributeNS(null,g,String(r[g]));return a&&a.appendChild(d),d}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ze=typeof document<"u"?document.documentElement&&document.documentElement.style:null,at=ze&&ze.userSelect!==void 0?"userSelect":"WebkitUserSelect",Wt;function Pn(){ze&&at&&(Wt=ze[at],ze[at]="none")}function Zt(){ze&&at&&(ze[at]=Wt)}function Qt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Qt,!0)}function Tr(){window.addEventListener("click",Qt,!0),window.setTimeout(()=>{window.removeEventListener("click",Qt,!0)},0)}function gr(h,r){let a=h.getBoundingClientRect();return Ge(h,a,r)}function qn(h,r){let a=h.getBoundingClientRect(),d=[];for(let g=0;g<r.length;g++)d.push(Ge(h,a,r[g]));return d}function Br(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Ge(h,r,a){let d=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new i.P((a.clientX-r.left)*d,(a.clientY-r.top)*d)}class ci{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,a){this._updatedSourceCaches[r]=a,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){let a=r.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(r.id),this.setDirty()}removeLayer(r){let a=r.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][r.id]=r,this._updatedLayers[a].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){let r={};for(let a in this._updatedLayers)r[a]=r[a]||{},r[a].updatedIds=Array.from(this._updatedLayers[a].values());for(let a in this._removedLayers)r[a]=r[a]||{},r[a].removedIds=Object.keys(this._removedLayers[a]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Uo extends i.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,a){return i.l(this.requestManager.transformRequest(a,i.R.Model).url).then(d=>{if(!d)return;let g=i.c(d),v=new i.M(r,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(d=>{this.fire(new i.a(new Error(`Could not load model ${r} from ${a}: ${d.message}`)))})}load(r,a){this.models[a]||(this.models[a]={});let d=Object.keys(r);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+d.length;let g=[];for(let v of d)g.push(this.loadModel(v,r[v]));Promise.allSettled(g).then(v=>{for(let w=0;w<v.length;w++){let{status:E,value:D}=v[w];E==="fulfilled"&&D&&(this.models[a][d[w]]=D)}this.numModelsLoading[a]-=d.length,this.fire(new i.b("data",{dataType:"style"}))}).catch(v=>{this.fire(new i.a(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,a){return!!this.getModel(r,a)}getModel(r,a){return this.models[a]||(this.models[a]={}),this.models[a][r]}addModel(r,a,d){this.models[d]||(this.models[d]={}),this.hasModel(r,d)&&this.removeModel(r,d),this.load({[r]:this.requestManager.normalizeModelURL(a)},d)}addModels(r,a){let d={};for(let g in r)d[g]=this.requestManager.normalizeModelURL(r[g]);this.load(d,a)}removeModel(r,a){this.models[a]||(this.models[a]={});let d=this.models[a][r];delete this.models[a][r],d.destroy()}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,a){this.models[a]||(this.models[a]={});for(let d in this.models[a])this.models[a][d].upload(r.context)}}class an{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,d){let g=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},i.e(this.stateChanges[r][g],d),this.deletedStates[r]===null){this.deletedStates[r]={};for(let v in this.state[r])v!==g&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(let v in this.state[r][g])d[v]||(this.deletedStates[r][g][v]=null)}else for(let v in d)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][v]===null&&delete this.deletedStates[r][g][v]}removeFeatureState(r,a,d){if(this.deletedStates[r]===null)return;let g=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},d&&a!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][d]=null);else if(a!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(d in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][d]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,a){let d=String(a),g=i.e({},(this.state[r]||{})[d],(this.stateChanges[r]||{})[d]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){let v=this.deletedStates[r][a];if(v===null)return{};for(let w in v)delete g[w]}return g}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){let d={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let v={};for(let w in this.stateChanges[g])this.state[g][w]||(this.state[g][w]={}),i.e(this.state[g][w],this.stateChanges[g][w]),v[w]=this.state[g][w];d[g]=v}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let v={};if(this.deletedStates[g]===null)for(let w in this.state[g])v[w]={},this.state[g][w]={};else for(let w in this.deletedStates[g]){if(this.deletedStates[g][w]===null)this.state[g][w]={};else if(this.state[g][w])for(let E of Object.keys(this.deletedStates[g][w]))delete this.state[g][w][E];v[w]=this.state[g][w]}d[g]=d[g]||{},i.e(d[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(let g in r)r[g].setFeatureState(d,a)}}function Hr(h){let{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class yu extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new i.h({width:1,height:1})}isLoaded(){for(let r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,a){if(this.loaded[a]!==r&&(this.loaded[a]=r,r)){for(let{ids:d,callback:g}of this.requestors)this._notify(d,a,g);this.requestors=[]}}hasImage(r,a){return!!this.getImage(r,a)}getImage(r,a){return this.images[a][r]}addImage(r,a,d){this._validate(r,d)&&(this.images[a][r]=d)}_validate(r,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new i.a(new Error(`Image "${r}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new i.a(new Error(`Image "${r}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new i.a(new Error(`Image "${r}" has invalid "content" value`))),d=!1),d}_validateStretch(r,a){if(!r)return!0;let d=0;for(let g of r){if(g[0]<d||g[1]<g[0]||a<g[1])return!1;d=g[1]}return!0}_validateContent(r,a){return!(r&&(r.length!==4||r[0]<0||a.data.width<r[0]||r[1]<0||a.data.height<r[1]||r[2]<0||a.data.width<r[2]||r[3]<0||a.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,a,d){d.version=this.images[a][r].version+1,this.images[a][r]=d,this.updatedImages[a][r]=!0}removeImage(r,a){let d=this.images[a][r];delete this.images[a][r],delete this.patterns[a][r],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,a,d){let g=!0,v=!!this.loaded[a];if(!v)for(let w of r)this.images[a][w]||(g=!1);v||g?this._notify(r,a,d):this.requestors.push({ids:r,scope:a,callback:d})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,a,d){let g={};for(let v of r){this.images[a][v]||this.fire(new i.b("styleimagemissing",{id:v}));let w=this.images[a][v];w?g[v]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:i.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,g)}getPixelSize(r){let{width:a,height:d}=this.atlasImage[r];return{width:a,height:d}}getPattern(r,a){let d=this.patterns[a][r],g=this.getImage(r,a);if(!g)return null;if(d&&d.position.version===g.version)return d.position;if(d)d.position.version=g.version;else{let v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},w=new i.I(v,g);this.patterns[a][r]={bin:v,position:w}}return this._updatePatternAtlas(a),this.patterns[a][r].position}bind(r,a){let d=r.gl,g=this.atlasTexture[a];g?this.dirty&&(g.update(this.atlasImage[a]),this.dirty=!1):(g=new i.T(r,this.atlasImage[a],d.RGBA),this.atlasTexture[a]=g),g.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(r){let a=[];for(let w in this.patterns[r])a.push(this.patterns[r][w].bin);let{w:d,h:g}=i.p(a),v=this.atlasImage[r];v.resize({width:d||1,height:g||1});for(let w in this.patterns[r]){let{bin:E}=this.patterns[r][w],D=E.x+1,S=E.y+1,A=this.images[r][w].data,R=A.width,k=A.height;i.h.copy(A,v,{x:0,y:0},{x:D,y:S},{width:R,height:k}),i.h.copy(A,v,{x:0,y:k-1},{x:D,y:S-1},{width:R,height:1}),i.h.copy(A,v,{x:0,y:0},{x:D,y:S+k},{width:R,height:1}),i.h.copy(A,v,{x:R-1,y:0},{x:D-1,y:S},{width:1,height:k}),i.h.copy(A,v,{x:0,y:0},{x:D+R,y:S},{width:1,height:k})}this.dirty=!0}beginFrame(){for(let r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,a){for(let d of r){if(this.callbackDispatchedThisFrame[a][d])continue;this.callbackDispatchedThisFrame[a][d]=!0;let g=this.images[a][d];Hr(g)&&this.updateImage(d,a,g)}}}class it{constructor(r,a,d,g){this.message=(r?`${r}: `:"")+d,g&&(this.identifier=g),a!=null&&a.__line__&&(this.line=a.__line__)}}class ho extends it{}function _i(h){let r=h.key,a=h.value,d=h.valueSpec||{},g=h.objectElementValidators||{},v=h.style,w=h.styleSpec,E=[],D=i.i(a);if(D!=="object")return[new it(r,a,`object expected, ${D} found`)];for(let S in a){let A=S.split(".")[0],R;g[A]?R=g[A]:d[A]?R=Ir:g["*"]?R=g["*"]:d["*"]&&(R=Ir),R?E=E.concat(R({key:(r&&`${r}.`)+S,value:a[S],valueSpec:d[A]||d["*"],style:v,styleSpec:w,object:a,objectKey:S},a)):E.push(new ho(r,a[S],`unknown property "${S}"`))}for(let S in d)g[S]||d[S].required&&d[S].default===void 0&&a[S]===void 0&&E.push(new it(r,a,`missing required property "${S}"`));return E}function Xt(h){let r=h.value,a=h.valueSpec,d=h.style,g=h.styleSpec,v=h.key,w=h.arrayElementValidator||Ir;if(i.i(r)!=="array")return[new it(v,r,`array expected, ${i.i(r)} found`)];if(a.length&&r.length!==a.length)return[new it(v,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new it(v,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let E={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(E.function=a.function),i.i(a.value)==="object"&&(E=a.value);let D=[];for(let S=0;S<r.length;S++)D=D.concat(w({array:r,arrayIndex:S,value:r[S],valueSpec:E,style:d,styleSpec:g,key:`${v}[${S}]`},!0));return D}function qa(h){let r=h.key,a=h.value,d=h.valueSpec,g=i.i(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new it(r,a,`number expected, ${g} found`)];if("minimum"in d){let v=d.minimum;if(i.i(d.minimum)==="array"&&(v=d.minimum[h.arrayIndex]),a<v)return[new it(r,a,`${a} is less than the minimum value ${v}`)]}if("maximum"in d){let v=d.maximum;if(i.i(d.maximum)==="array"&&(v=d.maximum[h.arrayIndex]),a>v)return[new it(r,a,`${a} is greater than the maximum value ${v}`)]}return[]}function xs(h){let r=h.valueSpec,a=i.u(h.value.type),d,g,v,w={},E=a!=="categorical"&&h.value.property===void 0,D=!E,S=i.i(h.value.stops)==="array"&&i.i(h.value.stops[0])==="array"&&i.i(h.value.stops[0][0])==="object",A=_i({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(F){if(a==="identity")return[new it(F.key,F.value,'identity function may not have a "stops" property')];let $=[],U=F.value;return $=$.concat(Xt({key:F.key,value:U,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:R})),i.i(U)==="array"&&U.length===0&&$.push(new it(F.key,U,"array must have at least one stop")),$},default:function(F){return Ir({key:F.key,value:F.value,valueSpec:r,style:F.style,styleSpec:F.styleSpec})}}});return a==="identity"&&E&&A.push(new it(h.key,h.value,'missing required property "property"')),a==="identity"||h.value.stops||A.push(new it(h.key,h.value,'missing required property "stops"')),a==="exponential"&&h.valueSpec.expression&&!i.s(h.valueSpec)&&A.push(new it(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(D&&!i.k(h.valueSpec)?A.push(new it(h.key,h.value,"property functions not supported")):E&&!i.m(h.valueSpec)&&A.push(new it(h.key,h.value,"zoom functions not supported"))),a!=="categorical"&&!S||h.value.property!==void 0||A.push(new it(h.key,h.value,'"property" property is required')),A;function R(F){let $=[],U=F.value,G=F.key;if(i.i(U)!=="array")return[new it(G,U,`array expected, ${i.i(U)} found`)];if(U.length!==2)return[new it(G,U,`array length 2 expected, length ${U.length} found`)];if(S){if(i.i(U[0])!=="object")return[new it(G,U,`object expected, ${i.i(U[0])} found`)];if(U[0].zoom===void 0)return[new it(G,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new it(G,U,"object stop key must have value")];let B=i.u(U[0].zoom);if(typeof B!="number")return[new it(G,U[0].zoom,"stop zoom values must be numbers")];if(v&&v>B)return[new it(G,U[0].zoom,"stop zoom values must appear in ascending order")];B!==v&&(v=B,g=void 0,w={}),$=$.concat(_i({key:`${G}[0]`,value:U[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:qa,value:k}}))}else $=$.concat(k({key:`${G}[0]`,value:U[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},U));return i.n(i.o(U[1]))?$.concat([new it(`${G}[1]`,U[1],"expressions are not allowed in function stops.")]):$.concat(Ir({key:`${G}[1]`,value:U[1],valueSpec:r,style:F.style,styleSpec:F.styleSpec}))}function k(F,$){let U=i.i(F.value),G=i.u(F.value),B=F.value!==null?F.value:$;if(d){if(U!==d)return[new it(F.key,B,`${U} stop domain type must match previous stop domain type ${d}`)]}else d=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new it(F.key,B,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&a!=="categorical"){let q=`number expected, ${U} found`;return i.k(r)&&a===void 0&&(q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(F.key,B,q)]}return a!=="categorical"||U!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?a!=="categorical"&&U==="number"&&typeof G=="number"&&typeof g=="number"&&g!==void 0&&G<g?[new it(F.key,B,"stop domain values must appear in ascending order")]:(g=G,a==="categorical"&&G in w?[new it(F.key,B,"stop domain values must be unique")]:(w[G]=!0,[])):[new it(F.key,B,`integer expected, found ${String(G)}`)]}}function fo(h){let r=(h.expressionContext==="property"?i.q:i.r)(i.o(h.value),h.valueSpec);if(r.result==="error")return r.value.map(d=>new it(`${h.key}${d.key}`,h.value,d.message));let a=r.value.expression||r.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new it(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!i.t(a))return[new it(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return ii(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!i.v(a,["zoom","feature-state"]))return[new it(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!i.x(a))return[new it(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ii(h,r){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(let g of r.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];let d=[];return h instanceof i.C&&a.has(h.name)?[new it(r.key,r.value,`["${h.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(h.eachChild(g=>{d.push(...ii(g,r))}),d)}function oa(h){let r=h.key,a=h.value,d=h.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(i.u(a))===-1&&g.push(new it(r,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(i.u(a))===-1&&g.push(new it(r,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Wa(h){return i.z(i.o(h.value))?fo(i.j({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Jl(h)}function Jl(h){let r=h.value,a=h.key;if(i.i(r)!=="array")return[new it(a,r,`array expected, ${i.i(r)} found`)];let d=h.styleSpec,g,v=[];if(r.length<1)return[new it(a,r,"filter array must have at least 1 element")];switch(v=v.concat(oa({key:`${a}[0]`,value:r[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),i.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&i.u(r[1])==="$type"&&v.push(new it(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new it(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=i.i(r[1]),g!=="string"&&v.push(new it(`${a}[1]`,r[1],`string expected, ${g} found`)));for(let w=2;w<r.length;w++)g=i.i(r[w]),i.u(r[1])==="$type"?v=v.concat(oa({key:`${a}[${w}]`,value:r[w],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new it(`${a}[${w}]`,r[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<r.length;w++)v=v.concat(Jl({key:`${a}[${w}]`,value:r[w],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=i.i(r[1]),r.length!==2?v.push(new it(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new it(`${a}[1]`,r[1],`string expected, ${g} found`))}return v}function Ql(h,r){let a=h.key,d=h.style,g=h.layer,v=h.styleSpec,w=h.value,E=h.objectKey,D=v[`${r}_${h.layerType}`];if(!D)return[];let S=E.match(/^(.*)-transition$/);if(r==="paint"&&S&&D[S[1]]&&D[S[1]].transition)return Ir({key:a,value:w,valueSpec:v.transition,style:d,styleSpec:v});let A=h.valueSpec||D[E];if(!A)return[new ho(a,w,`unknown property "${E}"`)];let R;if(i.i(w)==="string"&&i.k(A)&&!A.tokens&&(R=/^{([^}]+)}$/.exec(w))){let F=`\`{ "type": "identity", "property": ${R?JSON.stringify(R[1]):'"_"'} }\``;return[new it(a,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${F}.`)]}let k=[];if(h.layerType==="symbol")E!=="text-field"||!d||d.glyphs||d.imports||k.push(new it(a,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&i.A(i.o(w))&&i.u(w.type)==="identity"&&k.push(new it(a,w,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&r==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&i.k(A)&&(i.B(A)||i.m(A))){let F=i.q(i.o(w),A),$=F.value.expression||F.value._styleExpression.expression;$&&!i.v($,["measure-light"])&&(E==="model-emissive-strength"&&i.x($)&&i.t($)||k.push(new it(a,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return k.concat(Ir({key:h.key,value:w,valueSpec:A,style:d,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:E}))}function ec(h){return Ql(h,"paint")}function sa(h){return Ql(h,"layout")}function $o(h){let r=[],a=h.value,d=h.key,g=h.style,v=h.styleSpec;a.type||a.ref||r.push(new it(d,a,'either "type" or "ref" is required'));let w=i.u(a.type),E=i.u(a.ref);if(a.id){let D=i.u(a.id);for(let S=0;S<h.arrayIndex;S++){let A=g.layers[S];i.u(A.id)===D&&r.push(new it(d,a.id,`duplicate layer id "${a.id}", previously used at line ${A.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach(S=>{S in a&&r.push(new it(d,a[S],`"${S}" is prohibited for ref layers`))}),g.layers.forEach(S=>{i.u(S.id)===E&&(D=S)}),D?D.ref?r.push(new it(d,a.ref,"ref cannot reference another ref layer")):w=i.u(D.type):typeof E=="string"&&r.push(new it(d,a.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(a.source){let D=g.sources&&g.sources[a.source],S=D&&i.u(D.type);D?S==="vector"&&w==="raster"?r.push(new it(d,a.source,`layer "${a.id}" requires a raster source`)):S==="raster"&&w!=="raster"?r.push(new it(d,a.source,`layer "${a.id}" requires a vector source`)):S!=="vector"||a["source-layer"]?S==="raster-dem"&&w!=="hillshade"?r.push(new it(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||S==="geojson"&&D.lineMetrics?w==="raster-particle"&&S!=="raster-array"&&r.push(new it(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):r.push(new it(d,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new it(d,a.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new it(d,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new it(d,a.source,`source "${a.source}" not found`))}else r.push(new it(d,a,'missing required property "source"'));return r=r.concat(_i({key:d,value:a,valueSpec:v.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ir({key:`${d}.type`,value:a.type,valueSpec:v.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:D=>Wa(i.j({layerType:w},D)),layout:D=>_i({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":S=>sa(i.j({layerType:w},S))}}),paint:D=>_i({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":S=>ec(i.j({layerType:w,layer:a},S))}})}})),r}function oi(h){let r=h.value,a=h.key,d=i.i(r);return d!=="string"?[new it(a,r,`string expected, ${d} found`)]:[]}let Ki={promoteId:function({key:h,value:r}){if(i.i(r)==="string")return oi({key:h,value:r});{let a=[];for(let d in r)a.push(...oi({key:`${h}.${d}`,value:r[d]}));return a}}};function Bi(h){let r=h.value,a=h.key,d=h.styleSpec,g=h.style;if(!r.type)return[new it(a,r,'"type" is required')];let v=i.u(r.type),w=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(r.url||r.tiles||w.push(new ho(a,r,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(_i({key:a,value:r,valueSpec:d[`source_${v.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Ki})),w;case"geojson":if(w=_i({key:a,value:r,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:Ki}),r.cluster)for(let E in r.clusterProperties){let[D,S]=r.clusterProperties[E],A=typeof D=="string"?[D,["accumulated"],["get",E]]:D;w.push(...fo({key:`${a}.${E}.map`,value:S,expressionContext:"cluster-map"})),w.push(...fo({key:`${a}.${E}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return w;case"video":return _i({key:a,value:r,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return _i({key:a,value:r,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new it(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oa({key:`${a}.type`,value:r.type,valueSpec:{values:vu(d)},style:g,styleSpec:d})}}function vu(h){return h.source.reduce((r,a)=>{let d=h[a];return d.type.type==="enum"&&(r=r.concat(Object.keys(d.type.values))),r},[])}function _r(h){let r=h.value,a=[];if(!r)return a;let d=i.i(r);return d!=="string"?(a=a.concat([new it(h.key,r,`string expected, "${d}" found`)]),a):(function(g){let v=g.indexOf("://")===-1;try{return new URL(g,v?"http://example.com":void 0),!0}catch{return!1}}(r)||(a=a.concat([new it(h.key,r,`invalid url "${r}"`)])),a)}function Ji(h){let r=h.value,a=h.styleSpec,d=a.light,g=h.style,v=[],w=i.i(r);if(r===void 0)return v;if(w!=="object")return v=v.concat([new it("light",r,`object expected, ${w} found`)]),v;for(let E in r){let D=E.match(/^(.*)-transition$/);v=v.concat(D&&d[D[1]]&&d[D[1]].transition?Ir({key:E,value:r[E],valueSpec:a.transition,style:g,styleSpec:a}):d[E]?Ir({key:E,value:r[E],valueSpec:d[E],style:g,styleSpec:a}):[new it(E,r[E],`unknown property "${E}"`)])}return v}function aa(h){let r=h.value,a=[];if(!r)return a;let d=i.i(r);if(d!=="object")return a=a.concat([new it("light-3d",r,`object expected, ${d} found`)]),a;let g=h.styleSpec,v=g["light-3d"],w=h.key,E=h.style,D=h.style.lights;for(let R of["type","id"])if(!(R in r))return a=a.concat([new it("light-3d",r,`missing property ${R} on light`)]),a;if(r.type&&D)for(let R=0;R<h.arrayIndex;R++){let k=i.u(r.type),F=D[R];i.u(F.type)===k&&a.push(new it(w,r.id,`duplicate light type "${r.type}", previously defined at line ${F.id.__line__}`))}let S=`properties_light_${r.type}`;if(!(S in g))return a=a.concat([new it("light-3d",r,`Invalid light type ${r.type}`)]),a;let A=g[S];for(let R in r)if(R==="properties"){let k=r[R],F=i.i(k);if(F!=="object")return a=a.concat([new it("properties",k,`object expected, ${F} found`)]),a;for(let $ in k)a=a.concat(A[$]?Ir({key:$,value:k[$],valueSpec:A[$],style:E,styleSpec:g}):[new ho(h.key,k[$],`unknown property "${$}"`)])}else{let k=R.match(/^(.*)-transition$/);a=a.concat(k&&v[k[1]]&&v[k[1]].transition?Ir({key:R,value:r[R],valueSpec:g.transition,style:E,styleSpec:g}):v[R]?Ir({key:R,value:r[R],valueSpec:v[R],style:E,styleSpec:g}):[new ho(R,r[R],`unknown property "${R}"`)])}return a}function Go(h){let r=h.value,a=h.key,d=h.style,g=h.styleSpec,v=g.terrain,w=[],E=i.i(r);if(r===void 0||E==="null")return w;if(E!=="object")return w=w.concat([new it("terrain",r,`object expected, ${E} found`)]),w;for(let D in r){let S=D.match(/^(.*)-transition$/);w=w.concat(S&&v[S[1]]&&v[S[1]].transition?Ir({key:D,value:r[D],valueSpec:g.transition,style:d,styleSpec:g}):v[D]?Ir({key:D,value:r[D],valueSpec:v[D],style:d,styleSpec:g}):[new ho(D,r[D],`unknown property "${D}"`)])}if(r.source){let D=d.sources&&d.sources[r.source],S=D&&i.u(D.type);D?S!=="raster-dem"&&w.push(new it(a,r.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):w.push(new it(a,r.source,`source "${r.source}" not found`))}else w.push(new it(a,r,'terrain is missing required property "source"'));return w}function Lo(h){let r=h.value,a=h.style,d=h.styleSpec,g=d.fog,v=[],w=i.i(r);if(r===void 0)return v;if(w!=="object")return v=v.concat([new it("fog",r,`object expected, ${w} found`)]),v;for(let E in r){let D=E.match(/^(.*)-transition$/);v=v.concat(D&&g[D[1]]&&g[D[1]].transition?Ir({key:E,value:r[E],valueSpec:d.transition,style:a,styleSpec:d}):g[E]?Ir({key:E,value:r[E],valueSpec:g[E],style:a,styleSpec:d}):[new ho(E,r[E],`unknown property "${E}"`)])}return v}let la={"*":()=>[],array:Xt,boolean:function(h){let r=h.value,a=h.key,d=i.i(r);return d!=="boolean"?[new it(a,r,`boolean expected, ${d} found`)]:[]},number:qa,color:function(h){let r=h.key,a=h.value,d=i.i(a);return d!=="string"?[new it(r,a,`color expected, ${d} found`)]:i.y(a)===null?[new it(r,a,`color expected, "${a}" found`)]:[]},enum:oa,filter:Wa,function:xs,layer:$o,object:_i,source:Bi,model:_r,light:Ji,"light-3d":aa,terrain:Go,fog:Lo,string:oi,formatted:function(h){return oi(h).length===0?[]:fo(h)},resolvedImage:function(h){return oi(h).length===0?[]:fo(h)},projection:function(h){let r=h.value,a=h.styleSpec,d=a.projection,g=h.style,v=[],w=i.i(r);if(w==="object")for(let E in r)v=v.concat(Ir({key:E,value:r[E],valueSpec:d[E],style:g,styleSpec:a}));else w!=="string"&&(v=v.concat([new it("projection",r,`object or string expected, ${w} found`)]));return v},import:function(h){let{value:r,styleSpec:a}=h,w=r,{data:d}=w,g=lx(w,["data"]);Object.defineProperty(g,"__line__",{value:r.__line__,enumerable:!1});let v=_i(i.j({},h,{value:g,valueSpec:a.import}));return i.u(g.id)===""&&v.push(new it(`${h.key}.id`,g,"import id can't be an empty string")),d&&(v=v.concat(Xa(d,a,{key:`${h.key}.data`}))),v}};function Ir(h,r=!1){let a=h.value,d=h.valueSpec,g=h.styleSpec;if(d.expression&&i.A(i.u(a)))return xs(h);if(d.expression&&i.n(i.o(a)))return fo(h);if(d.type&&la[d.type]){let v=la[d.type](h);return r===!0&&v.length>0&&i.i(h.value)==="array"?fo(h):v}return _i(i.j({},h,{valueSpec:d.type?g[d.type]:d}))}function Za(h){let r=h.value,a=h.key,d=oi(h);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new it(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new it(a,r,'"glyphs" url must include a "{range}" token'))),d}function Xa(h,r=i.D,a={}){return Ir({key:a.key||"",value:h,valueSpec:r.$root,styleSpec:r,style:h,objectElementValidators:{glyphs:Za,"*":()=>[]}})}function Qi(h,r=i.D){return Ae(Xa(h,r))}let Ho=h=>Ae(Bi(h)),bs=h=>Ae(Ji(h)),Oe=h=>Ae(aa(h)),Y=h=>Ae(Go(h)),re=h=>Ae(Lo(h)),he=h=>Ae($o(h)),Se=h=>Ae(Wa(h)),ke=h=>Ae(ec(h)),$e=h=>Ae(sa(h)),pt=h=>Ae(_r(h));function Ae(h){return h.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function gt(h,r){let a=!1;if(r&&r.length)for(let d of r)d instanceof ho?i.w(d.message):(h.fire(new i.a(new Error(d.message))),a=!0);return a}let ct=new i.F({anchor:new i.G(i.D.light.anchor),position:new i.H(i.D.light.position),color:new i.G(i.D.light.color),intensity:new i.G(i.D.light.intensity)});class yt extends i.E{constructor(r,a="flat"){super(),this._transitionable=new i.J(ct),this.setLight(r,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,a,d={}){this._validate(bs,r,d)||(this._transitionable.setTransitionOrValue(r),this.id=a)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,d){return(!d||d.validate!==!1)&&gt(this,r.call(Qi,i.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i.D})))}}let Yt=new i.F({source:new i.G(i.D.terrain.source),exaggeration:new i.G(i.D.terrain.exaggeration)}),Fn=class extends i.E{constructor(h,r,a,d){super(),this.scope=a,this._transitionable=new i.J(Yt,a,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(h,r){this._transitionable.setTransitionOrValue(h,r)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new i.K(h)).get("exaggeration")}isZoomDependent(){let h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof i.Z}},Qn=45,zn=65,Sn=.05;function In(h,r,a,d){let g=i.O(Qn,zn,a),[v,w]=On(h,d),E=1-Math.min(1,Math.exp((r-v)/(w-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*g*h.alpha}function On(h,r){let a=.5/Math.tan(.5*r);return[h.range[0]+a,h.range[1]+a]}function Wn(h,r,a,d,g){let v=i.N.transformMat4([],[r,a,d],g.mercatorFogMatrix);return In(h,i.N.length(v),g.pitch,g._fov)}function jr(h,r,a,d,g,v,w){let E=[[a,d,0],[g,d,0],[g,v,0],[a,v,0]],D=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let A of E){let R=i.N.transformMat4([],A,r),k=i.N.length(R);D=Math.min(D,k),S=Math.max(S,k)}return[In(h,D,w.pitch,w._fov),In(h,S,w.pitch,w._fov)]}let Jn=new i.F({range:new i.G(i.D.fog.range),color:new i.G(i.D.fog.color),"high-color":new i.G(i.D.fog["high-color"]),"space-color":new i.G(i.D.fog["space-color"]),"horizon-blend":new i.G(i.D.fog["horizon-blend"]),"star-intensity":new i.G(i.D.fog["star-intensity"]),"vertical-range":new i.G(i.D.fog["vertical-range"])});class yi extends i.E{constructor(r,a,d,g){super(),this._transitionable=new i.J(Jn,d,new Map(g)),this.set(r,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new i.Q(Jn)}get state(){let r=this._transform,a=r.projection.name==="globe",d=i.S(r.zoom),g=this.properties.get("range"),v=[.5,3];return{range:a?[i.U(v[0],g[0],d),i.U(v[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,a,d={}){if(this._validate(re,r,d))return;let g=i.e({},r);for(let v of Object.keys(i.D.fog))g[v]===void 0&&(g[v]=i.D.fog[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;let a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.O(Qn,zn,r))*a.a}getOpacityAtLatLng(r,a){return this._transform.projection.supportsFog?function(d,g,v){let w=i.L.fromLngLat(g),E=v.elevation?v.elevation.getAtPointOrZero(w):0;return Wn(d,w.x,w.y,E,v)}(this.state,r,a):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];let a=this._transform.calculateFogTileMatrix(r.toUnwrapped());return jr(this.state,a,0,0,i.V,i.V,this._transform)}getOpacityForBounds(r,a,d,g,v){return this._transform.projection.supportsFog?jr(this.state,r,a,d,g,v,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?On(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;let a=[4,5,6,7];for(let d of a){let g=r.points[d],v;if(g[2]>=0)v=g;else{let w=r.points[d-4];v=i.W(w,g,w[2]/(w[2]-g[2]))}if(Wn(this.state,v[0],v[1],0,this._transform)>=Sn)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,d){return(!d||d.validate!==!1)&&gt(this,r.call(Qi,i.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i.D})))}}class ui extends i.E{constructor(r,a,d,g){super(),this.scope=d,this._options=r,this.properties=new i.Q(a),this._transitionable=new i.J(a,d,new Map(g)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,a){this._options=r,this._transitionable.setTransitionOrValue(r.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Mi=new i.F({color:new i.G(i.D.properties_light_ambient.color),intensity:new i.G(i.D.properties_light_ambient.intensity)}),Sr=new i.F({direction:new i.X(i.D.properties_light_directional.direction),color:new i.G(i.D.properties_light_directional.color),intensity:new i.G(i.D.properties_light_directional.intensity),"cast-shadows":new i.G(i.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.G(i.D.properties_light_directional["shadow-intensity"])});class Dr{constructor(r,a,d,g){this.screenBounds=r,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(r,a){let d,g;if(r instanceof i.P||typeof r[0]=="number"){let v=i.P.convert(r);d=[v],g=a.isPointAboveHorizon(v)}else{let v=i.P.convert(r[0]),w=i.P.convert(r[1]);d=[v,w],g=i.Y(v,w).every(E=>a.isPointAboveHorizon(E))}return new Dr(d,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],g=i.Y(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),i._(g,r)}bufferedCameraGeometryGlobe(r){let a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],g=i.Y(a,d,r),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>d.y))+((v.x>a.x)+(v.x>d.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(r,a,d,g=0){let v=r.queryPadding/a._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a),E=r.tileID.wrap+(w.unwrapped?g:0),D=w.polygon.map(G=>i.$(r.tileTransform,G,E));if(!i.a0(D,0,0,i.V,i.V))return;E=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let S=this.screenGeometryMercator.polygon.map(G=>i.a1(r.tileTransform,G,E)),A=S.map(G=>new i.P(G[0],G[1])),R=a.getFreeCameraOptions().position||new i.L(0,0,0),k=i.a1(r.tileTransform,R,E),F=S.map(G=>{let B=i.N.sub(G,G,k);return i.N.normalize(B,B),new i.a2(k,B)}),$=i.a3(r,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:F,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(U=i.a4(D),U.min.x=i.aa(U.min.x,0,i.V),U.min.y=i.aa(U.min.y,0,i.V),U.max.x=i.aa(U.max.x,0,i.V),U.max.y=i.aa(U.max.y,0,i.V),U),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:$};var U}_bufferedScreenMercator(r,a){let d=He(r);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),a):{polygon:this.bufferedScreenGeometry(r).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(r,a){let d=He(r);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),a):{polygon:this.bufferedCameraGeometry(r).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(r,a){let d=function(v,w){let E=i.a6.multiply([],w.pixelMatrix,w.globeMatrix),D=[0,-i.ab,0,1],S=[0,i.ab,0,1],A=[0,0,0,1];i.a7.transformMat4(D,D,E),i.a7.transformMat4(S,S,E),i.a7.transformMat4(A,A,E);let R=new i.P(D[0]/D[3],D[1]/D[3]),k=new i.P(S[0]/S[3],S[1]/S[3]),F=i.a8(v,R)&&D[3]<A[3],$=i.a8(v,k)&&S[3]<A[3];if(!F&&!$)return null;let U=function(te,oe,ae){for(let ue=1;ue<te.length;ue++){let xe=Pe(oe.pointCoordinate3D(te[ue-1]).x),fe=Pe(oe.pointCoordinate3D(te[ue]).x);if(ae<0){if(xe<fe)return{idx:ue,t:-xe/(fe-1-xe)}}else if(fe<xe)return{idx:ue,t:(1-xe)/(fe+1-xe)}}return null}(v,w,F?-1:1);if(!U)return null;let{idx:G,t:B}=U,q=G>1?Ce(v.slice(0,G),w):[],Q=G<v.length?Ce(v.slice(G),w):[];q=q.map(te=>new i.P(Pe(te.x),te.y)),Q=Q.map(te=>new i.P(Pe(te.x),te.y));let X=[...q];X.length===0&&X.push(Q[Q.length-1]);let ee=i.U(X[X.length-1].y,(Q.length===0?q[0]:Q[0]).y,B),H;return H=F?[new i.P(0,ee),new i.P(0,0),new i.P(1,0),new i.P(1,ee)]:[new i.P(1,ee),new i.P(1,1),new i.P(0,1),new i.P(0,ee)],X.push(...H),Q.length===0?X.push(q[0]):X.push(...Q),{polygon:X.map(te=>new i.L(te.x,te.y)),unwrapped:!1}}(r,a);if(d)return d;let g=function(v,w){let E=!1,D=-1/0,S=0;for(let R=0;R<v.length-1;R++)v[R].x>D&&(D=v[R].x,S=R);for(let R=0;R<v.length-1;R++){let k=(S+R)%(v.length-1),F=v[k],$=v[k+1];Math.abs(F.x-$.x)>.5&&(F.x<$.x?(F.x+=1,k===0&&(v[v.length-1].x+=1)):($.x+=1,k+1===v.length-1&&(v[0].x+=1)),E=!0)}let A=i.a5(w.center.lng);return E&&A<Math.abs(A-1)&&v.forEach(R=>{R.x-=1}),{polygon:v,unwrapped:E}}(Ce(r,a).map(v=>new i.P(Pe(v.x),v.y)),a);return{polygon:g.polygon.map(v=>new i.L(v.x,v.y)),unwrapped:g.unwrapped}}}function Ce(h,r){return i.a9(h,a=>{let d=r.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Pe(h){return h<0?1+h%1:h%1}function He(h){return 100*h|0}function Je(h,r,a,d,g){let v=function(w,E){if(w)return g(w);if(E){h.url&&E.tiles&&h.tiles&&delete h.tiles;let D=i.ac(i.e(E,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(D.vectorLayers=E.vector_layers,D.vectorLayerIds=D.vectorLayers.map(S=>S.id)),E.raster_layers&&(D.rasterLayers=E.raster_layers,D.rasterLayerIds=D.rasterLayers.map(S=>S.id)),D.tiles=r.canonicalizeTileset(D,h.url),g(null,D)}};return h.url?i.g(r.transformRequest(r.normalizeSourceURL(h.url,null,a,d),i.R.Source),v):i.f.frame(()=>v(null,h))}class Ze{constructor(r,a,d){this.bounds=i.ad.convert(this.validateBounds(r)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){let a=Math.pow(2,r.z),d=Math.floor(i.a5(this.bounds.getWest())*a),g=Math.floor(i.ae(this.bounds.getNorth())*a),v=Math.ceil(i.a5(this.bounds.getEast())*a),w=Math.ceil(i.ae(this.bounds.getSouth())*a);return r.x>=d&&r.x<v&&r.y>=g&&r.y<w}}class tt extends i.E{constructor(r,a,d,g){if(super(),this.id=r,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.e(this,i.ac(a,["url","scheme","tileSize","promoteId"])),this._options=i.e({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new i.af}load(r){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=Je(this._options,this.map._requestManager,a,d,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new i.a(g))):v&&(i.e(this,v),v.bounds&&(this.tileBounds=new Ze(v.bounds,this.minzoom,this.maxzoom)),i.aj(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(g)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=i.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.e({},this._options)}loadTile(r,a){let d=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(d,i.R.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster};if(g.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=a:r.request=r.actor.send("reloadTile",g,v.bind(this));else if(r.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",g,v.bind(this),void 0,!0);else{let w=i.ah.call({deduped:this._deduped},g,(E,D)=>{E||!D?v.call(this,E):(g.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},r.actor&&r.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);r.request={cancel:w}}function v(w,E){return delete r.request,r.aborted?a(null):w&&w.status!==404?a(w):(E&&E.resourceTiming&&(r.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&r.setExpiryData(E),r.loadVectorData(E,this.map.painter),i.ai(this.dispatcher),a(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class nt extends i.E{constructor(r,a,d,g){super(),this.id=r,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.e({type:"raster"},a),i.e(this,i.ac(a,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Je(this._options,this.map._requestManager,null,null,(a,d)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new i.a(a)):d&&(i.e(this,d),d.bounds&&(this.tileBounds=new Ze(d.bounds,this.minzoom,this.maxzoom)),i.aj(d.tiles),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(a)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=i.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,a){let d=i.f.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);r.request=i.d(this.map._requestManager.transformRequest(g,i.R.Tile),(v,w,E,D)=>(delete r.request,r.aborted?(r.state="unloaded",a(null)):v?(r.state="errored",a(v)):w?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:D}),r.setTexture(w,this.map.painter),r.state="loaded",i.ai(this.dispatcher),void a(null)):a(null)))}abortTile(r,a){r.request&&(r.request.cancel(),delete r.request),a()}unloadTile(r,a){r.texture&&r.texture instanceof i.T?(r.destroy(!0),r.texture&&r.texture instanceof i.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ye extends nt{constructor(r,a,d,g){super(r,a,d,g),this.type="raster-array",this.maxzoom=22,this._options=i.e({type:"raster-array"},a)}triggerRepaint(r){let a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,r.tileID),this.map.triggerRepaint()}loadTile(r,a){let d=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(d,i.R.Tile);r.requestParams=g,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(v,w,E,D)=>{if(delete r.request,r.aborted)return r.state="unloaded",a(null);if(v)return v.code===20?void 0:(r.state="errored",a(v));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:E,expires:D}),r.state="empty",a(null)})}unloadTile(r){let a=r.texture;a&&a instanceof i.T?(r.destroy(!0),this.map.painter.saveTileTexture(a)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,a,d){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(a,d,(g,v)=>{if(g)return r.state="errored",this.fire(new i.a(g)),void this.triggerRepaint(r);v&&(r.setTexture(v,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;let a=this.rasterLayers.find(({id:v})=>v===r),d=a&&a.fields,g=d&&d.bands&&d.bands;return g?g[0]:0}getTextureDescriptor(r,a,d){if(!r)return;let g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;a instanceof i.an?v=a.paint.get("raster-array-band"):a instanceof i.ao&&(v=a.paint.get("raster-particle-array-band"));let w=v||this.getInitialBand(g);if(w!=null)if(r.textureDescriptor){if(!r.updateNeeded(g,w)||d)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,g,w)}}let ot=32,Qe=33,At=new Uint16Array(8184);for(let h=0;h<2046;h++){let r=h+2,a=0,d=0,g=0,v=0,w=0,E=0;for(1&r?g=v=w=ot:a=d=E=ot;(r>>=1)>1;){let S=a+g>>1,A=d+v>>1;1&r?(g=a,v=d,a=w,d=E):(a=g,d=v,g=w,v=E),w=S,E=A}let D=4*h;At[D+0]=a,At[D+1]=d,At[D+2]=g,At[D+3]=v}let ln=new Uint16Array(2178),bt=new Uint8Array(1089),Un=new Uint16Array(1089);function nr(h){return h===0?-.03125:h===32?.03125:0}let fr=(()=>{class h{constructor(a,d,g,v){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++,this.context=a;let w=a.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++;let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return h.uniqueIdxCounter=0,h})(),Ar={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kr{constructor(r,a,d,g,v,w){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=w,this.context=r;let E=r.gl;this.buffer=E.createBuffer(),r.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,a){for(let d=0;d<this.attributes.length;d++){let g=a.attributes[this.attributes[d].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,a,d){for(let g=0;g<this.attributes.length;g++){let v=this.attributes[g],w=a.attributes[v.name];w!==void 0&&r.vertexAttribPointer(w,v.components,r[Ar[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(r,a,d){for(let g=0;g<this.attributes.length;g++){let v=a.attributes[this.attributes[g].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(v,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ji extends Tn{getDefault(){return i.ax.transparent}set(r){let a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class po extends Tn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Jr extends Tn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class tc extends Tn{getDefault(){return[!0,!0,!0,!0]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ws extends Tn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ya extends Tn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class fd extends Tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let a=this.current;(r.func!==a.func||r.ref!==a.ref||r.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class ca extends Tn{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class pd extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=r,this.dirty=!1}}class Ka extends Tn{getDefault(){return[0,1]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class _m extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=r,this.dirty=!1}}class xu extends Tn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class md extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.BLEND):a.disable(a.BLEND),this.current=r,this.dirty=!1}}class bu extends Tn{getDefault(){let r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class gd extends Tn{getDefault(){return i.ax.transparent}set(r){let a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ci extends Tn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Mr extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;r?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=r,this.dirty=!1}}class cn extends Tn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class ym extends Tn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let wu=class extends Tn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class _d extends Tn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class p0 extends Tn{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Oo extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class yd extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class m0 extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Ja extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class lt extends Tn{getDefault(){return null}set(r){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Dn extends Tn{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Mn extends Tn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class eo extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Qa extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class mn extends Tn{constructor(r,a){super(r),this.context=r,this.parent=a}getDefault(){return null}}class Tu extends mn{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class el extends mn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class nc extends mn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Si extends el{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Er{constructor(r,a,d,g,v){this.context=r,this.width=a,this.height=d;let w=this.framebuffer=r.gl.createFramebuffer();g&&(this.colorAttachment=new Tu(r,w)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new el(r,w):new nc(r,w))}destroy(){let r=this.context.gl;if(this.colorAttachment){let a=this.colorAttachment.get();a&&r.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let a=this.depthAttachment.get();a&&r.deleteRenderbuffer(a)}else{let a=this.depthAttachment.get();a&&r.deleteTexture(a)}r.deleteFramebuffer(this.framebuffer)}}class Dt{constructor(r,a,d){this.func=r,this.mask=a,this.range=d}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);let ua=7680;class Lt{constructor(r,a,d,g,v,w){this.test=r,this.ref=a,this.mask=d,this.fail=g,this.depthFail=v,this.pass=w}}Lt.disabled=new Lt({func:519,mask:0},0,0,ua,ua,ua);let Ts=771;class Kt{constructor(r,a,d,g){this.blendFunction=r,this.blendColor=a,this.mask=d,this.blendEquation=g}}Kt.Replace=[1,0,1,0],Kt.disabled=new Kt(Kt.Replace,i.ax.transparent,[!1,!1,!1,!1]),Kt.unblended=new Kt(Kt.Replace,i.ax.transparent,[!0,!0,!0,!0]),Kt.alphaBlended=new Kt([1,Ts,1,Ts],i.ax.transparent,[!0,!0,!0,!0]),Kt.multiply=new Kt([774,0,774,0],i.ax.transparent,[!0,!0,!0,!0]);let tl=1029,Qr=2305;class Mt{constructor(r,a,d){this.enable=r,this.mode=a,this.frontFace=d}}Mt.disabled=new Mt(!1,tl,Qr),Mt.backCCW=new Mt(!0,tl,Qr),Mt.backCW=new Mt(!0,tl,2304),Mt.frontCW=new Mt(!0,1028,2304),Mt.frontCCW=new Mt(!0,1028,Qr);class vm{constructor(r,a){this.gl=r,this.clearColor=new ji(this),this.clearDepth=new po(this),this.clearStencil=new Jr(this),this.colorMask=new tc(this),this.depthMask=new ws(this),this.stencilMask=new Ya(this),this.stencilFunc=new fd(this),this.stencilOp=new ca(this),this.stencilTest=new pd(this),this.depthRange=new Ka(this),this.depthTest=new _m(this),this.depthFunc=new xu(this),this.blend=new md(this),this.blendFunc=new bu(this),this.blendColor=new gd(this),this.blendEquation=new Ci(this),this.cullFace=new Mr(this),this.cullFaceSide=new cn(this),this.frontFace=new ym(this),this.program=new wu(this),this.activeTexture=new _d(this),this.viewport=new p0(this),this.bindFramebuffer=new Oo(this),this.bindRenderbuffer=new yd(this),this.bindTexture=new m0(this),this.bindVertexBuffer=new Ja(this),this.bindElementBuffer=new lt(this),this.bindVertexArrayOES=new Dn(this),this.pixelStoreUnpack=new Mn(this),this.pixelStoreUnpackPremultiplyAlpha=new eo(this),this.pixelStoreUnpackFlipY=new Qa(this),this.options=a?Pt({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,a,d){return new fr(this,r,a,d)}createVertexBuffer(r,a,d,g,v){return new Kr(this,r,a,d,g,v)}createRenderbuffer(r,a,d){let g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,r,a,d),this.bindRenderbuffer.set(null),v}createFramebuffer(r,a,d,g){return new Er(this,r,a,d,g)}clear({color:r,depth:a,stencil:d,colorMask:g}){let v=this.gl,w=0;r&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),v.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){C(r.blendFunction,Kt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var ha=i.ay([{name:"a_pos",type:"Float32",components:3}]);class Pr{constructor(r,a,d,g){let v={width:d[0],height:d[1],data:null},w=r.gl;this.targetColorTexture=new i.T(r,v,w.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new i.T(r,v,w.RGBA,{useMipmap:!1}),this.context=r,this.setNumParticles(a,g),this.lastInvalidatedAt=0}setNumParticles(r,a){if(this.numParticles===a)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());let d=new i.az;d.reserve(Math.round(a));let g=i.aA(r.key);for(let v=0;v<a;v++)d.emplaceBack(g(),g(),g());this.particleVertices0=this.context.createVertexBuffer(d,ha.members,!0),this.particleVertices1=this.context.createVertexBuffer(d,ha.members,!0),this.particleSegment=i.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=a}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=i.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}let to={type:2,extent:i.V,loadGeometry:()=>[[new i.P(0,0),new i.P(i.V+1,0),new i.P(i.V+1,i.V+1),new i.P(0,i.V+1),new i.P(0,0)]]};class Es{constructor(r,a,d,g,v){this.tileID=r,this.uid=i.aC(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(r){let a=r+this.timeAdded;a<i.f.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,d){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(g,v){let w={};if(!v)return w;for(let E of g){let D=E.layerIds.map(S=>v.getLayer(S)).filter(Boolean);if(D.length!==0){E.layers=D,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(S=>D.filter(A=>A.id===S)[0]));for(let S of D)w[S.fqid]=E}}return w}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let v=this.buckets[g];if(v instanceof i.aE){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let v=this.buckets[g];if(v instanceof i.aE&&v.hasRTLText){this.hasRTLText=!0,i.aF();break}}this.queryPadding=0;for(let g in this.buckets){let v=this.buckets[g],w=a.style.getOwnLayer(g);if(!w)continue;let E=w.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,E)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new i.aD}unloadVectorData(){if(this.hasData()){for(let r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.fqid]}upload(r){for(let g in this.buckets){let v=this.buckets[g];v.uploadPending()&&v.upload(r)}let a=r.gl,d=this.imageAtlas;if(d&&!d.uploaded){let g=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new i.T(r,d.image,a.RGBA,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(r,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(r,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(r,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(void 0,a)))}queryRenderedFeatures(r,a,d,g,v,w,E,D){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:E,transform:w,params:v,tileTransform:this.tileTransform},r,a,d):{}}querySourceFeatures(r,a){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let g=d.loadVTLayers(),v=a?a.sourceLayer:"",w=g._geojsonTileLayer||g[v];if(!w)return;let E=i.aG(a&&a.filter),{z:D,x:S,y:A}=this.tileID.canonical,R={z:D,x:S,y:A};for(let k=0;k<w.length;k++){let F=w.feature(k);if(E.needGeometry){let G=i.aH(F,!0);if(!E.filter(new i.K(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!E.filter(new i.K(this.tileID.overscaledZ),F))continue;let $=d.getId(F,v),U=new i.aI(F,D,S,A,$);U.tile=R,r.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let r in this.buckets)if(this.buckets[r].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){let a=this.expirationTime;if(r.cacheControl){let d=i.aJ(r.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){let d=Date.now(),g=!1;if(this.expirationTime>d)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{let v=this.expirationTime-a;v?this.expirationTime=d+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(r).length!==0&&a&&this.updateBuckets(r,a)}updateBuckets(r,a){if(!this.latestFeatureIndex)return;let d=this.latestFeatureIndex.loadVTLayers(),g=a.style.listImages(),v=a.style.getBrightness();for(let w in this.buckets){if(!a.style.hasLayer(w))continue;let E=this.buckets[w],D=E.layers[0].sourceLayer||"_geojsonTileLayer",S=d[D],A={};if(r&&(A=r[D],!S||!A||Object.keys(A).length===0))continue;if(E.update(A,S,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),E instanceof i.aK||E instanceof i.aL){let k=a.style.getOwnSourceCache(E.layers[0].source);a._terrain&&a._terrain.enabled&&k&&E.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(k.id,this.tileID)}let R=a&&a.style&&a.style.getOwnLayer(w);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=i.f.now()+r}setTexture(r,a){let d=a.context,g=d.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{useMipmap:!0}):(this.texture=new i.T(d,r,g.RGBA,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(r,a){let d={};for(let g of a)d[g]=!0;this.dependencies[r]=d}hasDependency(r,a){for(let d of r){let g=this.dependencies[d];if(g){for(let v of a)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;let d=i.aM(to,this.tileID.canonical,this.tileTransform)[0],g=new i.aN,v=new i.aO;for(let w=0;w<d.length;w++){let{x:E,y:D}=d[w];g.emplaceBack(E,D),v.emplaceBack(w)}v.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(v),this._tileDebugBuffer=r.createVertexBuffer(g,i.aP.members),this._tileDebugSegments=i.aB.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;let d=i.aM(to,this.tileID.canonical,this.tileTransform)[0],g,v;if(this.isRaster){let w=function(E,D){let S=i.as(E,D),A=Math.pow(2,E.z);for(let G=0;G<Qe;G++)for(let B=0;B<Qe;B++){let q=i.at((E.x+(B+nr(B))/ot)/A),Q=i.au((E.y+(G+nr(G))/ot)/A),X=D.project(q,Q),ee=G*Qe+B;ln[2*ee+0]=Math.round((X.x*S.scale-S.x)*i.V),ln[2*ee+1]=Math.round((X.y*S.scale-S.y)*i.V)}bt.fill(0),Un.fill(0);for(let G=2045;G>=0;G--){let B=4*G,q=At[B+0],Q=At[B+1],X=At[B+2],ee=At[B+3],H=q+X>>1,te=Q+ee>>1,oe=H+te-Q,ae=te+q-H,ue=Q*Qe+q,xe=ee*Qe+X,fe=te*Qe+H,De=Math.hypot((ln[2*ue+0]+ln[2*xe+0])/2-ln[2*fe+0],(ln[2*ue+1]+ln[2*xe+1])/2-ln[2*fe+1])>=16;bt[fe]=bt[fe]||(De?1:0),G<1022&&(bt[fe]=bt[fe]||bt[(Q+ae>>1)*Qe+(q+oe>>1)]||bt[(ee+ae>>1)*Qe+(X+oe>>1)])}let R=new i.av,k=new i.aw,F=0;function $(G,B){let q=B*Qe+G;return Un[q]===0&&(R.emplaceBack(ln[2*q+0],ln[2*q+1],G*i.V/ot,B*i.V/ot),Un[q]=++F),Un[q]-1}function U(G,B,q,Q,X,ee){let H=G+q>>1,te=B+Q>>1;if(Math.abs(G-X)+Math.abs(B-ee)>1&&bt[te*Qe+H])U(X,ee,G,B,H,te),U(q,Q,X,ee,H,te);else{let oe=$(G,B),ae=$(q,Q),ue=$(X,ee);k.emplaceBack(oe,ae,ue)}}return U(0,0,ot,ot,ot,0),U(ot,ot,0,0,0,ot),{vertices:R,indices:k}}(this.tileID.canonical,a);g=w.vertices,v=w.indices}else{g=new i.av,v=new i.aw;for(let{x:E,y:D}of d)g.emplaceBack(E,D,0,0);let w=i.aQ(g.int16,void 0,4);for(let E=0;E<w.length;E+=3)v.emplaceBack(w[E],w[E+1],w[E+2])}this._tileBoundsBuffer=r.createVertexBuffer(g,i.aR.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(v),this._tileBoundsSegments=i.aB.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(r,a){let d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;let g=this.tileID.canonical,v=i.aS(g,a),w=i.aT(v),E=i.S(a.zoom),D;E>0&&(D=i.a6.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,g,a,w,D,E),this._makeGlobeTileDebugTextBuffer(r,g,a,w,D,E)}_globePoint(r,a,d,g,v,w,E){let D=i.aU(r,a,d);if(w){let S=1<<d.z,A=i.a5(g.center.lng),R=i.ae(g.center.lat),k=(d.x+.5)/S-A,F=0;k>.5?F=-1:k<-.5&&(F=1);let $=(r/i.V+d.x)/S+F,U=(a/i.V+d.y)/S;$=($-A)*g._pixelsPerMercatorPixel+A,U=(U-R)*g._pixelsPerMercatorPixel+R;let G=[$*g.worldSize,U*g.worldSize,0];i.N.transformMat4(G,G,w),D=i.aV(D,G,E)}return i.N.transformMat4(D,D,v)}_makeGlobeTileDebugBorderBuffer(r,a,d,g,v,w){let E=new i.aN,D=new i.aO,S=new i.aW,A=(k,F,$,U,G)=>{let B=($-k)/(G-1),q=(U-F)/(G-1),Q=E.length;for(let X=0;X<G;X++){let ee=k+X*B,H=F+X*q;E.emplaceBack(ee,H);let te=this._globePoint(ee,H,a,d,g,v,w);S.emplaceBack(te[0],te[1],te[2]),D.emplaceBack(Q+X)}},R=i.V;A(0,0,R,0,16),A(R,0,R,R,16),A(R,R,0,R,16),A(0,R,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(D),this._tileDebugBuffer=r.createVertexBuffer(E,i.aP.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(S,i.aX.members),this._tileDebugSegments=i.aB.simpleSegment(0,0,E.length,D.length)}_makeGlobeTileDebugTextBuffer(r,a,d,g,v,w){let E=i.V/4,D=new i.aN,S=new i.aw,A=new i.aW,R=25;S.reserve(32),D.reserve(R),A.reserve(R);let k=(F,$)=>R*F+$;for(let F=0;F<R;F++){let $=F*E;for(let U=0;U<R;U++){let G=U*E;D.emplaceBack(G,$);let B=this._globePoint(G,$,a,d,g,v,w);A.emplaceBack(B[0],B[1],B[2])}}for(let F=0;F<4;F++)for(let $=0;$<4;$++){let U=k(F,$),G=k(F,$+1),B=k(F+1,$),q=k(F+1,$+1);S.emplaceBack(U,G,B),S.emplaceBack(B,G,q)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(S),this._tileDebugTextBuffer=r.createVertexBuffer(D,i.aP.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(A,i.aX.members),this._tileDebugTextSegments=i.aB.simpleSegment(0,0,R,32)}destroy(r=!1){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let qo={vector:tt,raster:nt,"raster-dem":class extends nt{constructor(h,r,a,d){super(h,r,a,d),this.type="raster-dem",this.maxzoom=22,this._options=i.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){let a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,v){g&&(h.state="errored",r(g)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=i.d(this.map._requestManager.transformRequest(a,i.R.Tile),(function(g,v,w,E){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(g)h.state="errored",r(g);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:w,expires:E});let D=ImageBitmap&&v instanceof ImageBitmap&&i.ak(),S=1-(v.width-i.al(v.width))/2;S<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));let A=D?v:i.f.getImageData(v,S),R={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:A,encoding:this.encoding,padding:S};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",R,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){let r=h.canonical,a=Math.pow(2,r.z),d=(r.x-1+a)%a,g=r.x===0?h.wrap-1:h.wrap,v=(r.x+1+a)%a,w=r.x+1===a?h.wrap+1:h.wrap,E={};return E[new i.am(h.overscaledZ,g,r.z,d,r.y).key]={backfilled:!1},E[new i.am(h.overscaledZ,w,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(E[new i.am(h.overscaledZ,g,r.z,d,r.y-1).key]={backfilled:!1},E[new i.am(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},E[new i.am(h.overscaledZ,w,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<a&&(E[new i.am(h.overscaledZ,g,r.z,d,r.y+1).key]={backfilled:!1},E[new i.am(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},E[new i.am(h.overscaledZ,w,r.z,v,r.y+1).key]={backfilled:!1}),E}},"raster-array":Ye,geojson:class extends i.E{constructor(h,r,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=r.data,this._options=i.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let g=i.V/this.tileSize;this.workerOptions=i.e({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*g,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*g,extent:i.V,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.V,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*g,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},r),this}getClusterLeaves(h,r,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:r,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.b("dataloading",{dataType:"source"})),this._loaded=!1;let h=i.e({},this.workerOptions);h.scope=this.scope;let r=this._data;typeof r=="string"?(h.request=this.map._requestManager.transformRequest(i.f.resolveURL(r),i.R.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new i.a(a));else{let g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(g.resourceTiming=d.resourceTiming[this.id]),this.fire(new i.b("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){let a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;let d={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:i.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};h.request=this.actor.send(a,d,(g,v)=>(delete h.request,h.destroy(),h.aborted?r(null):g?r(g):(h.loadVectorData(v,this.map.painter,a==="reloadTile"),r(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.ap{constructor(h,r,a,d){super(h,r,a,d),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let h=this.options;this.urls=[];for(let r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.R.Source).url);i.aq(this.urls,(r,a)=>{this._loaded=!0,r?this.fire(new i.a(r)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){let r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new i.a(new it(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.ap,model:class extends i.E{constructor(h,r,a,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){let h=[];for(let r in this._options.models){let a=this._options.models[r],d=i.l(this.map._requestManager.transformRequest(a.uri,i.R.Model).url).then(g=>{if(!g)return;let v=i.c(g),w=new i.M(r,a.position,a.orientation,v);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(g=>{this.fire(new i.a(new Error(`Could not load model ${r} from ${a.uri}: ${g.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new i.a(new Error(`Could not load models: ${r.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,r){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(h,r,a,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=Je(this._options,this.map._requestManager,r,a,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new i.a(d))):g&&(i.e(this,g),g.bounds&&(this.tileBounds=new Ze(g.bounds,this.minzoom,this.maxzoom)),i.aj(g.tiles,this.map._requestManager._customAccessToken),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,r){let a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,i.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=r;else{if(h.buckets){let v=Object.values(h.buckets);for(let w of v)w.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,g.bind(this),void 0,!0);function g(v,w){return h.aborted?r(null):v&&v.status!==404?r(v):(w&&(w.resourceTiming&&(h.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&h.setExpiryData(w),h.buckets=Pt(Pt({},h.buckets),w.buckets),w.featureIndex&&(h.latestFeatureIndex=w.featureIndex)),h.state="loaded",void r(null))}}serialize(){return i.e({},this._options)}},canvas:class extends i.ap{constructor(h,r,a,d){super(h,r,a,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new i.a(new it(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.a(new it(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.a(new it(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new i.a(new it(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.a(new it(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof i.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends i.E{constructor(h,r,a,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=r,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ze(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.e(this,i.ac(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){let{x:r,y:a,z:d}=h.canonical;return this._implementation.hasTile({x:r,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){let{x:a,y:d,z:g}=h.tileID.canonical,v=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:g},{signal:v.signal})).then((function(w){return delete h.request,h.aborted?(h.state="unloaded",r(null)):w===void 0?(h.state="errored",r(null)):w===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(w)?(this.loadTileData(h,w),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(h.state="errored",r(w))}),h.request.cancel=()=>v.abort()}loadTileData(h,r){h.setTexture(r,this._map.painter)}unloadTile(h,r){if(h.texture&&h.texture instanceof i.T?(h.destroy(!0),h.texture&&h.texture instanceof i.T&&this._map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){let{x:a,y:d,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:g})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){let h=i.ag(this.id,this.scope);this._map.style.clearSource(h)}_update(){this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))}}},Rr=function(h,r,a,d){let g=new qo[r.type](h,r,a,d);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return i.aY(["load","abort","unload","serialize","prepare"],g),g};function vd(h,r){let a=i.a6.identity([]);return i.a6.scale(a,a,[.5*h.width,.5*-h.height,1]),i.a6.translate(a,a,[1,-1,0]),i.a6.multiply(a,a,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(a)}function xd(h,r,a,d,g,v,w,E=!1){let D=h.tilesIn(d,w,E);D.sort(nl);let S=[];for(let R of D)S.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,a,h._state,R,g,v,vd(h.transform,R.tile.tileID),E)});let A=function(R){let k={},F={};for(let $ of R){let U=$.queryResults,G=$.wrappedTileID,B=F[G]=F[G]||{};for(let q in U){let Q=U[q],X=B[q]=B[q]||{},ee=k[q]=k[q]||[];for(let H of Q)X[H.featureIndex]||(X[H.featureIndex]=!0,ee.push(H))}}return k}(S);for(let R in A)A[R].forEach(k=>{let F=k.feature,$=F.layer;$&&$.type!=="background"&&$.type!=="sky"&&$.type!=="slot"&&(F.source=$.source,$["source-layer"]&&(F.sourceLayer=$["source-layer"]),F.state=F.id!==void 0?h.getFeatureState($["source-layer"],F.id):{})});return A}function Wo(h,r){let a=h.getRenderableIds().map(v=>h.getTileByID(v)),d=[],g={};for(let v=0;v<a.length;v++){let w=a[v],E=w.tileID.canonical.key;g[E]||(g[E]=!0,w.querySourceFeatures(d,r))}return d}function nl(h,r){let a=h.tileID,d=r.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}class da extends Es{constructor(r,a,d,g,v){super(r,a,d,g,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,a){let d=a.context,g=d.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{useMipmap:!1,premultiply:!1}):this.texture=new i.T(d,r,g.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,a){let d=this._mrt=new i.aZ(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=i.a_(g,(v,w,E,D)=>{if(v)a(v);else try{let S=d.getHeaderLength(w);if(S>r)return void(this.request=this.fetchHeader(S,a));d.parseHeader(w),this._isHeaderLoaded=!0;let A=0;for(let R of Object.values(d.layers))A=Math.max(A,R.dataIndex[R.dataIndex.length-1].last_byte);w.byteLength>=A&&(this.entireBuffer=w),a(null,this.entireBuffer||w,E,D)}catch(S){a(S)}}),this.request}fetchBand(r,a,d){let g=this._mrt;if(!this._isHeaderLoaded||!g)return void d(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void d(new Error("Can't fetch tile band without an actor"));let w,E=(R,k)=>{w.complete(R,k),R?d(R):(this.updateTextureDescriptor(r,a),d(null,this.textureDescriptor&&this.textureDescriptor.img))},D=(R,k)=>{if(R)return d(R);let F=v.send("decodeRasterArray",{buffer:k,task:w},E,void 0,!0);this._workQueue.push(()=>{F&&F.cancel(),w.cancel()})},S=g.getLayer(r);if(!S)return void d(new Error(`Unknown sourceLayer "${r}"`));if(S.hasDataForBand(a))return this.updateTextureDescriptor(r,a),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);let A=S.getDataRange([a]);if(w=g.createDecodingTask(A),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{let R=Object.assign({},this.requestParams,{headers:{Range:`bytes=${A.firstByte}-${A.lastByte}`}}),k=i.a_(R,D);this._fetchQueue.push(()=>{k.cancel(),w.cancel()})}else d(null)}updateNeeded(r,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,a){if(!this._mrt)return;let d=this._mrt.getLayer(r);if(!d||!d.hasBand(a)||!d.hasDataForBand(a))return;let{bytes:g,tileSize:v,buffer:w,offset:E,scale:D}=d.getBandView(a),S=v+2*w,A={data:g,width:S,height:S},R=this.texture;R&&R instanceof i.T&&R.update(A,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:r,band:a,img:A,buffer:w,offset:E,tileSize:v,format:d.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class rl{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(let r in this.data)for(let a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,d){let g=r.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);let v={value:a,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},d)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){let w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){let a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){let a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;let d=r.wrapped().key,g=a===void 0?0:this.data[d].indexOf(a),v=this.data[d][g];return this.data[d].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){let a=[];for(let d in this.data)for(let g of this.data[d])r(g.value)||a.push(g);for(let d of a)this.remove(d.value.tileID,d)}}class mo extends i.E{constructor(r,a,d){super(),this.id=r,this._onlySymbols=d,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new rl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new an,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let r in this._tiles){let a=this._tiles[r];if(a.state!=="errored"&&(a.state!=="loaded"||!a.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let d=this._tiles[a];d.upload(r),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return i.a$(this._tiles).map(r=>r.tileID).sort(Eu).map(r=>r.key)}getRenderableIds(r,a){let d=[];for(let g in this._tiles)this._isIdRenderable(+g,r,a)&&d.push(this._tiles[g]);return r?d.sort((g,v)=>{let w=g.tileID,E=v.tileID,D=new i.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),S=new i.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-E.overscaledZ||S.y-D.y||S.x-D.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(Eu).map(g=>g.key)}hasRenderableParent(r){let a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a,d){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())&&(d||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){let d=this._tiles[r];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,r,a)))}_tileLoaded(r,a,d,g){if(g)if(r.state="errored",g.status!==404)this._source.fire(new i.a(g,{tile:r}));else{if(!(r.tileID.key in this._loadedParentTiles))return void this._source.fire(new i.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=i.f.now(),d==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new i.b("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){let a=this.getRenderableIds();for(let g=0;g<a.length;g++){let v=a[g];if(r.neighboringTiles&&r.neighboringTiles[v]){let w=this.getTileByID(v);d(r,w),d(w,r)}}function d(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let w=v.tileID.canonical.x-g.tileID.canonical.x,E=v.tileID.canonical.y-g.tileID.canonical.y,D=Math.pow(2,g.tileID.canonical.z),S=v.tileID.key;w===0&&E===0||Math.abs(E)>1||(Math.abs(w)>1&&(Math.abs(w+D)===1?w+=D:Math.abs(w-D)===1&&(w-=D)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,w,E),g.neighboringTiles&&g.neighboringTiles[S]&&(g.neighboringTiles[S].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,d,g){for(let v in this._tiles){let w=this._tiles[v];if(g[v]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>d)continue;let E=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){let S=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[S.key],w&&w.hasData()&&(E=S)}let D=E;for(;D.overscaledZ>a;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){g[E.key]=E;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){let d=this._loadedParentTiles[r.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=r.overscaledZ-1;d>=a;d--){let g=r.scaledTo(d),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(r){let a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;let d=Math.ceil(r.width/a)+1,g=Math.ceil(r.height/a)+1,v=Math.floor(d*g*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(E)}handleWrapJump(r){let a=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,a){let d={};for(let g in this._tiles){let v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+a),d[v.tileID.key]=v}this._tiles=d;for(let g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(let g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(r,a,d,g){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let v;if(this.updateCacheSize(r,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)v=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new i.am(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){let D=r.clone();D.tileCoverLift=this.tileCoverLift,v=D.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&r.projection.name==="globe"&&(v.push(new i.am(1,0,1,0,0)),v.push(new i.am(1,0,1,1,0)),v.push(new i.am(1,0,1,0,1)),v.push(new i.am(1,0,1,1,1)))}else v=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(v=v.filter(D=>this._source.hasTile(D)));else v=[];if(v.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Zo(this._source.type)){let D=r.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),S=Math.min(D,this._source.maxzoom),A=r.extendTileCoverForShadows(v,g,S);for(let R of A)this._shadowCasterTiles[R.key]=!0,v.push(R)}let w=this._updateRetainedTiles(v);if(Zo(this._source.type)&&v.length!==0){let D={},S={},A=Object.keys(w);for(let k of A){let F=w[k],$=this._tiles[k];if(!$||$.fadeEndTime&&$.fadeEndTime<=i.f.now())continue;let U=this.findLoadedParent(F,Math.max(F.overscaledZ-mo.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),D[U.tileID.key]=U.tileID),S[k]=F}let R=v[v.length-1].overscaledZ;for(let k in this._tiles){let F=this._tiles[k];if(w[k]||!F.hasData())continue;let $=F.tileID;for(;$.overscaledZ>R;){$=$.scaledTo($.overscaledZ-1);let U=this._tiles[$.key];if(U&&U.hasData()&&S[$.key]){w[k]=F.tileID;break}}}for(let k in D)w[k]||(this._coveredTiles[k]=!0,w[k]=D[k])}for(let D in w)this._tiles[D].clearFadeHold();let E=i.b0(this._tiles,w);for(let D of E){let S=this._tiles[D];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){let a={};if(r.length===0)return a;let d={},g=r.reduce((S,A)=>Math.min(S,A.overscaledZ),1/0),v=r[0].overscaledZ,w=Math.max(v-mo.maxOverzooming,this._source.minzoom),E=Math.max(v+mo.maxUnderzooming,this._source.minzoom),D={};for(let S of r){let A=this._addTile(S);a[S.key]=S,A.hasData()||g<this._source.maxzoom&&(D[S.key]=S)}this._retainLoadedChildren(D,g,E,a);for(let S of r){let A=this._tiles[S.key];if(A.hasData())continue;if(S.canonical.z>=this._source.maxzoom){let k=S.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){a[k.key]=k;continue}}else{let k=S.children(this._source.maxzoom);if(a[k[0].key]&&a[k[1].key]&&a[k[2].key]&&a[k[3].key])continue}let R=A.wasRequested();for(let k=S.overscaledZ-1;k>=w;--k){let F=S.scaledTo(k);if(d[F.key]||(d[F.key]=!0,A=this.getTile(F),!A&&R&&(A=this._addTile(F)),A&&(a[F.key]=F,R=A.wasRequested(),A.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let r in this._tiles){let a=[],d,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}a.push(g.key);let v=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;g=v}for(let v of a)this._loadedParentTiles[v]=d}}_addTile(r){let a=this._tiles[r.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));let d=!!a;if(!d){let g=this.map?this.map.painter:null,v=this._source.tileSize*r.overscaleFactor();a=this._source.type==="raster-array"?new da(r,v,this.transform.tileZoom,g,this._isRaster):new Es(r,v,this.transform.tileZoom,g,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,d||this._source.fire(new i.b("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);let d=a.getExpiryTimeout();d&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},d))}_removeTile(r){let a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,d){let g=[],v=this.transform;if(!v)return g;let w=v.projection.name==="globe",E=i.a5(v.center.lng);for(let D in this._tiles){let S=this._tiles[D];if(d&&S.clearQueryDebugViz(),S.holdingForFade())continue;let A;if(w){let R=S.tileID.canonical;if(R.z===0){let k=[Math.abs(i.aa(E,...rc(R,-1))-E),Math.abs(i.aa(E,...rc(R,1))-E)];A=[0,2*k.indexOf(Math.min(...k))-1]}else{let k=[Math.abs(i.aa(E,...rc(R,-1))-E),Math.abs(i.aa(E,...rc(R,0))-E),Math.abs(i.aa(E,...rc(R,1))-E)];A=[k.indexOf(Math.min(...k))-1]}}else A=[0];for(let R of A){let k=r.containsTile(S,v,a,R);k&&g.push(k)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,a){let d=this.getRenderableIds(r,a).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(let v of d)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return d}sortCoordinatesByDistance(r){let a=r.slice(),d=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(let w of a){let E=1/(1<<w.canonical.z);v[w.key]=((w.canonical.x+.5)*E+w.wrap-d[0])*g[0]+((w.canonical.y+.5)*E-d[1])*g[1]-d[2]*g[2]}return a.sort((w,E)=>v[w.key]-v[E.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Zo(this._source.type))for(let r in this._tiles){let a=this._tiles[r];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=i.f.now())return!0}return!1}setFeatureState(r,a,d){this._state.updateState(r=r||"_geojsonTileLayer",a,d)}removeFeatureState(r,a,d){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,d)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,d){let g=this._tiles[r];g&&g.setDependencies(a,d)}reloadTilesForDependencies(r,a){for(let d in this._tiles)this._tiles[d].hasDependency(r,a)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(r,a))}_preloadTiles(r,a){if(!this._sourceLoaded){let D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(r,a))};return void this._source.on("data",D)}let d=new Map,g=Array.isArray(r)?r:[r],v=this.map.painter.terrain,w=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let D of g){let S=D.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let A of S)d.set(A.key,A);this.usedForTerrain&&D.updateElevation(!1)}let E=Array.from(d.values());i.b1(E,(D,S)=>{let A=new Es(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,R=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),S(R,A)})},a)}}function Eu(h,r){let a=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*r.wrap)-+(r.wrap<0);return h.overscaledZ-r.overscaledZ||d-a||r.canonical.y-h.canonical.y||r.canonical.x-h.canonical.x}function Zo(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function rc(h,r){let a=1<<h.z;return[h.x/a+r,(h.x+1)/a+r]}mo.maxOverzooming=10,mo.maxUnderzooming=3;class xm{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let r=!1,a=!1;for(let d in this.style._mergedLayers){let g=this.style._mergedLayers[d];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:r,visibilityChanged:a});else if(g.type==="model"){let v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:r,visibilityChanged:a})}}}onNewFrame(r){this.layersGotHidden=!1;for(let a of this.layers){let d=a.layer,g=!1;d.type==="fill-extrusion"?g=!d.isHidden(r)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(g=!d.isHidden(r)&&d.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(r,a){this.currentBuildingBuckets=[];for(let g of this.layers){let v=g.layer,w=this.style.getLayerSourceCache(v),E=1;v.type==="fill-extrusion"&&(E=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=w?w.getTile(a):null;if(!D&&w&&a.canonical.z>w.getSource().minzoom){let S=a.scaledTo(Math.min(w.getSource().maxzoom,a.overscaledZ-1));for(;S.overscaledZ>=w.getSource().minzoom&&(D=w.getTile(S),!D&&S.overscaledZ!==0);)S=S.scaledTo(S.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:a,verticalScale:E})}r.hasAnyZOffset=!1;let d=!1;for(let g=0;g<r.symbolInstances.length;g++){let v=r.symbolInstances.get(g),w=v.zOffset,E=this._getHeightAtTileOffset(a,v.tileAnchorX,v.tileAnchorY);v.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,d||w===v.zOffset||(d=!0),r.hasAnyZOffset||v.zOffset===0||(r.hasAnyZOffset=!0)}d&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,a,d,g){let v=a,w=d;if(r.canonical.z!==g.canonical.z){let E=g.canonical,D=1/(1<<r.canonical.z-E.z);v=(a+r.canonical.x*i.V)*D-E.x*i.V|0,w=(d+r.canonical.y*i.V)*D-E.y*i.V|0}return{tileX:v,tileY:w}}_getHeightAtTileOffset(r,a,d){let g,v;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;let{bucket:E,tileID:D,verticalScale:S}=this.currentBuildingBuckets[w];if(!E)continue;let{tileX:A,tileY:R}=this._mapCoordToOverlappingTile(r,a,d,D),k=E.getHeightAtTileCoord(A,R);k&&k.height!==void 0&&(k.hidden?g=k.height:v=Math.max(k.height*S,v||0))}if(v!==void 0)return v;for(let w=0;w<this.layers.length;++w){let E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;let{bucket:D,tileID:S}=this.currentBuildingBuckets[w];if(!D)continue;let{tileX:A,tileY:R}=this._mapCoordToOverlappingTile(r,a,d,S),k=D.getHeightAtTileCoord(A,R);if(k&&!k.hidden)return k.height===void 0&&g!==void 0?Math.min(k.maxHeight,g)*k.verticalScale:(k.height||0)*k.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function fa(h,r){let a={};for(let d in h)d!=="ref"&&(a[d]=h[d]);return i.b2.forEach(d=>{d in r&&(a[d]=r[d])}),a}function bm(h){h=h.slice();let r=Object.create(null);for(let a=0;a<h.length;a++)r[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=fa(h[a],r[h[a].ref]));return h}let hn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ic(h,r,a){a.push({command:hn.addSource,args:[h,r[h]]})}function bd(h,r,a){r.push({command:hn.removeSource,args:[h]}),a[h]=!0}function g0(h,r,a,d){bd(h,a,d),ic(h,r,a)}function _0(h,r,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!C(h[a][d],r[a][d]))return!1;for(d in r[a])if(r[a].hasOwnProperty(d)&&d!=="data"&&!C(h[a][d],r[a][d]))return!1;return!0}function Is(h,r,a,d,g,v){let w;for(w in r=r||{},h=h||{})h.hasOwnProperty(w)&&(C(h[w],r[w])||a.push({command:v,args:[d,w,r[w],g]}));for(w in r)r.hasOwnProperty(w)&&!h.hasOwnProperty(w)&&(C(h[w],r[w])||a.push({command:v,args:[d,w,r[w],g]}))}function Ds(h){return h.id}function Iu(h,r){return h[r.id]=r,h}class il{constructor(r,a){this.reset(r,a)}reset(r,a){this.points=r||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.aa(r,0,1);let a=1,d=this._distances[a],g=r*this.paddedLength+this.padding;for(;d<g&&a<this._distances.length;)d=this._distances[++a];let v=a-1,w=this._distances[v],E=d-w,D=E>0?(g-w)/E:0;return this.points[v].mult(1-D).add(this.points[a].mult(D))}}class wd{constructor(r,a,d){let g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/d),this.yCellCount=Math.ceil(a/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=a,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,a,d,g,v){this._forEachCell(a,d,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(r,a,d,g){this._forEachCell(a-g,d-g,a+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(a),this.circles.push(d),this.circles.push(g)}_insertBoxCell(r,a,d,g,v,w){this.boxCells[v].push(w)}_insertCircleCell(r,a,d,g,v,w){this.circleCells[v].push(w)}_query(r,a,d,g,v,w){if(d<0||r>this.width||g<0||a>this.height)return!v&&[];let E=[];if(r<=0&&a<=0&&this.width<=d&&this.height<=g){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)E.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){let S=this.circles[3*D],A=this.circles[3*D+1],R=this.circles[3*D+2];E.push({key:this.circleKeys[D],x1:S-R,y1:A-R,x2:S+R,y2:A+R})}return w?E.filter(w):E}return this._forEachCell(r,a,d,g,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},w),v?E.length>0:E}_queryCircle(r,a,d,g,v){let w=r-d,E=r+d,D=a-d,S=a+d;if(E<0||w>this.width||S<0||D>this.height)return!g&&[];let A=[];return this._forEachCell(w,D,E,S,this._queryCellCircle,A,{hitTest:g,circle:{x:r,y:a,radius:d},seenUids:{box:{},circle:{}}},v),g?A.length>0:A}query(r,a,d,g,v){return this._query(r,a,d,g,!1,v)}hitTest(r,a,d,g,v){return this._query(r,a,d,g,!0,v)}hitTestCircle(r,a,d,g){return this._queryCircle(r,a,d,!0,g)}_queryCell(r,a,d,g,v,w,E,D){let S=E.seenUids,A=this.boxCells[v];if(A!==null){let k=this.bboxes;for(let F of A)if(!S.box[F]){S.box[F]=!0;let $=4*F;if(r<=k[$+2]&&a<=k[$+3]&&d>=k[$+0]&&g>=k[$+1]&&(!D||D(this.boxKeys[F]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[F],x1:k[$],y1:k[$+1],x2:k[$+2],y2:k[$+3]})}}}let R=this.circleCells[v];if(R!==null){let k=this.circles;for(let F of R)if(!S.circle[F]){S.circle[F]=!0;let $=3*F;if(this._circleAndRectCollide(k[$],k[$+1],k[$+2],r,a,d,g)&&(!D||D(this.circleKeys[F]))){if(E.hitTest)return w.push(!0),!0;{let U=k[$],G=k[$+1],B=k[$+2];w.push({key:this.circleKeys[F],x1:U-B,y1:G-B,x2:U+B,y2:G+B})}}}}}_queryCellCircle(r,a,d,g,v,w,E,D){let S=E.circle,A=E.seenUids,R=this.boxCells[v];if(R!==null){let F=this.bboxes;for(let $ of R)if(!A.box[$]){A.box[$]=!0;let U=4*$;if(this._circleAndRectCollide(S.x,S.y,S.radius,F[U+0],F[U+1],F[U+2],F[U+3])&&(!D||D(this.boxKeys[$])))return w.push(!0),!0}}let k=this.circleCells[v];if(k!==null){let F=this.circles;for(let $ of k)if(!A.circle[$]){A.circle[$]=!0;let U=3*$;if(this._circlesCollide(F[U],F[U+1],F[U+2],S.x,S.y,S.radius)&&(!D||D(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(r,a,d,g,v,w,E,D){let S=this._convertToXCellCoord(r),A=this._convertToYCellCoord(a),R=this._convertToXCellCoord(d),k=this._convertToYCellCoord(g);for(let F=S;F<=R;F++)for(let $=A;$<=k;$++)if(v.call(this,r,a,d,g,this.xCellCount*$+F,w,E,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,a,d,g,v,w){let E=g-r,D=v-a,S=d+w;return S*S>E*E+D*D}_circleAndRectCollide(r,a,d,g,v,w,E){let D=(w-g)/2,S=Math.abs(r-(g+D));if(S>D+d)return!1;let A=(E-v)/2,R=Math.abs(a-(v+A));if(R>A+d)return!1;if(S<=D||R<=A)return!0;let k=S-D,F=R-A;return k*k+F*F<=d*d}}let Xo={unknown:0,flipRequired:1,flipNotRequired:2},Ms=Math.tan(85*Math.PI/180);function oc(h,r,a,d,g,v,w){let E=i.a6.create();if(a)if(v.name==="globe"){let D=i.b3(g,r);i.a6.multiply(E,E,D)}else{let D=i.b4.invert([],w);E[0]=D[0],E[1]=D[1],E[4]=D[2],E[5]=D[3],d||i.a6.rotateZ(E,E,g.angle)}else i.a6.multiply(E,g.labelPlaneMatrix,h);return E}function Td(h,r,a,d,g,v,w){let E=oc(h,r,a,d,g,v,w);return v.name==="globe"&&a||(E[2]=E[6]=E[10]=E[14]=0),E}function Ed(h,r,a,d,g,v,w){if(a){if(v.name==="globe"){let E=oc(h,r,a,d,g,v,w);return i.a6.invert(E,E),i.a6.multiply(E,h,E),E}{let E=i.a6.clone(h),D=i.a6.identity([]);return D[0]=w[0],D[1]=w[1],D[4]=w[2],D[5]=w[3],i.a6.multiply(E,E,D),d||i.a6.rotateZ(E,E,-g.angle),E}}return g.glCoordMatrix}function no(h,r,a,d){let g=[h,r,a,1];a?i.a7.transformMat4(g,g,d):Ad(g,g,d);let v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function wm(h,r){return Math.min(.5+h/r*.5,1.5)}function Id(h,r){let a=h[0]/h[3],d=h[1]/h[3];return a>=-r[0]&&a<=r[0]&&d>=-r[1]&&d<=r[1]}function Dd(h,r,a,d,g,v,w,E,D,S){let A=a.transform,R=d?h.textSizeData:h.iconSizeData,k=i.b5(R,a.transform.zoom),F=A.projection.name==="globe",$=[256/a.width*2+1,256/a.height*2+1],U=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;U.clear();let G=null;F&&(G=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);let B=h.lineVertexArray,q=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Q=a.transform.width/a.transform.height,X,ee=!1;for(let H=0;H<q.length;H++){let te=q.get(H),{numGlyphs:oe,writingMode:ae}=te;if(ae!==i.b6.vertical||ee||X===i.b6.horizontal||(ee=!0),X=ae,(te.hidden||ae===i.b6.vertical)&&!ee){Cs(oe,U);continue}ee=!1;let ue=new i.P(te.tileAnchorX,te.tileAnchorY),{x:xe,y:fe,z:De}=A.projection.projectTilePoint(ue.x,ue.y,S.canonical);if(D){let[et,ft,wt]=D(ue);xe+=et,fe+=ft,De+=wt}let Ee=[xe,fe,De,1];if(i.a7.transformMat4(Ee,Ee,r),!Id(Ee,$)){Cs(oe,U);continue}let Be=Ee[3],pe=wm(a.transform.getCameraToCenterDistance(A.projection),Be),we=i.b7(R,k,te),ce=w?we/pe:we*pe,_e=no(xe,fe,De,g);if(_e[3]<=0){Cs(oe,U);continue}let je={},We=w?null:D,qe=Sd(te,ce,!1,E,r,g,v,h.glyphOffsetArray,B,U,G,_e,ue,je,Q,We,A.projection,S,w);ee=qe.useVertical,We&&qe.needsFlipping&&(je={}),(qe.notEnoughRoom||ee||qe.needsFlipping&&Sd(te,ce,!0,E,r,g,v,h.glyphOffsetArray,B,U,G,_e,ue,je,Q,We,A.projection,S,w).notEnoughRoom)&&Cs(oe,U)}d?(h.text.dynamicLayoutVertexBuffer.updateData(U),G&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(G)):(h.icon.dynamicLayoutVertexBuffer.updateData(U),G&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(G))}function Md(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U){let{lineStartIndex:G,glyphStartIndex:B,segment:q}=E,Q=B+E.numGlyphs,X=G+E.lineLength,ee=r.getoffsetX(B),H=r.getoffsetX(Q-1),te=sc(h*ee,a,d,g,v,w,q,G,X,D,S,A,R,k,!0,F,$,U);if(!te)return null;let oe=sc(h*H,a,d,g,v,w,q,G,X,D,S,A,R,k,!0,F,$,U);return oe?{first:te,last:oe}:null}function Cd(h,r,a,d){return h===i.b6.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:h===i.b6.vertical?d>0?{needsFlipping:!0}:null:r!==Xo.unknown&&function(g,v){return g===0||Math.abs(v/g)>Ms}(a,d)?r===Xo.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Sd(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B,q){let Q=r/24,X=h.lineOffsetX*Q,ee=h.lineOffsetY*Q,{lineStartIndex:H,glyphStartIndex:te,numGlyphs:oe,segment:ae,writingMode:ue,flipState:xe}=h,fe=H+h.lineLength,De=Ee=>{if(A){let[ce,_e,je]=Ee.up,We=S.length;i.b8(A,We+0,ce,_e,je),i.b8(A,We+1,ce,_e,je),i.b8(A,We+2,ce,_e,je),i.b8(A,We+3,ce,_e,je)}let[Be,pe,we]=Ee.point;i.b9(S,Be,pe,we,Ee.angle)};if(oe>1){let Ee=Md(Q,E,X,ee,a,R,k,h,D,v,F,U,!1,G,B,q);if(!Ee)return{notEnoughRoom:!0};if(d&&!a){let[Be,pe,we]=Ee.first.point,[ce,_e,je]=Ee.last.point;[Be,pe]=no(Be,pe,we,w),[ce,_e]=no(ce,_e,je,w);let We=Cd(ue,xe,(ce-Be)*$,_e-pe);if(h.flipState=We&&We.needsFlipping?Xo.flipRequired:Xo.flipNotRequired,We)return We}De(Ee.first);for(let Be=te+1;Be<te+oe-1;Be++){let pe=sc(Q*E.getoffsetX(Be),X,ee,a,R,k,ae,H,fe,D,v,F,U,!1,!1,G,B,q);if(!pe)return S.length-=4*(Be-te),{notEnoughRoom:!0};De(pe)}De(Ee.last)}else{if(d&&!a){let Be=no(k.x,k.y,0,g),pe=H+ae+1,we=new i.P(D.getx(pe),D.gety(pe)),ce=no(we.x,we.y,0,g),_e=ce[3]>0?ce:Du(k,we,Be,1,g,void 0,G,B.canonical),je=Cd(ue,xe,(_e[0]-Be[0])*$,_e[1]-Be[1]);if(h.flipState=je&&je.needsFlipping?Xo.flipRequired:Xo.flipNotRequired,je)return je}let Ee=sc(Q*E.getoffsetX(te),X,ee,a,R,k,ae,H,fe,D,v,F,U,!1,!1,G,B,q);if(!Ee)return{notEnoughRoom:!0};De(Ee)}return{}}function ol(h,r,a,d,g){let{x:v,y:w,z:E}=d.projectTilePoint(h.x,h.y,r);if(!g)return no(v,w,E,a);let[D,S,A]=g(h);return no(v+D,w+S,E+A,a)}function Du(h,r,a,d,g,v,w,E){let D=ol(h.sub(r)._unit()._add(h),E,g,w,v);return i.N.sub(D,a,D),i.N.normalize(D,D),i.N.scaleAndAdd(D,a,D,d)}function sc(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B){let q=d?h-r:h+r,Q=q>0?1:-1,X=0;d&&(Q*=-1,X=Math.PI),Q<0&&(X+=Math.PI);let ee=E+w+(Q>0?0:1)|0,H=g,te=g,oe=0,ae=0,ue=Math.abs(q),xe=[],fe=[],De=v,Ee=De,Be=()=>Du(Ee,De,te,ue-oe+1,A,k,U,G.canonical);for(;oe+ae<=ue;){if(ee+=Q,ee<E||ee>=D)return null;if(te=H,Ee=De,xe.push(te),F&&fe.push(Ee),De=new i.P(S.getx(ee),S.gety(ee)),H=R[ee],!H){let ft=ol(De,G.canonical,A,U,k);H=ft[3]>0?R[ee]=ft:Be()}oe+=ae,ae=i.N.distance(te,H)}$&&k&&(R[ee]&&(H=Be(),ae=i.N.distance(te,H)),R[ee]=H);let pe=(ue-oe)/ae,we=De.sub(Ee)._mult(pe)._add(Ee),ce=i.N.sub([],H,te),_e=i.N.scaleAndAdd([],te,ce,pe),je=[0,0,1],We=ce[0],qe=ce[1];if(B&&(je=U.upVector(G.canonical,we.x,we.y),je[0]!==0||je[1]!==0||je[2]!==1)){let ft=[je[2],0,-je[0]],wt=i.N.cross([],je,ft);i.N.normalize(ft,ft),i.N.normalize(wt,wt),We=i.N.dot(ce,ft),qe=i.N.dot(ce,wt)}if(a){let ft=i.N.cross([],je,ce);i.N.normalize(ft,ft),i.N.scaleAndAdd(_e,_e,ft,a*Q)}let et=X+Math.atan2(qe,We);return xe.push(_e),F&&fe.push(we),{point:_e,angle:et,path:xe,tilePath:fe,up:je}}function Cs(h,r){let a=r.length,d=a+4*h;r.resize(d),r.float32.fill(-1/0,4*a,4*d)}function Ad(h,r,a){let d=r[0],g=r[1];return h[0]=a[0]*d+a[4]*g+a[12],h[1]=a[1]*d+a[5]*g+a[13],h[3]=a[3]*d+a[7]*g+a[15],h}let ro=100;class rt{constructor(r,a,d=new wd(r.width+200,r.height+200,25),g=new wd(r.width+200,r.height+200,25)){this.transform=r,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ro,this.screenBottomBoundary=r.height+ro,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=a}placeCollisionBox(r,a,d,g,v,w,E,D){let S=d.projectedAnchorX,A=d.projectedAnchorY,R=d.projectedAnchorZ,k=d.elevation,F=d.tileID,$=r.getProjection();if(k&&F){let[H,te,oe]=$.upVector(F.canonical,d.tileAnchorX,d.tileAnchorY),ae=$.upVectorScale(F.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;S+=H*k*ae,A+=te*k*ae,R+=oe*k*ae}let U=this.projectAndGetPerspectiveRatio(E,S,A,R,d.tileID,$.name==="globe"||!!k||this.transform.pitch>0,$),G=w*U.perspectiveRatio,B=(d.x1*a+g.x-d.padding)*G+U.point.x,q=(d.y1*a+g.y-d.padding)*G+U.point.y,Q=(d.x2*a+g.x+d.padding)*G+U.point.x,X=(d.y2*a+g.y+d.padding)*G+U.point.y,ee=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid(B,q,Q,X)||!v&&this.grid.hitTest(B,q,Q,X,D)||ee?{box:[],offscreen:!1,occluded:U.occluded}:{box:[B,q,Q,X],offscreen:this.isOffscreen(B,q,Q,X),occluded:!1}}placeCollisionCircles(r,a,d,g,v,w,E,D,S,A,R,k,F,$,U){let G=[],B=this.transform.elevation,q=r.getProjection(),Q=B?B.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,q):null,X=new i.P(d.tileAnchorX,d.tileAnchorY),{x:ee,y:H,z:te}=q.projectTilePoint(X.x,X.y,U.canonical);if(Q){let[we,ce,_e]=Q(X);ee+=we,H+=ce,te+=_e}let oe=q.name==="globe",ae=this.projectAndGetPerspectiveRatio(E,ee,H,te,U,oe||!!B||this.transform.pitch>0,q),{perspectiveRatio:ue}=ae,xe=(R?w/ue:w*ue)/i.bc,fe=no(ee,H,te,D),De=ae.signedDistanceFromCamera>0?Md(xe,v,d.lineOffsetX*xe,d.lineOffsetY*xe,!1,fe,X,d,g,D,{},B&&!R?Q:null,R&&!!B,q,U,R):null,Ee=!1,Be=!1,pe=!0;if(De&&!ae.occluded){let we=.5*F*ue+$,ce=new i.P(-100,-100),_e=new i.P(this.screenRightBoundary,this.screenBottomBoundary),je=new il,{first:We,last:qe}=De,et=We.path.length,ft=[];for(let xt=et-1;xt>=1;xt--)ft.push(We.path[xt]);for(let xt=1;xt<qe.path.length;xt++)ft.push(qe.path[xt]);let wt=2.5*we;S&&(ft=ft.map(([xt,Ut,Rt],zt)=>(Q&&!oe&&(Rt=Q(zt<et-1?We.tilePath[et-1-zt]:qe.tilePath[zt-et+2])[2]),no(xt,Ut,Rt,S))),ft.some(xt=>xt[3]<=0)&&(ft=[]));let _t=[];if(ft.length>0){let xt=1/0,Ut=-1/0,Rt=1/0,zt=-1/0;for(let kt of ft)xt=Math.min(xt,kt[0]),Rt=Math.min(Rt,kt[1]),Ut=Math.max(Ut,kt[0]),zt=Math.max(zt,kt[1]);Ut>=ce.x&&xt<=_e.x&&zt>=ce.y&&Rt<=_e.y&&(_t=[ft.map(kt=>new i.P(kt[0],kt[1]))],(xt<ce.x||Ut>_e.x||Rt<ce.y||zt>_e.y)&&(_t=i.ba(_t,ce.x,ce.y,_e.x,_e.y)))}for(let xt of _t){je.reset(xt,.25*we);let Ut=0;Ut=je.length<=.5*we?1:Math.ceil(je.paddedLength/wt)+1;for(let Rt=0;Rt<Ut;Rt++){let zt=Rt/Math.max(Ut-1,1),kt=je.lerp(zt),dn=kt.x+ro,Hn=kt.y+ro;G.push(dn,Hn,we,0);let en=dn-we,cr=Hn-we,tn=dn+we,yn=Hn+we;if(pe=pe&&this.isOffscreen(en,cr,tn,yn),Be=Be||this.isInsideGrid(en,cr,tn,yn),!a&&this.grid.hitTestCircle(dn,Hn,we,k)&&(Ee=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ee,occluded:!1}}}}return{circles:!A&&Ee||!Be?[]:G,offscreen:pe,collisionDetected:Ee,occluded:ae.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],d=1/0,g=1/0,v=-1/0,w=-1/0;for(let A of r){let R=new i.P(A.x+ro,A.y+ro);d=Math.min(d,R.x),g=Math.min(g,R.y),v=Math.max(v,R.x),w=Math.max(w,R.y),a.push(R)}let E=this.grid.query(d,g,v,w).concat(this.ignoredGrid.query(d,g,v,w)),D={},S={};for(let A of E){let R=A.key;if(D[R.bucketInstanceId]===void 0&&(D[R.bucketInstanceId]={}),D[R.bucketInstanceId][R.featureIndex])continue;let k=[new i.P(A.x1,A.y1),new i.P(A.x2,A.y1),new i.P(A.x2,A.y2),new i.P(A.x1,A.y2)];i.bb(a,k)&&(D[R.bucketInstanceId][R.featureIndex]=!0,S[R.bucketInstanceId]===void 0&&(S[R.bucketInstanceId]=[]),S[R.bucketInstanceId].push(R.featureIndex))}return S}insertCollisionBox(r,a,d,g,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,a,d,g,v){let w=a?this.ignoredGrid:this.grid,E={bucketInstanceId:d,featureIndex:g,collisionGroupID:v};for(let D=0;D<r.length;D+=4)w.insertCircle(E,r[D],r[D+1],r[D+2])}projectAndGetPerspectiveRatio(r,a,d,g,v,w,E){let D=[a,d,g,1],S=!1;g||this.transform.pitch>0?(i.a7.transformMat4(D,D,r),this.fogState&&v&&E.name!=="globe"&&(S=function(k,F,$,U,G,B){let q=B.calculateFogTileMatrix(G),Q=[F,$,U];return i.N.transformMat4(Q,Q,q),In(k,i.N.length(Q),B.pitch,B._fov)}(this.fogState,a,d,g,v.toUnwrapped(),this.transform)>.9)):Ad(D,D,r);let A=D[3];return{point:new i.P((D[0]/A+1)/2*this.transform.width+ro,(-D[1]/A+1)/2*this.transform.height+ro),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/A*.5,1.5),signedDistanceFromCamera:A,occluded:w&&D[2]>A||S}}isOffscreen(r,a,d,g){return d<ro||r>=this.screenRightBoundary||g<ro||a>this.screenBottomBoundary}isInsideGrid(r,a,d,g){return d>=0&&r<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let r=i.a6.identity([]);return i.a6.translate(r,r,[-100,-100,0]),r}}function Mu(h,r,a){let d=r.createTileMatrix(h,h.worldSize,a.toUnwrapped());return i.a6.multiply(new Float32Array(16),h.projMatrix,d)}function Pd(h,r,a){if(r.projection.name===a.projection.name)return h.projMatrix;let d=a.clone();return d.setProjection(r.projection),Mu(d,r.getProjection(),h)}function ac(h,r,a){return r.name===a.projection.name?h.projMatrix:Mu(a,r,h)}class Rd{constructor(r,a,d,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?a:-a))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Ss{constructor(r,a,d,g,v,w=!1){this.text=new Rd(r?r.text:null,a,d,v),this.icon=new Rd(r?r.icon:null,a,g,v),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class go{constructor(r,a,d,g=!1){this.text=r,this.icon=a,this.skipFade=d,this.clipped=g}}class Ld{constructor(){this.invProjMatrix=i.a6.create(),this.viewportMatrix=i.a6.create(),this.circles=[]}}class pa{constructor(r,a,d,g,v){this.bucketInstanceId=r,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=v}}class Cu{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let a=++this.maxGroupID;this.collisionGroups[r]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[r]}}function ma(h,r,a,d,g){let{horizontalAlign:v,verticalAlign:w}=i.bf(h),E=-(v-.5)*r,D=-(w-.5)*a,S=i.bd(h,d);return new i.P(E+S[0]*g,D+S[1]*g)}function Od(h,r,a,d,g){let v=new i.P(h,r);return a&&v._rotate(d?g:-g),v}class y0{constructor(r,a,d,g,v,w){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new rt(this.transform,v),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Cu(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,a,d,g){let v=d.getBucket(a),w=d.latestFeatureIndex;if(!v||!w||a.fqid!==v.layerIds[0])return;let E=v.layers[0].layout,D=d.collisionBoxArray,S=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),A=d.tileSize/i.V,R=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);let k=(F=d.tileID,$=v.getProjection(),U=this.transform,$.name===this.projection?U.calculateProjMatrix(F.toUnwrapped()):Mu(U,$,F));var F,$,U;let G=E.get("text-pitch-alignment")==="map",B=E.get("text-rotation-alignment")==="map";a.compileFilter();let q=a.dynamicFilter(),Q=a.dynamicFilterNeedsFeature(),X=this.transform.calculatePixelsToTileUnitsMatrix(d),ee=Td(k,d.tileID.canonical,G,B,this.transform,v.getProjection(),X),H=null;if(G){let ae=Ed(k,d.tileID.canonical,G,B,this.transform,v.getProjection(),X);H=i.a6.multiply([],this.transform.labelPlaneMatrix,ae)}let te=null;q&&d.latestFeatureIndex&&(te={unwrappedTileID:R,dynamicFilter:q,dynamicFilterNeedsFeature:Q,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new pa(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,d.tileID);let oe={bucket:v,layout:E,posMatrix:k,textLabelPlaneMatrix:ee,labelToScreenMatrix:H,clippingData:te,scale:S,textPixelRatio:A,holdingForFade:d.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:i.b5(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.b5(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(let ae of v.sortKeyRanges){let{sortKey:ue,symbolInstanceStart:xe,symbolInstanceEnd:fe}=ae;r.push({sortKey:ue,symbolInstanceStart:xe,symbolInstanceEnd:fe,parameters:oe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B,q){let{textOffset0:Q,textOffset1:X,crossTileID:ee}=k,H=[Q,X],te=ma(r,d,g,H,v),oe=this.collisionIndex.placeCollisionBox($,v,a,Od(te.x,te.y,w,E,this.transform.angle),R,D,S,A.predicate);if(G){let ae=$.getSymbolInstanceIconSize(q,this.transform.zoom,k.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox($,ae,G,Od(te.x,te.y,w,E,this.transform.angle),R,D,S,A.predicate).box.length===0)return}if(oe.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[ee]&&this.prevPlacement.placements[ee]&&this.prevPlacement.placements[ee].text&&(ae=this.prevPlacement.variableOffsets[ee].anchor),this.variableOffsets[ee]={textOffset:H,width:d,height:g,anchor:r,textScale:v,prevAnchor:ae},this.markUsedJustification($,r,k,U),$.allowVerticalPlacement&&(this.markUsedOrientation($,U,k),this.placedOrientations[ee]=U),{shift:te,placedGlyphBoxes:oe}}}placeLayerBucketPart(r,a,d,g){let{bucket:v,layout:w,posMatrix:E,textLabelPlaneMatrix:D,labelToScreenMatrix:S,clippingData:A,textPixelRatio:R,holdingForFade:k,collisionBoxArray:F,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:U,collisionGroup:G}=r.parameters,B=w.get("text-optional"),q=w.get("icon-optional"),Q=w.get("text-allow-overlap"),X=w.get("icon-allow-overlap"),ee=w.get("text-rotation-alignment")==="map",H=w.get("text-pitch-alignment")==="map",te=w.get("symbol-z-order")==="viewport-y",oe=w.get("symbol-z-elevate");this.transform.setProjection(v.projection);let ae=Q&&(X||!v.hasIconData()||q),ue=X&&(Q||!v.hasTextData()||B);!v.collisionArrays&&F&&v.deserializeCollisionBoxes(F),d&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,F);let xe=(fe,De,Ee)=>{let{crossTileID:Be,numVerticalGlyphVertices:pe}=fe;if(A){let tn={zoom:this.transform.zoom,pitch:this.transform.pitch},yn=null;if(A.dynamicFilterNeedsFeature){let nn=this.retainedQueryData[v.bucketInstanceId];yn=A.featureIndex.loadFeature({featureIndex:fe.featureIndex,bucketIndex:nn.bucketIndex,sourceLayerIndex:nn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,A.dynamicFilter)(tn,yn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new i.P(fe.tileAnchorX,fe.tileAnchorY),this.transform.calculateDistanceTileData(A.unwrappedTileID)))return this.placements[Be]=new go(!1,!1,!1,!0),void a.add(Be)}if(a.has(Be))return;if(k)return void(this.placements[Be]=new go(!1,!1,!1));let we=!1,ce=!1,_e=!0,je=!1,We=!1,qe=null,et={box:null,offscreen:null,occluded:null},ft={box:null,offscreen:null,occluded:null},wt=null,_t=null,xt=null,Ut=0,Rt=0,zt=0;Ee.textFeatureIndex?Ut=Ee.textFeatureIndex:fe.useRuntimeCollisionCircles&&(Ut=fe.featureIndex),Ee.verticalTextFeatureIndex&&(Rt=Ee.verticalTextFeatureIndex);let kt=tn=>{tn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let yn=this.transform.elevation;tn.elevation=fe.zOffset+(yn?yn.getAtTileOffset(tn.tileID,tn.tileAnchorX,tn.tileAnchorY):0)},dn=Ee.textBox;if(dn){kt(dn);let tn=nn=>{let _n=i.b6.horizontal;if(v.allowVerticalPlacement&&!nn&&this.prevPlacement){let Zn=this.prevPlacement.placedOrientations[Be];Zn&&(this.placedOrientations[Be]=Zn,_n=Zn,this.markUsedOrientation(v,_n,fe))}return _n},yn=(nn,_n)=>{if(v.allowVerticalPlacement&&pe>0&&Ee.verticalTextBox){for(let Zn of v.writingModes)if(Zn===i.b6.vertical?(et=_n(),ft=et):et=nn(),et&&et.box&&et.box.length)break}else et=nn()};if(w.get("text-variable-anchor")){let nn=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Be]){let En=this.prevPlacement.variableOffsets[Be];nn.indexOf(En.anchor)>0&&(nn=nn.filter(Ur=>Ur!==En.anchor),nn.unshift(En.anchor))}let _n=(En,Ur,ti)=>{let Ri=v.getSymbolInstanceTextSize($,fe,this.transform.zoom,De),ko=(En.x2-En.x1)*Ri+2*En.padding,Li=(En.y2-En.y1)*Ri+2*En.padding,$r=fe.hasIconTextFit&&!X?Ur:null;$r&&kt($r);let Lr={box:[],offscreen:!1,occluded:!1},di=Q?2*nn.length:nn.length;for(let bi=0;bi<di;++bi){let Oi=this.attemptAnchorPlacement(nn[bi%nn.length],En,ko,Li,Ri,ee,H,R,E,G,bi>=nn.length,fe,De,v,ti,$r,$,U);if(Oi&&(Lr=Oi.placedGlyphBoxes,Lr&&Lr.box&&Lr.box.length)){we=!0,qe=Oi.shift;break}}return Lr};yn(()=>_n(dn,Ee.iconBox,i.b6.horizontal),()=>{let En=Ee.verticalTextBox;return En&&kt(En),v.allowVerticalPlacement&&!(et&&et.box&&et.box.length)&&pe>0&&En?_n(En,Ee.verticalIconBox,i.b6.vertical):{box:null,offscreen:null,occluded:null}}),et&&(we=et.box,_e=et.offscreen,je=et.occluded);let Zn=tn(!(!et||!et.box));if(!we&&this.prevPlacement){let En=this.prevPlacement.variableOffsets[Be];En&&(this.variableOffsets[Be]=En,this.markUsedJustification(v,En.anchor,fe,Zn))}}else{let nn=(_n,Zn)=>{let En=v.getSymbolInstanceTextSize($,fe,this.transform.zoom,De),Ur=this.collisionIndex.placeCollisionBox(v,En,_n,new i.P(0,0),Q,R,E,G.predicate);return Ur&&Ur.box&&Ur.box.length&&(this.markUsedOrientation(v,Zn,fe),this.placedOrientations[Be]=Zn),Ur};yn(()=>nn(dn,i.b6.horizontal),()=>{let _n=Ee.verticalTextBox;return v.allowVerticalPlacement&&pe>0&&_n?(kt(_n),nn(_n,i.b6.vertical)):{box:null,offscreen:null,occluded:null}}),tn(!!(et&&et.box&&et.box.length))}}if(wt=et,we=wt&&wt.box&&wt.box.length>0,_e=wt&&wt.offscreen,je=wt&&wt.occluded,fe.useRuntimeCollisionCircles){let tn=v.text.placedSymbolArray.get(fe.centerJustifiedTextSymbolIndex>=0?fe.centerJustifiedTextSymbolIndex:fe.verticalPlacedTextSymbolIndex),yn=i.b7(v.textSizeData,$,tn),nn=w.get("text-padding");_t=this.collisionIndex.placeCollisionCircles(v,Q,tn,v.lineVertexArray,v.glyphOffsetArray,yn,E,D,S,d,H,G.predicate,fe.collisionCircleDiameter*yn/i.bc,nn,this.retainedQueryData[v.bucketInstanceId].tileID),we=Q||_t.circles.length>0&&!_t.collisionDetected,_e=_e&&_t.offscreen,je=_t.occluded}if(Ee.iconFeatureIndex&&(zt=Ee.iconFeatureIndex),Ee.iconBox){let tn=yn=>{kt(yn);let nn=fe.hasIconTextFit&&qe?Od(qe.x,qe.y,ee,H,this.transform.angle):new i.P(0,0),_n=v.getSymbolInstanceIconSize(U,this.transform.zoom,fe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,_n,yn,nn,X,R,E,G.predicate)};ft&&ft.box&&ft.box.length&&Ee.verticalIconBox?(xt=tn(Ee.verticalIconBox),ce=xt.box.length>0):(xt=tn(Ee.iconBox),ce=xt.box.length>0),_e=_e&&xt.offscreen,We=xt.occluded}let Hn=B||fe.numHorizontalGlyphVertices===0&&pe===0,en=q||fe.numIconVertices===0;if(Hn||en?en?Hn||(ce=ce&&we):we=ce&&we:ce=we=ce&&we,we&&wt&&wt.box&&this.collisionIndex.insertCollisionBox(wt.box,w.get("text-ignore-placement"),v.bucketInstanceId,ft&&ft.box&&Rt?Rt:Ut,G.ID),ce&&xt&&this.collisionIndex.insertCollisionBox(xt.box,w.get("icon-ignore-placement"),v.bucketInstanceId,zt,G.ID),_t&&(we&&this.collisionIndex.insertCollisionCircles(_t.circles,w.get("text-ignore-placement"),v.bucketInstanceId,Ut,G.ID),d)){let tn=v.bucketInstanceId,yn=this.collisionCircleArrays[tn];yn===void 0&&(yn=this.collisionCircleArrays[tn]=new Ld);for(let nn=0;nn<_t.circles.length;nn+=4)yn.circles.push(_t.circles[nn+0]),yn.circles.push(_t.circles[nn+1]),yn.circles.push(_t.circles[nn+2]),yn.circles.push(_t.collisionDetected?1:0)}let cr=v.projection.name!=="globe";ae=ae&&(cr||!je),ue=ue&&(cr||!We),this.placements[Be]=new go(we||ae,ce||ue,_e||v.justReloaded),a.add(Be)};if(oe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),te){let fe=v.getSortedSymbolIndexes(this.transform.angle);for(let De=fe.length-1;De>=0;--De){let Ee=fe[De];xe(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee])}v.hasAnyZOffset&&i.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){let fe=v.getSortedIndexesByZOffset();for(let De=0;De<fe.length;++De){let Ee=fe[De];xe(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee])}}else for(let fe=r.symbolInstanceStart;fe<r.symbolInstanceEnd;fe++)xe(v.symbolInstances.get(fe),fe,v.collisionArrays[fe]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){let fe=this.collisionCircleArrays[v.bucketInstanceId];i.a6.invert(fe.invProjMatrix,E),fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,a,d,g){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:D,crossTileID:S}=d,A=i.be(a),R=g===i.b6.vertical?D:A==="left"?v:A==="center"?w:A==="right"?E:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=R>=0&&v!==R?0:S),w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=R>=0&&w!==R?0:S),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=R>=0&&E!==R?0:S),D>=0&&(r.text.placedSymbolArray.get(D).crossTileID=R>=0&&D!==R?0:S)}markUsedOrientation(r,a,d){let g=a===i.b6.horizontal||a===i.b6.horizontalOnly?a:0,v=a===i.b6.vertical?a:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:S}=d,A=r.text.placedSymbolArray;w>=0&&(A.get(w).placedOrientation=g),E>=0&&(A.get(E).placedOrientation=g),D>=0&&(A.get(D).placedOrientation=g),S>=0&&(A.get(S).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let g=a?a.symbolFadeChange(r):1,v=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(let D in this.placements){let S=this.placements[D],A=v[D];A?(this.opacities[D]=new Ss(A,g,S.text,S.icon,null,S.clipped),d=d||S.text!==A.text.placed||S.icon!==A.icon.placed):(this.opacities[D]=new Ss(null,g,S.text,S.icon,S.skipFade,S.clipped),d=d||S.text||S.icon)}for(let D in v){let S=v[D];if(!this.opacities[D]){let A=new Ss(S,g,!1,!1);A.isHidden()||(this.opacities[D]=A,d=d||S.text.placed||S.icon.placed)}}for(let D in w)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=w[D]);for(let D in E)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=E[D]);d?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:r)}updateLayerOpacities(r,a){let d=new Set;for(let g of a){let v=g.getBucket(r);v&&g.latestFeatureIndex&&r.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,d,g.collisionBoxArray),v.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,g.tileID),v.updateZOffset()))}}updateBucketOpacities(r,a,d){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let g=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),w=new Ss(null,0,!1,!1,!0),E=g.get("text-allow-overlap"),D=g.get("icon-allow-overlap"),S=g.get("text-variable-anchor"),A=g.get("text-rotation-alignment")==="map",R=g.get("text-pitch-alignment")==="map",k=new Ss(null,0,E&&(D||!r.hasIconData()||g.get("icon-optional")),D&&(E||!r.hasTextData()||g.get("text-optional")),!0);!r.collisionArrays&&d&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(d);let F=(U,G,B)=>{for(let q=0;q<G/4;q++)U.opacityVertexArray.emplaceBack(B)},$=0;for(let U=0;U<r.symbolInstances.length;U++){let G=r.symbolInstances.get(U),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:q,crossTileID:Q,numIconVertices:X}=G,ee=a.has(Q),H=this.opacities[Q];ee?H=w:H||(H=k,this.opacities[Q]=H),a.add(Q);let te=B>0||q>0,oe=X>0,ae=this.placedOrientations[Q],ue=ae===i.b6.vertical,xe=ae===i.b6.horizontal||ae===i.b6.horizontalOnly;if(!te&&!oe||H.isHidden()||$++,te){let fe=Im(H.text);F(r.text,B,ue?lc:fe),F(r.text,q,xe?lc:fe);let De=H.text.isHidden(),{leftJustifiedTextSymbolIndex:Ee,centerJustifiedTextSymbolIndex:Be,rightJustifiedTextSymbolIndex:pe,verticalPlacedTextSymbolIndex:we}=G,ce=r.text.placedSymbolArray,_e=De||ue?1:0;Ee>=0&&(ce.get(Ee).hidden=_e),Be>=0&&(ce.get(Be).hidden=_e),pe>=0&&(ce.get(pe).hidden=_e),we>=0&&(ce.get(we).hidden=De||xe?1:0);let je=this.variableOffsets[Q];je&&this.markUsedJustification(r,je.anchor,G,ae);let We=this.placedOrientations[Q];We&&(this.markUsedJustification(r,"left",G,We),this.markUsedOrientation(r,We,G))}if(oe){let fe=Im(H.icon),{placedIconSymbolIndex:De,verticalPlacedIconSymbolIndex:Ee}=G,Be=r.icon.placedSymbolArray,pe=H.icon.isHidden()?1:0;De>=0&&(F(r.icon,X,ue?lc:fe),Be.get(De).hidden=pe),Ee>=0&&(F(r.icon,G.numVerticalIconVertices,xe?lc:fe),Be.get(Ee).hidden=pe)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let fe=r.collisionArrays[U];if(fe){let De=new i.P(0,0),Ee=!0;if(fe.textBox||fe.verticalTextBox){if(S){let pe=this.variableOffsets[Q];pe?(De=ma(pe.anchor,pe.width,pe.height,pe.textOffset,pe.textScale),A&&De._rotate(R?this.transform.angle:-this.transform.angle)):Ee=!1}v&&(Ee=!H.clipped),fe.textBox&&sl(r.textCollisionBox.collisionVertexArray,H.text.placed,!Ee||ue,De.x,De.y),fe.verticalTextBox&&sl(r.textCollisionBox.collisionVertexArray,H.text.placed,!Ee||xe,De.x,De.y)}let Be=Ee&&!!(!xe&&fe.verticalIconBox);fe.iconBox&&sl(r.iconCollisionBox.collisionVertexArray,H.icon.placed,Be,G.hasIconTextFit?De.x:0,G.hasIconTextFit?De.y:0),fe.verticalIconBox&&sl(r.iconCollisionBox.collisionVertexArray,H.icon.placed,!Be,G.hasIconTextFit?De.x:0,G.hasIconTextFit?De.y:0)}}}if(r.fullyClipped=$===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let U=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=U.invProjMatrix,r.placementViewportMatrix=U.viewportMatrix,r.collisionCircleArray=U.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,a){let d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>r}setStale(){this.stale=!0}}function sl(h,r,a,d,g){h.emplaceBack(r?1:0,a?1:0,d||0,g||0),h.emplaceBack(r?1:0,a?1:0,d||0,g||0),h.emplaceBack(r?1:0,a?1:0,d||0,g||0),h.emplaceBack(r?1:0,a?1:0,d||0,g||0)}let v0=Math.pow(2,25),Tm=Math.pow(2,24),Em=Math.pow(2,17),Nd=Math.pow(2,16),x0=Math.pow(2,9),b0=Math.pow(2,8),w0=Math.pow(2,1);function Im(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let r=h.placed?1:0,a=Math.floor(127*h.opacity);return a*v0+r*Tm+a*Em+r*Nd+a*x0+r*b0+a*w0+r}let lc=0;class T0{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,a,d,g,v){let w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(a.getBucketParts(w,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,D)=>E.sortKey-D.sortKey));this._currentPartIndex<w.length;){let E=w[this._currentPartIndex];if(a.placeLayerBucketPart(E,this._seenCrossTileIDs,d,E.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Su{constructor(r,a,d,g,v,w,E,D,S){this.placement=new y0(r,v,w,E,D,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(r,a,d,g){let v=i.f.now(),w=()=>{let E=i.f.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=a[r[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=D)&&(!E.maxzoom||E.maxzoom>D)){let S=E,A=S.layout.get("symbol-z-elevate"),R=this._inProgressLayer=this._inProgressLayer||new T0(S),k=i.ag(E.source,E.scope);if(R.continuePlacement(A?g[k]:d[k],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let kd=512/i.V/2;class Dm{constructor(r,a,d){this.tileID=r,this.bucketInstanceId=d,this.index=new i.bg(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=r.canonical.x*i.V,v=r.canonical.y*i.V;for(let w=0;w<a.length;w++){let{key:E,crossTileID:D,tileAnchorX:S,tileAnchorY:A}=a.get(w),R=Math.floor((g+S)*kd),k=Math.floor((v+A)*kd);this.index.add(R,k),this.keys.push(E),this.crossTileIDs.push(D)}this.index.finish()}findMatches(r,a,d){let g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),v=kd/Math.pow(2,a.canonical.z-this.tileID.canonical.z),w=a.canonical.x*i.V,E=a.canonical.y*i.V;for(let D=0;D<r.length;D++){let S=r.get(D);if(S.crossTileID)continue;let{key:A,tileAnchorX:R,tileAnchorY:k}=S,F=Math.floor((w+R)*v),$=Math.floor((E+k)*v),U=this.index.range(F-g,$-g,F+g,$+g);for(let G of U){let B=this.crossTileIDs[G];if(this.keys[G]===A&&!d.has(B)){d.add(B),S.crossTileID=B;break}}}}}class Fd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Au{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let a=Math.round((r-this.lng)/360);if(a!==0)for(let d in this.indexes){let g=this.indexes[d],v={};for(let w in g){let E=g[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),v[E.tileID.key]=E}this.indexes[d]=v}this.lng=r}addBucket(r,a,d){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);let g=this.usedCrossTileIDs[r.overscaledZ];for(let v in this.indexes){let w=this.indexes[v];if(Number(v)>r.overscaledZ)for(let E in w){let D=w[E];D.tileID.isChildOf(r)&&D.findMatches(a.symbolInstances,r,g)}else{let E=w[r.scaledTo(Number(v)).key];E&&E.findMatches(a.symbolInstances,r,g)}}for(let v=0;v<a.symbolInstances.length;v++){let w=a.symbolInstances.get(v);w.crossTileID||(w.crossTileID=d.generate(),g.add(w.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Dm(r,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(r,a){for(let d of a.crossTileIDs)this.usedCrossTileIDs[r].delete(d)}removeStaleBuckets(r){let a=!1;for(let d in this.indexes){let g=this.indexes[d];for(let v in g)r[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[v]),delete g[v],a=!0)}return a}}class zd{constructor(){this.layerIndexes={},this.crossTileIDs=new Fd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,a,d,g){let v=this.layerIndexes[r.fqid];v===void 0&&(v=this.layerIndexes[r.fqid]=new Au);let w=!1,E={};g.name!=="globe"&&v.handleWrapJump(d);for(let D of a){let S=D.getBucket(r);S&&r.fqid===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,S,this.crossTileIDs)&&(w=!0),E[S.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(r){let a={};r.forEach(d=>{a[d]=!0});for(let d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}class ga{constructor(r=0,a=0,d=0,g=0){if(isNaN(r)||r<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=a,this.left=d,this.right=g}interpolate(r,a,d){return a.top!=null&&r.top!=null&&(this.top=i.U(r.top,a.top,d)),a.bottom!=null&&r.bottom!=null&&(this.bottom=i.U(r.bottom,a.bottom,d)),a.left!=null&&r.left!=null&&(this.left=i.U(r.left,a.left,d)),a.right!=null&&r.right!=null&&(this.right=i.U(r.right,a.right,d)),this}getCenter(r,a){let d=i.aa((this.left+r-this.right)/2,0,r),g=i.aa((this.top+a-this.bottom)/2,0,a);return new i.P(d,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ga(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Pu(h,r){let a=i.bk(h,3);i.a6.fromQuat(h,r),i.bm(h,3,a)}function cc(h,r){let a=i.bi.identity([]);return i.bi.rotateZ(a,a,-r),i.bi.rotateX(a,a,-h),a}function Bd(h,r){let a=[h[0],h[1],0],d=[r[0],r[1],0];if(i.N.length(a)>=1e-15){let w=i.N.normalize([],a);i.N.scale(d,w,i.N.dot(d,w)),r[0]=d[0],r[1]=d[1]}let g=i.N.cross([],r,h);if(i.N.len(g)<1e-15)return null;let v=Math.atan2(-g[1],g[0]);return cc(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class uc{constructor(r,a){this.position=r,this.orientation=a}get position(){return this._position}set position(r){if(r){let a=r instanceof i.L?r:new i.L(r[0],r[1],r[2]);this._renderWorldCopies&&(a.x=i.bh(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(r,a){if(this.orientation=null,!this.position)return;let d=this.position,g=this._elevation?this._elevation.getAtPointOrZero(i.L.fromLngLat(r)):0,v=i.L.fromLngLat(r,g),w=[v.x-d.x,v.y-d.y,v.z-d.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Bd(w,a)}setPitchBearing(r,a){this.orientation=cc(i.bj(r),i.bj(-a))}}class al{constructor(r,a){this._transform=i.a6.identity([]),this.orientation=a,this.position=r}get mercatorPosition(){let r=this.position;return new i.L(r[0],r[1],r[2])}get position(){let r=i.bk(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var a;r&&i.bm(this._transform,3,[(a=r)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.bi.identity([]),r&&Pu(this._transform,this._orientation)}getPitchBearing(){let r=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,a){this._orientation=cc(r,a),Pu(this._transform,this._orientation)}forward(){let r=i.bk(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){let r=i.bk(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){let r=i.bk(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,a){let d=new Float64Array(16);return i.a6.invert(d,this.getWorldToCamera(r,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,a,d){let g=this.position;i.N.scale(g,g,-r);let v=new Float64Array(16);return i.a6.fromScaling(v,[d,d,d]),i.a6.translate(v,v,g),v[10]*=a,v}getWorldToCamera(r,a){let d=new Float64Array(16),g=new Float64Array(4),v=this.position;return i.bi.conjugate(g,this._orientation),i.N.scale(v,v,-r),i.a6.fromQuat(d,g),i.a6.translate(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(r,a,d,g){let v=new Float64Array(16);return i.a6.perspective(v,r,a,d,g),v}getCameraToClipOrthographic(r,a,d,g,v,w){let E=new Float64Array(16);return i.a6.ortho(E,r,a,d,g,v,w),E}getDistanceToElevation(r,a=!1){let d=r===0?0:i.bl(r,a?i.au(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new al([...this.position],[...this.orientation])}}let ll=(h,r,a)=>(1-a)*h+a*r,hc=h=>h*h*h*h*h;class dc{constructor(r,a,d,g,v,w,E){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new i.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ga,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new al,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let r=new dc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,a=!1){let d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(r||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return i.ac(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};let a=this.projection?this.getProjection():void 0;this.projection=i.bo(this.projectionOptions);let d=!C(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){let r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bo({name:"mercator"});let a=r!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bh(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){let a=-r*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=i.b4.create(),i.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let a=i.aa(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.bj(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){let a=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){let r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop(),g=0,v=0;for(let w=0;w<a.length;w++){let E=new i.P(a[w][0]*this.width,d+a[w][1]*(this.height-d)),D=r.pointCoordinate(E);if(!D)continue;let S=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);g+=D[3]*S,v+=S}return v===0?NaN:g/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let r=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),w=Math.max(g-d,v);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){let a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude())),d;d=r.z<this._camera.position[2]?[a.x,a.y,a.z]:[r.x,r.y,r.z];let g=i.N.length(i.N.sub([],this._camera.position,d));return i.aa(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let a=!1;if(r.orientation&&!i.bi.exactEquals(r.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(r.orientation)),r.position){let d=[r.position.x,r.position.y,r.position.z];i.N.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,a=new uc;return a.position=new i.L(r[0],r[1],r[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(r){if(!i.bi.length(r))return!1;i.bi.normalize(r,r);let a=i.N.transformQuat([],[0,0,-1],r),d=i.N.transformQuat([],[0,-1,0],r);if(d[2]<0)return!1;let g=Bd(a,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(r){let a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;r[2]=i.aa(r[2],g/d,g/a),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,a,d){this._unmodified=!1,this._edgeInsets.interpolate(r,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){let a=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(r){let a=[new i.bp(0,r)];if(this.renderWorldCopies){let d=this.pointCoordinate(new i.P(0,0)),g=this.pointCoordinate(new i.P(this.width,0)),v=this.pointCoordinate(new i.P(this.width,this.height)),w=this.pointCoordinate(new i.P(0,this.height)),E=Math.floor(Math.min(d.x,g.x,v.x,w.x)),D=Math.floor(Math.max(d.x,g.x,v.x,w.x)),S=1;for(let A=E-S;A<=D+S;A++)A!==0&&a.push(new i.bp(A,r))}return a}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,a,d){let g=[];if(a[0]===0&&a[1]===0)return g;for(let w of r){let E=w.canonical,D=w.overscaledZ,S=w.wrap,A=1<<E.z,R=E.x+1<A,k=E.x>0,F=E.y+1<A,$=E.y>0,U=w.wrap-(k?0:1),G=w.wrap+(R?0:1),B=k?E.x-1:A-1,q=R?E.x+1:0;a[0]<0?(g.push(new i.am(D,G,E.z,q,E.y)),a[1]<0&&F&&(g.push(new i.am(D,S,E.z,E.x,E.y+1)),g.push(new i.am(D,G,E.z,q,E.y+1))),a[1]>0&&$&&(g.push(new i.am(D,S,E.z,E.x,E.y-1)),g.push(new i.am(D,G,E.z,q,E.y-1)))):a[0]>0?(g.push(new i.am(D,U,E.z,B,E.y)),a[1]<0&&F&&(g.push(new i.am(D,S,E.z,E.x,E.y+1)),g.push(new i.am(D,U,E.z,B,E.y+1))),a[1]>0&&$&&(g.push(new i.am(D,S,E.z,E.x,E.y-1)),g.push(new i.am(D,U,E.z,B,E.y-1)))):a[1]<0&&F?g.push(new i.am(D,S,E.z,E.x,E.y+1)):$&&g.push(new i.am(D,S,E.z,E.x,E.y-1))}if(g.length>1){g.sort((D,S)=>D.overscaledZ-S.overscaledZ||D.wrap-S.wrap||D.canonical.z-S.canonical.z||D.canonical.x-S.canonical.x||D.canonical.y-S.canonical.y);let w=0,E=0;for(;E<g.length;)g[E].equals(g[w])?++E:g[++w]=g[E++];g.length=w+1}let v=[];for(let w of g)g.some(E=>w.isChildOf(E))||v.push(w);return g=v.filter(w=>!r.some(E=>!!(w.overscaledZ<d&&E.isChildOf(w))||w.equals(E)||w.isChildOf(E))),g}coveringTiles(r){let a=this.coveringZoomLevel(r),d=a,g=this.elevation&&this.elevation.exaggeration(),v=g&&!r.isTerrainDEM,w=this.projection.name==="mercator";if(r.minzoom!==void 0&&a<r.minzoom)return[];r.maxzoom!==void 0&&a>r.maxzoom&&(a=r.maxzoom);let E=this.locationCoordinate(this.center),D=this.center.lat,S=1<<a,A=[S*E.x,S*E.y,0],R=this.projection.name==="globe",k=!R,F=i.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,k),$=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=S*i.bl(1,this.center.lat),G=this._camera.position[2]/i.bl(1,this.center.lat),B=[S*$.x,S*$.y,G*(k?1:U)],q=R||g,Q=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),X=this.isLODDisabled(!0)?a:0,ee;if(this._elevation&&r.isTerrainDEM)ee=1e4*this._elevation.exaggeration();else if(this._elevation){let ce=this._elevation.getMinMaxForVisibleTiles();ee=ce?ce.max:this._centerAltitude}else ee=this._centerAltitude;let H=r.isTerrainDEM?-ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,te=this.projection.isReprojectedInTileSpace?i.br(this):1,oe=ce=>{let je=new i.L(ce.x+25e-6,ce.y,ce.z),We=new i.L(ce.x,ce.y+25e-6,ce.z),qe=ce.toLngLat(),et=je.toLngLat(),ft=We.toLngLat(),wt=this.locationCoordinate(qe),_t=this.locationCoordinate(et),xt=this.locationCoordinate(ft),Ut=Math.hypot(_t.x-wt.x,_t.y-wt.y),Rt=Math.hypot(xt.x-wt.x,xt.y-wt.y);return Math.sqrt(Ut*Rt)*te/25e-6},ae=ce=>{let _e=ee,je=H;return{aabb:i.bu(this,S,0,0,0,ce,je,_e,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:_e,wrap:ce,fullyVisible:!1}},ue=[],xe=[],fe=a,De=r.reparseOverscaled?d:a,Ee=ce=>ce*ce,Be=Ee((G-this._centerAltitude)*U),pe=ce=>{if(!this._elevation||!ce.tileID||!w)return;let _e=this._elevation.getMinMaxForTile(ce.tileID),je=ce.aabb;_e?(je.min[2]=_e.min,je.max[2]=_e.max,je.center[2]=(je.min[2]+je.max[2])/2):(ce.shouldSplit=we(ce),ce.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},we=ce=>{if(ce.zoom<X)return!0;if(ce.zoom===fe)return!1;if(ce.shouldSplit!=null)return ce.shouldSplit;let _e=ce.aabb.distanceX(B),je=ce.aabb.distanceY(B),We=Be,qe=1;if(R){We=Ee(ce.aabb.distanceZ(B));let wt=Math.pow(2,ce.zoom),_t=i.au((ce.y+1)/wt),xt=i.au(ce.y/wt),Ut=Math.min(Math.max(D,_t),xt),Rt=i.bJ(Ut)/i.bJ(D);if(qe=Ut===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Rt/this._mercatorScaleRatio),this.zoom<=i.bG&&ce.zoom===fe-1&&Rt>=.9)return!0}else if(v&&(We=Ee(ce.aabb.distanceZ(B)*U)),this.projection.isReprojectedInTileSpace&&d<=5){let wt=Math.pow(2,ce.zoom),_t=oe(new i.L((ce.x+.5)/wt,(ce.y+.5)/wt));qe=_t>.85?1:_t}let et=_e*_e+je*je+We,ft=Ee((1<<fe-ce.zoom)*Q*qe*((wt,_t)=>{if(_t*Ee(.707)<wt)return 1;let xt=Math.sqrt(_t/wt);return xt/(1.4144271570014144+(Math.pow(1.1,xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(We,Be),et));return et<ft};if(this.renderWorldCopies)for(let ce=1;ce<=3;ce++)ue.push(ae(-ce)),ue.push(ae(ce));for(ue.push(ae(0));ue.length>0;){let ce=ue.pop(),_e=ce.x,je=ce.y,We=ce.fullyVisible,qe=()=>this.projection.name==="globe"&&(ce.y===0||ce.y===(1<<ce.zoom)-1);if(!We){let et=q?ce.aabb.intersects(F):ce.aabb.intersectsFlat(F);if(et===0&&qe()){let ft=new i.bs(ce.zoom,_e,je);et=i.bt(this,S,ft,!0).intersects(F)}if(et===0)continue;We=et===2}if(ce.zoom!==fe&&we(ce))for(let et=0;et<4;et++){let ft=(_e<<1)+et%2,wt=(je<<1)+(et>>1),_t={aabb:w?ce.aabb.quadrant(et):i.bu(this,S,ce.zoom+1,ft,wt,ce.wrap,ce.minZ,ce.maxZ,this.projection),zoom:ce.zoom+1,x:ft,y:wt,wrap:ce.wrap,fullyVisible:We,tileID:void 0,shouldSplit:void 0,minZ:ce.minZ,maxZ:ce.maxZ};v&&!R&&(_t.tileID=new i.am(ce.zoom+1===fe?De:ce.zoom+1,ce.wrap,ce.zoom+1,ft,wt),pe(_t)),ue.push(_t)}else{let et=ce.zoom===fe?De:ce.zoom;if(r.minzoom&&r.minzoom>et)continue;if(!We){let xt=q?ce.aabb.intersectsPrecise(F):ce.aabb.intersectsPreciseFlat(F);if(xt===0&&qe()){let Ut=new i.bs(ce.zoom,_e,je);xt=i.bt(this,S,Ut,!0).intersectsPrecise(F)}if(xt===0)continue}let ft=A[0]-(.5+_e+(ce.wrap<<ce.zoom))*(1<<a-ce.zoom),wt=A[1]-.5-je,_t=ce.tileID?ce.tileID:new i.am(et,ce.wrap,ce.zoom,_e,je);xe.push({tileID:_t,distanceSq:ft*ft+wt*wt})}}if(this.fogCullDistSq){let ce=this.fogCullDistSq,_e=this.horizonLineFromTop();xe=xe.filter(je=>{let We=[0,0,0,1],qe=[i.V,i.V,0,1],et=this.calculateFogTileMatrix(je.tileID.toUnwrapped());i.a7.transformMat4(We,We,et),i.a7.transformMat4(qe,qe,et);let ft=i.a7.min([],We,qe),wt=i.a7.max([],We,qe),_t=i.bv(ft,wt);if(_t===0)return!0;let xt=!1,Ut=this._elevation;if(Ut&&_t>ce&&_e!==0){let Rt=this.calculateProjMatrix(je.tileID.toUnwrapped()),zt;r.isTerrainDEM||(zt=Ut.getMinMaxForTile(je.tileID)),zt||(zt={min:H,max:ee});let kt=i.bH(this.rotation),dn=[kt[0]*i.V,kt[1]*i.V,zt.max];i.N.transformMat4(dn,dn,Rt),xt=(1-dn[1])*this.height*.5<_e}return _t<ce||xt})}return xe.sort((ce,_e)=>ce.distanceSq-_e.distanceSq).map(ce=>ce.tileID)}resize(r,a){this.width=r,this.height=a,this.pixelsToGLUnits=[2/r,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){let a=i.aa(r.lat,-i.bw,i.bw),d=this.projection.project(r.lng,a);return new i.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,a){let d,g,v=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;d=(a.x-v.x)/E,g=(a.y-v.y)/E}else{let E=this.pointCoordinate(a),D=this.pointCoordinate(v);d=E.x-D.x,g=E.y-D.y}let w=this.locationCoordinate(r);this.setLocation(new i.L(w.x-d,w.y-g))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,a){let d=a?i.bl(a,r.lat):void 0,g=this.projection.project(r.lng,r.lat);return new i.L(g.x,g.y,d)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,a){let d=a??this._centerAltitude,g=[r.x,r.y,0,1],v=[r.x,r.y,1,1];i.a7.transformMat4(g,g,this.pixelMatrixInverse),i.a7.transformMat4(v,v,this.pixelMatrixInverse);let w=v[3];i.a7.scale(g,g,1/g[3]),i.a7.scale(v,v,1/w);let E=g[2],D=v[2];return{p0:g,p1:v,t:E===D?0:(d-E)/(D-E)}}screenPointToMercatorRay(r){let a=[r.x,r.y,0,1],d=[r.x,r.y,1,1];return i.a7.transformMat4(a,a,this.pixelMatrixInverse),i.a7.transformMat4(d,d,this.pixelMatrixInverse),i.a7.scale(a,a,1/a[3]),i.a7.scale(d,d,1/d[3]),a[2]=i.bl(a[2],this._center.lat)*this.worldSize,d[2]=i.bl(d[2],this._center.lat)*this.worldSize,i.a7.scale(a,a,1/this.worldSize),i.a7.scale(d,d,1/this.worldSize),new i.a2([a[0],a[1],a[2]],i.N.normalize([],i.N.sub([],d,a)))}rayIntersectionCoordinate(r){let{p0:a,p1:d,t:g}=r,v=i.bl(a[2],this._center.lat),w=i.bl(d[2],this._center.lat);return new i.L(i.U(a[0],d[0],g)/this.worldSize,i.U(a[1],d[1],g)/this.worldSize,i.U(v,w,g))}pointCoordinate(r,a=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,a)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let a=this.projection.pointCoordinate3D(this,r.x,r.y);if(a)return new i.L(a[0],a[1],a[2]);let d=0,g=this.horizonLineFromTop();if(r.y>g)return this.pointCoordinate(r);let v=.02*g,w=r.clone();for(let E=0;E<10&&g-d>v;E++){w.y=i.U(d,g,.66);let D=this.projection.pointCoordinate3D(this,w.x,w.y);D?(g=w.y,a=D):d=w.y}return a?new i.L(a[0],a[1],a[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.bx)return!this.isPointAboveHorizon(r);let a=this.pointCoordinate(r);return a.y>=0&&a.y<=1}_coordinatePoint(r,a){let d=a&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,g=[r.x*this.worldSize,r.y*this.worldSize,d+r.toAltitude(),1];return i.a7.transformMat4(g,g,this.pixelMatrix),g[3]>0?new i.P(g[0]/g[3],g[1]/g[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:r,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new i.P(a,r)),w=this.pointLocation3D(new i.P(g,r)),E=this.pointLocation3D(new i.P(g,d)),D=this.pointLocation3D(new i.P(a,d)),S=Math.min(v.lng,w.lng,E.lng,D.lng),A=Math.max(v.lng,w.lng,E.lng,D.lng),R=Math.min(v.lat,w.lat,E.lat,D.lat),k=Math.max(v.lat,w.lat,E.lat,D.lat),F=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,U=(G,B,q,Q,X)=>{let ee=(G+q)/2,H=(B+Q)/2,te=new i.P(ee,H),{lng:oe,lat:ae}=this.pointLocation3D(te),ue=Math.max(0,S-oe,R-ae,oe-A,ae-k);S=Math.min(S,oe),A=Math.max(A,oe),R=Math.min(R,ae),k=Math.max(k,ae),(X<$||ue>F)&&(U(G,B,ee,H,X+1),U(ee,H,q,Q,X+1))};if(U(a,r,g,r,1),U(g,r,g,d,1),U(g,d,a,d,1),U(a,d,a,r,1),this.projection.name==="globe"){let[G,B]=i.by(this);G?(k=90,A=180,S=-180):B&&(R=-90,A=180,S=-180)}return new i.ad(new i.bn(S,R),new i.bn(A,k))}_getBoundsRectangular(r,a){let{top:d,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new i.P(g,d),D=new i.P(w,d),S=new i.P(w,v),A=new i.P(g,v),R=this.pointCoordinate(E,r),k=this.pointCoordinate(D,r),F=this.pointCoordinate(S,a),$=this.pointCoordinate(A,a),U=(G,B)=>(B.y-G.y)/(B.x-G.x);return R.y>1&&k.y>=0?R=new i.L((1-$.y)/U($,R)+$.x,1):R.y<0&&k.y<=1&&(R=new i.L(-$.y/U($,R)+$.x,0)),k.y>1&&R.y>=0?k=new i.L((1-F.y)/U(F,k)+F.x,1):k.y<0&&R.y<=1&&(k=new i.L(-F.y/U(F,k)+F.x,0)),new i.ad().extend(this.coordinateLocation(R)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(F))}_getBoundsRectangularTerrain(){let r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);let a=r.visibleDemTiles.reduce((d,g)=>{if(g.dem){let v=g.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*r.exaggeration(),a.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){let a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return r?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-i.bw,this.maxLat=i.bw,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.a5(this.minLng)*this.tileSize,this.worldMaxX=i.a5(this.maxLng)*this.tileSize,this.worldMinY=i.ae(this.maxLat)*this.tileSize,this.worldMaxY=i.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,a){return this.projection.createTileMatrix(this,a,r)}calculateDistanceTileData(r){let a=r.key,d=this._distanceTileDataCache;if(d[a])return d[a];let g=r.canonical,v=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(g.z),D=(g.x+Math.pow(2,g.z)*r.wrap)*E,S=g.y*E,A=this.point;A.x*=w/this.worldSize,A.y*=w/this.worldSize;let R=this.angle,k=Math.sin(-R),F=-Math.cos(-R);return d[a]={bearing:[k,F],center:[(A.x-D)*v,(A.y-S)*v],scale:E/i.V*v},d[a]}calculateFogTileMatrix(r){let a=r.key,d=this._fogTileMatrixCache;if(d[a])return d[a];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.a6.multiply(g,this.worldToFogMatrix,g),d[a]=new Float32Array(g),d[a]}calculateProjMatrix(r,a=!1,d=!1){let g=r.key,v;if(v=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];let w=this.calculatePosMatrix(r,this.worldSize),E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,i.a6.multiply(w,E,w),v[g]=new Float32Array(w),v[g]}calculatePixelsToTileUnitsMatrix(r){let a=r.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];let g=i.bz(r,this);return d[a]=g,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let r=1/this.worldSize,a=i.a6.fromScaling([],[r,r,r]);return i.a6.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let r=this._elevation;this._updateCameraState();let a=i.bl(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),g=this._camera.forward(),v=i.bl(1,this._center.lat);d[2]/=v,g[2]/=v,i.N.normalize(g,g);let w=r.raycast(d,g,r.exaggeration());if(w){let E=i.N.scaleAndAdd([],d,g,w),D=new i.L(E[0],E[1],i.bl(E[2],i.au(E[1]))),S=(D.z+i.N.length([D.x-d[0],D.y-d[1],D.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(S),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;let a=this._elevation,d=i.bl(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),v=a.getAtPointOrZero(new i.L(...g)),w=this.pixelsPerMeter/this.worldSize*v,E=this._minimumHeightOverTerrain(),D=g[2]-w;if(D<=E)if(D<0||r){let S=this.locationCoordinate(this._center,this._centerAltitude),A=[g[0],g[1],S.z-g[2]],R=i.N.length(A);A[2]-=(E-D)/this._pixelsPerMercatorPixel;let k=i.N.length(A);if(k===0)return;i.N.scale(A,A,R/k*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],S.z*this._pixelsPerMercatorPixel-A[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){let k=this.center;return k.lat=i.aa(k.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(k.lng=i.aa(k.lng,this.minLng,this.maxLng)),this.center=k,void(this._constraining=!1)}let a=this._unmodified,{x:d,y:g}=this.point,v=0,w=d,E=g,D=this.width/2,S=this.height/2,A=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(g-S<A&&(E=A+S),g+S>R&&(E=R-S),R-A<this.height&&(v=Math.max(v,this.height/(R-A)),E=(R+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let k=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,$=this.worldSize/2-(k+F)/2;w=(d+$+this.worldSize)%this.worldSize-$,w-D<k&&(w=k+D),w+D>F&&(w=F-D),F-k<this.width&&(v=Math.max(v,this.width/(F-k)),w=(F+k)/2)}w===d&&E===g||(this.center=this.unproject(new i.P(w,E))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bl(1,this.center.lat)/i.bl(1,i.bI));let g=i.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?d:1,w=this._camera.getWorldToCamera(this.worldSize,v),E,D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-r.x/this.width,D[9]=2*r.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ue=ae*this.aspect,xe=-ue,fe=-ae;ue-=r.x,xe-=r.x,ae+=r.y,fe+=r.y,E=this._camera.getCameraToClipOrthographic(xe,ue,fe,ae,this._nearZ,this._farZ),((De,Ee,Be,pe)=>{for(let we=0;we<16;we++)De[we]=ll(Ee[we],Be[we],pe)})(E,E,D,hc(this.pitch>=15?1:this.pitch/15))}else E=D;let S=i.a6.mul([],D,w),A=i.a6.mul([],E,w);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),ue=i.a6.identity([]);i.a6.translate(ue,ue,[ae.x*this.worldSize,ae.y*this.worldSize,0]),i.a6.multiply(ue,ue,i.bB(this)),i.a6.translate(ue,ue,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),i.a6.multiply(A,A,ue),i.a6.multiply(S,S,ue),this.inverseAdjustmentMatrix=i.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.a6.scale([],A,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=A,this.invProjMatrix=i.a6.invert(new Float64Array(16),this.projMatrix),a){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-r.x/this.width,ae[9]=2*r.y/this.height,this.expandedFarZProjMatrix=i.a6.mul([],ae,w)}else this.expandedFarZProjMatrix=this.projMatrix;let R=i.a6.invert([],E);this.frustumCorners=i.bD.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);let k=new Float32Array(16);i.a6.identity(k),i.a6.scale(k,k,[1,-1,1]),i.a6.rotateX(k,k,this._pitch),i.a6.rotateZ(k,k,this.angle);let F=i.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.a6.clone(F);let $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-r.x/this.width,F[9]=2*(r.y+$)/this.height,this.skyboxMatrix=i.a6.multiply(k,F,k);let U=this.point,G=U.x,B=U.y,q=this.width%2/2,Q=this.height%2/2,X=Math.cos(this.angle),ee=Math.sin(this.angle),H=G-Math.round(G)+X*q+ee*Q,te=B-Math.round(B)+X*Q+ee*q,oe=new Float64Array(A);if(i.a6.translate(oe,oe,[H>.5?H-1:H,te>.5?te-1:te,0]),this.alignedProjMatrix=oe,A=i.a6.create(),i.a6.scale(A,A,[this.width/2,-this.height/2,1]),i.a6.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=i.a6.create(),i.a6.scale(A,A,[1,-1,1]),i.a6.translate(A,A,[-1,-1,0]),i.a6.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=i.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,S),this._calcFogMatrices(),this._distanceTileDataCache={},A=i.a6.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.bE(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.N.transformMat4(ae,ae,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,a];i.N.scale(v,v,g),i.N.scale(d,d,-1),i.N.multiply(d,d,v);let w=i.a6.create();i.a6.translate(w,w,d),i.a6.scale(w,w,v),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,a,g)}_computeCameraPosition(r){let a=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-r/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*v,g.y/this.worldSize-d[1]*v,r/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){let a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=r[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((a-d)/g,1)),this._camera.position=i.N.scaleAndAdd([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),v=i.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.bj(this._maxPitch)),E=Math.max((r[2]-v)/Math.cos(d),w),D=this._zoomFromMercatorZ(E);i.N.scaleAndAdd(r,r,a,E),this._pitch=i.aa(d,i.bj(this.minPitch),i.bj(this.maxPitch)),this.angle=i.bh(g,-Math.PI,Math.PI),this._setZoom(i.aa(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.L(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){let r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let a=0,d=i.bx,g=0,v=1/0;for(;d-a>1e-6&&d>a;){let w=a+.5*(d-a),E=this.tileSize*Math.pow(2,w),D=this.getCameraToCenterDistance(this.projection,w,E),S=this.scaleZoom(D/(r*this.tileSize)),A=Math.abs(w-S);A<v&&(v=A,g=w),w<S?a=w:d=w}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,a){let d=Math.min(r.x,a.x),g=Math.max(r.x,a.x),v=Math.min(r.y,a.y),w=Math.max(r.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new i.P(d,v),new i.P(g,w),new i.P(d,w),new i.P(g,v)],D=this.renderWorldCopies?-3:0,S=this.renderWorldCopies?4:1;for(let A of E){let R=this.pointRayIntersection(A);if(R.t<0)return!0;let k=this.rayIntersectionCoordinate(R);if(k.x<D||k.y<0||k.x>S||k.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(r,a){let d=i.N.length(i.N.sub([],this._camera.position,r)),g=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let r=function([a,d,g],v){let w=[a,d,g,1];i.a7.transformMat4(w,w,v);let E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(r[0],r[1])}{let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,r))}}getCameraToCenterDistance(r,a=this.zoom,d=this.worldSize){let g=i.bA(r,a,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,d,g),w=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(w=ll(1,w,hc(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){let r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.a6.multiply(r,r,this.globeMatrix),r}getFrustum(r){return i.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}let ei={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},As=(h,r)=>{if(r>0&&h.terrain&&i.w("Cutoff is currently disabled on terrain"),r<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let a=h.transform,d=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?i.O(60,45,a.pitch):i.O(30,15,a.pitch),v=a._farZ-a._nearZ,w=r*a.height,E=((1-(D=g))*a.cameraToCenterDistance+D*(a._farZ+w))*d;var D;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(E-a._nearZ)/v,(E-w-a._nearZ)/v]}}},vi={cascadeCount:2,shadowMapResolution:2048};class jd{constructor(r,a){this.aabb=r,this.lastCascade=a}}class Mm{add(r,a){let d=this.receivers[r.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[r.key]=new jd(a,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,a,d){let g=i.bS.fromPoints(r.points),v=0;for(let w in this.receivers){let E=this.receivers[w];if(!E||!g.intersectsAabb(E.aabb))continue;E.aabb.min=g.closestPoint(E.aabb.min),E.aabb.max=g.closestPoint(E.aabb.max);let D=E.aabb.getCorners();for(let S=0;S<d.length;S++){let A=!0;for(let R of D){let k=[R[0]*a,R[1]*a,R[2]];if(i.N.transformMat4(k,k,d[S].matrix),k[0]<-1||k[0]>1||k[1]<-1||k[1]>1){A=!1;break}}if(E.lastCascade=S,v=Math.max(v,S),A)break}}return v+1}}class Vd{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Mm,this._depthMode=new Dt(r.context.gl.LEQUAL,Dt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,r.tp.registerParameter(vi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(vi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(let r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,a){let d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;let g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=d.style.order.reduce(($,U)=>{let G=d.style._mergedLayers[U];return $+(G.hasShadowPass()&&!G.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let v=d.context,w=vi.shadowMapResolution,E=vi.shadowMapResolution;if(this._cascades.length===0||vi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<vi.cascadeCount;++$){let U=d._shadowMapDebug,G=v.gl,B=v.createFramebuffer(w,E,U,"texture"),q=new i.T(v,{width:w,height:E,data:null},G.DEPTH_COMPONENT);if(B.depthAttachment.set(q.texture),U){let Q=new i.T(v,{width:w,height:E,data:null},G.RGBA);B.colorAttachment.set(Q.texture)}this._cascades.push({framebuffer:B,texture:q,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bq,scale:0})}}this.shadowDirection=Ru(a);let D=0;if(r.elevation){let $=r.elevation,U=[1e4,-1e4];$.visibleDemTiles.filter(G=>G.dem).forEach(G=>{let B=G.dem.tree;U[0]=Math.min(U[0],B.minimums[0]),U[1]=Math.max(U[1],B.maximums[0])}),U[0]!==1e4&&(D=(U[1]-U[0])*$.exaggeration())}let S=1.5*r.cameraToCenterDistance,A=3*S,R=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){let U=this._cascades[$],G=r.height/50,B=1;vi.cascadeCount===1?B=A:$===0?B=S:(G=S,B=A);let[q,Q]=Cm(r,this.shadowDirection,G,B,vi.shadowMapResolution,D);U.scale=r.scale,U.matrix=q,U.boundingSphereRadius=Q,i.a6.invert(R,U.matrix),U.frustum=i.bq.fromInvProjectionMatrix(R,1,0,!0),U.far=B}let k=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[k].far,this._cascades[k].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/vi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=vi.shadowMapResolution,this._uniformValues.u_shadowmap_0=ei.ShadowMap0,this._uniformValues.u_shadowmap_1=ei.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let F=d.transform.elevation;for(let $ of this._groundShadowTiles){let U={min:0,max:0};if(F){let G=F.getMinMaxForTile($);G&&(U=G)}this.addShadowReceiver($.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled}set enabled(r){this._enabled=r}drawShadowPass(r,a){if(!this._enabled)return;let d=this.painter,g=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),g.viewport.set([0,0,vi.shadowMapResolution,vi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){d.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:i.ax.white,depth:1});for(let w of r.order){let E=r._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(d.transform.zoom))continue;let D=r.getLayerSourceCache(E),S=D?a[D.id]:void 0;(E.type==="model"||S&&S.length)&&d.renderLayer(d,D,E,S)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let r=this.painter,a=r.style,d=r.context,g=a.directionalLight,v=a.ambientLight;if(!g||!v)return;let w=[],E=As(r,r.longestCutoffRange);E.shouldRenderCutoff&&w.push("RENDER_CUTOFF");let D=fc(g,v),S=new Dt(d.gl.LEQUAL,Dt.ReadOnly,r.depthRangeFor3D);for(let A of this._groundShadowTiles){let R=A.toUnwrapped(),k=r.isTileAffectedByFog(A),F=r.getOrCreateProgram("groundShadow",{defines:w,overrideFog:k});this.setupShadows(R,F),r.uploadCommonUniforms(d,F,R,null,E);let $={u_matrix:r.transform.calculateProjMatrix(R),u_ground_shadow_factor:D};F.draw(r,d.gl.TRIANGLES,S,Lt.disabled,Kt.multiply,Mt.disabled,$,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Kt.unblended:Kt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){let a=this.painter.transform,d=a.calculatePosMatrix(r,a.worldSize);return i.a6.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(r){return i.a6.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,a,d,g=0){if(!this._enabled)return;let v=this.painter.transform,w=this.painter.context,E=w.gl,D=this._uniformValues,S=new Float64Array(16),A=v.calculatePosMatrix(r,v.worldSize);for(let R=0;R<this._cascades.length;R++)i.a6.multiply(S,this._cascades[R].matrix,A),D[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),w.activeTexture.set(E.TEXTURE0+ei.ShadowMap0+R),this._cascades[R].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){let R=i.bR(r.canonical),k=2/v.tileSize*i.V/vi.shadowMapResolution,F=k*this._cascades[0].boundingSphereRadius,$=k*this._cascades[this._cascades.length-1].boundingSphereRadius,U=(d==="vector-tile"?1:3)/Math.pow(2,g-r.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[R,F*U,$*U],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(w,D)}setupShadowsFromMatrix(r,a,d=!1){if(!this._enabled)return;let g=this.painter.context,v=g.gl,w=this._uniformValues,E=new Float64Array(16);for(let D=0;D<vi.cascadeCount;D++)i.a6.multiply(E,this._cascades[D].matrix,r),w[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),g.activeTexture.set(v.TEXTURE0+ei.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=d,d?(w.u_shadow_normal_offset=[1,5,5],w.u_shadow_bias=[6e-5,.0012,.012]):w.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(g,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,a,d,g){if(g[2]>=0)return{};let v=function(D,S,A){let R=A/(1<<D.canonical.z);return new i.bS([D.canonical.x*R+D.wrap*A,D.canonical.y*R+D.wrap*A,0],[(D.canonical.x+1)*R+D.wrap*A,(D.canonical.y+1)*R+D.wrap*A,S])}(r,a,d).getCorners(),w=a/-g[2];g[0]<0?(i.N.add(v[0],v[0],[g[0]*w,0,0]),i.N.add(v[3],v[3],[g[0]*w,0,0])):g[0]>0&&(i.N.add(v[1],v[1],[g[0]*w,0,0]),i.N.add(v[2],v[2],[g[0]*w,0,0])),g[1]<0?(i.N.add(v[0],v[0],[0,g[1]*w,0]),i.N.add(v[1],v[1],[0,g[1]*w,0])):g[1]>0&&(i.N.add(v[2],v[2],[0,g[1]*w,0]),i.N.add(v[3],v[3],[0,g[1]*w,0]));let E={};return E.vertices=v,E.planes=[_a(v[1],v[0],v[4]),_a(v[2],v[1],v[5]),_a(v[3],v[2],v[6]),_a(v[0],v[3],v[7])],E}addShadowReceiver(r,a,d){this._receivers.add(r,i.bS.fromTileIdAndHeight(r,a,d))}getMaxCascadeForTile(r){let a=this._receivers.get(r);return a&&a.lastCascade?a.lastCascade:0}}function _a(h,r,a){let d=i.N.sub([],a,r),g=i.N.sub([],h,r),v=i.N.cross([],d,g),w=i.N.length(v);return w===0?[0,0,1,0]:(i.N.scale(v,v,1/w),[v[0],v[1],v[2],-i.N.dot(v,r)])}function Ru(h){let r=h.properties.get("direction"),a=i.bQ(r.x,r.y,r.z);a[2]=i.aa(a[2],0,75);let d=i.bT([a[0],a[1],a[2]]);return i.N.fromValues(d.x,d.y,d.z)}function fc(h,r){let a=h.properties.get("color"),d=h.properties.get("intensity"),g=h.properties.get("direction"),v=[g.x,g.y,g.z],w=r.properties.get("color"),E=r.properties.get("intensity"),D=Math.max(i.N.dot([0,0,1],v),0),S=[0,0,0];i.N.scale(S,w.toArray01Linear().slice(0,3),E);let A=[0,0,0];return i.N.scale(A,a.toArray01Linear().slice(0,3),D*d),i.bU([S[0]>0?S[0]/(S[0]+A[0]):0,S[1]>0?S[1]/(S[1]+A[1]):0,S[2]>0?S[2]/(S[2]+A[2]):0])}function Cm(h,r,a,d,g,v){let w=h.zoom,E=h.scale,D=h.worldSize,S=1/D,A=h.aspect,R=Math.sqrt(1+A*A)*Math.tan(.5*h.fovX),k=R*R,F=d-a,$=d+a,U,G;k>F/$?(U=d,G=d*R):(U=.5*$*(1+k),G=.5*Math.sqrt(F*F+2*(d*d+a*a)*k+$*$*k*k));let B=h.projection.pixelsPerMeter(h.center.lat,D),q=h._camera.getCameraToWorldMercator(),Q=[0,0,-U*S];i.N.transformMat4(Q,Q,q);let X=G*S,ee=h._edgeInsets;if(!(ee.left===0&&ee.top===0&&ee.right===0&&ee.bottom===0||ee.left===ee.right&&ee.top===ee.bottom)){let We=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?B:1),qe=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,d);qe[8]=2*-h.centerOffset.x/h.width,qe[9]=2*h.centerOffset.y/h.height;let et=new Float64Array(16);i.a6.mul(et,qe,We);let ft=new Float64Array(16);i.a6.invert(ft,et);let wt=i.bq.fromInvProjectionMatrix(ft,D,w,!0);for(let _t of wt.points){let xt=((H=_t)[0]/=E,H[1]/=E,H[2]=i.bl(H[2],h._center.lat),H);X=Math.max(X,i.N.len(i.N.subtract([],Q,xt)))}}var H;X*=g/(g-1);let te=Math.acos(r[2]),oe=Math.atan2(-r[0],-r[1]),ae=new al;ae.position=Q,ae.setPitchBearing(te,oe);let ue=ae.getWorldToCamera(D,B),xe=X*D,fe=Math.min(h._mercatorZfromZoom(17)*D*-2,-2*xe),De=ae.getCameraToClipOrthographic(-xe,xe,-xe,xe,fe,(xe+v*B)/r[2]),Ee=new Float64Array(16);i.a6.multiply(Ee,De,ue);let Be=i.N.fromValues(Math.floor(1e6*Q[0])/1e6*D,Math.floor(1e6*Q[1])/1e6*D,0),pe=.5*g,we=[0,0,0];i.N.transformMat4(we,Be,Ee),i.N.scale(we,we,pe);let ce=[Math.floor(we[0]),Math.floor(we[1]),Math.floor(we[2])],_e=[0,0,0];i.N.sub(_e,we,ce),i.N.scale(_e,_e,-1/pe);let je=new Float64Array(16);return i.a6.identity(je),i.a6.translate(je,je,_e),i.a6.multiply(Ee,je,Ee),[Ee,xe]}let Ps=(h,r)=>gt(h,r&&r.filter(a=>a.identifier!=="source.canvas")),Sm=i.ac(hn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),cl=i.ac(hn,["setCenter","setZoom","setBearing","setPitch"]),Ud={version:8,layers:[],sources:{}},Am={duration:300,delay:0},E0=new Set(["fill","line","background","hillshade","raster"]);class _o extends i.E{constructor(r,a={}){super(),this.map=r,this.scope=a.scope||"",this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=i.e({},Am),this._buildingIndex=new xm(this),this.crossTileSymbolIndex=new zd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new ci,this.dispatcher=a.dispatcher?a.dispatcher:new i.bW(i.bX(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new yu,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new i.bY(r._requestManager,a.localFontFamily?i.bZ.all:a.localIdeographFontFamily?i.bZ.ideographs:i.bZ.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Uo(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this.dispatcher.broadcast("setReferrer",i.b_());let d=this;this._rtlTextPluginCallback=_o.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,w)=>{if(i.b$(v),w&&w.every(E=>E))for(let E in d._sourceCaches){let D=d._sourceCaches[E],S=D.getSource().type;S!=="vector"&&S!=="geojson"||D.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(let w in this._layers){let E=this._layers[w];E.source===v.id&&this._validateLayer(E)}})}loadURL(r,a={}){this.fire(new i.b("dataloading",{dataType:"style"}));let d=typeof a.validate=="boolean"?a.validate:!i.c0(r);r=this.map._requestManager.normalizeStyleURL(r,a.accessToken),this.resolvedImports.add(r);let g=this.importsCache.get(r);if(g)return this._load(g,d);let v=this.map._requestManager.transformRequest(r,i.R.Style);this._request=i.g(v,(w,E)=>{if(this._request=null,w)this.fire(new i.a(w));else if(E)return this.importsCache.set(r,E),this._load(E,d)})}loadJSON(r,a={}){this.fire(new i.b("dataloading",{dataType:"style"})),this._request=i.f.frame(()=>{this._request=null,this._load(r,a.validate!==!1)})}loadEmpty(){this.fire(new i.b("dataloading",{dataType:"style"})),this._load(Ud,!1)}_loadImports(r,a,d){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let v of r){let w=this._createFragmentStyle(v),E=new Promise(A=>{w.once("style.import.load",A),w.once("error",A)}).then(()=>this.mergeAll());if(g.push(E),this.resolvedImports.has(v.url)){w.loadEmpty();continue}let D=v.data||this.importsCache.get(v.url);D?w.loadJSON(D,{validate:a}):v.url?w.loadURL(v.url,{validate:a}):w.loadEmpty();let S={style:w,id:v.id,config:v.config};if(d){let A=this.fragments.findIndex(({id:R})=>R===d);this.fragments=this.fragments.slice(0,A).concat(S).concat(this.fragments.slice(A))}else this.fragments.push(S)}return Promise.allSettled(g)}_createFragmentStyle(r){let a=this.scope?i.ag(r.id,this.scope):r.id,d=new _o(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return d.setEventedParent(this.map,{style:d}),d}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let r=this.isRootStyle();this._shouldPrecompile=r,this.fire(new i.b(r?"style.load":"style.import.load"))}_load(r,a){let d=r.schema;if(this.isRootStyle()&&(r.fragment||d&&r.fragment!==!1)){let w=i.e({},Ud,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(w,a)}if(this.setConfig(this._config,d),a&&Ps(this,Qi(r)))return;this._loaded=!0,this.stylesheet=i.c1(r);for(let w in r.sources)this.addSource(w,r.sources[w],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);let g=bm(this.stylesheet.layers);if(this._order=g.map(w=>w.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let w=this.stylesheet.lights[0];this.light=new yt(w.properties,w.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new yt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let w of g){let E=i.c2(w,this.scope,this.options);E.isConfigDependent&&this._configDependentLayers.add(E.fqid),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize();let D=this.getOwnLayerSourceCache(E),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&E.canCastShadows()&&S&&(D.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let v=this.stylesheet.terrain;v&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.b("data",{dataType:"style"})),r.imports?this._loadImports(r.imports,a).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,a,d,g,v,w,E,D;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(S=>{if(S.stylesheet){if(S.light!=null&&(r=S.light),S.stylesheet.lights)for(let A of S.stylesheet.lights)A.type==="ambient"&&S.ambientLight!=null&&(a=S.ambientLight),A.type==="directional"&&S.directionalLight!=null&&(d=S.directionalLight);g=this._prioritizeTerrain(g,S.terrain,S.stylesheet.terrain),S.stylesheet.fog&&S.fog!=null&&(v=S.fog),S.stylesheet.camera!=null&&(D=S.stylesheet.camera),S.stylesheet.projection!=null&&(w=S.stylesheet.projection),S.stylesheet.transition!=null&&(E=S.stylesheet.transition)}}),this.light=r,this.ambientLight=a,this.directionalLight=d,this.fog=v,g===null?delete this.terrain:this.terrain=g,this.camera=D||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=i.e({},Am,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){let a=d=>{for(let g of d.fragments)a(g.style);r(d)};a(this)}_prioritizeTerrain(r,a,d){let g=r&&r.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:g?r:null:a!=null&&(!r||g||a&&a.drapeRenderMode===1)?a:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{r=this._prioritizeTerrain(r,a.terrain,a.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(r=a.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){let r={},a={},d={};this.forEachFragmentStyle(g=>{for(let v in g._sourceCaches){let w=i.ag(v,g.scope);r[w]=g._sourceCaches[v]}for(let v in g._otherSourceCaches){let w=i.ag(v,g.scope);a[w]=g._otherSourceCaches[v]}for(let v in g._symbolSourceCaches){let w=i.ag(v,g.scope);d[w]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeLayers(){let r={},a=[],d={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(let w of v._order){let E=v._layers[w];if(E.type==="slot"){let D=i.c3(w);if(r[D])continue;r[D]=[]}E.slot&&r[E.slot]?r[E.slot].push(E):a.push(E)}}),this._mergedOrder=[];let g=(v=[])=>{for(let w of v)if(w.type==="slot"){let E=i.c3(w.id);r[E]&&g(r[E])}else{let E=i.ag(w.id,w.scope);this._mergedOrder.push(E),d[E]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0)}};g(a),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=i.e({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(a,d,g){let v,w,E,D=i.f.devicePixelRatio>1?"@2x":"",S=i.g(d.transformRequest(d.normalizeSpriteURL(a,D,".json"),i.R.SpriteJSON),(k,F)=>{S=null,E||(E=k,v=F,R())}),A=i.d(d.transformRequest(d.normalizeSpriteURL(a,D,".png"),i.R.SpriteImage),(k,F)=>{A=null,E||(E=k,w=F,R())});function R(){if(E)g(E);else if(v&&w){let k=i.f.getImageData(w),F={};for(let $ in v){let{width:U,height:G,x:B,y:q,sdf:Q,pixelRatio:X,stretchX:ee,stretchY:H,content:te}=v[$],oe=new i.h({width:U,height:G});i.h.copy(k,oe,{x:B,y:q},{x:0,y:0},{width:U,height:G}),F[$]={data:oe,pixelRatio:X,sdf:Q,stretchX:ee,stretchY:H,content:te}}g(null,F)}}return{cancel(){S&&(S.cancel(),S=null),A&&(A.cancel(),A=null)}}}(r,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new i.a(a));else if(d)for(let g in d)this.imageManager.addImage(g,this.scope,d[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.b("data",{dataType:"style"}))})}_validateLayer(r){let a=this.getOwnSource(r.source);if(!a)return;let d=r.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new i.a(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,a)=>{let d=this.fragments[a];return d&&d.style&&(r.data=d.style.serialize()),r})}_serializeSources(){let r={};for(let a in this._sourceCaches){let d=this._sourceCaches[a].getSource();r[d.id]||(r[d.id]=d.serialize())}return r}_serializeLayers(r){let a=[];for(let d of r){let g=this._layers[d];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped(this.getLayerSourceCache(r)):E0.has(r.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){let a=this.getOwnLayer(r);if(a)return a;this.fire(new i.a(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){let a=this.getOwnSource(r);if(a)return a;this.fire(new i.a(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);let a=this.calculateLightsBrightness();r.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));let d=this._changes.isDirty();if(this._changes.isDirty()){let v=this._changes.getLayerUpdatesByScope();for(let w in v){let{updatedIds:E,removedIds:D}=v[w];(E||D)&&this._updateWorkerLayers(w,E,D)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}let g={};for(let v in this._mergedSourceCaches){let w=this._mergedSourceCaches[v];g[v]=w.used,w.used=!1,w.tileCoverLift=0}for(let v of this._mergedOrder){let w=this._mergedLayers[v];if(w.recalculate(r,this._availableImages),!w.isHidden(r.zoom)){let E=this.getLayerSourceCache(w);E&&(E.used=!0,E.tileCoverLift=Math.max(E.tileCoverLift,w.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let E=w.minzoom||0;E<(w.maxzoom||25.5);E++){let D=this.map.painter;if(D){let S=w.getProgramIds();if(!S)continue;for(let A of S){let R=w.getDefaultProgramParams(A,r.zoom);R&&(D.style=this,this.fog&&(D._fogVisible=!0,R.overrideFog=!0,D.getOrCreateProgram(A,R)),D._fogVisible=!1,R.overrideFog=!1,D.getOrCreateProgram(A,R),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(R.overrideRtt=!0,D.getOrCreateProgram(A,R)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let v in g){let w=this._mergedSourceCaches[v];g[v]!==w.used&&w.getSource().fire(new i.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new i.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let r=this._changes.getUpdatedImages();if(r.length){for(let a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,a,d){let g=this.getFragmentStyle(r);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:r,removedIds:d||[],options:g.options})}setState(r){if(this._checkLoaded(),Ps(this,Qi(r)))return!1;(r=i.c1(r)).layers=bm(r.layers);let a=function(g,v){if(!g)return[{command:hn.setStyle,args:[v]}];let w=[];try{if(!C(g.version,v.version))return[{command:hn.setStyle,args:[v]}];C(g.center,v.center)||w.push({command:hn.setCenter,args:[v.center]}),C(g.zoom,v.zoom)||w.push({command:hn.setZoom,args:[v.zoom]}),C(g.bearing,v.bearing)||w.push({command:hn.setBearing,args:[v.bearing]}),C(g.pitch,v.pitch)||w.push({command:hn.setPitch,args:[v.pitch]}),C(g.sprite,v.sprite)||w.push({command:hn.setSprite,args:[v.sprite]}),C(g.glyphs,v.glyphs)||w.push({command:hn.setGlyphs,args:[v.glyphs]}),C(g.imports,v.imports)||function(R=[],k=[],F){k=k||[];let $=(R=R||[]).map(Ds),U=k.map(Ds),G=R.reduce(Iu,{}),B=k.reduce(Iu,{}),q=$.slice(),Q,X,ee,H;for(Q=0,X=0;Q<$.length;Q++)ee=$[Q],B.hasOwnProperty(ee)?X++:(F.push({command:hn.removeImport,args:[ee]}),q.splice(q.indexOf(ee,X),1));for(Q=0,X=0;Q<U.length;Q++)ee=U[U.length-1-Q],q[q.length-1-Q]!==ee&&(G.hasOwnProperty(ee)?(F.push({command:hn.removeImport,args:[ee]}),q.splice(q.lastIndexOf(ee,q.length-X),1)):X++,H=q[q.length-Q],F.push({command:hn.addImport,args:[B[ee],H]}),q.splice(q.length-Q,0,ee));for(let te of k){let oe=G[te.id];oe&&!C(oe,te)&&F.push({command:hn.updateImport,args:[te.id,te]})}}(g.imports,v.imports,w),C(g.transition,v.transition)||w.push({command:hn.setTransition,args:[v.transition]}),C(g.light,v.light)||w.push({command:hn.setLight,args:[v.light]}),C(g.fog,v.fog)||w.push({command:hn.setFog,args:[v.fog]}),C(g.projection,v.projection)||w.push({command:hn.setProjection,args:[v.projection]}),C(g.lights,v.lights)||w.push({command:hn.setLights,args:[v.lights]}),C(g.camera,v.camera)||w.push({command:hn.setCamera,args:[v.camera]});let E={},D=[];(function(R,k,F,$){let U;for(U in k=k||{},R=R||{})R.hasOwnProperty(U)&&(k.hasOwnProperty(U)||bd(U,F,$));for(U in k){if(!k.hasOwnProperty(U))continue;let G=k[U];R.hasOwnProperty(U)?C(R[U],G)||(R[U].type==="geojson"&&G.type==="geojson"&&_0(R,k,U)?F.push({command:hn.setGeoJSONSourceData,args:[U,G.data]}):g0(U,k,F,$)):ic(U,k,F)}})(g.sources,v.sources,D,E);let S=[];g.layers&&g.layers.forEach(R=>{R.source&&E[R.source]?w.push({command:hn.removeLayer,args:[R.id]}):S.push(R)});let A=g.terrain;A&&E[A.source]&&(w.push({command:hn.setTerrain,args:[void 0]}),A=void 0),w=w.concat(D),C(A,v.terrain)||w.push({command:hn.setTerrain,args:[v.terrain]}),function(R,k,F){k=k||[];let $=(R=R||[]).map(Ds),U=k.map(Ds),G=R.reduce(Iu,{}),B=k.reduce(Iu,{}),q=$.slice(),Q=Object.create(null),X,ee,H,te,oe,ae,ue;for(X=0,ee=0;X<$.length;X++)H=$[X],B.hasOwnProperty(H)?ee++:(F.push({command:hn.removeLayer,args:[H]}),q.splice(q.indexOf(H,ee),1));for(X=0,ee=0;X<U.length;X++)H=U[U.length-1-X],q[q.length-1-X]!==H&&(G.hasOwnProperty(H)?(F.push({command:hn.removeLayer,args:[H]}),q.splice(q.lastIndexOf(H,q.length-ee),1)):ee++,ae=q[q.length-X],F.push({command:hn.addLayer,args:[B[H],ae]}),q.splice(q.length-X,0,H),Q[H]=!0);for(X=0;X<U.length;X++)if(H=U[X],te=G[H],oe=B[H],!Q[H]&&!C(te,oe))if(C(te.source,oe.source)&&C(te["source-layer"],oe["source-layer"])&&C(te.type,oe.type)){for(ue in Is(te.layout,oe.layout,F,H,null,hn.setLayoutProperty),Is(te.paint,oe.paint,F,H,null,hn.setPaintProperty),C(te.slot,oe.slot)||F.push({command:hn.setSlot,args:[H,oe.slot]}),C(te.filter,oe.filter)||F.push({command:hn.setFilter,args:[H,oe.filter]}),C(te.minzoom,oe.minzoom)&&C(te.maxzoom,oe.maxzoom)||F.push({command:hn.setLayerZoomRange,args:[H,oe.minzoom,oe.maxzoom]}),te)te.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?Is(te[ue],oe[ue],F,H,ue.slice(6),hn.setPaintProperty):C(te[ue],oe[ue])||F.push({command:hn.setLayerProperty,args:[H,ue,oe[ue]]}));for(ue in oe)oe.hasOwnProperty(ue)&&!te.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?Is(te[ue],oe[ue],F,H,ue.slice(6),hn.setPaintProperty):C(te[ue],oe[ue])||F.push({command:hn.setLayerProperty,args:[H,ue,oe[ue]]}))}else F.push({command:hn.removeLayer,args:[H]}),ae=q[q.lastIndexOf(H)+1],F.push({command:hn.addLayer,args:[oe,ae]})}(S,v.layers,w)}catch(E){console.warn("Unable to compute style diff:",E),w=[{command:hn.setStyle,args:[v]}]}return w}(this.serialize(),r).filter(g=>!(g.command in cl));if(a.length===0)return!1;let d=a.filter(g=>!(g.command in Sm));if(d.length>0)throw new Error(`Unimplemented: ${d.map(g=>g.command).join(", ")}.`);return a.forEach(g=>{this[g.command].apply(this,g.args)}),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,a){return this.getImage(r)?this.fire(new i.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,a),this._afterImageUpdated(r),this)}updateImage(r,a){this.imageManager.updateImage(r,this.scope,a)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new i.a(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,a,d={}){return this._checkLoaded(),this._validate(pt,`models.${r}`,a,null,d)||(this.modelManager.addModel(r,a,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new i.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,a,d={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Ho,`sources.${r}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let g=Rr(r,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let v=w=>{let E=(w?"symbol:":"other:")+g.id,D=i.ag(E,this.scope),S=this._sourceCaches[E]=new mo(D,g,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=S,S.onAdd(this.map)};v(!1),a.type!=="vector"&&a.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();let a=this.getOwnSource(r);if(!a)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===r)return this.fire(new i.a(new Error(`Source "${r}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new i.a(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));let d=this.getOwnSourceCaches(r);for(let g of d){let v=i.c3(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new i.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,a){this._checkLoaded(),this.getOwnSource(r).setData(a),this._changes.setDirty()}getOwnSource(r){let a=this.getOwnSourceCache(r);return a&&a.getSource()}getOwnSources(){let r=[];for(let a in this._otherSourceCaches){let d=this.getOwnSourceCache(a);d&&r.push(d.getSource())}return r}areTilesLoaded(){let r=this._mergedSourceCaches;for(let a in r){let d=r[a]._tiles;for(let g in d){let v=d[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;let a=this._getTransitionParameters();for(let g of r){if(this._validate(Oe,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(g),v.updateTransitions(a)}else this.ambientLight=new ui(g,Mi,this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(g),v.updateTransitions(a)}else this.directionalLight=new ui(g,Sr,this.scope,this.options)}}let d=new i.K(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let r=this.directionalLight,a=this.ambientLight;if(!r||!a)return;let d=R=>.2126*(R[0]<=.03928?R[0]/12.92:Math.pow((R[0]+.055)/1.055,2.4))+.7152*(R[1]<=.03928?R[1]/12.92:Math.pow((R[1]+.055)/1.055,2.4))+.0722*(R[2]<=.03928?R[2]/12.92:Math.pow((R[2]+.055)/1.055,2.4)),g=r.properties.get("color").toArray01(),v=r.properties.get("intensity"),w=r.properties.get("direction"),E=1-i.bQ(w.x,w.y,w.z)[2]/90,D=d(g)*v*E,S=a.properties.get("color").toArray01(),A=a.properties.get("intensity");return(D+d(S)*A)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(i.c4(r)){let a=i.c5(r),d=this.fragments.find(({id:v})=>v===a);if(!d)throw new Error(`Style import not found: ${r}`);let g=i.c3(r);return d.style.getFragmentStyle(g)}{let a=this.fragments.find(({id:d})=>d===r);if(!a)throw new Error(`Style import not found: ${r}`);return a.style}}getConfigProperty(r,a){let d=this.getFragmentStyle(r);if(!d)return null;let g=i.ag(a,d.scope),v=d.options.get(g),w=v?v.value||v.default:null;return w?w.serialize():null}setConfigProperty(r,a,d){let g=i.r(d);if(g.result!=="success")return void Ps(this,g.value);let v=g.value.expression,w=this.getFragmentStyle(r);if(!w)return;let E=i.ag(a,w.scope),D=w.options.get(E);D&&(this.options.set(E,Gr(Pt({},D),{value:v})),this.updateConfigDependencies())}setConfig(r,a){if(this._config=r,r||a)if(a)for(let d in a){let g,v,w=i.r(a[d].default);if(w.result==="success"&&(g=w.value.expression),r&&r[d]!==void 0){let k=i.r(r[d]);k.result==="success"&&(v=k.value.expression)}let{minValue:E,maxValue:D,stepValue:S,type:A,values:R}=a[d];if(g){let k=i.ag(d,this.scope);this.options.set(k,{default:g,value:v,minValue:E,maxValue:D,stepValue:S,type:A,values:R})}else this.fire(new i.a(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new i.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let r of this._configDependentLayers){let a=this.getLayer(r);a&&(a.possiblyEvaluateVisibility(),this._updateLayer(a))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(r,a,d={}){this._checkLoaded();let g=r.id;if(this._layers[g])return void this.fire(new i.a(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(r.type==="custom"){if(Ps(this,i.c6(r)))return;v=i.c2(r,this.scope,this.options)}else{if(typeof r.source=="object"&&(this.addSource(g,r.source),r=i.c1(r),r=i.e(r,{source:g})),this._validate(he,`layers.${g}`,r,{arrayIndex:-1},d))return;v=i.c2(r,this.scope,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let w=this._order.length;if(a){let A=this._order.indexOf(a);if(A===-1)return void this.fire(new i.a(new Error(`Layer with id "${a}" does not exist on this map.`)));v.slot===this._layers[a].slot?w=A:i.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,g),this._layerOrderChanged=!0,this._layers[g]=v;let E=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&v.canCastShadows()&&D&&(E.castsShadows=!0);let S=this._changes.getRemovedLayer(v);if(S&&v.source&&E&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let A=i.ag(v.source,v.scope);S.type!==v.type?this._changes.updateSourceCache(A,"clear"):(this._changes.updateSourceCache(A,"reload"),E.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(r,a){this._checkLoaded();let d=this._checkLayer(r);if(!d||r===a)return;let g=this._order.indexOf(r);this._order.splice(g,1);let v=this._order.length;if(a){let w=this._order.indexOf(a);if(w===-1)return void this.fire(new i.a(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?v=w:i.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();let a=this._checkLayer(r);if(!a)return;a.setEventedParent(null);let d=this._order.indexOf(r);this._order.splice(d,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);let g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let v=!1;for(let w in this._layers)if(this._layers[w].source===a.source&&this._layers[w].canCastShadows()){v=!0;break}g.castsShadows=v}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(let a in this._layers)if(this._layers[a].type===r)return!0;return!1}setLayerZoomRange(r,a,d){this._checkLoaded();let g=this._checkLayer(r);g&&(g.minzoom===a&&g.maxzoom===d||(a!=null&&(g.minzoom=a),d!=null&&(g.maxzoom=d),this._updateLayer(g)))}setSlot(r,a){this._checkLoaded();let d=this._checkLayer(r);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(r,a,d={}){this._checkLoaded();let g=this._checkLayer(r);if(g&&!C(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Se,`layers.${g.id}.filter`,a,{layerType:g.type},d)||(g.filter=i.c1(a),this._updateLayer(g)))}getFilter(r){let a=this._checkLayer(r);if(a)return i.c1(a.filter)}setLayoutProperty(r,a,d,g={}){this._checkLoaded();let v=this._checkLayer(r);if(v&&!C(v.getLayoutProperty(a),d)){if(d!=null&&(!g||g.validate!==!1)&&Ps(v,$e.call(Qi,{key:`layers.${r}.layout.${a}`,layerType:v.type,objectKey:a,value:d,styleSpec:i.D,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(a,d),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(r,a){let d=this._checkLayer(r);if(d)return d.getLayoutProperty(a)}setPaintProperty(r,a,d,g={}){this._checkLoaded();let v=this._checkLayer(r);if(!v||C(v.getPaintProperty(a),d)||d!=null&&(!g||g.validate!==!1)&&Ps(v,ke.call(Qi,{key:`layers.${r}.paint.${a}`,layerType:v.type,objectKey:a,value:d,styleSpec:i.D})))return;let w=v.setPaintProperty(a,d);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),w&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(r,a){let d=this._checkLayer(r);if(d)return d.getPaintProperty(a)}setFeatureState(r,a){this._checkLoaded();let d=r.source,g=r.sourceLayer,v=this._checkSource(d);if(!v)return;let w=v.type;if(w==="geojson"&&g)return void this.fire(new i.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!g)return void this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.a(new Error("The feature id parameter must be provided.")));let E=this.getOwnSourceCaches(d);for(let D of E)D.setFeatureState(g,r.id,a)}removeFeatureState(r,a){this._checkLoaded();let d=r.source,g=this._checkSource(d);if(!g)return;let v=g.type,w=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!w)return void this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.a(new Error("A feature id is required to remove its specific state property.")));let E=this.getOwnSourceCaches(d);for(let D of E)D.removeFeatureState(w,r.id,a)}getFeatureState(r){this._checkLoaded();let a=r.source,d=r.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||d)return r.id===void 0&&this.fire(new i.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,r.id);this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=i.e({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return i.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let r=this.getTerrain(),a=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return i.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(r){this._changes.updateLayer(r);let a=this.getLayerSourceCache(r),d=i.ag(r.source,r.scope),g=this._changes.getUpdatedSourceCaches();r.source&&!g[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){let a=E=>this._mergedLayers[E].type==="fill-extrusion"||this._mergedLayers[E].type==="model",d=this.order,g={},v=[];for(let E=d.length-1;E>=0;E--){let D=d[E];if(a(D)){g[D]=E;for(let S of r){let A=S[D];if(A)for(let R of A)v.push(R)}}}v.sort((E,D)=>D.intersectionZ-E.intersectionZ);let w=[];for(let E=d.length-1;E>=0;E--){let D=d[E];if(a(D))for(let S=v.length-1;S>=0;S--){let A=v[S].feature;if(g[A.layer.id]<E)break;w.push(A),v.pop()}else for(let S of r){let A=S[D];if(A)for(let R of A)w.push(R.feature)}}return w}queryRenderedFeatures(r,a,d){a&&a.filter&&this._validate(Se,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;let g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new i.a(new Error("parameters.layers must be an Array."))),[];for(let S of a.layers){let A=this._mergedLayers[S];if(!A)return this.fire(new i.a(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];g[A.source]=!0}}let v=[],w=a.serializedLayers||{},E=a&&a.layers?a.layers.some(S=>{let A=this.getLayer(S);return A&&A.is3D()}):this.has3DLayers(),D=Dr.createFromScreenPoints(r,d);for(let S in this._mergedSourceCaches){let A=this._mergedSourceCaches[S].getSource();if(!A||A.scope!==a.scope)continue;let R=this._mergedSourceCaches[S].getSource().id;a.layers&&!g[R]||v.push(xd(this._mergedSourceCaches[S],this._mergedLayers,w,D,a,d,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(S,A,R,k,F,$,U){let G={},B=$.queryRenderedSymbols(k),q=[];for(let Q of Object.keys(B).map(Number))q.push(U[Q]);q.sort(nl);for(let Q of q){let X=Q.featureIndex.lookupSymbolFeatures(B[Q.bucketInstanceId],A,Q.bucketIndex,Q.sourceLayerIndex,F.filter,F.layers,F.availableImages,S);for(let ee in X){let H=G[ee]=G[ee]||[],te=X[ee];te.sort((oe,ae)=>{let ue=Q.featureSortOrder;if(ue){let xe=ue.indexOf(oe.featureIndex);return ue.indexOf(ae.featureIndex)-xe}return ae.featureIndex-oe.featureIndex});for(let oe of te)H.push(oe)}}for(let Q in G)G[Q].forEach(X=>{let ee=X.feature,H=R(S[Q]);if(!H)return;let te=H.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=te});return G}(this._mergedLayers,w,this.getLayerSourceCache.bind(this),D.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,a){a&&a.filter&&this._validate(Se,"querySourceFeatures.filter",a.filter,null,a);let d=this.getOwnSourceCaches(r),g=[];for(let v of d)g=g.concat(Wo(v,a));return g}addSourceType(r,a,d){return _o.getSourceType(r)?d(new Error(`A source type called "${r}" already exists.`)):(_o.setSourceType(r,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,a,d={}){this._checkLoaded();let g=this.light.getLight(),v=!1;for(let E in r)if(!C(r[E],g[E])){v=!0;break}if(!v)return;let w=this._getTransitionParameters();this.light.setLight(r,a,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,a=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&a!==0||delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let d=r,g=r.source==null;if(a===1){if(typeof d.source=="object"){let E="terrain-dem-src";this.addSource(E,d.source),d=i.c1(d),d=i.e(d,{source:E})}let v=i.e({},d),w={};if(this.terrain&&g){v.source=this.terrain.get().source;let E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(Y,"terrain",v,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new i.b("data",{dataType:"style"}))}else{let v=this.terrain,w=v.get();for(let E of Object.keys(i.D.terrain))!d.hasOwnProperty(E)&&i.D.terrain[E].default&&(d[E]=i.D.terrain[E].default);for(let E in r)if(!C(r[E],w[E])){v.set(r,this.options),this.stylesheet.terrain=r;let D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new i.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){let a=this.fog=new yi(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();let d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let a=this.fog;if(!C(a.get(),r)){a.set(r,this.options),this.stylesheet.fog=a.get();let d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(r);this._markersNeedUpdate=!0}_getTransitionParameters(r){return{now:i.f.now(),transition:i.e(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;let r=[],a=[];for(let d in this._mergedLayers)this.isLayerDraped(this._mergedLayers[d])?r.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...a)}_createTerrain(r,a){let d=this.terrain=new Fn(r,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(let r in this._layers){let a=this._layers[r];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(let r in this._layers){let a=this._layers[r];a.type==="symbol"&&this._updateLayer(a)}}_validate(r,a,d,g,v={}){if(v&&v.validate===!1)return!1;let w=i.e({},this.serialize());return Ps(this,r.call(Qi,i.e({key:a,style:w,value:d,styleSpec:i.D},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(let r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){let a=this.getSourceCaches(r);for(let d of a)d.clearTiles()}clearSources(){for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){let a=this.getSourceCaches(r);for(let d of a)d.resume(),d.reload()}reloadSources(){for(let r of this.getSources())r.reload&&r.reload()}updateSources(r){let a;this.directionalLight&&(a=Ru(this.directionalLight));for(let d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(r,void 0,void 0,a)}_generateCollisionBoxes(){for(let r in this._sourceCaches){let a=this._sourceCaches[r];a.resume(),a.reload()}}_updatePlacement(r,a,d,g,v=!1){let w=!1,E=!1,D={},S={};for(let A of this._mergedOrder){let R=this._mergedLayers[A];if(R.type!=="symbol")continue;let k=i.ag(R.source,R.scope),F=D[k];if(!F){let U=this.getLayerSourceCache(R);if(!U)continue;let G=U.getRenderableIds(!0).map(B=>U.getTileByID(B));S[k]=G.slice(),F=D[k]=G.sort((B,q)=>q.tileID.overscaledZ-B.tileID.overscaledZ||(B.tileID.isLessThan(q.tileID)?-1:1))}let $=this.crossTileSymbolIndex.addLayer(R,F,r.center.lng,r.projection);w=w||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new i.b("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.f.now(),r.zoom))&&(this.pauseablePlacement=new Su(r,this._mergedOrder,v,a,d,g,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.f.now()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w){this._buildingIndex.onNewFrame(r.zoom);for(let A of this._mergedOrder){let R=this._mergedLayers[A];R.type==="symbol"&&this.placement.updateLayerOpacities(R,D[i.ag(R.source,R.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.f.now())}_releaseSymbolFadeTiles(){for(let r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,a){this._checkLoaded();let d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:v})=>v===r.id)!==-1)return this.fire(new i.a(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!a)return d.push(r),this._loadImports([r],!0),this;let g=d.findIndex(({id:v})=>v===a);return g===-1?this.fire(new i.a(new Error(`Import with id "${a}" does not exist on this map.`))):(this.stylesheet.imports=d.slice(0,g).concat(r).concat(d.slice(g)),this._loadImports([r],!0,a),this)}updateImport(r,a){this._checkLoaded();let d=this.stylesheet.imports||[],g=this.getImportIndex(r);return g===-1?this:typeof a=="string"?(this.setImportUrl(r,a),this):(a.url&&a.url!==d[g].url&&this.setImportUrl(r,a.url),C(a.config,d[g].config)||this.setImportConfig(r,a.config),C(a.data,d[g].data)||this.setImportData(r,a.data),this)}moveImport(r,a){this._checkLoaded();let d=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;let v=this.getImportIndex(a);if(v===-1)return this;let w=d[g],E=this.fragments[g];return d=d.filter(({id:D})=>D!==r),this.fragments=this.fragments.filter(({id:D})=>D!==r),this.stylesheet.imports=d.slice(0,v).concat(w).concat(d.slice(v)),this.fragments=this.fragments.slice(0,v).concat(E).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(r,a){this._checkLoaded();let d=this.stylesheet.imports||[],g=this.getImportIndex(r);if(g===-1)return this;d[g].url=a;let v=this.fragments[g];return v.style=this._createFragmentStyle(d[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(a),this}setImportData(r,a){this._checkLoaded();let d=this.getImportIndex(r),g=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete g[d].data,this.setImportUrl(r,g[d].url))}setImportConfig(r,a){this._checkLoaded();let d=this.getImportIndex(r),g=this.stylesheet.imports||[];if(d===-1)return this;a?g[d].config=a:delete g[d].config;let v=this.fragments[d],w=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=a,v.style.setConfig(a,w),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();let a=this.stylesheet.imports||[],d=this.getImportIndex(r);return d===-1||(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports()),this}getImportIndex(r){let a=(this.stylesheet.imports||[]).findIndex(d=>d.id===r);return a===-1&&this.fire(new i.a(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),a}getLayer(r){return this._mergedLayers[r]}getSources(){let r=[];for(let a in this._mergedOtherSourceCaches){let d=this._mergedOtherSourceCaches[a];d&&r.push(d.getSource())}return r}getSource(r,a){let d=this.getSourceCache(r,a);return d&&d.getSource()}getLayerSource(r){let a=this.getLayerSourceCache(r);return a&&a.getSource()}getSourceCache(r,a){let d=i.ag(r,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(r){let a=i.ag(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(r){let a=[];return this._mergedOtherSourceCaches[r]&&a.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&a.push(this._mergedSymbolSourceCaches[r]),a}updateSourceCaches(){let r=this._changes.getUpdatedSourceCaches();for(let a in r){let d=r[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(r){let a=this._changes.getUpdatedPaintProperties();for(let d of a){let g=this.getLayer(d);g&&g.updateTransitions(r)}}getImages(r,a,d){this.imageManager.getImages(a.icons,a.scope,d),this._updateTilesForChangedImages();let g=v=>{v&&v.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}getGlyphs(r,a,d){this.glyphManager.getGlyphs(a.stacks,a.scope,d)}getResource(r,a,d){return i.c9(a,d)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){let a=[];return this._otherSourceCaches[r]&&a.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&a.push(this._symbolSourceCaches[r]),a}_isSourceCacheLoaded(r){let a=this.getOwnSourceCaches(r);return a.length===0?(this.fire(new i.a(new Error(`There is no source with ID '${r}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}_o.getSourceType=function(h){return qo[h]},_o.setSourceType=function(h,r){qo[h]=r},_o.registerForPluginStateChange=i.bV;var Lu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ou=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Nu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ku="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$d=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Gd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pm=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ul=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hl=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,Hd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,pc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let dl=[];Rs(Lu,dl),Rs(Nu,dl),Rs(Ou,dl);let Vi={"_prelude_fog.vertex.glsl":Gd,"_prelude_terrain.vertex.glsl":$d,"_prelude_shadow.vertex.glsl":Hd,"_prelude_fog.fragment.glsl":Pm,"_prelude_shadow.fragment.glsl":pc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ul,"_prelude_raster_particle.glsl":hl},fl={};gn("",$d),gn(Pm,Gd),gn(pc,Hd),gn(ul,""),gn(hl,"");let qd=gn(Ou,Nu),Fu=Lu;var Wd={background:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:gn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:gn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:gn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:gn("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:gn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:gn("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:gn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:gn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:gn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:gn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:gn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ku),skyboxGradient:gn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ku),skyboxCapture:gn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:gn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Rs(h,r){let a=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=d.split(" ");for(let v of g)r.includes(v)||r.push(v)}}function gn(h,r){let a=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(S=>{let A=S.split(" ");return A[A.length-1]}),g=[...new Set(g)]);let v={},w=[],E=[];if(h=h.replace(a,(S,A)=>(E.push(A),"")),(r=r.replace(a,(S,A)=>(w.push(A),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...dl];Rs(h,D),Rs(r,D);for(let S of[...w,...E])Vi[S]||console.error(`Undefined include: ${S}`),fl[S]||(fl[S]=[],Rs(Vi[S],fl[S])),D=[...D,...fl[S]];return{fragmentSource:h=h.replace(d,(S,A,R,k,F)=>(v[F]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${R} ${k} ${F};
#else
uniform ${R} ${k} u_${F};
#endif
`:A==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${R} ${k} ${F} = u_${F};
#endif
`:A==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${R} ${k} ${F};
#endif
`:A==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(d,(S,A,R,k,F)=>{let $=k==="float"?"vec2":k,U=F.match(/color/)?"color":$;return A==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${R} ${k} a_${F};
#endif
`:v[F]?A==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${R} ${$} a_${F};
out ${R} ${k} ${F};
#else
uniform ${R} ${k} u_${F};
#endif
`:A==="initialize"?U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${R} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${R} ${k} ${F} = u_${F};
#endif
`:A==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${R} ${k} a_${F};
    out ${R} ${k} ${F};
#endif
`:A==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:A==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${R} ${$} a_${F};
#else
uniform ${R} ${k} u_${F};
#endif
`:A==="define-instanced"?U==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${R} ${k} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${R} ${$} a_${F};
#else
uniform ${R} ${k} u_${F};
#endif
`:A==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${R} ${k} ${F} = a_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${R} ${k} ${F} = a_${F};
#else
    ${R} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${R} ${k} ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${R} ${k} ${F} = u_${F};
#endif
`}),staticAttributes:g,usedDefines:D,vertexIncludes:w,fragmentIncludes:E}}class Zd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,a,d,g,v,w,E,D){this.context=r;let S=this.boundPaintVertexBuffers.length!==g.length;for(let R=0;!S&&R<g.length;R++)this.boundPaintVertexBuffers[R]!==g[R]&&(S=!0);let A=this.boundDynamicVertexBuffers.length!==E.length;for(let R=0;!A&&R<E.length;R++)this.boundDynamicVertexBuffers[R]!==E[R]&&(A=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||S||A||this.boundIndexBuffer!==v||this.boundVertexOffset!==w)this.freshBind(a,d,g,v,w,E,D);else{r.bindVertexArrayOES.set(this.vao);for(let R of E)R&&(R.bind(),D&&R.instanceCount&&R.setVertexAttribDivisor(r.gl,a,D));v&&v.dynamicDraw&&v.bind()}}freshBind(r,a,d,g,v,w,E){let D=r.numAttributes,S=this.context,A=S.gl;this.vao&&this.destroy(),this.vao=S.gl.createVertexArray(),S.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=w,a.enableAttributes(A,r),a.bind(),a.setVertexAttribPointers(A,r,v);for(let R of d)R.enableAttributes(A,r),R.bind(),R.setVertexAttribPointers(A,r,v);for(let R of w)R&&(R.enableAttributes(A,r),R.bind(),R.setVertexAttribPointers(A,r,v),E&&R.instanceCount&&R.setVertexAttribDivisor(A,r,E));g&&g.bind(),S.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function I0(h,r){let a=Math.pow(2,r.canonical.z),d=r.canonical.y;return[new i.L(0,d/a).toLngLat().lat,new i.L(0,(d+1)/a).toLngLat().lat]}function zu(h,r,a,d,g,v,w){let E=h.context,D=E.gl,S=a.hillshadeFBO;if(!S)return;h.prepareDrawTile();let A=h.isTileAffectedByFog(r),R=h.getOrCreateProgram("hillshade",{overrideFog:A});E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,S.colorAttachment.get());let k=((G,B,q,Q)=>{let X=q.paint.get("hillshade-shadow-color"),ee=q.paint.get("hillshade-highlight-color"),H=q.paint.get("hillshade-accent-color"),te=q.paint.get("hillshade-emissive-strength"),oe=i.bj(q.paint.get("hillshade-illumination-direction"));if(q.paint.get("hillshade-illumination-anchor")==="viewport")oe-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){let ue=G.style.directionalLight.properties.get("direction"),xe=i.bQ(ue.x,ue.y,ue.z);oe=i.bj(xe[1])}let ae=!G.options.moving;return{u_matrix:Q||G.transform.calculateProjMatrix(B.tileID.toUnwrapped(),ae),u_image:0,u_latrange:I0(0,B.tileID),u_light:[q.paint.get("hillshade-exaggeration"),oe],u_shadow:X,u_highlight:ee,u_emissive_strength:te,u_accent:H}})(h,a,d,h.terrain?r.projMatrix:null);h.uploadCommonUniforms(E,R,r.toUnwrapped());let{tileBoundsBuffer:F,tileBoundsIndexBuffer:$,tileBoundsSegments:U}=h.getTileBoundsBuffers(a);R.draw(h,D.TRIANGLES,g,v,w,Mt.disabled,k,d.id,F,$,U)}function Rm(h,r,a){if(!r.needsDEMTextureUpload)return;let d=h.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(a.stride);let v=a.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new i.T(d,v,g.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Xd(h,r,a){let d=h.context,g=d.gl;if(!r.dem)return;let v=r.dem;if(d.activeTexture.set(g.TEXTURE1),Rm(h,r,v),!r.demTexture)return;r.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let w=v.dim;d.activeTexture.set(g.TEXTURE0);let E=r.hillshadeFBO;if(!E){let k=new i.T(d,{width:w,height:w,data:null},g.RGBA);k.bind(g.LINEAR,g.CLAMP_TO_EDGE),E=r.hillshadeFBO=d.createFramebuffer(w,w,!0,"renderbuffer"),E.colorAttachment.set(k.texture)}d.bindFramebuffer.set(E.framebuffer),d.viewport.set([0,0,w,w]);let{tileBoundsBuffer:D,tileBoundsIndexBuffer:S,tileBoundsSegments:A}=h.getMercatorTileBoundsBuffers(),R=[];h.linearFloatFilteringSupported()&&R.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:R}).draw(h,g.TRIANGLES,Dt.disabled,Lt.disabled,Kt.unblended,Mt.disabled,((k,F)=>{let $=F.stride,U=i.a6.create();return i.a6.ortho(U,0,i.V,-i.V,0,0,1),i.a6.translate(U,U,[0,-i.V,0]),{u_matrix:U,u_image:1,u_dimension:[$,$],u_zoom:k.overscaledZ}})(r.tileID,v),a.id,D,S,A),r.needsHillshadePrepare=!1}let Lm=h=>({u_matrix:new i.bK(h),u_image0:new i.bO(h),u_skirt_height:new i.bN(h),u_ground_shadow_factor:new i.bM(h)}),Bu=(h,r,a)=>({u_matrix:h,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:a}),Om=(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:D,u_frustum_bl:S,u_globe_pos:A,u_globe_radius:R,u_viewport:k,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:F,u_far_z_cutoff:$});function mc(h,r){return h!=null&&r!=null&&!(!h.hasData()||!r.hasData())&&h.demTexture!=null&&r.demTexture!=null&&h.tileID.key!==r.tileID.key}let pl=new class{constructor(){this.operations={}}newMorphing(h,r,a,d,g){if(h in this.operations){let v=this.operations[h];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:g,from:r,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;let r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(let r in this.operations){let a=this.operations[r];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Yd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Kd(h,r,a){if(r===0)return 0;let d=r<1&&a===514?.25/r:1;return 6*Math.pow(1.5,22-h)*Math.max(r,1)*d}function ml(h,r){let a=1<<h.z;return!r&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}let Jd=h=>({u_matrix:h});function Qd(h,r,a,d,g){if(g>0){let v=i.f.now(),w=(v-h.timeAdded)/g,E=r?(v-r.timeAdded)/g:-1,D=a.getSource(),S=d.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),A=!r||Math.abs(r.tileID.overscaledZ-S)>Math.abs(h.tileID.overscaledZ-S),R=A&&h.refreshedUponExpiration?1:i.aa(A?w:1-E,0,1);return h.refreshedUponExpiration&&w>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class D0 extends mo{constructor(r){let a={type:"raster-dem",maxzoom:r.transform.maxZoom},d=new i.bW(i.bX(),null),g=Rr("mock-dem",a,d,r.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,a){r.state="loaded",a(null)}}class M0 extends mo{constructor(r){let a=Rr("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new i.bW(i.bX(),null),r.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,a,d){if(r.freezeTileCoverage)return;this.transform=r;let g=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,w)=>{if(v[w.key]="",!this._tiles[w.key]){let E=new Es(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom);E.state="loaded",this._tiles[w.key]=E}return v},{});for(let v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){let a=this.proxyCachedFBO[r];if(a!==void 0){let d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Nm extends i.am{constructor(r,a,d){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class C0 extends i.ck{constructor(r,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[d,g,v]=function(D){let S=new i.aN,A=new i.aw,R=131;S.reserve(17161),A.reserve(33800);let k=i.V/128,F=i.V+k/2,$=F+k;for(let G=-k;G<$;G+=k)for(let B=-k;B<$;B+=k){let q=B<0||B>F||G<0||G>F?24575:0,Q=i.aa(Math.round(B),0,i.V),X=i.aa(Math.round(G),0,i.V);S.emplaceBack(Q+q,X)}let U=(G,B)=>{let q=B*R+G;A.emplaceBack(q+1,q,q+R),A.emplaceBack(q+R,q+R+1,q+1)};for(let G=1;G<129;G++)for(let B=1;B<129;B++)U(B,G);return[0,129].forEach(G=>{for(let B=0;B<130;B++)U(B,G),U(G,B)}),[S,A,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(d,i.aP.members),this.gridIndexBuffer=w.createIndexBuffer(g),this.gridSegments=i.aB.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=i.aB.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new M0(a.map),this.orthoMatrix=i.a6.create(),i.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.V,0,i.V,0,1);let E=w.gl;this._overlapStencilMode=new Lt({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new D0(a.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,a,d){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);let g=r.terrain.properties,v=r.terrain.drapeRenderMode===0,w=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.f.now();let E=r.terrain&&r.terrain.scope,D=g.get("source"),S=v?this._mockSourceCache:r.getSourceCache(D,E);if(!S)return void i.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=S,this._exaggeration=w?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;let A=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let R=this.getScaledDemTileSize();this.sourceCache.update(a,R,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(r){let a=this._previousCameraAltitude,d=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=d;let g=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let v=r.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(v);let E=v-this._previousZoom,D=this._previousUpdateTimestamp,S=v;this._evaluationZoom!=null&&(S=this._evaluationZoom,Math.abs(v-S)>.5&&(E=.5*(v-S+E)),E*g<0&&(S+=E)),this._evaluationZoom=S;let A=w.getExaggeration(S),R=A===w.getExaggeration(Math.max(0,S-.1));if(R&&Math.abs(A-this._exaggeration)<.01)return A;let k=Math.min(.1,.00375*(this._updateTimestamp-D));return(R||A<.1||Math.abs(E)<1e-4)&&(k=Math.min(.2,4*k)),i.U(this._exaggeration,A,k)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(i.L.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=a.getIds().map(D=>{let S=a.getTileByID(D).tileID;return S.projMatrix=d.calculateProjMatrix(S.toUnwrapped()),S});(function(D,S){let A=S.transform.pointCoordinate(S.transform.getCameraPoint()),R=new i.P(A.x,A.y);D.sort((k,F)=>{if(F.overscaledZ-k.overscaledZ)return F.overscaledZ-k.overscaledZ;let $=new i.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),U=new i.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),G=R.mult(1<<k.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr($)-G.distSqr(U)})})(g,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},g.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};let w=this._style._mergedSourceCaches;for(let D in w){let S=w[D];if(!S.used||(S!==this.sourceCache&&this.resetTileLookupCache(S.id),this._setupProxiedCoordsForOrtho(S,r[D],v),S.usedForTerrain))continue;let A=r[D];S.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[a.id]=g.map(D=>new Nm(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let E={};this._visibleDemTiles=[];for(let D of this.proxyCoords){let S=this.terrainTileForTile[D.key];if(!S)continue;let A=S.tileID.key;A in E||(this._visibleDemTiles.push(S),E[A]=A)}}_assignTerrainTiles(r){this._initializing||r.forEach(a=>{if(this.terrainTileForTile[a.key])return;let d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){let r=this.painter.context,a=r.gl;for(let d in this.terrainTileForTile){let g=this.terrainTileForTile[d],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(r.activeTexture.set(a.TEXTURE1),Rm(this.painter,g,v))}}_prepareDemTileUniforms(r,a,d,g){if(!a||a.demTexture==null)return!1;let v=r.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-v.z),E=g||"";return d[`u_dem_tl${E}`]=[v.x*w%1,v.y*w%1],d[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let r=this.painter.context,a=r.gl;if(!this._emptyDepthBufferTexture){let d=new i.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.T(r,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0,a=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;let v=g.dem.tree.minimums[0];return v>0&&r++,d+v},0);return r?a/r:0}_updateEmptyDEMTexture(){let r=this.painter.context,a=r.gl;r.activeTexture.set(a.TEXTURE2);let d=this._getLoadedAreaMinimum(),[g,v]=(()=>{let E=new i.cm({width:1,height:1},new Float32Array([d]));return[a.R32F,E]})();this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new i.T(r,v,g,{premultiply:!1}),w}setupElevationDraw(r,a,d){let g=this.painter.context,v=g.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,D=null,S=1;if(d&&d.morphing&&this._useVertexMorphing){let k=d.morphing.srcDemTile,F=d.morphing.dstDemTile;S=d.morphing.phase,k&&F&&(this._prepareDemTileUniforms(r,k,w,"_prev")&&(D=k),this._prepareDemTileUniforms(r,F,w)&&(E=F))}let A=k=>k&&k.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,R=k=>{w.u_dem_size=k.size[0]===1?1:k.size[0]-2};if(D&&E)g.activeTexture.set(v.TEXTURE2),E.demTexture.bind(A(E),v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE4),D.demTexture.bind(A(D),v.CLAMP_TO_EDGE),E.demTexture&&R(E.demTexture),w.u_dem_lerp=S;else{E=this.terrainTileForTile[r.tileID.key],g.activeTexture.set(v.TEXTURE2);let k=this._prepareDemTileUniforms(r,E,w)?E.demTexture:this.emptyDEMTexture;k.bind(A(E),v.CLAMP_TO_EDGE),R(k)}if(g.activeTexture.set(v.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&E){let k=(1<<E.tileID.canonical.z)*i.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=k}if(d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(g,w),this.painter.transform.projection.name==="globe"){let k=this.globeUniformValues(this.painter.transform,r.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,k)}}globeUniformValues(r,a,d){let g=r.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,i.V,0),u_tile_br_up:g.upVector(a,i.V,i.V),u_tile_bl_up:g.upVector(a,0,i.V),u_tile_up_scale:d?i.cl(1):g.upVectorScale(a,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){let a=this.painter,d=this.painter.context;r.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,w,E,D){if(g.transform.projection.name==="globe")(function(S,A,R,k,F){let $=S.context,U=$.gl,G,B,q=S.transform,Q=i.cd(S,$,q),X=(De,Ee)=>{if(B===Ee)return;let Be=[Yd[Ee],"PROJECTION_GLOBE_VIEW"];Q&&Be.push("CUSTOM_ANTIALIASING");let pe=S.isTileAffectedByFog(De);G=S.getOrCreateProgram("globeRaster",{defines:Be,overrideFog:pe}),B=Ee},ee=S.colorModeForRenderPass(),H=new Dt(U.LEQUAL,Dt.ReadWrite,S.depthRangeFor3D);pl.update(F);let te=i.ce(q),oe=[i.a5(q.center.lng),i.ae(q.center.lat)],ae=S.globeSharedBuffers,ue=[q.width*i.f.devicePixelRatio,q.height*i.f.devicePixelRatio],xe=Float32Array.from(q.globeMatrix),fe={useDenormalizedUpVectorScale:!0};{let De=S.transform,Ee=Kd(De.zoom,A.exaggeration(),A.sourceCache._source.tileSize);B=-1;let Be=U.TRIANGLES;for(let pe of k){let we=R.getTile(pe),ce=Lt.disabled,_e=A.prevTerrainTileForTile[pe.key],je=A.terrainTileForTile[pe.key];mc(_e,je)&&pl.newMorphing(pe.key,_e,je,F,250),$.activeTexture.set(U.TEXTURE0),we.texture&&we.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let We=pl.getMorphValuesForProxy(pe.key),qe=We?1:0;We&&i.j(fe,{morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:i.cc(We.phase)}});let et=i.cf(pe.canonical),ft=i.cg(et.getCenter().lat),wt=i.ch(pe.canonical,et,ft,De.worldSize/De._pixelsPerMercatorPixel),_t=i.aT(i.ci(pe.canonical)),xt=Om(De.expandedFarZProjMatrix,xe,te,_t,i.S(De.zoom),oe,De.frustumCorners.TL,De.frustumCorners.TR,De.frustumCorners.BR,De.frustumCorners.BL,De.globeCenterInViewSpace,De.globeRadius,ue,Ee,De._farZ,wt);if(X(pe,qe),G&&(A.setupElevationDraw(we,G,fe),S.uploadCommonUniforms($,G,pe.toUnwrapped()),ae)){let[Ut,Rt,zt]=ae.getGridBuffers(ft,Ee!==0);G.draw(S,Be,H,ce,ee,Mt.backCCW,xt,"globe_raster",Ut,Rt,zt)}}}if(ae&&(S.renderDefaultNorthPole||S.renderDefaultSouthPole)){let De=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Q&&De.push("CUSTOM_ANTIALIASING"),G=S.getOrCreateProgram("globeRaster",{defines:De});for(let Ee of k){let{x:Be,y:pe,z:we}=Ee.canonical,ce=pe===0,_e=pe===(1<<we)-1,[je,We,qe,et]=ae.getPoleBuffers(we,!1);if(et&&(ce||_e)){let ft=R.getTile(Ee);$.activeTexture.set(U.TEXTURE0),ft.texture&&ft.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let wt=i.cj(we,Be,q),_t=i.aT(i.ci(Ee.canonical)),xt=(Ut,Rt)=>Ut.draw(S,U.TRIANGLES,H,Lt.disabled,ee,Mt.disabled,Om(q.expandedFarZProjMatrix,wt,wt,_t,0,oe,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,ue,0,q._farZ),"globe_pole_raster",Rt,qe,et);A.setupElevationDraw(ft,G,fe),S.uploadCommonUniforms($,G,Ee.toUnwrapped()),ce&&S.renderDefaultNorthPole&&xt(G,je),_e&&S.renderDefaultSouthPole&&(wt=i.a6.scale(i.a6.create(),wt,[1,-1,1]),xt(G,We))}}}})(g,v,w,E,D);else{let S=g.context,A=S.gl,R,k,F=g.shadowRenderer,$=As(g,g.longestCutoffRange),U=ee=>{if(k===ee)return;let H=[];H.push(Yd[ee]),$.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),R=g.getOrCreateProgram("terrainRaster",{defines:H}),k=ee},G=g.colorModeForRenderPass(),B=new Dt(A.LEQUAL,Dt.ReadWrite,g.depthRangeFor3D);pl.update(D);let q=g.transform,Q=Kd(q.zoom,v.exaggeration(),v.sourceCache._source.tileSize),X=[0,0,0];if(F){let ee=g.style.directionalLight,H=g.style.ambientLight;ee&&H&&(X=fc(ee,H))}{k=-1;let ee=A.TRIANGLES,[H,te]=[v.gridIndexBuffer,v.gridSegments];for(let oe of E){let ae=w.getTile(oe),ue=Lt.disabled,xe=v.prevTerrainTileForTile[oe.key],fe=v.terrainTileForTile[oe.key];mc(xe,fe)&&pl.newMorphing(oe.key,xe,fe,D,250),S.activeTexture.set(A.TEXTURE0),ae.texture&&ae.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let De=pl.getMorphValuesForProxy(oe.key),Ee=De?1:0,Be;De&&(Be={morphing:{srcDemTile:De.from,dstDemTile:De.to,phase:i.cc(De.phase)}});let pe=Bu(oe.projMatrix,ml(oe.canonical,q.renderWorldCopies)?Q/10:Q,X);if(U(Ee),!R)continue;v.setupElevationDraw(ae,R,Be);let we=oe.toUnwrapped();F&&F.setupShadows(we,R),g.uploadCommonUniforms(S,R,we,null,$),R.draw(g,ee,B,ue,G,Mt.backCCW,pe,"terrain_raster",v.gridBuffer,H,te)}}}}(a,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;let a=this.painter,d=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],w=this._drapedRenderBatches.shift(),E=a.style.order,D=[],S=0;for(let A of v){let R=g.getTileByID(A.proxyTileKey),k=g.proxyCachedFBO[A.key]?g.proxyCachedFBO[A.key][r]:void 0,F=k!==void 0?g.renderCache[k]:this.pool[S++],$=k!==void 0;if(R.texture=F.tex,$&&!F.dirty){D.push(R.tileID);continue}let U;d.bindFramebuffer.set(F.fb.framebuffer),this.renderedToTile=!1,F.dirty&&(d.clear({color:i.ax.transparent,stencil:0}),F.dirty=!1);for(let G=w.start;G<=w.end;++G){let B=a.style._mergedLayers[E[G]];if(B.isHidden(a.transform.zoom))continue;let q=a.style.getLayerSourceCache(B),Q=q?this.proxyToSource[A.key][q.id]:[A];if(!Q)continue;let X=Q;d.viewport.set([0,0,F.fb.width,F.fb.height]),U!==(q?q.id:null)&&(this._setupStencil(F,Q,B,q),U=q?q.id:null),a.renderLayer(a,q,B,X)}if(this._drapedRenderBatches.length===0)for(let G of this._pendingGroundEffectLayers){let B=a.style._mergedLayers[E[G]];if(B.isHidden(a.transform.zoom))continue;let q=a.style.getLayerSourceCache(B),Q=q?this.proxyToSource[A.key][q.id]:[A];if(!Q)continue;let X=Q;d.viewport.set([0,0,F.fb.width,F.fb.height]),U!==(q?q.id:null)&&(this._setupStencil(F,Q,B,q),U=q?q.id:null),a.renderLayer(a,q,B,X)}this.renderedToTile?(F.dirty=!0,D.push(R.tileID)):$||--S,S===5&&(S=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}isLayerOrderingCorrect(r){let a=r.order.length,d=-1,g=a;for(let v=0;v<a;++v)this._style.isLayerDraped(r._mergedLayers[r.order[v]])?d=Math.max(d,v):g=Math.min(g,v);return g>d}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{r=Math.min(r,a.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,a,d){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let w=v.tileID,E=1<<w.overscaledZ,{x:D,y:S}=w.canonical,A=D/E,R=(D+1)/E,k=S/E,F=(S+1)/E;return{minx:A,miny:k,maxx:R,maxy:F,t:v.dem.tree.raycastRoot(A,k,R,F,r,a,d),tile:v}});g.sort((v,w)=>(v.t!==null?v.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(let v of g){if(v.t==null)return null;let w=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,a,d);if(w!=null)return w}return null}_createFBO(){let r=this.painter.context,a=r.gl,d=this.drapeBufferSize;r.activeTexture.set(a.TEXTURE0);let g=new i.T(r,{width:d[0],height:d[1],data:null},a.RGBA);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);let v=r.createFramebuffer(d[0],d[1],!0,null);return v.colorAttachment.set(g.texture),v.depthAttachment=new Si(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{let a=this._style._mergedLayers[r],d=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(let d of this._style.getSources())if(d instanceof tt){r=!0;break}if(!r)return;let a={};for(let d=0;d<this._style.order.length;++d){let g=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(g);if(v&&!a[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof i.Z){a[v.id]=!0;for(let w of this.proxyCoords){let E=this.proxyToSource[w.key][v.id];if(E)for(let D of E)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(let d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof nt){r=!0;break}if(!r)return;let a={};for(let d=0;d<this._style.order.length;++d){let g=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(g);if(!v||a[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let w=g.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let D=this.proxyToSource[E.key][v.id];if(D)for(let S of D){let A=Qd(v.getTile(S),v.findLoadedParent(S,0),v,this.painter.transform,w);(A.opacity!==1||A.mix!==0)&&this._clearRenderCacheForTile(v.id,S)}}}}_setupDrapedRenderBatches(){let r=this._style.order,a=r.length;if(a===0)return;let d=[];this._pendingGroundEffectLayers=[];let g,v=0,w=this._style._mergedLayers[r[v]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++v<a;)w=this._style._mergedLayers[r[v]];for(;v<a;++v){let E=this._style._mergedLayers[r[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?g===void 0&&(g=v):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(d.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&d.push({start:g,end:v-1}),d.length!==0){let E=d[d.length-1];this._pendingGroundEffectLayers.every(D=>D>E.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(r){let a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){let w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<w.length;++E){let D=Object.values(w[E]);a.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();let d=this.proxyCoords,g=this._tilesDirty;for(let w=d.length-1;w>=0;w--){let E=d[w];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){let D=r[E.key],S=this.proxyToSource[E.key],A=0;for(let R in S){let k=S[R],F=D[R];if(!F||F.length!==k.length||k.some(($,U)=>$!==F[U]||g[R]&&g[R].hasOwnProperty($.key))){A=-1;break}++A}for(let R in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][R]].dirty=A<0||A!==Object.values(D).length}}let v=[...this._drapedRenderBatches];v.sort((w,E)=>E.end-E.start-(w.end-w.start));for(let w of v)for(let E of d){if(a.proxyCachedFBO[E.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][w.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(r,a,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,w=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(d.isTileClipped())E=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Lt.disabled}_renderTileClippingMasks(r,a){let d=this.painter,g=this.painter.context,v=g.gl;d._tileClippingMaskIDs={},g.setColorMode(Kt.disabled),g.setDepthMode(Dt.disabled);let w=d.getOrCreateProgram("clippingMask");for(let E of r){let D=d._tileClippingMaskIDs[E.key]=--a;w.draw(d,v.TRIANGLES,Dt.disabled,new Lt({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Kt.disabled,Mt.disabled,Jd(E.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(r){let a=this.painter.transform;if(r.x<0||r.x>a.width||r.y<0||r.y>a.height)return null;let d=[r.x,r.y,1,1];i.a7.transformMat4(d,d,a.pixelMatrixInverse),i.a7.scale(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;let g=a._camera.position,v=i.bl(1,a.center.lat),w=[g[0],g[1],g[2]/v,0],E=i.N.subtract([],d.slice(0,3),w);i.N.normalize(E,E);let D=this.raycast(w,E,this._exaggeration);return D!==null&&D?(i.N.scaleAndAdd(w,w,E,D),w[3]=w[2],w[2]*=v,w):null}drawDepth(){let r=this.painter,a=r.context,d=this.proxySourceCache,g=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let w=a.gl,E=a.createFramebuffer(g,v,!0,"renderbuffer");a.activeTexture.set(w.TEXTURE0);let D=new i.T(a,{width:g,height:v,data:null},w.RGBA);D.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.colorAttachment.set(D.texture);let S=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,g,v);E.depthAttachment.set(S),this._depthFBO=E,this._depthTexture=D}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,g,v]),function(w,E,D,S){if(w.transform.projection.name==="globe")return;let A=w.context,R=A.gl;A.clear({depth:1});let k=w.getOrCreateProgram("terrainDepth"),F=new Dt(R.LESS,Dt.ReadWrite,w.depthRangeFor3D);for(let $ of S){let U=D.getTile($),G=Bu($.projMatrix,0,[0,0,0]);E.setupElevationDraw(U,k),k.draw(w,R.TRIANGLES,F,Lt.disabled,Kt.unblended,Mt.backCCW,G,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(r,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,a,d){if(r.getSource()instanceof i.ap)return this._setupProxiedCoordsForImageSource(r,a,d);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};let g=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){let S=v[D],A=this._findTileCoveringTileID(S,r);if(A){let R=this._createProxiedId(S,A,d[S.key]&&d[S.key][r.id]);g.push(R),this.proxyToSource[S.key][r.id]=[R]}}let w=!1,E=new Set;for(let D=0;D<a.length;D++){let S=r.getTile(a[D]);if(!S||!S.hasData())continue;let A=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==S.tileID.canonical.z){let R=this.proxyToSource[A.tileID.key][r.id],k=this._createProxiedId(A.tileID,S,d[A.tileID.key]&&d[A.tileID.key][r.id]);R?R.splice(R.length-1,0,k):this.proxyToSource[A.tileID.key][r.id]=[k];let F=this.proxyToSource[A.tileID.key][r.id];E.has(F)||E.add(F),g.push(k),w=!0}}if(this._sourceTilesOverlap[r.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(let D of E)D.sort((S,A)=>A.overscaledZ-S.overscaledZ)}_setupProxiedCoordsForImageSource(r,a,d){if(!r.getSource().loaded())return;let g=this.proxiedCoords[r.id]=[],v=this.proxyCoords,w=r.getSource(),E=w.tileID;if(!E)return;let D=new i.P(E.x,E.y)._div(1<<E.z),S=w.coordinates.map(i.L.fromLngLat).reduce((R,k)=>(R.min.x=Math.min(R.min.x,k.x-D.x),R.min.y=Math.min(R.min.y,k.y-D.y),R.max.x=Math.max(R.max.x,k.x-D.x),R.max.y=Math.max(R.max.y,k.y-D.y),R),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(R,k)=>{let F=R.wrap+R.canonical.x/(1<<R.canonical.z),$=R.canonical.y/(1<<R.canonical.z),U=i.V/(1<<R.canonical.z),G=k.wrap+k.canonical.x/(1<<k.canonical.z),B=k.canonical.y/(1<<k.canonical.z);return F+U<G+S.min.x||F>G+S.max.x||$+U<B+S.min.y||$>B+S.max.y};for(let R=0;R<v.length;R++){let k=v[R];for(let F=0;F<a.length;F++){let $=r.getTile(a[F]);if(!$||!$.hasData()||A(k,$.tileID))continue;let U=this._createProxiedId(k,$,d[k.key]&&d[k.key][r.id]),G=this.proxyToSource[k.key][r.id];G?G.push(U):this.proxyToSource[k.key][r.id]=[U],g.push(U)}}}_createProxiedId(r,a,d){let g=this.orthoMatrix;if(d){let v=d.find(w=>w.key===a.tileID.key);if(v)return v}if(a.tileID.key!==r.key){let v=r.canonical.z-a.tileID.canonical.z,w,E,D;g=i.a6.create();let S=a.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(w=i.V>>v,E=w*((a.tileID.canonical.x<<v)-r.canonical.x+S),D=w*((a.tileID.canonical.y<<v)-r.canonical.y)):(w=i.V<<-v,E=i.V*(a.tileID.canonical.x-(r.canonical.x+S<<-v)),D=i.V*(a.tileID.canonical.y-(r.canonical.y<<-v))),i.a6.ortho(g,0,w,0,w,0,1),i.a6.translate(g,g,[E,D,0])}return new Nm(a.tileID,r.key,g)}_findTileCoveringTileID(r,a){let d=a.getTile(r);if(d&&d.hasData())return d;let g=this._findCoveringTileCache[a.id],v=g[r.key];if(d=v?a.getTileByID(v):null,d&&d.hasData()||v===null)return d;let w=d?d.tileID:r,E=w.overscaledZ,D=a.getSource().minzoom,S=[];if(!v){let R=a.getSource().maxzoom;if(r.canonical.z>=R){let k=r.canonical.z-R;a.getSource().reparseOverscaled?(E=Math.max(r.canonical.z+2,a.transform.tileZoom),w=new i.am(E,r.wrap,R,r.canonical.x>>k,r.canonical.y>>k)):k!==0&&(E=R,w=new i.am(E,r.wrap,R,r.canonical.x>>k,r.canonical.y>>k))}w.key!==r.key&&(S.push(w.key),d=a.getTile(w))}let A=R=>{S.forEach(k=>{g[k]=R}),S.length=0};for(E-=1;E>=D&&(!d||!d.hasData());E--){d&&A(d.tileID.key);let R=w.calculateScaledKey(E);if(d=a.getTileByID(R),d&&d.hasData())break;let k=g[R];if(k===null)break;k===void 0?S.push(R):d=a.getTileByID(k)}return A(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,a){let d=this._tilesDirty[r];d||(d=this._tilesDirty[r]={}),d[a.key]=!0}}function ef(h,r,a){let d=function(E,D,S){let A=i.N.dot(D,E),R=i.N.dot(S,[.2126,.7152,.0722]),k=($,U,G)=>(1-G)*$+G*U,F=k(1-.3*Math.min(R,1),1,Math.min(A+1,1));return k(.92,1,Math.asin(i.aa(D[2],-1,1))/Math.PI+.5)*F}(h,[0,0,1],r),g=[0,0,0];i.N.scale(g,a.slice(0,3),d);let v=[0,0,0];i.N.scale(v,r.slice(0,3),h[2]);let w=[0,0,0];return i.N.add(w,g,v),i.bU(w)}let tf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],km=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class nf{static cacheKey(r,a,d,g){let v=`${a}${g?g.cacheKey:""}`;for(let w of d)r.usedDefines.includes(w)&&(v+=`/${w}`);return v}constructor(r,a,d,g,v,w,E){let D=r.gl;this.program=D.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...w];let S=g?g.getBinderAttributes():[],A=(d.staticAttributes||[]).concat(S),R=g?g.defines():[];R=R.concat(w.map(B=>`#define ${B}`));let k=`#version 300 es
`,F=k+R.concat("precision mediump float;",Fu,qd.fragmentSource).join(`
`);for(let B of d.fragmentIncludes)F+=`
${Vi[B]}`;F+=`
${d.fragmentSource}`;let $=k+R.concat("precision highp float;",Fu,qd.vertexSource).join(`
`);for(let B of d.vertexIncludes)$+=`
${Vi[B]}`;$+=`
${d.vertexSource}`;let U=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(U,F),D.compileShader(U),D.attachShader(this.program,U);let G=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(G,$),D.compileShader(G),D.attachShader(this.program,G),this.attributes={},this.numAttributes=A.length;for(let B=0;B<this.numAttributes;B++)if(A[B]){let q=A[B].startsWith("a_")?A[B]:`a_${A[B]}`;D.bindAttribLocation(this.program,B,q),this.attributes[q]=B}E&&E.shaderVaryings.length>0&&D.transformFeedbackVaryings(this.program,E.shaderVaryings,E.bufferMode),D.linkProgram(this.program),D.deleteShader(G),D.deleteShader(U),this.fixedUniforms=v(r),this.binderUniforms=g?g.getUniforms(r):[],w.includes("TERRAIN")&&(this.terrainUniforms=(B=>({u_dem:new i.bO(B),u_dem_prev:new i.bO(B),u_dem_tl:new i.bL(B),u_dem_scale:new i.bN(B),u_dem_tl_prev:new i.bL(B),u_dem_scale_prev:new i.bN(B),u_dem_size:new i.bN(B),u_dem_lerp:new i.bN(B),u_exaggeration:new i.bN(B),u_depth:new i.bO(B),u_depth_size_inv:new i.bL(B),u_meter_to_dem:new i.bN(B),u_label_plane_matrix_inv:new i.bK(B)}))(r)),w.includes("GLOBE")&&(this.globeUniforms=(B=>({u_tile_tl_up:new i.bM(B),u_tile_tr_up:new i.bM(B),u_tile_br_up:new i.bM(B),u_tile_bl_up:new i.bM(B),u_tile_up_scale:new i.bN(B)}))(r)),w.includes("FOG")&&(this.fogUniforms=(B=>({u_fog_matrix:new i.bK(B),u_fog_range:new i.bL(B),u_fog_color:new i.bP(B),u_fog_horizon_blend:new i.bN(B),u_fog_vertical_limit:new i.bL(B),u_fog_temporal_offset:new i.bN(B),u_frustum_tl:new i.bM(B),u_frustum_tr:new i.bM(B),u_frustum_br:new i.bM(B),u_frustum_bl:new i.bM(B),u_globe_pos:new i.bM(B),u_globe_radius:new i.bN(B),u_globe_transition:new i.bN(B),u_is_globe:new i.bO(B),u_viewport:new i.bL(B)}))(r)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(B=>({u_cutoff_params:new i.bP(B)}))(r)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(B=>({u_lighting_ambient_color:new i.bM(B),u_lighting_directional_dir:new i.bM(B),u_lighting_directional_color:new i.bM(B),u_ground_radiance:new i.bM(B)}))(r)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(B=>({u_light_matrix_0:new i.bK(B),u_light_matrix_1:new i.bK(B),u_fade_range:new i.bL(B),u_shadow_normal_offset:new i.bM(B),u_shadow_intensity:new i.bN(B),u_shadow_texel_size:new i.bN(B),u_shadow_map_resolution:new i.bN(B),u_shadow_direction:new i.bM(B),u_shadow_bias:new i.bM(B),u_shadowmap_0:new i.bO(B),u_shadowmap_1:new i.bO(B)}))(r))}}setTerrainUniformValues(r,a){if(!this.terrainUniforms)return;let d=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)d[g]&&d[g].set(this.program,g,a[g])}}setGlobeUniformValues(r,a){if(!this.globeUniforms)return;let d=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)d[g]&&d[g].set(this.program,g,a[g])}}setFogUniformValues(r,a){if(!this.fogUniforms)return;let d=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)d[g].set(this.program,g,a[g])}}setCutoffUniformValues(r,a){if(!this.cutoffUniforms)return;let d=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)d[g].set(this.program,g,a[g])}}setLightsUniformValues(r,a){if(!this.lightsUniforms)return;let d=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let g in a)d[g].set(this.program,g,a[g])}}setShadowUniformValues(r,a){if(this.failedToCreate||!this.shadowUniforms)return;let d=this.shadowUniforms;r.program.set(this.program);for(let g in a)d[g].set(this.program,g,a[g])}_drawDebugWireframe(r,a,d,g,v,w,E,D,S,A){let R=r.options.wireframe;if(R.terrain===!1&&R.layers2D===!1&&R.layers3D===!1)return;let k=r.context;if(!(!(!R.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!R.layers2D||r._terrain&&r._terrain.renderingToTexture||!tf.includes(this.name))||!(!R.layers3D||!km.includes(this.name))))return;let F=k.gl,$=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,v,k);if(!$)return;let U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");let G=r.getOrCreateProgram(this.name,{config:this.configuration,defines:U});k.program.set(G.program);let B=(X,ee,H)=>{if(ee[X]&&H[X])for(let te in ee[X])H[X][te]&&H[X][te].set(H.program,te,ee[X][te].current)};S&&S.setUniforms(G.program,k,G.binderUniforms,E,{zoom:D}),B("fixedUniforms",this,G),B("terrainUniforms",this,G),B("globeUniforms",this,G),B("fogUniforms",this,G),B("lightsUniforms",this,G),B("shadowUniforms",this,G),$.bind(),k.setColorMode(new Kt([F.ONE,F.ONE_MINUS_SRC_ALPHA,F.ZERO,F.ONE],i.ax.transparent,[!0,!0,!0,!1])),k.setDepthMode(new Dt(a.func===F.LESS?F.LEQUAL:a.func,Dt.ReadOnly,a.range)),k.setStencilMode(Lt.disabled);let q=3*w.primitiveLength*2,Q=3*w.primitiveOffset*2*2;A&&A>1?F.drawElementsInstanced(F.LINES,q,F.UNSIGNED_SHORT,Q,A):F.drawElements(F.LINES,q,F.UNSIGNED_SHORT,Q),v.bind(),k.program.set(this.program),k.setDepthMode(a),k.setStencilMode(d),k.setColorMode(g)}draw(r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B){let q=r.context,Q=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(d),q.setStencilMode(g),q.setColorMode(v),q.setCullFace(w);for(let te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,E[te]);$&&$.setUniforms(this.program,q,this.binderUniforms,k,{zoom:F});let X={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[a],ee=B&&B.length>0;if(ee){for(let te of B)Q.bindBufferBase(Q.TRANSFORM_FEEDBACK_BUFFER,te.targetIndex,te.buffer.buffer);Q.beginTransformFeedback(a)}let H=G&&G>0?1:void 0;for(let te of R.get()){let oe=te.vaos||(te.vaos={});(oe[D]||(oe[D]=new Zd)).bind(q,this,S,$?$.getPaintVertexBuffers():[],A,te.vertexOffset,U||[],H),G&&G>1?Q.drawElementsInstanced(a,te.primitiveLength*X,Q.UNSIGNED_SHORT,te.primitiveOffset*X*2,G):A?Q.drawElements(a,te.primitiveLength*X,Q.UNSIGNED_SHORT,te.primitiveOffset*X*2):Q.drawArrays(a,te.vertexOffset,te.vertexLength),a===Q.TRIANGLES&&A&&this._drawDebugWireframe(r,d,g,v,A,te,k,F,$,G)}ee&&Q.endTransformFeedback()}}function rf(h,r){let a=Math.pow(2,r.tileID.overscaledZ),d=r.tileSize*Math.pow(2,h.transform.tileZoom)/a,g=d*(r.tileID.canonical.x+r.tileID.wrap*a),v=d*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.a3(r,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}let Fm=i.a6.create(),of=(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U)=>{let G=r.style.light,B=G.properties.get("position"),q=[B.x,B.y,B.z],Q=i.co.create();G.properties.get("anchor")==="viewport"&&(i.co.fromRotation(Q,-r.transform.angle),i.N.transformMat3(q,q,Q));let X=G.properties.get("color"),ee=r.transform,H={u_matrix:h,u_lightpos:q,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v,u_flood_light_color:R,u_vertical_scale:k,u_flood_light_intensity:F,u_ground_shadow_factor:$,u_emissive_strength:U};return ee.projection.name==="globe"&&(H.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],H.u_zoom_transition=D,H.u_inv_rot_matrix=A,H.u_merc_center=S,H.u_up_dir=ee.projection.upVector(new i.bs(0,0,0),S[0]*i.V,S[1]*i.V),H.u_height_lift=E),H},sf=(h,r,a)=>({u_matrix:h,u_edge_radius:r,u_vertical_scale:a}),ya=(h,r,a,d,g,v,w,E,D,S,A,R,k,F)=>{let $=of(h,r,a,d,g,v,w,D,S,A,R,k,F,1,[0,0,0],0),U={u_height_factor:-Math.pow(2,w.overscaledZ)/E.tileSize/8};return i.e($,rf(r,E),U)},gl=(h,r)=>({u_matrix:h,u_emissive_strength:r}),af=(h,r,a,d)=>i.e(gl(h,r),rf(a,d)),va=(h,r,a)=>({u_matrix:h,u_world:a,u_emissive_strength:r}),zm=(h,r,a,d,g)=>i.e(af(h,r,a,d),{u_world:g}),ju=(h,r,a,d)=>{let g=i.V/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(d),u_extrude_scale:[r.pixelsToGLUnits[0]/g,r.pixelsToGLUnits[1]/g]}},lf=(h,r,a=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:a}),Bm=i.a6.create(),cf=(h,r,a,d,g,v,w)=>{let E=h.transform,D=E.projection.name==="globe",S=D?i.cp(E.zoom,r.canonical)*E._pixelsPerMercatorPixel:i.a3(a,1,v),A={u_matrix:r.projMatrix,u_extrude_scale:S,u_intensity:w,u_inv_rot_matrix:Bm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){A.u_inv_rot_matrix=d,A.u_merc_center=g,A.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],A.u_zoom_transition=i.S(E.zoom);let R=g[0]*i.V,k=g[1]*i.V;A.u_up_dir=E.projection.upVector(new i.bs(0,0,0),R,k)}return A};function Vu(h,[r,a,d,g],[v,w]){if(v===w)return[0,0,0,0];let E=255*(h-1)/(h*(w-v));return[r*E,a*E,d*E,g*E]}function jm(h,r,[a,d]){return a===d?0:.5/h+(r-a)*(h-1)/(h*(d-a))}let uf=(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B,q,Q,X)=>{return{u_matrix:h,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:S,u_fade_t:A.mix,u_opacity:A.opacity*R.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:R.paint.get("raster-brightness-min"),u_brightness_high:R.paint.get("raster-brightness-max"),u_saturation_factor:(H=R.paint.get("raster-saturation"),H>0?1-1/(1.001-H):-H),u_contrast_factor:(ee=R.paint.get("raster-contrast"),ee>0?1/(1-ee):1+ee),u_spin_weights:gc(R.paint.get("raster-hue-rotate")),u_perspective_transform:k,u_raster_elevation:F,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:D,u_colorization_mix:Vu(i.cq,U,B),u_colorization_offset:jm(i.cq,G,B),u_color_ramp:$,u_texture_offset:[Q/(q+2*Q),q/(q+2*Q)],u_texture_res:[q+2*Q,q+2*Q],u_emissive_strength:X};var ee,H};function gc(h){h*=Math.PI/180;let r=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*r-a+1)/3,(Math.sqrt(3)*r-a+1)/3]}let S0=(h,r,a,d,g,v,w,E,D,S,A,R)=>({u_matrix:h,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:S,u_fade_t:A.mix,u_opacity:A.opacity,u_image0:0,u_image1:1,u_raster_elevation:R,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:D}),A0=(h,r,a,d,g,v,w,E)=>({u_tile_offset:h,u_velocity:r,u_color_ramp:d,u_velocity_res:a,u_max_speed:g,u_texture_offset:v,u_data_scale:w,u_data_offset:E}),Vm=(h,r,a,d,g,v,w,E)=>({u_velocity:h,u_velocity_res:r,u_max_speed:a,u_speed_factor:d,u_lifetime_delta:g,u_rand_seed:Math.random(),u_texture_offset:v,u_data_scale:w,u_data_offset:E}),Um=i.a6.create(),Uu=(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B)=>{let q=g.transform,Q={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:q.getCameraToCenterDistance(U),u_rotate_symbol:+a,u_aspect_ratio:q.width/q.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+D,u_pitch_with_map:+d,u_texsize:S,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Um,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Um,u_up_vector:[0,-1,0],u_icon_transition:B||0,u_icon_saturation:G};return U.name==="globe"&&(Q.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],Q.u_zoom_transition=R,Q.u_inv_rot_matrix=F,Q.u_merc_center=k,Q.u_camera_forward=q._camera.forward(),Q.u_ecef_origin=i.cr(q.globeMatrix,A.toUnwrapped()),Q.u_tile_matrix=Float32Array.from(q.globeMatrix),Q.u_up_vector=$),Q},_c=(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G)=>i.e(Uu(h,r,a,d,g,v,w,E,D,S,R,k,F,$,U,G,1),{u_gamma_scale:d?g.transform.getCameraToCenterDistance(G)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:i.f.devicePixelRatio,u_is_halo:+A,undefined:void 0}),$u=(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U)=>i.e(_c(h,r,a,d,g,v,w,E,!0,D,!0,A,R,k,F,$,U),{u_texsize_icon:S,u_texture_icon:1}),hf=(h,r,a,d)=>({u_matrix:h,u_emissive_strength:r,u_opacity:a,u_color:d}),yc=(h,r,a,d,g,v,w)=>i.e(function(E,D,S,A){let R=S.imageManager.getPattern(E.toString(),D),{width:k,height:F}=S.imageManager.getPixelSize(D),$=Math.pow(2,A.tileID.overscaledZ),U=A.tileSize*Math.pow(2,S.transform.tileZoom)/$,G=U*(A.tileID.canonical.x+A.tileID.wrap*$),B=U*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[k,F],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/i.a3(A,1,S.transform.tileZoom),u_pixel_coord_upper:[G>>16,B>>16],u_pixel_coord_lower:[65535&G,65535&B]}}(g,v,d,w),{u_matrix:h,u_emissive_strength:r,u_opacity:a}),Gu=(h,r,a,d,g,v,w,E,D,S,A,R,k=[0,0,0],F)=>{let $=d.style.light,U=$.properties.get("position"),G=[-U.x,-U.y,U.z],B=i.co.create();$.properties.get("anchor")==="viewport"&&(i.co.fromRotation(B,-d.transform.angle),i.N.transformMat3(G,G,B));let q=S.alphaMode==="MASK",Q=$.properties.get("color"),X=R.paint.get("model-ambient-occlusion-intensity"),ee=R.paint.get("model-color").constantOr(i.ax.white),H=R.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:r,u_normal_matrix:a,u_lightpos:G,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_camera_pos:k,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+q,u_alphaCutoff:S.alphaCutoff,u_baseColorFactor:[v.r,v.g,v.b,v.a],u_emissiveFactor:[w[0],w[1],w[2],1],u_metallicFactor:E,u_roughnessFactor:D,u_baseColorTexture:ei.BaseColor,u_metallicRoughnessTexture:ei.MetallicRoughness,u_normalTexture:ei.Normal,u_occlusionTexture:ei.Occlusion,u_emissionTexture:ei.Emission,u_color_mix:[ee.r,ee.g,ee.b,H],u_aoIntensity:X,u_emissive_strength:A,u_occlusionTextureTransform:F||[0,0,0,0]}},vc=new Float32Array(16),xc=(h,r=vc,a=vc)=>({u_matrix:h,u_instance:r,u_node_matrix:a}),P0={fillExtrusion:h=>({u_matrix:new i.bK(h),u_lightpos:new i.bM(h),u_lightintensity:new i.bN(h),u_lightcolor:new i.bM(h),u_vertical_gradient:new i.bN(h),u_opacity:new i.bN(h),u_edge_radius:new i.bN(h),u_ao:new i.bL(h),u_tile_id:new i.bM(h),u_zoom_transition:new i.bN(h),u_inv_rot_matrix:new i.bK(h),u_merc_center:new i.bL(h),u_up_dir:new i.bM(h),u_height_lift:new i.bN(h),u_flood_light_color:new i.bM(h),u_vertical_scale:new i.bN(h),u_flood_light_intensity:new i.bN(h),u_ground_shadow_factor:new i.bM(h),u_emissive_strength:new i.bN(h)}),fillExtrusionDepth:h=>({u_matrix:new i.bK(h),u_edge_radius:new i.bN(h),u_vertical_scale:new i.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new i.bK(h),u_lightpos:new i.bM(h),u_lightintensity:new i.bN(h),u_lightcolor:new i.bM(h),u_vertical_gradient:new i.bN(h),u_height_factor:new i.bN(h),u_edge_radius:new i.bN(h),u_ao:new i.bL(h),u_tile_id:new i.bM(h),u_zoom_transition:new i.bN(h),u_inv_rot_matrix:new i.bK(h),u_merc_center:new i.bL(h),u_up_dir:new i.bM(h),u_height_lift:new i.bN(h),u_image:new i.bO(h),u_texsize:new i.bL(h),u_pixel_coord_upper:new i.bL(h),u_pixel_coord_lower:new i.bL(h),u_tile_units_to_pixels:new i.bN(h),u_opacity:new i.bN(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new i.bK(h),u_opacity:new i.bN(h),u_ao_pass:new i.bN(h),u_meter_to_tile:new i.bN(h),u_ao:new i.bL(h),u_flood_light_intensity:new i.bN(h),u_flood_light_color:new i.bM(h),u_attenuation:new i.bN(h),u_edge_radius:new i.bN(h),u_fb:new i.bO(h),u_fb_size:new i.bN(h)}),fill:h=>({u_matrix:new i.bK(h),u_emissive_strength:new i.bN(h)}),fillPattern:h=>({u_matrix:new i.bK(h),u_emissive_strength:new i.bN(h),u_image:new i.bO(h),u_texsize:new i.bL(h),u_pixel_coord_upper:new i.bL(h),u_pixel_coord_lower:new i.bL(h),u_tile_units_to_pixels:new i.bN(h)}),fillOutline:h=>({u_matrix:new i.bK(h),u_emissive_strength:new i.bN(h),u_world:new i.bL(h)}),fillOutlinePattern:h=>({u_matrix:new i.bK(h),u_emissive_strength:new i.bN(h),u_world:new i.bL(h),u_image:new i.bO(h),u_texsize:new i.bL(h),u_pixel_coord_upper:new i.bL(h),u_pixel_coord_lower:new i.bL(h),u_tile_units_to_pixels:new i.bN(h)}),circle:i.cs,collisionBox:h=>({u_matrix:new i.bK(h),u_camera_to_center_distance:new i.bN(h),u_extrude_scale:new i.bL(h)}),collisionCircle:h=>({u_matrix:new i.bK(h),u_inv_matrix:new i.bK(h),u_camera_to_center_distance:new i.bN(h),u_viewport_size:new i.bL(h)}),debug:h=>({u_color:new i.ca(h),u_matrix:new i.bK(h),u_overlay:new i.bO(h),u_overlay_scale:new i.bN(h)}),clippingMask:h=>({u_matrix:new i.bK(h)}),heatmap:h=>({u_extrude_scale:new i.bN(h),u_intensity:new i.bN(h),u_matrix:new i.bK(h),u_inv_rot_matrix:new i.bK(h),u_merc_center:new i.bL(h),u_tile_id:new i.bM(h),u_zoom_transition:new i.bN(h),u_up_dir:new i.bM(h)}),heatmapTexture:h=>({u_image:new i.bO(h),u_color_ramp:new i.bO(h),u_opacity:new i.bN(h)}),hillshade:h=>({u_matrix:new i.bK(h),u_image:new i.bO(h),u_latrange:new i.bL(h),u_light:new i.bL(h),u_shadow:new i.ca(h),u_highlight:new i.ca(h),u_emissive_strength:new i.bN(h),u_accent:new i.ca(h)}),hillshadePrepare:h=>({u_matrix:new i.bK(h),u_image:new i.bO(h),u_dimension:new i.bL(h),u_zoom:new i.bN(h)}),line:i.ct,linePattern:i.cu,raster:h=>({u_matrix:new i.bK(h),u_normalize_matrix:new i.bK(h),u_globe_matrix:new i.bK(h),u_merc_matrix:new i.bK(h),u_grid_matrix:new i.cb(h),u_tl_parent:new i.bL(h),u_scale_parent:new i.bN(h),u_fade_t:new i.bN(h),u_opacity:new i.bN(h),u_image0:new i.bO(h),u_image1:new i.bO(h),u_brightness_low:new i.bN(h),u_brightness_high:new i.bN(h),u_saturation_factor:new i.bN(h),u_contrast_factor:new i.bN(h),u_spin_weights:new i.bM(h),u_perspective_transform:new i.bL(h),u_raster_elevation:new i.bN(h),u_zoom_transition:new i.bN(h),u_merc_center:new i.bL(h),u_cutoff_params:new i.bP(h),u_colorization_mix:new i.bP(h),u_colorization_offset:new i.bN(h),u_color_ramp:new i.bO(h),u_texture_offset:new i.bL(h),u_texture_res:new i.bL(h),u_emissive_strength:new i.bN(h)}),rasterParticle:h=>({u_matrix:new i.bK(h),u_normalize_matrix:new i.bK(h),u_globe_matrix:new i.bK(h),u_merc_matrix:new i.bK(h),u_grid_matrix:new i.cb(h),u_tl_parent:new i.bL(h),u_scale_parent:new i.bN(h),u_fade_t:new i.bN(h),u_opacity:new i.bN(h),u_image0:new i.bO(h),u_image1:new i.bO(h),u_raster_elevation:new i.bN(h),u_zoom_transition:new i.bN(h),u_merc_center:new i.bL(h),u_cutoff_params:new i.bP(h)}),rasterParticleTexture:h=>({u_texture:new i.bO(h),u_opacity:new i.bN(h)}),rasterParticleDraw:h=>({u_tile_offset:new i.bL(h),u_velocity:new i.bO(h),u_color_ramp:new i.bO(h),u_velocity_res:new i.bL(h),u_max_speed:new i.bN(h),u_texture_offset:new i.bL(h),u_data_scale:new i.bP(h),u_data_offset:new i.bN(h)}),rasterParticleUpdate:h=>({u_velocity:new i.bO(h),u_velocity_res:new i.bL(h),u_max_speed:new i.bN(h),u_speed_factor:new i.bN(h),u_lifetime_delta:new i.bN(h),u_rand_seed:new i.bN(h),u_texture_offset:new i.bL(h),u_data_scale:new i.bP(h),u_data_offset:new i.bN(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new i.bO(h),u_is_size_feature_constant:new i.bO(h),u_size_t:new i.bN(h),u_size:new i.bN(h),u_camera_to_center_distance:new i.bN(h),u_rotate_symbol:new i.bO(h),u_aspect_ratio:new i.bN(h),u_fade_change:new i.bN(h),u_matrix:new i.bK(h),u_label_plane_matrix:new i.bK(h),u_coord_matrix:new i.bK(h),u_is_text:new i.bO(h),u_pitch_with_map:new i.bO(h),u_texsize:new i.bL(h),u_tile_id:new i.bM(h),u_zoom_transition:new i.bN(h),u_inv_rot_matrix:new i.bK(h),u_merc_center:new i.bL(h),u_camera_forward:new i.bM(h),u_tile_matrix:new i.bK(h),u_up_vector:new i.bM(h),u_ecef_origin:new i.bM(h),u_texture:new i.bO(h),u_icon_transition:new i.bN(h),u_icon_saturation:new i.bN(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new i.bO(h),u_is_size_feature_constant:new i.bO(h),u_size_t:new i.bN(h),u_size:new i.bN(h),u_camera_to_center_distance:new i.bN(h),u_rotate_symbol:new i.bO(h),u_aspect_ratio:new i.bN(h),u_fade_change:new i.bN(h),u_matrix:new i.bK(h),u_label_plane_matrix:new i.bK(h),u_coord_matrix:new i.bK(h),u_is_text:new i.bO(h),u_pitch_with_map:new i.bO(h),u_texsize:new i.bL(h),u_texture:new i.bO(h),u_gamma_scale:new i.bN(h),u_device_pixel_ratio:new i.bN(h),u_tile_id:new i.bM(h),u_zoom_transition:new i.bN(h),u_inv_rot_matrix:new i.bK(h),u_merc_center:new i.bL(h),u_camera_forward:new i.bM(h),u_tile_matrix:new i.bK(h),u_up_vector:new i.bM(h),u_ecef_origin:new i.bM(h),u_is_halo:new i.bO(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new i.bO(h),u_is_size_feature_constant:new i.bO(h),u_size_t:new i.bN(h),u_size:new i.bN(h),u_camera_to_center_distance:new i.bN(h),u_rotate_symbol:new i.bO(h),u_aspect_ratio:new i.bN(h),u_fade_change:new i.bN(h),u_matrix:new i.bK(h),u_label_plane_matrix:new i.bK(h),u_coord_matrix:new i.bK(h),u_is_text:new i.bO(h),u_pitch_with_map:new i.bO(h),u_texsize:new i.bL(h),u_texsize_icon:new i.bL(h),u_texture:new i.bO(h),u_texture_icon:new i.bO(h),u_gamma_scale:new i.bN(h),u_device_pixel_ratio:new i.bN(h),u_is_halo:new i.bO(h)}),background:h=>({u_matrix:new i.bK(h),u_emissive_strength:new i.bN(h),u_opacity:new i.bN(h),u_color:new i.ca(h)}),backgroundPattern:h=>({u_matrix:new i.bK(h),u_emissive_strength:new i.bN(h),u_opacity:new i.bN(h),u_image:new i.bO(h),u_pattern_tl:new i.bL(h),u_pattern_br:new i.bL(h),u_texsize:new i.bL(h),u_pattern_size:new i.bL(h),u_pixel_coord_upper:new i.bL(h),u_pixel_coord_lower:new i.bL(h),u_tile_units_to_pixels:new i.bN(h)}),terrainRaster:Lm,terrainDepth:Lm,skybox:h=>({u_matrix:new i.bK(h),u_sun_direction:new i.bM(h),u_cubemap:new i.bO(h),u_opacity:new i.bN(h),u_temporal_offset:new i.bN(h)}),skyboxGradient:h=>({u_matrix:new i.bK(h),u_color_ramp:new i.bO(h),u_center_direction:new i.bM(h),u_radius:new i.bN(h),u_opacity:new i.bN(h),u_temporal_offset:new i.bN(h)}),skyboxCapture:h=>({u_matrix_3f:new i.cb(h),u_sun_direction:new i.bM(h),u_sun_intensity:new i.bN(h),u_color_tint_r:new i.bP(h),u_color_tint_m:new i.bP(h),u_luminance:new i.bN(h)}),globeRaster:h=>({u_proj_matrix:new i.bK(h),u_globe_matrix:new i.bK(h),u_normalize_matrix:new i.bK(h),u_merc_matrix:new i.bK(h),u_zoom_transition:new i.bN(h),u_merc_center:new i.bL(h),u_image0:new i.bO(h),u_grid_matrix:new i.cb(h),u_skirt_height:new i.bN(h),u_far_z_cutoff:new i.bN(h),u_frustum_tl:new i.bM(h),u_frustum_tr:new i.bM(h),u_frustum_br:new i.bM(h),u_frustum_bl:new i.bM(h),u_globe_pos:new i.bM(h),u_globe_radius:new i.bN(h),u_viewport:new i.bL(h)}),globeAtmosphere:h=>({u_frustum_tl:new i.bM(h),u_frustum_tr:new i.bM(h),u_frustum_br:new i.bM(h),u_frustum_bl:new i.bM(h),u_horizon:new i.bN(h),u_transition:new i.bN(h),u_fadeout_range:new i.bN(h),u_color:new i.bP(h),u_high_color:new i.bP(h),u_space_color:new i.bP(h),u_temporal_offset:new i.bN(h),u_horizon_angle:new i.bN(h)}),model:h=>({u_matrix:new i.bK(h),u_lighting_matrix:new i.bK(h),u_normal_matrix:new i.bK(h),u_lightpos:new i.bM(h),u_lightintensity:new i.bN(h),u_lightcolor:new i.bM(h),u_camera_pos:new i.bM(h),u_opacity:new i.bN(h),u_baseColorFactor:new i.bP(h),u_emissiveFactor:new i.bP(h),u_metallicFactor:new i.bN(h),u_roughnessFactor:new i.bN(h),u_baseTextureIsAlpha:new i.bO(h),u_alphaMask:new i.bO(h),u_alphaCutoff:new i.bN(h),u_baseColorTexture:new i.bO(h),u_metallicRoughnessTexture:new i.bO(h),u_normalTexture:new i.bO(h),u_occlusionTexture:new i.bO(h),u_emissionTexture:new i.bO(h),u_color_mix:new i.bP(h),u_aoIntensity:new i.bN(h),u_emissive_strength:new i.bN(h),u_occlusionTextureTransform:new i.bP(h)}),modelDepth:h=>({u_matrix:new i.bK(h),u_instance:new i.bK(h),u_node_matrix:new i.bK(h)}),groundShadow:h=>({u_matrix:new i.bK(h),u_ground_shadow_factor:new i.bM(h)}),stars:h=>({u_matrix:new i.bK(h),u_up:new i.bM(h),u_right:new i.bM(h),u_intensity_multiplier:new i.bN(h)})},yo;function vo(h,r,a,d,g,v,w){let E=h.context,D=E.gl,S=h.transform,A=h.getOrCreateProgram("collisionBox"),R=[],k=0,F=0;for(let X=0;X<d.length;X++){let ee=d[X],H=r.getTile(ee),te=H.getBucket(a);if(!te)continue;let oe=Pd(ee,te,S),ae=oe;g[0]===0&&g[1]===0||(ae=h.translatePosMatrix(oe,H,g,v));let ue=w?te.textCollisionBox:te.iconCollisionBox,xe=te.collisionCircleArray;if(xe.length>0){let fe=i.a6.create(),De=ae;i.a6.mul(fe,te.placementInvProjMatrix,S.glCoordMatrix),i.a6.mul(fe,fe,te.placementViewportMatrix),R.push({circleArray:xe,circleOffset:F,transform:De,invTransform:fe,projection:te.getProjection()}),k+=xe.length/4,F=k}ue&&(h.terrain&&h.terrain.setupElevationDraw(H,A),A.draw(h,D.LINES,Dt.disabled,Lt.disabled,h.colorModeForRenderPass(),Mt.disabled,ju(ae,S,H,te.getProjection()),a.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,null,S.zoom,null,[ue.collisionVertexBuffer,ue.collisionVertexBufferExt]))}if(!w||!R.length)return;let $=h.getOrCreateProgram("collisionCircle"),U=new i.cv;U.resize(4*k),U._trim();let G=0;for(let X of R)for(let ee=0;ee<X.circleArray.length/4;ee++){let H=4*ee,te=X.circleArray[H+0],oe=X.circleArray[H+1],ae=X.circleArray[H+2],ue=X.circleArray[H+3];U.emplace(G++,te,oe,ae,ue,0),U.emplace(G++,te,oe,ae,ue,1),U.emplace(G++,te,oe,ae,ue,2),U.emplace(G++,te,oe,ae,ue,3)}(!yo||yo.length<2*k)&&(yo=function(X){let ee=2*X,H=new i.aw;H.resize(ee),H._trim();for(let te=0;te<ee;te++){let oe=6*te;H.uint16[oe+0]=4*te+0,H.uint16[oe+1]=4*te+1,H.uint16[oe+2]=4*te+2,H.uint16[oe+3]=4*te+2,H.uint16[oe+4]=4*te+3,H.uint16[oe+5]=4*te+0}return H}(k));let B=E.createIndexBuffer(yo,!0),q=E.createVertexBuffer(U,i.cw.members,!0);for(let X of R){let ee={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(Q=S).getCameraToCenterDistance(X.projection),u_viewport_size:[Q.width,Q.height]};$.draw(h,D.TRIANGLES,Dt.disabled,Lt.disabled,h.colorModeForRenderPass(),Mt.disabled,ee,a.id,q,B,i.aB.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,S.zoom)}var Q;q.destroy(),B.destroy()}let Yo=i.a6.create();function bc(h){let r=h._camera.getWorldToCamera(h.worldSize,1),a=i.a6.multiply([],r,h.globeMatrix);i.a6.invert(a,a);let d=[0,0,0],g=[0,1,0,0];return i.a7.transformMat4(g,g,a),d[0]=g[0],d[1]=g[1],d[2]=g[2],i.N.normalize(d,d),d}function ut({width:h,height:r,anchor:a,textOffset:d,textScale:g},v){let{horizontalAlign:w,verticalAlign:E}=i.bf(a),D=-(w-.5)*h,S=-(E-.5)*r,A=i.bd(a,d);return new i.P((D/g+A[0])*v,(S/g+A[1])*v)}function $m(h,r,a,d,g,v,w,E,D,S,A){let R=h.text.placedSymbolArray,k=h.text.dynamicLayoutVertexArray,F=h.icon.dynamicLayoutVertexArray,$={},U=h.getProjection(),G=ac(E,U,v),B=v.elevation,q=U.upVectorScale(E.canonical,v.center.lat,v.worldSize).metersToTile;k.clear();for(let Q=0;Q<R.length;Q++){let X=R.get(Q),{tileAnchorX:ee,tileAnchorY:H,numGlyphs:te}=X,oe=X.hidden||!X.crossTileID||h.allowVerticalPlacement&&!X.placedOrientation?null:d[X.crossTileID];if(oe){let ae=0,ue=0,xe=0;if(B){let je=B?B.getAtTileOffset(E,ee,H):0,[We,qe,et]=U.upVector(E.canonical,ee,H);ae=je*We*q,ue=je*qe*q,xe=je*et*q}let[fe,De,Ee,Be]=no(X.projectedAnchorX+ae,X.projectedAnchorY+ue,X.projectedAnchorZ+xe,a?G:w),pe=wm(v.getCameraToCenterDistance(U),Be),we=g.evaluateSizeForFeature(h.textSizeData,S,X)*pe/i.bc;a&&(we*=h.tilePixelRatio/D);let ce=ut(oe,we);a?({x:fe,y:De,z:Ee}=U.projectTilePoint(ee+ce.x,H+ce.y,E.canonical),[fe,De,Ee]=no(fe+ae,De+ue,Ee+xe,w)):(r&&ce._rotate(-v.angle),fe+=ce.x,De+=ce.y,Ee=0);let _e=h.allowVerticalPlacement&&X.placedOrientation===i.b6.vertical?Math.PI/2:0;for(let je=0;je<te;je++)i.b9(k,fe,De,Ee,_e);A&&X.associatedIconIndex>=0&&($[X.associatedIconIndex]={x:fe,y:De,z:Ee,angle:_e})}else Cs(te,k)}if(A){F.clear();let Q=h.icon.placedSymbolArray;for(let X=0;X<Q.length;X++){let ee=Q.get(X),{numGlyphs:H}=ee,te=$[X];if(ee.hidden||!te)Cs(H,F);else{let{x:oe,y:ae,z:ue,angle:xe}=te;for(let fe=0;fe<H;fe++)i.b9(F,oe,ae,ue,xe)}}h.icon.dynamicLayoutVertexBuffer.updateData(F)}h.text.dynamicLayoutVertexBuffer.updateData(k)}function Hu(h,r,a,d,g,v,w={}){let E=a.paint.get("icon-translate"),D=a.paint.get("text-translate"),S=a.paint.get("icon-translate-anchor"),A=a.paint.get("text-translate-anchor"),R=a.layout.get("icon-rotation-alignment"),k=a.layout.get("text-rotation-alignment"),F=a.layout.get("icon-pitch-alignment"),$=a.layout.get("text-pitch-alignment"),U=a.layout.get("icon-keep-upright"),G=a.layout.get("text-keep-upright"),B=a.paint.get("icon-color-saturation"),q=h.context,Q=q.gl,X=h.transform,ee=R==="map",H=k==="map",te=F==="map",oe=$==="map",ae=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,ue=!1,xe=h.depthModeForSublayer(0,Dt.ReadOnly),fe=[i.a5(X.center.lng),i.ae(X.center.lat)],De=a.layout.get("text-variable-anchor"),Ee=X.projection.name==="globe",Be=[],pe=[0,-1,0];for(let we of d){let ce=r.getTile(we),_e=ce.getBucket(a);if(!_e||_e.projection.name==="mercator"&&Ee||_e.fullyClipped)continue;let je=_e.projection.name==="globe",We=je?i.S(X.zoom):0,qe=ac(we,_e.getProjection(),X),et=X.calculatePixelsToTileUnitsMatrix(ce),ft=De&&_e.hasTextData(),wt=_e.hasIconTextFit()&&ft&&_e.hasIconData(),_t=_e.getProjection().createInversionMatrix(X,we.canonical),xt=()=>{let cr=ee&&a.layout.get("symbol-placement")!=="point",tn=[],yn=cr||wt,nn=a.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&te&&tn.push("PITCH_WITH_MAP_TERRAIN"),je&&(tn.push("PROJECTION_GLOBE_VIEW"),yn&&tn.push("PROJECTED_POS_ON_VIEWPORT")),nn>0&&tn.push("ICON_TRANSITION"),_e.icon.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),B<1&&tn.push("SATURATION");let _n=_e.icon.programConfigurations.get(a.id),Zn=h.getOrCreateProgram(_e.sdfIcons?"symbolSDF":"symbolIcon",{config:_n,defines:tn}),En,Ur=ce.imageAtlasTexture?ce.imageAtlasTexture.size:[0,0],ti=_e.iconSizeData,Ri=i.b5(ti,X.zoom),ko=te||X.pitch!==0,Li=oc(qe,ce.tileID.canonical,te,ee,X,_e.getProjection(),et),$r=Ed(qe,ce.tileID.canonical,te,ee,X,_e.getProjection(),et),Lr=h.translatePosMatrix($r,ce,E,S,!0),di=h.translatePosMatrix(qe,ce,E,S),bi=yn?Yo:Li,Oi=ee&&!te&&!cr,Fo=pe;!Ee&&!X.mercatorFromTransition||ee||(Fo=bc(X));let Vs=je?Fo:pe;En=_e.sdfIcons&&!_e.iconsInText?_c(ti.kind,Ri,Oi,te,h,di,bi,Lr,!1,Ur,!0,we,We,fe,_t,Vs,_e.getProjection()):Uu(ti.kind,Ri,Oi,te,h,di,bi,Lr,!1,Ur,we,We,fe,_t,Vs,_e.getProjection(),B,nn);let Ea=ce.imageAtlasTexture?ce.imageAtlasTexture:null,jc=a.layout.get("icon-size").constantOr(0)!==1||_e.iconsNeedLinear,Vc=_e.sdfIcons||h.options.rotating||h.options.zooming||jc||ko?Q.LINEAR:Q.NEAREST,Vf=_e.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Uc=h.terrain&&te&&cr?i.a6.invert(i.a6.create(),Li):Yo;if(cr&&_e.icon){let bl=X.elevation,th=bl?bl.getAtTileOffsetFunc(we,X.center.lat,X.worldSize,_e.getProjection()):null,es=Td(qe,ce.tileID.canonical,te,ee,X,_e.getProjection(),et);Dd(_e,qe,h,!1,es,$r,te,U,th,we)}return{program:Zn,buffers:_e.icon,uniformValues:En,atlasTexture:Ea,atlasTextureIcon:null,atlasInterpolation:Vc,atlasInterpolationIcon:null,isSDF:_e.sdfIcons,hasHalo:Vf,tile:ce,labelPlaneMatrixInv:Uc}},Ut=()=>{let cr=H&&a.layout.get("symbol-placement")!=="point",tn=[],yn=cr||De||wt;h.terrainRenderModeElevated()&&oe&&tn.push("PITCH_WITH_MAP_TERRAIN"),je&&(tn.push("PROJECTION_GLOBE_VIEW"),yn&&tn.push("PROJECTED_POS_ON_VIEWPORT")),_e.text.zOffsetVertexBuffer&&tn.push("Z_OFFSET");let nn=_e.text.programConfigurations.get(a.id),_n=h.getOrCreateProgram(_e.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:nn,defines:tn}),Zn,En=[0,0],Ur=null,ti=_e.textSizeData;_e.iconsInText&&(En=ce.imageAtlasTexture?ce.imageAtlasTexture.size:[0,0],Ur=ce.imageAtlasTexture?ce.imageAtlasTexture:null,Zn=oe||X.pitch!==0||h.options.rotating||h.options.zooming||ti.kind==="composite"||ti.kind==="camera"?Q.LINEAR:Q.NEAREST);let Ri=ce.glyphAtlasTexture?ce.glyphAtlasTexture.size:[0,0],ko=i.b5(ti,X.zoom),Li=oc(qe,ce.tileID.canonical,oe,H,X,_e.getProjection(),et),$r=Ed(qe,ce.tileID.canonical,oe,H,X,_e.getProjection(),et),Lr=h.translatePosMatrix($r,ce,D,A,!0),di=h.translatePosMatrix(qe,ce,D,A),bi=yn?Yo:Li,Oi=H&&!oe&&!cr,Fo=pe;!Ee&&!X.mercatorFromTransition||H||(Fo=bc(X));let Vs=je?Fo:pe,Ea;Ea=_e.iconsInText?$u(ti.kind,ko,Oi,oe,h,di,bi,Lr,Ri,En,we,We,fe,_t,Vs,_e.getProjection()):_c(ti.kind,ko,Oi,oe,h,di,bi,Lr,!0,Ri,!0,we,We,fe,_t,Vs,_e.getProjection());let jc=ce.glyphAtlasTexture?ce.glyphAtlasTexture:null,Vc=Q.LINEAR,Vf=a.paint.get("text-halo-width").constantOr(1)!==0,Uc=h.terrain&&oe&&cr?i.a6.invert(i.a6.create(),Li):Yo;if(cr&&_e.text){let bl=X.elevation,th=bl?bl.getAtTileOffsetFunc(we,X.center.lat,X.worldSize,_e.getProjection()):null,es=Td(qe,ce.tileID.canonical,oe,H,X,_e.getProjection(),et);Dd(_e,qe,h,!0,es,$r,oe,G,th,we)}return{program:_n,buffers:_e.text,uniformValues:Ea,atlasTexture:jc,atlasTextureIcon:Ur,atlasInterpolation:Vc,atlasInterpolationIcon:Zn,isSDF:!0,hasHalo:Vf,tile:ce,labelPlaneMatrixInv:Uc}},Rt=_e.icon.segments.get().length,zt=_e.text.segments.get().length,kt=Rt&&!w.onlyText?xt():null,dn=zt&&!w.onlyIcons?Ut():null,Hn=a.paint.get("icon-opacity").constantOr(1),en=a.paint.get("text-opacity").constantOr(1);if(ae&&_e.canOverlap){ue=!0;let cr=Hn&&!w.onlyText?_e.icon.segments.get():[],tn=en&&!w.onlyIcons?_e.text.segments.get():[];for(let yn of cr)Be.push({segments:new i.aB([yn]),sortKey:yn.sortKey,state:kt});for(let yn of tn)Be.push({segments:new i.aB([yn]),sortKey:yn.sortKey,state:dn})}else w.onlyText||Be.push({segments:Hn?_e.icon.segments:new i.aB([]),sortKey:0,state:kt}),w.onlyIcons||Be.push({segments:en?_e.text.segments:new i.aB([]),sortKey:0,state:dn})}ue&&Be.sort((we,ce)=>we.sortKey-ce.sortKey);for(let we of Be){let ce=we.state;if(ce)if(h.terrain&&h.terrain.setupElevationDraw(ce.tile,ce.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ce.labelPlaneMatrixInv}),q.activeTexture.set(Q.TEXTURE0),ce.atlasTexture&&ce.atlasTexture.bind(ce.atlasInterpolation,Q.CLAMP_TO_EDGE,!0),ce.atlasTextureIcon&&(q.activeTexture.set(Q.TEXTURE1),ce.atlasTextureIcon&&ce.atlasTextureIcon.bind(ce.atlasInterpolationIcon,Q.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,ce.program),ce.hasHalo){let _e=ce.uniformValues;_e.u_is_halo=1,Ls(ce.buffers,we.segments,a,h,ce.program,xe,g,v,_e,2),_e.u_is_halo=0}else{if(ce.isSDF){let _e=ce.uniformValues;ce.hasHalo&&(_e.u_is_halo=1,Ls(ce.buffers,we.segments,a,h,ce.program,xe,g,v,_e,1)),_e.u_is_halo=0}Ls(ce.buffers,we.segments,a,h,ce.program,xe,g,v,ce.uniformValues,1)}}}function Ls(h,r,a,d,g,v,w,E,D,S){let A=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];g.draw(d,d.context.gl.TRIANGLES,v,w,E,Mt.disabled,D,a.id,h.layoutVertexBuffer,h.indexBuffer,r,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),A,S)}function xa(h,r,a,d,g,v,w){let E=h.context.gl,D=a.paint.get("fill-pattern"),S=D&&D.constantOr(1),A,R,k,F,$;w?(R=S&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=E.LINES):(R=S?"fillPattern":"fill",A=E.TRIANGLES);for(let U of d){let G=r.getTile(U);if(S&&!G.patternsLoaded())continue;let B=G.getBucket(a);if(!B)continue;h.prepareDrawTile();let q=B.programConfigurations.get(a.id),Q=h.isTileAffectedByFog(U),X=h.getOrCreateProgram(R,{config:q,overrideFog:Q});S&&(h.context.activeTexture.set(E.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),q.updatePaintBuffers());let ee=D.constantOr(null);if(ee&&G.imageAtlas){let oe=G.imageAtlas.patternPositions[ee.toString()];oe&&q.setConstantPatternPositions(oe)}let H=h.translatePosMatrix(U.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),te=a.paint.get("fill-emissive-strength");if(w){F=B.indexBuffer2,$=B.segments2;let oe=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];k=R==="fillOutlinePattern"&&S?zm(H,te,h,G,oe):va(H,te,oe)}else F=B.indexBuffer,$=B.segments,k=S?af(H,te,h,G):gl(H,te);h.uploadCommonUniforms(h.context,X,U.toUnwrapped()),X.draw(h,A,g,h.stencilModeForClipping(U),v,Mt.disabled,k,a.id,B.layoutVertexBuffer,F,$,a.paint,h.transform.zoom,q,void 0)}}function mt(h,r,a,d,g,v,w,E){a.resetLayerRenderingStats(h);let D=h.context,S=D.gl,A=h.transform,R=a.paint.get("fill-extrusion-pattern"),k=R.constantOr(1),F=a.paint.get("fill-extrusion-opacity"),$=h.style.enable3dLights(),U=a.paint.get($&&!k?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],B=a.layout.get("fill-extrusion-edge-radius"),q=B>0&&!a.paint.get("fill-extrusion-rounded-roof"),Q=q?0:B,X=A.projection.name==="globe"?i.cF():0,ee=A.projection.name==="globe",H=ee?i.S(A.zoom):0,te=[i.a5(A.center.lng),i.ae(A.center.lat)],oe=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ae=a.paint.get("fill-extrusion-flood-light-intensity"),ue=a.paint.get("fill-extrusion-vertical-scale"),xe=As(h,a.paint.get("fill-extrusion-cutoff-fade-range")),fe=a.paint.get("fill-extrusion-emissive-strength"),De=[],Ee;ee&&De.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&De.push("FAUX_AO"),q&&De.push("ZERO_ROOF_RADIUS"),E&&De.push("HAS_CENTROID"),ae>0&&De.push("FLOOD_LIGHT"),xe.shouldRenderCutoff&&De.push("RENDER_CUTOFF");let Be=h.renderPass==="shadow",pe=h.shadowRenderer,we=Be&&!!pe;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let ce=[0,0,0];if(pe){let We=h.style.directionalLight,qe=h.style.ambientLight;We&&qe&&(ce=fc(We,qe)),Ee=De.concat(["SHADOWS_SINGLE_CASCADE"])}let _e=we?"fillExtrusionDepth":k?"fillExtrusionPattern":"fillExtrusion",je=a.getLayerRenderingStats();for(let We of d){let qe=r.getTile(We),et=qe.getBucket(a);if(!et||et.projection.name!==A.projection.name)continue;let ft=!1;pe&&(ft=pe.getMaxCascadeForTile(We.toUnwrapped())===0);let wt=h.isTileAffectedByFog(We),_t=et.programConfigurations.get(a.id),xt=h.getOrCreateProgram(_e,{config:_t,defines:ft?Ee:De,overrideFog:wt});if(h.terrain&&h.terrain.setupElevationDraw(qe,xt,{useMeterToDem:!0}),!et.centroidVertexBuffer){let Hn=xt.attributes.a_centroid_pos;Hn!==void 0&&S.vertexAttrib2f(Hn,0,0)}!Be&&pe&&pe.setupShadows(qe.tileID.toUnwrapped(),xt,"vector-tile",qe.tileID.overscaledZ),k&&(h.context.activeTexture.set(S.TEXTURE0),qe.imageAtlasTexture&&qe.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),_t.updatePaintBuffers());let Ut=R.constantOr(null);if(Ut&&qe.imageAtlas){let Hn=qe.imageAtlas.patternPositions[Ut.toString()];Hn&&_t.setConstantPatternPositions(Hn)}let Rt=a.paint.get("fill-extrusion-vertical-gradient"),zt;if(Be&&pe){if(Hm(qe.tileID,et,h))continue;let Hn=pe.calculateShadowPassMatrixFromTile(qe.tileID.toUnwrapped());zt=sf(Hn,Q,ue)}else{let Hn=h.translatePosMatrix(We.expandedProjMatrix,qe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),en=A.projection.createInversionMatrix(A,We.canonical);zt=k?ya(Hn,h,Rt,F,G,Q,We,qe,X,H,te,en,oe,ue):of(Hn,h,Rt,F,G,Q,We,X,H,te,en,oe,ue,ae,ce,fe)}h.uploadCommonUniforms(D,xt,We.toUnwrapped(),null,xe);let kt=et.segments;if(A.projection.name==="mercator"&&!Be&&(kt=et.getVisibleSegments(qe.tileID,h.terrain,h.transform.getFrustum(0)),!kt.get().length))continue;if(je)if(Be)for(let Hn of kt.get())je.numRenderedVerticesInShadowPass+=Hn.primitiveLength;else for(let Hn of kt.get())je.numRenderedVerticesInTransparentPass+=Hn.primitiveLength;let dn=[];(h.terrain||E)&&dn.push(et.centroidVertexBuffer),ee&&dn.push(et.layoutVertexExtBuffer),xt.draw(h,D.gl.TRIANGLES,g,v,w,Mt.backCCW,zt,a.id,et.layoutVertexBuffer,et.indexBuffer,kt,a.paint,h.transform.zoom,_t,dn)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Os(h,r,a,d,g,v,w,E,D,S,A,R,k,F,$,U,G,B,q){let Q=h.context,X=Q.gl,ee=h.transform,H=h.transform.zoom,te=[],oe=As(h,a.paint.get("fill-extrusion-cutoff-fade-range"));S==="clear"?(te.push("CLEAR_SUBPASS"),q&&(te.push("CLEAR_FROM_TEXTURE"),Q.activeTexture.set(X.TEXTURE0),q.bind(X.LINEAR,X.CLAMP_TO_EDGE))):S==="sdf"&&te.push("SDF_SUBPASS"),G&&te.push("HAS_CENTROID"),oe.shouldRenderCutoff&&te.push("RENDER_CUTOFF");let ae=a.layout.get("fill-extrusion-edge-radius"),ue=(xe,fe,De,Ee,Be)=>{let pe=fe.programConfigurations.get(a.id),we=h.isTileAffectedByFog(xe),ce=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:pe,defines:te,overrideFog:we}),_e=((We,qe,et,ft,wt,_t,xt,Ut,Rt,zt,kt)=>({u_matrix:qe,u_opacity:et,u_ao_pass:ft?1:0,u_meter_to_tile:wt,u_ao:_t,u_flood_light_intensity:xt,u_flood_light_color:Ut,u_attenuation:Rt,u_edge_radius:zt,u_fb:0,u_fb_size:kt}))(0,Ee,A,D,Be,[R,k*Be],F,$,U,H>=17?0:ae*Be,q?q.size[0]:0),je=[];G&&je.push(fe.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(Q,ce,xe.toUnwrapped(),null,oe),ce.draw(h,Q.gl.TRIANGLES,g,v,w,E,_e,a.id,fe.vertexBuffer,fe.indexBuffer,De,a.paint,H,pe,je)};for(let xe of d){let fe=r.getTile(xe),De=fe.getBucket(a);if(!De||De.projection.name!==ee.projection.name||!De.groundEffect||De.groundEffect&&!De.groundEffect.hasData())continue;let Ee=De.groundEffect,Be=1/De.tileToMeter;{let pe=h.translatePosMatrix(xe.projMatrix,fe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),we=Ee.getDefaultSegment();ue(xe,Ee,we,pe,Be)}if(B)for(let pe=0;pe<4;pe++){let we=i.cG[pe](xe),ce=r.getTile(we);if(!ce)continue;let _e=ce.getBucket(a);if(!_e||_e.projection.name!==ee.projection.name||!_e.groundEffect||_e.groundEffect&&!_e.groundEffect.hasData())continue;let je=_e.groundEffect,We,qe;pe===0?(We=[-i.V,0,0],qe=1):pe===1?(We=[i.V,0,0],qe=0):pe===2?(We=[0,-i.V,0],qe=3):(We=[0,i.V,0],qe=2);let et=je.regionSegments[qe];if(!et)continue;let ft=new Float32Array(16);i.a6.translate(ft,xe.projMatrix,We),ue(xe,je,et,h.translatePosMatrix(ft,fe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Be)}}}function R0(h,r,a,d,g,v,w){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();let E=v?v.findDEMTileFor(a):null;if(!(E&&E.dem||w))return;let D=B=>new i.P(Math.ceil((B+i.cJ)*i.cK),0),S=B=>{let q=r.getSource().minzoom,Q=ee=>{let H=r.getTileByID(ee);if(H&&H.hasData())return H.getBucket(g)},X=[0,-1,1];for(let ee of X){if(B.overscaledZ+ee<q)continue;let H=Q(B.calculateScaledKey(B.overscaledZ+ee));if(H)return H}},A=[0,0,0],R=(B,q)=>(A[0]=Math.min(B.min.y,q.min.y),A[1]=Math.max(B.max.y,q.max.y),A[2]=i.V-q.min.x>B.max.x?q.min.x-i.V:B.max.x,A),k=(B,q)=>(A[0]=Math.min(B.min.x,q.min.x),A[1]=Math.max(B.max.x,q.max.x),A[2]=i.V-q.min.y>B.max.y?q.min.y-i.V:B.max.y,A),F=[(B,q)=>R(B,q),(B,q)=>R(q,B),(B,q)=>k(B,q),(B,q)=>k(q,B)],$=(B,q,Q,X,ee,H,te)=>{if(!v)return 0;let oe=[[H?Q:B,H?B:Q,0],[H?Q:q,H?q:Q,0]],ae=te<0?i.V+te:te,ue=[H?ae:(B+q)/2,H?(B+q)/2:ae,0];return Q===0&&te<0||Q!==0&&te>0?v.getForTilePoints(ee,[ue],!0,X):oe.push(ue),v.getForTilePoints(a,oe,!0,E),Math.max(oe[0][2],oe[1][2],ue[2])/v.exaggeration()};for(let B=0;B<4;B++){let q=d.borderFeatureIndices[B];if(q.length===0)continue;let Q=i.cG[B](a),X=S(Q);if(!(X&&X instanceof i.cH)||d.borderDoneWithNeighborZ[B]===X.canonical.z)continue;X.centroidVertexArray.length===0&&X.createCentroidsBuffer();let ee=v?v.findDEMTileFor(Q):null;if(!(ee&&ee.dem||w))continue;let H=(B<2?1:5)-B,te=X.borderDoneWithNeighborZ[H]!==d.canonical.z,oe=X.borderFeatureIndices[H],ae=0;if(d.canonical.z!==X.canonical.z){for(let ue of q)d.showCentroid(d.featuresOnBorder[ue]);if(te)for(let ue of oe)X.showCentroid(X.featuresOnBorder[ue]);d.borderDoneWithNeighborZ[B]=X.canonical.z,X.borderDoneWithNeighborZ[H]=d.canonical.z}for(let ue of q){let xe=d.featuresOnBorder[ue],fe=d.centroidData[xe.centroidDataIndex],De=xe.borders[B],Ee;for(;ae<oe.length;){Ee=X.featuresOnBorder[oe[ae]];let Be=Ee.borders[H];if(Be[1]>De[0]+3||Be[0]>De[0]-3)break;X.showCentroid(Ee),ae++}if(Ee&&ae<oe.length){let Be=ae,pe=0;for(;!(Ee.borders[H][0]>De[1]-3)&&(pe++,++ae!==oe.length);)Ee=X.featuresOnBorder[oe[ae]];if(Ee=X.featuresOnBorder[oe[Be]],pe>1){let _e=Ee.borders[H];Math.abs(De[0]-_e[0])<3&&Math.abs(De[1]-_e[1])<3&&(pe=1,ae=Be+1)}else if(pe===0){d.showCentroid(xe);continue}let we=X.centroidData[Ee.centroidDataIndex];w&&pe===1&&(((U=fe).flags|(G=we).flags)&i.cI?(U.flags|=i.cI,G.flags|=i.cI):(U.flags&=~i.cI,G.flags&=~i.cI));let ce=xe.intersectsCount()>1||Ee.intersectsCount()>1;if(pe>1)ae=Be,fe.centroidXY=we.centroidXY=new i.P(0,0);else if(ee&&ee.dem&&!ce){let _e=F[B](fe,we),je=B%2?i.V-1:0,We=$(_e[0],Math.min(i.V-1,_e[1]),je,ee,Q,B<2,_e[2]);fe.centroidXY=we.centroidXY=D(We)}else ce?fe.centroidXY=we.centroidXY=new i.P(0,0):(fe.centroidXY=d.encodeBorderCentroid(xe),we.centroidXY=X.encodeBorderCentroid(Ee));d.writeCentroidToBuffer(fe),X.writeCentroidToBuffer(we)}else d.showCentroid(xe)}d.borderDoneWithNeighborZ[B]=X.canonical.z,X.borderDoneWithNeighborZ[H]=d.canonical.z}var U,G;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}let L0=[1,0,0],df=[0,1,0],Gm=[0,0,1];function Hm(h,r,a){let d=a.transform,g=a.shadowRenderer;if(!g)return!0;let v=h.toUnwrapped(),w=d.tileSize*g._cascades[a.currentShadowCascade].scale,E=r.maxHeight;if(d.elevation){let U=d.elevation.getMinMaxForTile(h);U&&(E+=U.max)}let D=[...g.shadowDirection];D[2]=-D[2];let S=g.computeSimplifiedTileShadowVolume(v,E,w,D);if(!S)return!1;let A=[L0,df,Gm,D,[D[0],0,D[2]],[0,D[1],D[2]]],R=d.projection.name==="globe",k=d.scaleZoom(w),F=i.bq.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,k,!R),$=g.getCurrentCascadeFrustum();return F.intersectsPrecise(S.vertices,S.planes,A)===0||$.intersectsPrecise(S.vertices,S.planes,A)===0}function qm(h){return[h[0]*i.cL,h[1]*i.cL,h[2]*i.cL,0]}function ff(h,r,a,d,g,v,w,E,D){let S=d.getSource(),A=a.globeSharedBuffers;if(!A)return;let R,k,F;if(r&&(R=d.getTile(r)),S instanceof i.ap?(k=S.texture,F=i.cj(0,0,a.transform)):R&&r&&(k=R.texture,F=i.cj(r.canonical.z,r.canonical.x,a.transform)),!k||!F)return;h||(F=i.a6.scale(i.a6.create(),F,[1,-1,1]));let $=a.context,U=$.gl,G=g.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,B=a.colorModeForDrapableLayerRenderPass(v),q=w.defines;q.push("GLOBE_POLES");let Q=new Dt(U.LEQUAL,Dt.ReadWrite,a.depthRangeFor3D),X=Float32Array.from(a.transform.expandedFarZProjMatrix),ee=Float32Array.from(i.aT(i.ci(new i.bs(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),$.activeTexture.set(U.TEXTURE0),k.bind(G,U.CLAMP_TO_EDGE),$.activeTexture.set(U.TEXTURE1),k.bind(G,U.CLAMP_TO_EDGE),k.useMipmap&&$.extTextureFilterAnisotropic&&a.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);let[H,te,oe,ae]=r?A.getPoleBuffers(r.canonical.z,!1):A.getPoleBuffers(0,!0),ue=g.paint.get("raster-elevation"),xe;h?(xe=H,a.renderDefaultNorthPole=ue!==0):(xe=te,a.renderDefaultSouthPole=ue!==0);let fe=qm(w.mix),De=((Be,pe,we,ce,_e,je,We,qe,et,ft,wt,_t,xt)=>uf(Be,pe,we,new Float32Array(16),new Float32Array(9),[0,0],ce,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],qe,2,ft,wt,_t,1,0,xt))(X,ee,F,i.S(a.transform.zoom),0,g,0,ue,0,fe,w.offset,w.range,v),Ee=a.getOrCreateProgram("raster",{defines:q});a.uploadCommonUniforms($,Ee,null),Ee.draw(a,U.TRIANGLES,Q,D,B,E,De,g.id,xe,oe,ae)}function pf(h){let r=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-r,g=.2*h.height,v=r+g;return[r,a,(v-g-r)/d,(v-r)/d]}function mf(h,r,a,d){if(h)return r instanceof Ye&&h instanceof da?r.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:qm(d.mix),offset:d.offset,buffer:0,tileSize:1}}function gf(h,r,a){if(!h)return null;let d=r.getTextureDescriptor(h,a,!0);if(!d)return null;let{texture:g,mix:v,offset:w,tileSize:E,buffer:D,format:S}=d;if(!g||!S)return null;let A=!1;return S==="uint32"&&(A=!0,v[3]=0,v=Vu(i.cM,v,[0,a.paint.get("raster-particle-max-speed")]),w=jm(i.cM,w,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[D/(E+2*D),E/(E+2*D)],tileSize:E,scalarData:A,scale:v,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[S]]}}function _f(h){let r=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-r,g=.2*h.height,v=r+g;return[r,a,(v-g-r)/d,(v-r)/d]}let Ai=new i.ax(1,0,0,1),Ns=new i.ax(0,1,0,1),Wm=new i.ax(0,0,1,1),yf=new i.ax(1,0,1,1),vf=new i.ax(0,1,1,1);function ks(h,r,a,d,g,v,w){let E=h.context,D=h.transform,S=E.gl,A=D.projection.name==="globe",R=A?["PROJECTION_GLOBE_VIEW"]:[],k=i.a6.clone(a.projMatrix);if(A&&i.S(D.zoom)>0){let fe=i.aS(a.canonical,D),De=i.cN(fe);k=i.a6.multiply(new Float32Array(16),D.globeMatrix,De),i.a6.multiply(k,D.projMatrix,k)}let F=i.a6.create();F[12]+=2*g/(i.f.devicePixelRatio*D.width),F[13]+=2*v/(i.f.devicePixelRatio*D.height),i.a6.multiply(k,F,k);let $=h.getOrCreateProgram("debug",{defines:R}),U=r.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(U,$);let G=Dt.disabled,B=Lt.disabled,q=h.colorModeForRenderPass(),Q="$debug";E.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),A?U._makeGlobeTileDebugBuffers(h.context,D):U._makeDebugTileBoundsBuffers(h.context,D.projection);let X=U._tileDebugBuffer||h.debugBuffer,ee=U._tileDebugIndexBuffer||h.debugIndexBuffer,H=U._tileDebugSegments||h.debugSegments;if($.draw(h,S.LINE_STRIP,G,B,q,Mt.disabled,lf(k,d),Q,X,ee,H,null,null,null,[U._globeTileDebugBorderBuffer]),w){let fe=U.latestRawTileData,De=Math.floor((fe&&fe.byteLength||0)/1024),Ee=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ee+=` => ${a.overscaledZ}`),Ee+=` ${U.state}`,Ee+=` ${De}kb`,function(Be,pe){Be.initDebugOverlayCanvas();let we=Be.debugOverlayCanvas,ce=Be.context.gl,_e=Be.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,we.width,we.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(pe,5,5),_e.strokeText(pe,5,5),Be.debugOverlayTexture.update(we),Be.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(h,Ee)}let te=r.getTile(a).tileSize,oe=512/Math.min(te,512)*(a.overscaledZ/D.zoom)*.5,ae=U._tileDebugTextBuffer||h.debugBuffer,ue=U._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,xe=U._tileDebugTextSegments||h.debugSegments;$.draw(h,S.TRIANGLES,G,B,Kt.alphaBlended,Mt.disabled,lf(k,i.ax.transparent,oe),Q,ae,ue,xe,null,null,null,[U._globeTileDebugTextBuffer])}function xf(h,r,a,d){ar(h,0,r+a/2,h.transform.width,a,d)}function Ui(h,r,a,d){ar(h,r-a/2,0,a,h.transform.height,d)}function ar(h,r,a,d,g,v){let w=h.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(r*i.f.devicePixelRatio,a*i.f.devicePixelRatio,d*i.f.devicePixelRatio,g*i.f.devicePixelRatio),w.clear({color:v}),E.disable(E.SCISSOR_TEST)}let qu=i.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bf}=qu;function Ko(h,r,a,d){h.emplaceBack(r,a,d)}class wf{constructor(r){this.vertexArray=new i.az,this.indices=new i.aw,Ko(this.vertexArray,-1,-1,1),Ko(this.vertexArray,1,-1,1),Ko(this.vertexArray,-1,1,1),Ko(this.vertexArray,1,1,1),Ko(this.vertexArray,-1,-1,-1),Ko(this.vertexArray,1,-1,-1),Ko(this.vertexArray,-1,1,-1),Ko(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,bf),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.aB.simpleSegment(0,0,36,12)}}function ba(h,r,a,d,g,v){let w=h.context.gl,E=r.paint.get("sky-atmosphere-color"),D=r.paint.get("sky-atmosphere-halo-color"),S=r.paint.get("sky-atmosphere-sun-intensity"),A=((R,k,F,$,U)=>({u_matrix_3f:R,u_sun_direction:k,u_sun_intensity:F,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(i.co.fromMat4(i.co.create(),d),g,S,E,D);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),a.draw(h,w.TRIANGLES,Dt.disabled,Lt.disabled,Kt.unblended,Mt.frontCW,A,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let O0=i.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _l{constructor(r){let a=new i.cO;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);let d=new i.aw;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(a,O0.members),this.indexBuffer=r.createIndexBuffer(d),this.segments=i.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let wc=i.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Xe{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Et{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Kt([1,Ts,1,Ts],i.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Kt([1,0,1,0],i.ax.transparent,[!1,!1,!1,!0]),this.params=new Xe,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){let a=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new _l(a);let d=this.params.sizeRange,g=this.params.intensityRange,v=function(A){let R=i.aA(30),k=[];for(let F=0;F<A;++F){let $=2*Math.PI*R(),U=Math.acos(1-2*R())-.5*Math.PI;k.push(i.N.fromValues(Math.cos(U)*Math.cos($),Math.cos(U)*Math.sin($),Math.sin(U)))}return k}(this.params.starsCount),w=i.aA(300),E=new i.cP,D=new i.aw,S=0;for(let A=0;A<v.length;++A){let R=i.N.scale([],v[A],200),k=Math.max(0,1+.01*d*(1*w()-.5)),F=Math.max(0,1+.01*g*(1*w()-.5));E.emplaceBack(R[0],R[1],R[2],-1,-1,k,F),E.emplaceBack(R[0],R[1],R[2],1,-1,k,F),E.emplaceBack(R[0],R[1],R[2],1,1,k,F),E.emplaceBack(R[0],R[1],R[2],-1,1,k,F),D.emplaceBack(S+0,S+1,S+2),D.emplaceBack(S+0,S+2,S+3),S+=4}this.starsVx=a.createVertexBuffer(E,wc.members),this.starsIdx=a.createIndexBuffer(D),this.starsSegments=i.aB.simpleSegment(0,0,E.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,a){let d=r.context,g=d.gl,v=r.transform,w=new Dt(g.LEQUAL,Dt.ReadOnly,[0,1]),E=i.S(v.zoom),D=a.properties.get("color").toArray01(),S=a.properties.get("high-color").toArray01(),A=a.properties.get("space-color").toArray01PremultipliedAlpha(),R=5e-4,k=i.cQ(a.properties.get("horizon-blend"),0,1,R,.25),F=i.cd(r,d,v)&&k===R?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,$=r.frameCounter/1e3%1,U=i.N.length(v.globeCenterInViewSpace),G=Math.sqrt(Math.pow(U,2)-Math.pow(F,2)),B=Math.acos(G/U),q=Q=>{let X=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Q&&X.push("ALPHA_PASS");let ee=r.getOrCreateProgram("globeAtmosphere",{defines:X}),H=((oe,ae,ue,xe,fe,De,Ee,Be,pe,we,ce,_e)=>({u_frustum_tl:oe,u_frustum_tr:ae,u_frustum_br:ue,u_frustum_bl:xe,u_horizon:fe,u_transition:De,u_fadeout_range:Ee,u_color:Be,u_high_color:pe,u_space_color:we,u_temporal_offset:ce,u_horizon_angle:_e}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,E,k,D,S,A,$,B);r.uploadCommonUniforms(d,ee);let te=this.atmosphereBuffer;te&&ee.draw(r,g.TRIANGLES,w,Lt.disabled,Q?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Mt.backCW,H,Q?"atmosphere_glow_alpha":"atmosphere_glow",te.vertexBuffer,te.indexBuffer,te.segments)};q(!1),q(!0)}drawStars(r,a){let d=i.aa(a.properties.get("star-intensity"),0,1);if(d===0)return;let g=r.context,v=g.gl,w=r.transform,E=r.getOrCreateProgram("stars"),D=i.bi.identity([]);i.bi.rotateX(D,D,-w._pitch),i.bi.rotateZ(D,D,-w.angle),i.bi.rotateX(D,D,i.bj(w._center.lat)),i.bi.rotateY(D,D,-i.bj(w._center.lng));let S=i.a6.fromQuat(new Float32Array(16),D),A=i.a6.multiply([],w.starsProjMatrix,S),R=i.co.fromMat4([],S),k=i.co.invert([],R),F=[0,1,0];i.N.transformMat3(F,F,k),i.N.scale(F,F,this.params.sizeMultiplier);let $=[1,0,0];i.N.transformMat3($,$,k),i.N.scale($,$,this.params.sizeMultiplier);let U=(G=F,B=$,q=d,{u_matrix:Float32Array.from(A),u_up:G,u_right:B,u_intensity_multiplier:q});var G,B,q;r.uploadCommonUniforms(g,E),this.starsVx&&this.starsIdx&&E.draw(r,v.TRIANGLES,Dt.disabled,Lt.disabled,this.colorModeAlphaBlendedWriteRGB,Mt.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wa(h,r){let a=[...h],d=r.cameraWorldSizeForFog/r.worldSize,g=i.a6.identity([]);return i.a6.scale(g,g,[d,d,1]),i.a6.multiply(a,g,a),i.a6.multiply(a,r.worldToFogMatrix,a),a}function lr(h,r,a,d){let g=a.material,v=d.context,{baseColorTexture:w,metallicRoughnessTexture:E}=g.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:S,emissionTexture:A}=g;function R(k,F,$){if(k&&(h.push(F),v.activeTexture.set(v.gl.TEXTURE0+$),k.gfxTexture)){let{minFilter:U,magFilter:G,wrapS:B,wrapT:q}=k.sampler;k.gfxTexture.bindExtraParam(U,G,B,q)}}R(w,"HAS_TEXTURE_u_baseColorTexture",ei.BaseColor),R(E,"HAS_TEXTURE_u_metallicRoughnessTexture",ei.MetallicRoughness),R(D,"HAS_TEXTURE_u_normalTexture",ei.Normal),R(S,"HAS_TEXTURE_u_occlusionTexture",ei.Occlusion),R(A,"HAS_TEXTURE_u_emissionTexture",ei.Emission),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(a.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES")}function Tc(h,r,a,d,g,v){let w=a.paint.get("model-opacity"),E=r.context,D=new Dt(r.context.gl.LEQUAL,Dt.ReadWrite,r.depthRangeFor3D),S=r.transform,A=h.mesh,R=A.material,k=R.pbrMetallicRoughness,F=r.style.fog,$;$=r.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:i.a6.multiply([],d.zScaleMatrix,h.nodeModelMatrix),i.a6.multiply($,d.negCameraPosMatrix,$);let U=i.a6.invert([],$);i.a6.transpose(U,U);let G=a.paint.get("model-emissive-strength").constantOr(0),B=Gu(new Float32Array(h.worldViewProjection),new Float32Array($),new Float32Array(U),r,w,k.baseColorFactor,R.emissiveFactor,k.metallicFactor,k.roughnessFactor,R,G,a),q={defines:[]},Q=[];lr(q.defines,Q,A,r);let X=r.shadowRenderer;X&&(X.useNormalOffset=!1);let ee=null;if(F){let oe=wa(h.nodeModelMatrix,r.transform);if(ee=new Float32Array(oe),S.projection.name!=="globe"){let ae=A.aabb.min,ue=A.aabb.max,[xe,fe]=F.getOpacityForBounds(oe,ae[0],ae[1],ue[0],ue[1]);q.overrideFog=xe>=Sn||fe>=Sn}}let H=As(r,a.paint.get("model-cutoff-fade-range"));H.shouldRenderCutoff&&q.defines.push("RENDER_CUTOFF");let te=r.getOrCreateProgram("model",q);r.uploadCommonUniforms(E,te,null,ee,H),r.renderPass!=="shadow"&&X&&X.setupShadowsFromMatrix(h.nodeModelMatrix,te),te.draw(r,E.gl.TRIANGLES,D,g,v,A.material.doubleSided?Mt.disabled:Mt.backCCW,B,a.id,A.vertexBuffer,A.indexBuffer,A.segments,a.paint,r.transform.zoom,void 0,Q)}function Ec(h,r,a,d,g,v,w){let E;E=h.projection.name==="globe"?i.cS(a,h):[...a],i.a6.multiply(E,E,r.matrix);let D=i.a6.multiply([],d,E);if(r.meshes)for(let S of r.meshes){if(S.material.alphaMode!=="BLEND"){w.push({mesh:S,depth:0,modelIndex:g,worldViewProjection:D,nodeModelMatrix:E});continue}let A=i.N.transformMat4([],S.centroid,D);A[2]>0&&v.push({mesh:S,depth:A[2],modelIndex:g,worldViewProjection:D,nodeModelMatrix:E})}if(r.children)for(let S of r.children)Ec(h,S,a,d,g,v,w)}function ye(h,r,a,d){let g=a.shadowRenderer;if(!g)return;let v=g.getShadowPassDepthMode(),w=g.getShadowPassColorMode(),E=g.calculateShadowPassMatrixFromMatrix(r),D=xc(E);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,v,Lt.disabled,w,Mt.backCCW,D,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,a.transform.zoom,void 0,void 0)}function Tf(h,r,a){let d=r.updateZoomBasedPaintProperties(),g=function(v,w,E){let D,S,A,R=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&R>0){let k=v.terrain,F=k.findDEMTileFor(E);F&&F.dem?D=i.cU.create(k,E,F):R=0}if(R===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),R===w.validForExaggeration&&(R===0||D&&D._demTile&&D._demTile.tileID===w.validForDEMTile.id&&D._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(let k in w.instancesPerModel){let F=w.instancesPerModel[k];for(let $=0;$<F.instancedDataArray.length;++$){let U=(D?R*D.getElevationAt(0|F.instancedDataArray.float32[16*$],0|F.instancedDataArray.float32[16*$+1],!0,!0):0)+F.instancesEvaluatedElevation[$];F.instancedDataArray.float32[16*$+6]=U,S=S?Math.min(w.terrainElevationMin,U):U,A=A?Math.max(w.terrainElevationMax,U):U}}return w.terrainElevationMin=S||0,w.terrainElevationMax=A||0,w.validForExaggeration=R,w.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,r,a);(d||g)&&(r.uploaded=!1,r.upload(h.context))}let $i={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.bS([0,0,0],[i.V,i.V,0])};function Zm(h,r){let a=1<<h.canonical.z,d=r.getFreeCameraOptions().position,g=r.elevation,v=h.canonical.x/a,w=(h.canonical.x+1)/a,E=h.canonical.y/a,D=(h.canonical.y+1)/a,S=r._centerAltitude;if(g){let F=g.getMinMaxForTile(h);F&&F.max>S&&(S=F.max)}let A=i.aa(d.x,v,w)-d.x,R=i.aa(d.y,E,D)-d.y,k=i.bl(S,r.center.lat)-d.z;return r._zoomFromMercatorZ(Math.sqrt(A*A+R*R+k*k))}function Ef(h,r,a,d,g,v,w){let E=h.context,D=h.renderPass==="shadow",S=h.shadowRenderer,A=D&&S?S.getShadowPassDepthMode():new Dt(E.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D),R=h.isTileAffectedByFog(v);if(a.meshes)for(let k of a.meshes){let F=["MODEL_POSITION_ON_GPU"],$=[],U,G,B;d.instancedDataArray.length>20&&F.push("INSTANCED_ARRAYS");let q=As(h,r.paint.get("model-cutoff-fade-range"));if(q.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),D&&S)U=h.getOrCreateProgram("modelDepth",{defines:F}),G=xc(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(a.matrix)),B=S.getShadowPassColorMode();else{lr(F,$,k,h),U=h.getOrCreateProgram("model",{defines:F,overrideFog:R});let X=k.material,ee=X.pbrMetallicRoughness,H=r.paint.get("model-opacity"),te=r.paint.get("model-emissive-strength").constantOr(0);G=Gu(v.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),h,H,ee.baseColorFactor,X.emissiveFactor,ee.metallicFactor,ee.roughnessFactor,X,te,r,g),S&&(w.shadowUniformsInitialized?U.setShadowUniformValues(E,S.getShadowUniformValues()):(S.setupShadows(v.toUnwrapped(),U,"model-tile",v.overscaledZ),w.shadowUniformsInitialized=!0)),B=q.shouldRenderCutoff||H<1||X.alphaMode!=="OPAQUE"?Kt.alphaBlended:Kt.unblended}h.uploadCommonUniforms(E,U,v.toUnwrapped(),null,q);let Q=k.material.doubleSided?Mt.disabled:Mt.backCCW;if(d.instancedDataArray.length>20)$.push(d.instancedDataBuffer),U.draw(h,E.gl.TRIANGLES,A,Lt.disabled,B,Q,G,r.id,k.vertexBuffer,k.indexBuffer,k.segments,r.paint,h.transform.zoom,void 0,$,d.instancedDataArray.length);else{let X=D?"u_instance":"u_normal_matrix";for(let ee=0;ee<d.instancedDataArray.length;++ee)G[X]=new Float32Array(d.instancedDataArray.arrayBuffer,64*ee,16),U.draw(h,E.gl.TRIANGLES,A,Lt.disabled,B,Q,G,r.id,k.vertexBuffer,k.indexBuffer,k.segments,r.paint,h.transform.zoom,void 0,$)}}if(a.children)for(let k of a.children)Ef(h,r,k,d,g,v,w)}let yl=[1,-1,1];function N0(h,r,a,d){if(!a.modelManager)return!0;let g=a.modelManager;if(!a.shadowRenderer)return!0;let v=a.shadowRenderer,w=r.aabb,E=!0,D=h.maxHeight;if(D===0){let A=0;for(let R in h.instancesPerModel){let k=g.getModel(R,d);k?A=Math.max(A,Math.max(Math.max(k.aabb.max[0],k.aabb.max[1]),k.aabb.max[2])):E=!1}D=h.maxScale*A*1.41+h.maxVerticalOffset,E&&(h.maxHeight=D)}w.max[2]=D,w.min[2]+=h.terrainElevationMin,w.max[2]+=h.terrainElevationMax,i.N.transformMat4(w.min,w.min,r.tileMatrix),i.N.transformMat4(w.max,w.max,r.tileMatrix);let S=w.intersects(v.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=S===2),S===0}class k0{}class Xm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,a,d){{let R=this._storage.get(a.id);if(R)return R.lastUsedFrameIdx=r,R.buf}let g=d.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),w=new ArrayBuffer(v),E=new Int16Array(w);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));let D=new i.cW;for(let R=0;R<v/2;R+=3){let k=E[R],F=E[R+1],$=E[R+2];D.emplaceBack(k,F),D.emplaceBack(F,$),D.emplaceBack($,k)}let S=d.bindVertexArrayOES.current,A=new k0;return A.buf=new fr(d,D),A.lastUsedFrameIdx=r,this._storage.set(a.id,A),d.bindVertexArrayOES.set(S),A.buf}update(r){for(let[a,d]of this._storage)r-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(let[r,a]of this._storage)a.buf.destroy(),this._storage.delete(r)}}class Ic{registerParameter(r,a,d,g,v){}registerButton(r,a,d){}}let Dc={symbol:function(h,r,a,d,g){if(h.renderPass!=="translucent")return;let v=Lt.disabled,w=h.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(S,A,R,k,F,$,U){let G=A.transform,B=F==="map",q=$==="map";for(let Q of S){let X=k.getTile(Q),ee=X.getBucket(R);if(!ee||!ee.text||!ee.text.segments.get().length)continue;let H=i.b5(ee.textSizeData,G.zoom),te=ac(Q,ee.getProjection(),G),oe=G.calculatePixelsToTileUnitsMatrix(X),ae=oc(te,X.tileID.canonical,q,B,G,ee.getProjection(),oe),ue=ee.hasIconTextFit()&&ee.hasIconData();if(H){let xe=Math.pow(2,G.zoom-X.tileID.overscaledZ);$m(ee,B,q,U,i.cx,G,ae,Q,xe,H,ue)}}}(d,h,a,r,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g);let E=a.paint.get("icon-opacity").constantOr(1)!==0,D=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(E||D)?Hu(h,r,a,d,v,w):(E&&Hu(h,r,a,d,v,w,{onlyIcons:!0}),D&&Hu(h,r,a,d,v,w,{onlyText:!0})),r.map.showCollisionBoxes&&(vo(h,r,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),vo(h,r,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,a,d){if(h.renderPass!=="translucent")return;let g=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0,D=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;let S=h.context,A=S.gl,R=h.transform,k=h.depthModeForSublayer(0,Dt.ReadOnly),F=Lt.disabled,$=h.colorModeForDrapableLayerRenderPass(D),U=R.projection.name==="globe",G=[i.a5(R.center.lng),i.ae(R.center.lat)],B=[];for(let Q=0;Q<d.length;Q++){let X=d[Q],ee=r.getTile(X),H=ee.getBucket(a);if(!H||H.projection.name!==R.projection.name)continue;let te=H.programConfigurations.get(a.id),oe=i.cy(a),ae=h.isTileAffectedByFog(X);U&&oe.push("PROJECTION_GLOBE_VIEW");let ue=h.getOrCreateProgram("circle",{config:te,defines:oe,overrideFog:ae}),xe=H.layoutVertexBuffer,fe=H.globeExtVertexBuffer,De=H.indexBuffer,Ee=R.projection.createInversionMatrix(R,X.canonical),Be={programConfiguration:te,program:ue,layoutVertexBuffer:xe,globeExtVertexBuffer:fe,indexBuffer:De,uniformValues:i.cz(h,X,ee,Ee,G,a),tile:ee};if(E){let pe=H.segments.get();for(let we of pe)B.push({segments:new i.aB([we]),sortKey:we.sortKey,state:Be})}else B.push({segments:H.segments,sortKey:0,state:Be})}E&&B.sort((Q,X)=>Q.sortKey-X.sortKey);let q={useDepthForOcclusion:R.depthOcclusionForSymbolsAndCircles};for(let Q of B){let{programConfiguration:X,program:ee,layoutVertexBuffer:H,globeExtVertexBuffer:te,indexBuffer:oe,uniformValues:ae,tile:ue}=Q.state,xe=Q.segments;h.terrain&&h.terrain.setupElevationDraw(ue,ee,q),h.uploadCommonUniforms(S,ee,ue.tileID.toUnwrapped()),ee.draw(h,A.TRIANGLES,k,F,$,Mt.disabled,ae,a.id,H,oe,xe,a.paint,R.zoom,X,[te])}},heatmap:function(h,r,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){let g=h.context,v=g.gl,w=Lt.disabled,E=new Kt([v.ONE,v.ONE,v.ONE,v.ONE],i.ax.transparent,[!0,!0,!0,!0]);(function(F,$,U,G){let B=F.gl,q=$.width*G,Q=$.height*G;F.activeTexture.set(B.TEXTURE1),F.viewport.set([0,0,q,Q]);let X=U.heatmapFbo;if(!X||X&&(X.width!==q||X.height!==Q)){X&&X.destroy();let ee=B.createTexture();B.bindTexture(B.TEXTURE_2D,ee),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),X=U.heatmapFbo=F.createFramebuffer(q,Q,!0,null),function(H,te,oe,ae,ue,xe){let fe=H.gl;fe.texImage2D(fe.TEXTURE_2D,0,H.extRenderToTextureHalfFloat?fe.RGBA16F:fe.RGBA,ue,xe,0,fe.RGBA,H.extRenderToTextureHalfFloat?fe.HALF_FLOAT:fe.UNSIGNED_BYTE,null),ae.colorAttachment.set(oe)}(F,0,ee,X,q,Q)}else B.bindTexture(B.TEXTURE_2D,X.colorAttachment.get()),F.bindFramebuffer.set(X.framebuffer)})(g,h,a,h.transform.projection.name==="globe"?.5:.25),g.clear({color:i.ax.transparent});let D=h.transform,S=D.projection.name==="globe",A=S?["PROJECTION_GLOBE_VIEW"]:[],R=S?Mt.frontCCW:Mt.disabled,k=[i.a5(D.center.lng),i.ae(D.center.lat)];for(let F=0;F<d.length;F++){let $=d[F];if(r.hasRenderableParent($))continue;let U=r.getTile($),G=U.getBucket(a);if(!G||G.projection.name!==D.projection.name)continue;let B=h.isTileAffectedByFog($),q=G.programConfigurations.get(a.id),Q=h.getOrCreateProgram("heatmap",{config:q,defines:A,overrideFog:B}),{zoom:X}=h.transform;h.terrain&&h.terrain.setupElevationDraw(U,Q),h.uploadCommonUniforms(g,Q,$.toUnwrapped());let ee=D.projection.createInversionMatrix(D,$.canonical);Q.draw(h,v.TRIANGLES,Dt.disabled,w,E,R,cf(h,$,U,ee,k,X,a.paint.get("heatmap-intensity")),a.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,a.paint,h.transform.zoom,q,S?[G.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,v){let w=g.context,E=w.gl,D=v.heatmapFbo;if(!D)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,D.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let S=v.colorRampTexture;S||(S=v.colorRampTexture=new i.T(w,v.colorRamp,E.RGBA)),S.bind(E.LINEAR,E.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,E.TRIANGLES,Dt.disabled,Lt.disabled,g.colorModeForRenderPass(),Mt.disabled,((A,R,k,F)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(h,a))},line:function(h,r,a,d){if(h.renderPass!=="translucent")return;let g=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;let w=a.paint.get("line-emissive-strength"),E=h.depthModeForSublayer(0,Dt.ReadOnly),D=h.colorModeForDrapableLayerRenderPass(w),S=h.terrain&&h.terrain.renderingToTexture?1:i.f.devicePixelRatio,A=a.paint.get("line-dasharray"),R=A.constantOr(1),k=a.layout.get("line-cap"),F=a.paint.get("line-pattern"),$=F.constantOr(1),U=a.paint.get("line-pattern").constantOr(1),G=a.paint.get("line-opacity").constantOr(1)!==1,B=!U&&G,q=a.paint.get("line-gradient"),Q=$?"linePattern":"line",X=h.context,ee=X.gl,H=i.cA(a);h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(B=!1);for(let te of d){let oe=r.getTile(te);if($&&!oe.patternsLoaded())continue;let ae=oe.getBucket(a);if(!ae)continue;h.prepareDrawTile();let ue=ae.programConfigurations.get(a.id),xe=h.isTileAffectedByFog(te),fe=h.getOrCreateProgram(Q,{config:ue,defines:H,overrideFog:xe}),De=F.constantOr(null);if(De&&oe.imageAtlas){let We=oe.imageAtlas.patternPositions[De.toString()];We&&ue.setConstantPatternPositions(We)}let Ee=A.constantOr(null),Be=k.constantOr(null);if(!$&&Ee&&Be&&oe.lineAtlas){let We=oe.lineAtlas.getDash(Ee,Be);We&&ue.setConstantPatternPositions(We)}let[pe,we]=a.paint.get("line-trim-offset");(Be==="round"||Be==="square")&&pe!==we&&(pe===0&&(pe-=1),we===1&&(we+=1));let ce=h.terrain?te.projMatrix:null,_e=$?i.cB(h,oe,a,ce,S,[pe,we]):i.cC(h,oe,a,ce,ae.lineClipsArray.length,S,[pe,we]);if(q){let We=ae.gradients[a.id],qe=We.texture;if(a.gradientVersion!==We.version){let et=256;if(a.stepInterpolant){let ft=r.getSource().maxzoom,wt=te.canonical.z===ft?Math.ceil(1<<h.transform.maxZoom-te.canonical.z):1;et=i.aa(i.cD(ae.maxLineLength/i.V*1024*wt),256,X.maxTextureSize)}We.gradient=i.cE({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:et,image:We.gradient||void 0,clips:ae.lineClipsArray}),We.texture?We.texture.update(We.gradient):We.texture=new i.T(X,We.gradient,ee.RGBA),We.version=a.gradientVersion,qe=We.texture}X.activeTexture.set(ee.TEXTURE1),qe.bind(a.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}R&&(X.activeTexture.set(ee.TEXTURE0),oe.lineAtlasTexture&&oe.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),ue.updatePaintBuffers()),$&&(X.activeTexture.set(ee.TEXTURE0),oe.imageAtlasTexture&&oe.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ue.updatePaintBuffers()),h.uploadCommonUniforms(X,fe,te.toUnwrapped());let je=We=>{fe.draw(h,ee.TRIANGLES,E,We,D,Mt.disabled,_e,a.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,a.paint,h.transform.zoom,ue,[ae.layoutVertexBuffer2])};if(B){let We=h.stencilModeForClipping(te).ref;We===0&&h.terrain&&X.clear({stencil:0});let qe={func:ee.EQUAL,mask:255};_e.u_alpha_discard_threshold=.8,je(new Lt(qe,We,255,ee.KEEP,ee.KEEP,ee.INVERT)),_e.u_alpha_discard_threshold=0,je(new Lt(qe,We,255,ee.KEEP,ee.KEEP,ee.KEEP))}else je(h.stencilModeForClipping(te))}B&&(h.resetStencilClippingMasks(),h.terrain&&X.clear({stencil:0}))},fill:function(h,r,a,d){let g=a.paint.get("fill-color"),v=a.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let w=a.paint.get("fill-emissive-strength"),E=h.colorModeForDrapableLayerRenderPass(w),D=a.paint.get("fill-pattern"),S=h.opaquePassEnabledForLayer()&&!D.constantOr(1)&&g.constantOr(i.ax.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===S){let A=h.depthModeForSublayer(1,h.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);xa(h,r,a,d,A,E,!1)}if(h.renderPass==="translucent"&&a.paint.get("fill-antialias")){let A=h.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);xa(h,r,a,d,A,E,!0)}},"fill-extrusion":function(h,r,a,d){let g=a.paint.get("fill-extrusion-opacity"),v=h.context,w=v.gl,E=h.terrain,D=E&&E.renderingToTexture;if(g===0)return;let S=h.conflationActive&&h.layerUsedInConflation(a,r.getSource());if(S&&function(A,R,k,F){for(let $ of F){let U=R.getTile($).getBucket(k);U&&(U.updateReplacement($,A.replacementSource),U.uploadCentroid(A.context))}}(h,r,a,d),E||S)for(let A of d){let R=r.getTile(A).getBucket(a);R&&R0(h.context,r,A,R,a,E,S)}if(h.renderPass==="shadow"&&h.shadowRenderer){let A=h.shadowRenderer;if(E&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.Z)return;let R=A.getShadowPassDepthMode(),k=A.getShadowPassColorMode();mt(h,r,a,d,R,Lt.disabled,k,S)}else if(h.renderPass==="translucent"){let A=!a.paint.get("fill-extrusion-pattern").constantOr(1),R=a.paint.get("fill-extrusion-color").constantOr(i.ax.white);if(!D&&R.a!==0){let k=new Dt(h.context.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D);g===1&&A?mt(h,r,a,d,k,Lt.disabled,Kt.unblended,S):(mt(h,r,a,d,k,Lt.disabled,Kt.disabled,S),mt(h,r,a,d,k,h.stencilModeFor3D(),h.colorModeForRenderPass(),S),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&A&&(!E&&h.transform.projection.name!=="globe"||D)){let k=a.paint.get("fill-extrusion-opacity"),F=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),U=a.paint.get("fill-extrusion-flood-light-intensity"),G=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),B=F>0&&$>0,q=U>0,Q=(ee,H,te)=>(1-te)*ee+te*H,X=ee=>{let H=h.depthModeForSublayer(1,Dt.ReadOnly,w.LEQUAL,!0),te=a.paint.get(ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),oe=Q(.1,3,te),ae=h._showOverdrawInspector;if(!ae){let ue=new Lt({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),xe=new Kt([w.ONE,w.ONE,w.ONE,w.ONE],i.ax.transparent,[!1,!1,!1,!0],w.MIN);Os(h,r,a,d,H,ue,xe,Mt.disabled,ee,"sdf",k,F,$,U,G,oe,S,!1)}{let ue=ae?Lt.disabled:new Lt({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),xe=ae?h.colorModeForRenderPass():new Kt([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],i.ax.transparent,[!0,!0,!0,!0]);Os(h,r,a,d,H,ue,xe,Mt.disabled,ee,"color",k,F,$,U,G,oe,S,!1)}};if(D){let ee=(H,te,oe)=>{let ae=h.depthModeForSublayer(1,Dt.ReadOnly,w.LEQUAL,!1),ue=a.paint.get(H?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xe=Q(.1,3,ue);{let fe=new Kt([w.ONE,w.ONE,w.ONE,w.ONE],i.ax.transparent,[!1,!1,!1,!0]);Os(h,r,a,d,ae,Lt.disabled,fe,Mt.disabled,H,"clear",k,F,$,U,G,xe,S,te)}{let fe=new Lt({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),De=new Kt([w.ONE,w.ONE,w.ONE,w.ONE],i.ax.transparent,[!1,!1,!1,!0],w.MIN);Os(h,r,a,d,ae,fe,De,Mt.disabled,H,"sdf",k,F,$,U,G,xe,S,te)}{let fe=H?w.ZERO:w.ONE_MINUS_DST_ALPHA,De=new Lt({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ee=new Kt([fe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],i.ax.transparent,[!0,!0,!0,!0]);Os(h,r,a,d,ae,De,Ee,Mt.disabled,H,"color",k,F,$,U,G,xe,S,te)}{let fe=new Kt([w.ONE,w.ONE,w.ONE,H?w.ZERO:w.ONE],i.ax.transparent,[!1,!1,!1,!0],H?w.FUNC_ADD:w.MAX);Os(h,r,a,d,ae,Lt.disabled,fe,Mt.disabled,H,"clear",k,F,$,U,G,xe,S,te,oe)}};if(B||q){let H;if(h.prepareDrawTile(),E){let te=E.drapeBufferSize[0],oe=E.drapeBufferSize[1];H=E.framebufferCopyTexture,H&&(!H||H.size[0]===te&&H.size[1]===oe)||(H&&H.destroy(),H=E.framebufferCopyTexture=new i.T(v,new i.h({width:te,height:oe}),w.RGBA)),H.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,0,0,te,oe,0)}B&&ee(!0,!1,H),q&&ee(!1,!0,H)}}else B&&X(!0),q&&X(!1)}}},hillshade:function(h,r,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;let g=h.context,v=h.terrain&&h.terrain.renderingToTexture,[w,E]=h.renderPass!=="translucent"||v?[{},d]:h.stencilConfigForOverlap(d);for(let D of E){let S=r.getTile(D);if(S.needsHillshadePrepare&&h.renderPass==="offscreen")Xd(h,S,a);else if(h.renderPass==="translucent"){let A=h.depthModeForSublayer(0,Dt.ReadOnly),R=a.paint.get("hillshade-emissive-strength"),k=h.colorModeForDrapableLayerRenderPass(R),F=v&&h.terrain?h.terrain.stencilModeForRTTOverlap(D):w[D.overscaledZ];zu(h,D,S,a,A,F,k)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,a,d,g,v){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;let w=h.transform.projection.name==="globe",E=a.paint.get("raster-elevation")!==0,D=E&&w;if(h.renderElevatedRasterBackface&&!D)return;let S=h.context,A=S.gl,R=r.getSource(),k=function(H,te,oe,ae){let ue=te.paint.get("raster-color"),xe=H.type==="raster-array",fe=[],De=te.paint.get("raster-resampling"),Ee=te.paint.get("raster-color-mix"),Be=te.paint.get("raster-color-range"),pe=[Ee[0],Ee[1],Ee[2],0],we=Ee[3],ce=De==="nearest"?ae.NEAREST:ae.LINEAR;if(xe&&(fe.push("RASTER_ARRAY"),ue||fe.push("RASTER_COLOR"),De==="linear"&&fe.push("RASTER_ARRAY_LINEAR"),ce=ae.NEAREST,!Be&&H.rasterLayers)){let _e=H.rasterLayers.find(({id:je})=>je===te.sourceLayer);_e&&_e.fields&&_e.fields.range&&(Be=_e.fields.range)}if(Be=Be||[0,1],ue){fe.push("RASTER_COLOR"),oe.activeTexture.set(ae.TEXTURE2),te.updateColorRamp(Be);let _e=te.colorRampTexture;_e||(_e=te.colorRampTexture=new i.T(oe,te.colorRamp,ae.RGBA)),_e.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return{mix:pe,range:Be,offset:we,defines:fe,resampling:ce}}(R,a,S,A);if(R instanceof i.ap&&!d.length&&!w)return;let F=a.paint.get("raster-emissive-strength"),$=h.colorModeForDrapableLayerRenderPass(F),U=h.terrain&&h.terrain.renderingToTexture,G=!h.options.moving,B=a.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;if(R instanceof i.ap&&!d.length&&(R.onNorthPole||R.onSouthPole)){let H=E?h.stencilModeFor3D():Lt.disabled;return void ff(!!R.onNorthPole,null,h,r,a,F,k,Mt.disabled,H)}if(!d.length)return;let[q,Q]=R instanceof i.ap||U?[{},d]:h.stencilConfigForOverlap(d),X=Q[Q.length-1].overscaledZ;D&&k.defines.push("PROJECTION_GLOBE_VIEW"),E&&k.defines.push("RENDER_CUTOFF");let ee=(H,te,oe)=>{for(let ae of H){let ue=ae.toUnwrapped(),xe=r.getTile(ae);if(U&&(!xe||!xe.hasData()))continue;S.activeTexture.set(A.TEXTURE0);let fe=mf(xe,R,a,k);if(!fe||!fe.texture)continue;let{texture:De,mix:Ee,offset:Be,tileSize:pe,buffer:we}=fe,ce,_e;U?(ce=Dt.disabled,_e=ae.projMatrix):E?(ce=new Dt(A.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D),_e=w?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(ue,G)):(ce=h.depthModeForSublayer(ae.overscaledZ-X,a.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,A.LESS),_e=h.transform.calculateProjMatrix(ue,G));let je=h.terrain&&U?h.terrain.stencilModeForRTTOverlap(ae):q[ae.overscaledZ],We=v?0:a.paint.get("raster-fade-duration");xe.registerFadeDuration(We);let qe=r.findLoadedParent(ae,0),et=Qd(xe,qe,r,h.transform,We),ft,wt;h.terrain&&h.terrain.prepareDrawTile(),S.activeTexture.set(A.TEXTURE0),De.bind(B,A.CLAMP_TO_EDGE),S.activeTexture.set(A.TEXTURE1),qe?(qe.texture&&qe.texture.bind(B,A.CLAMP_TO_EDGE),ft=Math.pow(2,qe.tileID.overscaledZ-xe.tileID.overscaledZ),wt=[xe.tileID.canonical.x*ft%1,xe.tileID.canonical.y*ft%1]):De.bind(B,A.CLAMP_TO_EDGE),De.useMipmap&&S.extTextureFilterAnisotropic&&h.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);let _t=h.transform,xt,Ut=E?pf(_t):[0,0,0,0],Rt,zt,kt,dn,Hn,en=0;if(D&&R instanceof i.ap&&R.coordinates.length>3)Rt=Float32Array.from(i.aT(i.ci(new i.bs(0,0,0)))),zt=Float32Array.from(_t.globeMatrix),kt=Float32Array.from(i.ce(_t)),dn=[i.a5(_t.center.lng),i.ae(_t.center.lat)],xt=R.elevatedGlobePerspectiveTransform,Hn=R.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){let nn=i.cf(ae.canonical);en=i.cg(nn.getCenter().lat),Rt=Float32Array.from(i.aT(i.ci(ae.canonical))),zt=Float32Array.from(_t.globeMatrix),kt=Float32Array.from(i.ce(_t)),dn=[i.a5(_t.center.lng),i.ae(_t.center.lat)],xt=[0,0],Hn=Float32Array.from(i.ch(ae.canonical,nn,en,_t.worldSize/_t._pixelsPerMercatorPixel))}else xt=R instanceof i.ap?R.perspectiveTransform:[0,0],Rt=new Float32Array(16),zt=new Float32Array(9),kt=new Float32Array(16),dn=[0,0],Hn=new Float32Array(9);let cr=uf(_e,Rt,zt,kt,Hn,wt||[0,0],i.S(h.transform.zoom),dn,Ut,ft||1,et,a,xt,E?a.paint.get("raster-elevation"):0,2,Ee,Be,k.range,pe,we,F),tn=h.isTileAffectedByFog(ae),yn=h.getOrCreateProgram("raster",{defines:k.defines,overrideFog:tn});if(h.uploadCommonUniforms(S,yn,ue),R instanceof i.ap){let nn=R.elevatedGlobeVertexBuffer,_n=R.elevatedGlobeIndexBuffer;if(U||!w)R.boundsBuffer&&R.boundsSegments&&yn.draw(h,A.TRIANGLES,ce,Lt.disabled,$,Mt.disabled,cr,a.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments);else if(nn&&_n){let Zn=_t.zoom<=i.bG?R.elevatedGlobeSegments:R.getSegmentsForLongitude(_t.center.lng);Zn&&yn.draw(h,A.TRIANGLES,ce,Lt.disabled,$,te,cr,a.id,nn,_n,Zn)}}else if(D){ce=new Dt(A.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D);let nn=h.globeSharedBuffers;if(nn){let[_n,Zn,En]=nn.getGridBuffers(en,!1);yn.draw(h,A.TRIANGLES,ce,oe||je,h.colorModeForRenderPass(),te,cr,a.id,_n,Zn,En)}}else{let{tileBoundsBuffer:nn,tileBoundsIndexBuffer:_n,tileBoundsSegments:Zn}=h.getTileBoundsBuffers(xe);yn.draw(h,A.TRIANGLES,ce,je,$,Mt.disabled,cr,a.id,nn,_n,Zn)}}if(!(R instanceof i.ap)&&D)for(let ae of H){let ue=ae.canonical.y===(1<<ae.canonical.z)-1;ae.canonical.y===0&&ff(!0,ae,h,r,a,F,k,te,oe||Lt.disabled),ue&&ff(!1,ae,h,r,a,F,k,te===Mt.frontCW?Mt.backCW:Mt.frontCW,oe||Lt.disabled)}};D?ee(Q,h.renderElevatedRasterBackface?Mt.backCW:Mt.frontCW,h.stencilModeFor3D()):ee(Q,Mt.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,r,a,d,g,v){h.renderPass==="offscreen"&&function(w,E,D,S){if(!S.length)return;let A=w.context,R=A.gl,k=E.getSource();if(!(k instanceof Ye))return;let F=[];for(let G of S){let B=E.getTile(G);if(!(B instanceof da))continue;let q=gf(B,k,D);if(!q)continue;let Q=[q.tileSize,q.tileSize],X=D.tileFramebuffer;X||(X=D.tileFramebuffer=A.createFramebuffer(Q[0],Q[1],!0,null));let ee=B.rasterParticleState,H=D.paint.get("raster-particle-count");ee||(ee=B.rasterParticleState=new Pr(A,G,Q,H));let te=ee.update(D.lastInvalidatedAt);ee.numParticles!==H&&ee.setNumParticles(G,H);let oe=ee.targetColorTexture;ee.targetColorTexture=ee.backgroundColorTexture,ee.backgroundColorTexture=oe;let ae=ee.particleVertices0;ee.particleVertices0=ee.particleVertices1,ee.particleVertices1=ae,F.push([G,q,ee,te])}if(F.length===0)return;let $=i.f.now(),U=D.previousDrawTimestamp?.001*($-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=$,D.hasColorMap()){A.activeTexture.set(R.TEXTURE0+2);let G=D.colorRampTexture;G||(G=D.colorRampTexture=new i.T(A,D.colorRamp,R.RGBA)),G.bind(R.LINEAR,R.CLAMP_TO_EDGE)}A.bindFramebuffer.set(D.tileFramebuffer.framebuffer),A.activeTexture.set(R.TEXTURE0),function(G,B,q){let Q=G.context,X=Q.gl,ee=B.tileFramebuffer;Q.activeTexture.set(X.TEXTURE0);let H={u_texture:0,u_opacity:1.05*(oe=B.paint.get("raster-particle-fade-opacity-factor"))/(oe+.05)},te=G.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var oe;for(let ae of q){let[,,ue,xe]=ae;ee.colorAttachment.set(ue.targetColorTexture.texture),Q.viewport.set([0,0,ee.width,ee.height]),Q.clear({color:i.ax.transparent}),xe&&(ue.backgroundColorTexture.bind(X.NEAREST,X.CLAMP_TO_EDGE),te.draw(G,X.TRIANGLES,Dt.disabled,Lt.disabled,Kt.alphaBlended,Mt.disabled,H,B.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments))}}(w,D,F),function(G,B,q,Q){let X=G.context.gl,ee=q.tileFramebuffer,H=G.transform.projection.name==="globe",te=q.paint.get("raster-particle-max-speed");for(let oe of Q){let[ae,ue,xe]=oe;ue.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ee.colorAttachment.set(xe.targetColorTexture.texture);let fe=G.getOrCreateProgram("rasterParticleDraw",{defines:ue.defines,overrideFog:!1}),De=ue.scalarData?[]:[0,1,2,3].map(pe=>i.cG[pe](ae));De.push(ae);let Ee=ae.canonical.x,Be=ae.canonical.y;for(let pe of De){let we=B.getTile(H?pe.wrapped():pe);if(!we)continue;let ce=we.rasterParticleState;if(!ce)continue;let _e=A0([pe.canonical.x+(1<<pe.canonical.z)*(pe.wrap-ae.wrap)-Ee,pe.canonical.y-Be],0,ue.texture.size,2,te,ue.textureOffset,ue.scale,ue.offset);fe.draw(G,X.POINTS,Dt.disabled,Lt.disabled,Kt.alphaBlended,Mt.disabled,_e,q.id,ce.particleVertices0,void 0,ce.particleSegment)}}}(w,E,D,F),function(G,B,q,Q){let X=G.context.gl,ee=B.transformFeedbackObject;ee||(ee=B.transformFeedbackObject=X.createTransformFeedback()),X.bindTransformFeedback(X.TRANSFORM_FEEDBACK,B.transformFeedbackObject);let H=B.paint.get("raster-particle-max-speed"),te=Q*B.paint.get("raster-particle-speed-factor")*.3,oe=(ae=B.paint.get("raster-particle-reset-rate-factor"),Math.pow(ae,6));var ae;for(let ue of q){let[,xe,fe]=ue;xe.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let De=Vm(0,xe.texture.size,H,te,oe,xe.textureOffset,xe.scale,xe.offset);G.getOrCreateProgram("rasterParticleUpdate",{defines:xe.defines,transformFeedback:{bufferMode:X.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(G,X.POINTS,Dt.disabled,Lt.disabled,Kt.disabled,Mt.disabled,De,B.id,fe.particleVertices0,void 0,fe.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:fe.particleVertices1,targetIndex:0}])}X.bindTransformFeedback(X.TRANSFORM_FEEDBACK,null)}(w,D,F,U)}(h,r,a,d),h.renderPass==="translucent"&&(function(w,E,D,S,A){let R=w.context,k=R.gl,F=!w.options.moving,$=w.transform.projection.name==="globe";if(!S.length)return;let[U,G]=w.stencilConfigForOverlap(S),B=[];$&&B.push("PROJECTION_GLOBE_VIEW");for(let q of G){let Q=q.toUnwrapped(),X=E.getTile(q);if(!X.rasterParticleState)continue;let ee=X.rasterParticleState,H=100;X.registerFadeDuration(H);let te=E.findLoadedParent(q,0),oe=Qd(X,te,E,w.transform,H),ae,ue;w.terrain&&w.terrain.prepareDrawTile(),R.activeTexture.set(k.TEXTURE0),ee.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),R.activeTexture.set(k.TEXTURE1),te&&te.rasterParticleState?(te.rasterParticleState.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ae=Math.pow(2,te.tileID.overscaledZ-X.tileID.overscaledZ),ue=[X.tileID.canonical.x*ae%1,X.tileID.canonical.y*ae%1]):ee.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);let xe=$?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(Q,F),fe=w.transform,De=_f(fe),Ee=i.cf(q.canonical),Be=i.cg(Ee.getCenter().lat),pe,we,ce,_e,je;$?(pe=Float32Array.from(i.aT(i.ci(q.canonical))),we=Float32Array.from(fe.globeMatrix),ce=Float32Array.from(i.ce(fe)),_e=[i.a5(fe.center.lng),i.ae(fe.center.lat)],je=Float32Array.from(i.ch(q.canonical,Ee,Be,fe.worldSize/fe._pixelsPerMercatorPixel))):(pe=new Float32Array(16),we=new Float32Array(9),ce=new Float32Array(16),_e=[0,0],je=new Float32Array(9));let We=S0(xe,pe,we,ce,je,ue||[0,0],i.S(w.transform.zoom),_e,De,ae||1,oe,250),qe=w.isTileAffectedByFog(q),et=w.getOrCreateProgram("rasterParticle",{defines:B,overrideFog:qe});if(w.uploadCommonUniforms(R,et,Q),$){let ft=new Dt(k.LEQUAL,Dt.ReadWrite,w.depthRangeFor3D),wt=0,_t=w.globeSharedBuffers;if(_t){let[xt,Ut,Rt]=_t.getGridBuffers(Be,wt!==0);et.draw(w,k.TRIANGLES,ft,Lt.disabled,Kt.alphaBlended,Mt.backCCW,We,D.id,xt,Ut,Rt)}}else{let ft=w.depthModeForSublayer(0,Dt.ReadOnly),wt=U[q.overscaledZ],{tileBoundsBuffer:_t,tileBoundsIndexBuffer:xt,tileBoundsSegments:Ut}=w.getTileBoundsBuffers(X);et.draw(w,k.TRIANGLES,ft,wt,Kt.alphaBlended,Mt.disabled,We,D.id,_t,xt,Ut)}}w.resetStencilClippingMasks()}(h,r,a,d),h.style.map.triggerRepaint())},background:function(h,r,a,d){let g=a.paint.get("background-color"),v=a.paint.get("background-opacity"),w=a.paint.get("background-emissive-strength");if(v===0)return;let E=h.context,D=E.gl,S=h.transform,A=S.tileSize,R=a.paint.get("background-pattern");if(h.isPatternMissing(R,a.scope))return;let k=!R&&g.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==k)return;let F=Lt.disabled,$=h.depthModeForSublayer(0,k==="opaque"?Dt.ReadWrite:Dt.ReadOnly),U=h.colorModeForDrapableLayerRenderPass(w),G=R?"backgroundPattern":"background",B,q=d;q||(B=h.getBackgroundTiles(),q=Object.values(B).map(Q=>Q.tileID)),R&&(E.activeTexture.set(D.TEXTURE0),h.imageManager.bind(h.context,a.scope));for(let Q of q){let X=h.isTileAffectedByFog(Q),ee=h.getOrCreateProgram(G,{overrideFog:X}),H=Q.toUnwrapped(),te=d?Q.projMatrix:h.transform.calculateProjMatrix(H);h.prepareDrawTile();let oe=r?r.getTile(Q):B?B[Q.key]:new Es(Q,A,S.zoom,h),ae=R?yc(te,w,v,h,R,a.scope,{tileID:Q,tileSize:A}):hf(te,w,v,g);h.uploadCommonUniforms(E,ee,H);let{tileBoundsBuffer:ue,tileBoundsIndexBuffer:xe,tileBoundsSegments:fe}=h.getTileBoundsBuffers(oe);ee.draw(h,D.TRIANGLES,$,F,U,Mt.disabled,ae,a.id,ue,xe,fe)}},sky:function(h,r,a){let d=h._atmosphere?i.S(h.transform.zoom):1,g=a.paint.get("sky-opacity")*d;if(g===0)return;let v=h.context,w=a.paint.get("sky-type"),E=new Dt(v.gl.LEQUAL,Dt.ReadOnly,[0,1]),D=h.frameCounter/1e3%1;w==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(S,A,R,k){let F=S.context,$=F.gl,U=A.skyboxFbo;if(!U){U=A.skyboxFbo=F.createFramebuffer(32,32,!0,null),A.skyboxGeometry=new wf(F),A.skyboxTexture=F.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,A.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let Q=0;Q<6;++Q)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}F.bindFramebuffer.set(U.framebuffer),F.viewport.set([0,0,32,32]);let G=A.getCenter(S,!0),B=S.getOrCreateProgram("skyboxCapture"),q=new Float64Array(16);i.a6.identity(q),i.a6.rotateY(q,q,.5*-Math.PI),ba(S,A,B,q,G,0),i.a6.identity(q),i.a6.rotateY(q,q,.5*Math.PI),ba(S,A,B,q,G,1),i.a6.identity(q),i.a6.rotateX(q,q,.5*-Math.PI),ba(S,A,B,q,G,2),i.a6.identity(q),i.a6.rotateX(q,q,.5*Math.PI),ba(S,A,B,q,G,3),i.a6.identity(q),ba(S,A,B,q,G,4),i.a6.identity(q),i.a6.rotateY(q,q,Math.PI),ba(S,A,B,q,G,5),F.viewport.set([0,0,S.width,S.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(S,A,R,k,F){let $=S.context,U=$.gl,G=S.transform,B=S.getOrCreateProgram("skybox");$.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,A.skyboxTexture);let q=((Q,X,ee,H,te)=>({u_matrix:Q,u_sun_direction:X,u_cubemap:0,u_opacity:H,u_temporal_offset:te}))(G.skyboxMatrix,A.getCenter(S,!1),0,k,F);S.uploadCommonUniforms($,B),B.draw(S,U.TRIANGLES,R,Lt.disabled,S.colorModeForRenderPass(),Mt.backCW,q,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(h,a,E,g,D):w==="gradient"&&h.renderPass==="sky"&&function(S,A,R,k,F){let $=S.context,U=$.gl,G=S.transform,B=S.getOrCreateProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new wf($)),$.activeTexture.set(U.TEXTURE0);let q=A.colorRampTexture;q||(q=A.colorRampTexture=new i.T($,A.colorRamp,U.RGBA)),q.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Q=((X,ee,H,te,oe)=>({u_matrix:X,u_color_ramp:0,u_center_direction:ee,u_radius:i.bj(H),u_opacity:te,u_temporal_offset:oe}))(G.skyboxMatrix,A.getCenter(S,!1),A.paint.get("sky-gradient-radius"),k,F);S.uploadCommonUniforms($,B),B.draw(S,U.TRIANGLES,R,Lt.disabled,S.colorModeForRenderPass(),Mt.backCW,Q,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(h,a,E,g,D)},debug:function(h,r,a,d,g,v){for(let w=0;w<a.length;w++)if(g){let S=new i.ax(d.r*.8,d.g*.8,d.b*.8,1);ks(h,r,a[w],d,-1,-1,v),ks(h,r,a[w],d,-1,1,v),ks(h,r,a[w],d,1,1,v),ks(h,r,a[w],d,1,-1,v),ks(h,r,a[w],S,0,0,v)}else ks(h,r,a[w],d,0,0,v)},custom:function(h,r,a,d){let g=h.context,v=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isLayerDraped(r)){if(h.renderPass==="offscreen"){let w=v.prerender;if(w){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){let E=h.transform.pointMerc;w.call(v,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),i.S(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else w.call(v,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){let E=v.renderToTile;if(E){let D=d[0].canonical,S=new i.L(D.x+d[0].wrap*(1<<D.z),D.y,D.z);g.setDepthMode(Dt.disabled),g.setStencilMode(Lt.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),E.call(v,g.gl,S),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Lt.disabled);let w=v.renderingMode==="3d"?new Dt(h.context.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Dt.ReadOnly);if(g.setDepthMode(w),h.transform.projection.name==="globe"){let E=h.transform.pointMerc;v.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),i.S(h.transform.zoom),[E.x,E.y],h.transform.pixelsPerMeterRatio)}else v.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,r,a,d){if(h.renderPass==="opaque")return;let g=a.paint.get("model-opacity");if(g===0)return;let v=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!v||h.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof i.Z))return;let w=h.shadowRenderer,E=a.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,E||(w.enabled=!1));let D=()=>{w&&(w.useNormalOffset=!0,E||(w.enabled=!0))},S=r.getSource();if(h.renderPass==="light-beam"&&S.type!=="batched-model")return;if(S.type==="vector"||S.type==="geojson")return function(B,q,Q,X){let ee=B.transform;if(ee.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${ee.projection.name} projection is not yet implemented`);let H=ee.getFreeCameraOptions().position;if(!B.modelManager)return;let te=B.modelManager;Q.modelManager=te;let oe=B.shadowRenderer;if(!Q._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ae=Q._unevaluatedLayout._values["model-id"],ue=Pt({},Q.layout.get("model-id").parameters);for(let xe of X){let fe=q.getTile(xe).getBucket(Q);if(!fe||fe.projection.name!==ee.projection.name)continue;let De=Zm(xe,ee);ue.zoom=De;let Ee=ae.possiblyEvaluate(ue);if(Tf(B,fe,xe),$i.shadowUniformsInitialized=!1,$i.useSingleShadowCascade=!!oe&&oe.getMaxCascadeForTile(xe.toUnwrapped())===0,B.renderPass==="shadow"&&oe){if(B.currentShadowCascade===1&&fe.isInsideFirstShadowMapFrustum)continue;let we=ee.calculatePosMatrix(xe.toUnwrapped(),ee.worldSize);if($i.tileMatrix.set(we),$i.shadowTileMatrix=Float32Array.from(oe.calculateShadowPassMatrixFromMatrix(we)),$i.aabb.min.fill(0),$i.aabb.max[0]=$i.aabb.max[1]=i.V,$i.aabb.max[2]=0,N0(fe,$i,B,Q.scope))continue}let Be=1<<xe.canonical.z,pe=[((H.x-xe.wrap)*Be-xe.canonical.x)*i.V,(H.y*Be-xe.canonical.y)*i.V,H.z*Be*i.V];for(let we in fe.instancesPerModel){let ce=fe.instancesPerModel[we];ce.features.length>0&&(we=Ee.evaluate(ce.features[0].feature,{}));let _e=te.getModel(we,Q.scope);if(_e&&_e.uploaded)for(let je of _e.nodes)Ef(B,Q,je,ce,pe,xe,$i)}}}(h,r,a,d),void D();if(!S.loaded())return;if(S.type==="batched-model")return function(B,q,Q,X){Q.resetLayerRenderingStats(B);let ee=B.context,H=B.transform,te=B.style.fog,oe=B.shadowRenderer;if(H.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${H.projection.name} projection is not yet implemented`);let ae=B.transform.getFreeCameraOptions().position,ue=i.N.scale([],[ae.x,ae.y,ae.z],B.transform.worldSize);i.N.negate(ue,ue);let xe=i.a6.identity([]),fe=i.cR(H.center.lat,H.zoom),De=i.a6.fromScaling([],[1,1,1/fe]);i.a6.translate(xe,xe,ue);let Ee=Q.paint.get("model-opacity"),Be=new Dt(ee.gl.LEQUAL,Dt.ReadWrite,B.depthRangeFor3D),pe=new Dt(ee.gl.LEQUAL,Dt.ReadOnly,B.depthRangeFor3D),we=new i.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ce=B.renderPass==="shadow",_e=ce&&oe?oe.getCurrentCascadeFrustum():H.getFrustum(H.scaleZoom(H.worldSize)),je=Q.getLayerRenderingStats(),We=function(qe,et){for(let ft of X){let wt=q.getTile(ft).getBucket(Q);if(!wt||!wt.uploaded)continue;let _t=!1;oe&&(_t=oe.getMaxCascadeForTile(ft.toUnwrapped())===0);let xt=H.calculatePosMatrix(ft.toUnwrapped(),H.worldSize),Ut=wt.modelTraits;for(let Rt of wt.getNodesInfo()){if(Rt.hiddenByReplacement||!Rt.node.meshes)continue;let zt=Rt.evaluatedScale,kt=Rt.node,dn=0;if(B.terrain&&kt.elevation&&(dn=kt.elevation*B.terrain.exaggeration()),zt[0]<=1&&zt[1]<=1&&zt[2]<=1&&(()=>{let Zn=Rt.getLocalBounds();return we.min=[...Zn.min],we.max=[...Zn.max],we.min[2]+=dn,we.max[2]+=dn,i.N.transformMat4(we.min,we.min,xt),i.N.transformMat4(we.max,we.max,xt),we})().intersects(_e)===0)continue;let Hn=B.renderPass==="light-beam",en=[...xt];i.a6.translate(en,en,[(kt.anchor?kt.anchor[0]:0)*(zt[0]-1),(kt.anchor?kt.anchor[1]:0)*(zt[1]-1),dn]),i.N.exactEquals(zt,i.cT)||i.a6.scale(en,en,zt),i.a6.multiply(en,en,kt.matrix);let cr=i.a6.multiply([],De,en);i.a6.multiply(cr,xe,cr);let tn=i.a6.invert([],cr);i.a6.transpose(tn,tn),i.a6.scale(tn,tn,yl);let yn=i.a6.multiply([],H.expandedFarZProjMatrix,en),nn=Ut&i.cV.HasMapboxMeshFeatures,_n=nn?0:Rt.evaluatedRMEA[0][2];for(let Zn=0;Zn<kt.meshes.length;++Zn){let En=kt.meshes[Zn],Ur=Zn===kt.lightMeshIndex;if(Ur){if(!Hn&&!B.terrain&&B.shadowRenderer){B.currentLayer<B.firstLightBeamLayer&&(B.firstLightBeamLayer=B.currentLayer);continue}}else if(Hn)continue;let ti={defines:[]},Ri=[];if(lr(ti.defines,Ri,En,B),nn||ti.defines.push("DIFFUSE_SHADED"),_t&&ti.defines.push("SHADOWS_SINGLE_CASCADE"),je&&(ce?je.numRenderedVerticesInShadowPass+=En.vertexArray.length:je.numRenderedVerticesInTransparentPass+=En.vertexArray.length),ce){ye(En,en,B,Q);continue}let ko=null;if(te){let Oi=wa(en,B.transform);if(ko=new Float32Array(Oi),H.projection.name!=="globe"){let Fo=En.aabb.min,Vs=En.aabb.max,[Ea,jc]=te.getOpacityForBounds(Oi,Fo[0],Fo[1],Vs[0],Vs[1]);ti.overrideFog=Ea>=Sn||jc>=Sn}}let Li=En.material,$r;Li.occlusionTexture&&Li.occlusionTexture.offsetScale&&($r=Li.occlusionTexture.offsetScale,ti.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ce&&oe&&(oe.useNormalOffset=!!En.normalBuffer);let Lr=B.getOrCreateProgram("model",ti);!ce&&oe&&oe.setupShadowsFromMatrix(en,Lr,oe.useNormalOffset),B.uploadCommonUniforms(ee,Lr,ft.toUnwrapped(),ko);let di=Li.pbrMetallicRoughness;di.metallicFactor=.9,di.roughnessFactor=.5;let bi=Gu(new Float32Array(yn),new Float32Array(cr),new Float32Array(tn),B,Ee,di.baseColorFactor,Li.emissiveFactor,di.metallicFactor,di.roughnessFactor,Li,_n,Q,[0,0,0],$r);Lr.draw(B,ee.gl.TRIANGLES,et&&!Ur?Be:pe,Lt.disabled,qe?Ur||Ee<1||Rt.hasTranslucentParts?Kt.alphaBlended:Kt.unblended:Kt.disabled,Mt.backCCW,bi,Q.id,En.vertexBuffer,En.indexBuffer,En.segments,Q.paint,B.transform.zoom,void 0,Ri)}}}};(function(qe,et,ft,wt){let _t=qe.terrain?qe.terrain.exaggeration():0,xt=qe.transform.zoom;for(let Ut of wt){let Rt=et.getTile(Ut).getBucket(ft);Rt&&(qe.conflationActive&&Rt.updateReplacement(Ut,qe.replacementSource),Rt.evaluateScale(qe,ft),qe.terrain&&_t>0&&Rt.elevationUpdate(qe.terrain,_t,Ut,ft.source),Rt.needsReEvaluation(qe,xt,ft)&&Rt.evaluate(ft))}})(B,q,Q,X),Ee===1?We(!0,!0):(We(!1,!0),We(!0,!1))}(h,r,a,d),void D();let A=S.getModels(),R=[],k=h.transform.getFreeCameraOptions().position,F=i.N.scale([],[k.x,k.y,k.z],h.transform.worldSize);i.N.negate(F,F);let $=[],U=[],G=0;for(let B of A){let q=a.paint.get("model-rotation").constantOr(null),Q=a.paint.get("model-scale").constantOr(null),X=a.paint.get("model-translation").constantOr(null);B.computeModelMatrix(h,q,Q,X,!0,!0,!1);let ee=i.a6.identity([]),H=i.cR(B.position.lat,h.transform.zoom),te=i.a6.fromScaling([],[1,1,1/H]);i.a6.translate(ee,ee,F),R.push({zScaleMatrix:te,negCameraPosMatrix:ee});for(let oe of B.nodes)Ec(h.transform,oe,B.matrix,h.transform.expandedFarZProjMatrix,G,$,U);G++}if($.sort((B,q)=>q.depth-B.depth),h.renderPass!=="shadow"){if(g===1)for(let B of U)Tc(B,h,a,R[B.modelIndex],Lt.disabled,h.colorModeForRenderPass());else{for(let B of U)Tc(B,h,a,R[B.modelIndex],Lt.disabled,Kt.disabled);for(let B of U)Tc(B,h,a,R[B.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(let B of $)Tc(B,h,a,R[B.modelIndex],Lt.disabled,h.colorModeForRenderPass());D()}else{for(let B of U)ye(B.mesh,B.nodeModelMatrix,h,a);for(let B of $)ye(B.mesh,B.nodeModelMatrix,h,a);D()}}},If={model:function(h,r,a){let d=h.scope,g=r.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,d));if(g.type==="batched-model")return;let v=g.getModels();for(let w of v)w.upload(a.context)},raster:function(h,r,a){let d=r.getSource();if(!(d instanceof Ye&&d.loaded()))return;let g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;let v=h.paint.get("raster-array-band")||d.getInitialBand(g);if(v==null)return;let w=r.getIds().map(E=>r.getTileByID(E));for(let E of w)E.updateNeeded(g,v)&&d.prepareTile(E,g,v)},"raster-particle":function(h,r,a){let d=r.getSource();if(!(d instanceof Ye&&d.loaded()))return;let g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;let v=h.paint.get("raster-particle-array-band")||d.getInitialBand(g);if(v==null)return;let w=r.getIds().map(E=>r.getTileByID(E));for(let E of w)E.updateNeeded(g,v)&&d.prepareTile(E,g,v)}};class Ym{constructor(r,a,d,g){this.context=new vm(r,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._debugParams={showTerrainProxyTiles:!1},g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=mo.maxUnderzooming+mo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Vd(this),this._wireframeDebugCache=new Xm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(r,a){let d=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new C0(this,r));let g=this._terrain;this.transform.elevation=d?g:null,g.update(r,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(r){let a=r.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[d,g]=a.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);let v=d+.78*(g-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,a){if(this.width=r*i.f.devicePixelRatio,this.height=a*i.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style.order)this.style._mergedLayers[d].resize()}setup(){let r=this.context,a=new i.aN;a.emplaceBack(0,0),a.emplaceBack(i.V,0),a.emplaceBack(0,i.V),a.emplaceBack(i.V,i.V),this.tileExtentBuffer=r.createVertexBuffer(a,i.aP.members),this.tileExtentSegments=i.aB.simpleSegment(0,0,4,2);let d=new i.aN;d.emplaceBack(0,0),d.emplaceBack(i.V,0),d.emplaceBack(0,i.V),d.emplaceBack(i.V,i.V),this.debugBuffer=r.createVertexBuffer(d,i.aP.members),this.debugSegments=i.aB.simpleSegment(0,0,4,5);let g=new i.aN;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(g,i.aP.members),this.viewportSegments=i.aB.simpleSegment(0,0,4,2);let v=new i.av;v.emplaceBack(0,0,0,0),v.emplaceBack(i.V,0,i.V,0),v.emplaceBack(0,i.V,0,i.V),v.emplaceBack(i.V,i.V,i.V,i.V),this.mercatorBoundsBuffer=r.createVertexBuffer(v,i.aR.members),this.mercatorBoundsSegments=i.aB.simpleSegment(0,0,4,2);let w=new i.aw;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);let E=new i.aO;for(let S of[0,1,3,2,0])E.emplaceBack(S);this.debugIndexBuffer=r.createIndexBuffer(E),this.emptyTexture=new i.T(r,new i.h({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=i.a6.create();let D=this.context.gl;this.stencilClearMode=new Lt({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Dt.disabled,this.stencilClearMode,Kt.disabled,Mt.disabled,Jd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,a,d){if(!a||this.currentStencilSource===a.id||!r.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let D of d)if(this._tileClippingMaskIDs[D.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;let g=this.context,v=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(Kt.disabled),g.setDepthMode(Dt.disabled);let w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of d){let D=a.getTile(E),S=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:A,tileBoundsIndexBuffer:R,tileBoundsSegments:k}=this.getTileBoundsBuffers(D);w.draw(this,v.TRIANGLES,Dt.disabled,new Lt({func:v.ALWAYS,mask:0},S,255,v.KEEP,v.KEEP,v.REPLACE),Kt.disabled,Mt.disabled,Jd(E.projMatrix),"$clipping",A,R,k)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,a=this.context.gl;return new Lt({func:a.NOTEQUAL,mask:255},r,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let a=this.context.gl;return new Lt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(r){let a=this.context.gl,d=r.sort((w,E)=>E.overscaledZ-w.overscaledZ),g=d[d.length-1].overscaledZ,v=d[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let w={};for(let E=0;E<v;E++)w[E+g]=new Lt({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[w,d]}return[{[g]:Lt.disabled},d]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new Kt([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new i.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Kt.unblended:Kt.alphaBlended}colorModeForDrapableLayerRenderPass(r){let a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Kt([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new i.ax(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,a,d,g=!1){if(!this.opaquePassEnabledForLayer()&&!g)return Dt.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Dt(d||this.context.gl.LEQUAL,a,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,a){this._wireframeDebugCache.update(this.frameCounter),this.style=r,this.options=a;let d=this.style._mergedLayers,g=this.style.order,v=g.map(H=>d[H]),w=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.f.now()),this.imageManager.beginFrame();let E=0,D=!1;for(let H in w){let te=w[H];te.used&&(te.prepare(this.context),te.getSource().usedInConflation&&++E)}for(let H of v)H.isHidden(this.transform.zoom)||this.prepareLayer(H);let S={},A={},R={},k={},F={};for(let H in w){let te=w[H];S[H]=te.getVisibleCoordinates(),A[H]=S[H].slice().reverse(),R[H]=te.getVisibleCoordinates(!0).reverse(),k[H]=te.getShadowCasterCoordinates(),F[H]=te.sortCoordinatesByDistance(S[H])}let $=H=>{let te=this.style.getLayerSourceCache(H);return te&&te.used?te.getSource():null};if(E){let H=[];for(let te of v)this.layerUsedInConflation(te,$(te))&&H.push(te);if(H&&H.length>1){let te=[];for(let oe of H){let ae=this.style.getLayerSourceCache(oe);ae&&ae.used&&ae.getSource().usedInConflation&&te.push({layer:oe.fqid,cache:ae})}this.replacementSource.setSources(te),D=!0}}D||this.replacementSource.clear(),this.conflationActive=D,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let H of v){let te=H.cutoffRange();if(this.longestCutoffRange=Math.max(te,this.longestCutoffRange),te>0){let oe=$(H);oe&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom)),H.minzoom&&(this.minCutoffZoom=Math.max(H.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let H=0;H<v.length;H++)if(v[H].is3D()){this.opaquePassCutoff=H;break}let U=this.style&&this.style.fog;U?(this._fogVisible=U.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=U.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(R),this.opaquePassCutoff=0);let G=this._shadowRenderer;if(G){G.updateShadowParameters(this.transform,this.style.directionalLight);for(let H in w)for(let te of S[H]){let oe={min:0,max:0};this.terrain&&(oe=this.terrain.getMinMaxForTile(te)||oe),G.addShadowReceiver(te.toUnwrapped(),oe.min,oe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Et(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!i.cZ(this.context.gl))return;this.renderPass="offscreen";for(let H of v){let te=r.getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;let oe=te?A[te.id]:void 0;(H.type==="custom"||H.type==="raster"||H.type==="raster-particle"||H.isSky()||oe&&oe.length)&&this.renderLayer(this,te,H,oe)}this.depthRangeFor3D=[0,1-(v.length+2)*this.numSublayers*this.depthEpsilon];let B=this.terrain;B&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&B.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,k)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let q=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Q=(()=>{if(a.showOverdrawInspector)return i.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!q){let H=this.style.fog.properties.get("color").toArray01();return new i.ax(...H)}if(this.style.fog&&this.transform.projection.supportsFog&&q){let H=this.style.fog.properties.get("space-color").toArray01();return new i.ax(...H)}return i.ax.transparent})();if(this.context.clear({color:Q,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&q&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){let H=v[this.currentLayer],te=r.getLayerSourceCache(H);if(H.isSky())continue;let oe=te?(H.is3D()?F:A)[te.id]:void 0;this._renderTileClippingMasks(H,te,oe),this.renderLayer(this,te,H,oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&q&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){let H=v[this.currentLayer],te=r.getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,te,H,te?A[te.id]:void 0)}function X(H,te){let oe;return te&&(oe=(H.type==="symbol"?R:H.is3D()?F:A)[te.id]),oe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<g.length;){let H=v[this.currentLayer];if(H.type==="raster"){let te=r.getLayerSourceCache(H);this.renderLayer(this,te,H,X(H,te))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ee=0;for(G&&(ee=G.getShadowCastingLayerCount());this.currentLayer<g.length;){let H=v[this.currentLayer],te=r.getLayerSourceCache(H);if(H.isSky())++this.currentLayer;else if(B&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=B.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(H,te,te?S[te.id]:void 0),this.renderLayer(this,te,H,X(H,te)),!B&&G&&ee>0&&H.hasShadowPass()&&--ee==0&&(G.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let oe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=oe;this.currentLayer++){let ae=v[this.currentLayer];if(!ae.hasLightBeamPass())continue;let ue=r.getLayerSourceCache(ae);this.renderLayer(this,ue,ae,ue?A[ue.id]:void 0)}this.currentLayer=oe,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;v.forEach(te=>{let oe=r.getLayerSourceCache(te);oe&&!te.isHidden(this.transform.zoom)&&oe.getVisibleCoordinates().length&&(!H||H.getSource().maxzoom<oe.getSource().maxzoom)&&(H=oe)}),H&&this.options.showTileBoundaries&&Dc.debug(this,H,H.getVisibleCoordinates(),i.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Dc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(H){let te=H.transform.padding;xf(H,H.transform.height-(te.top||0),3,Ai),xf(H,te.bottom||0,3,Ns),Ui(H,te.left||0,3,Wm),Ui(H,H.transform.width-(te.right||0),3,yf);let oe=H.transform.centerPoint;(function(ae,ue,xe,fe){ar(ae,ue-1,xe-10,2,20,fe),ar(ae,ue-10,xe-1,20,2,fe)})(H,oe.x,H.transform.height-oe.y,vf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),D||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);let{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(r.type);if(If[r.type]&&(d||this.terrain&&r.type==="custom")){let g=this.style.getLayerSourceCache(r);If[r.type](r,g,this)}this.gpuTimingEnd()}renderLayer(r,a,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(d.type)||r.terrain&&d.type==="custom")&&Dc[d.type](r,a,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery,d=this.context.gl,g=this.gpuTimers[r.id];g||(g=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:d.createQuery()}),g.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let r=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(r.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){let r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){let a={};for(let d in r){let g=r[d],v=this.context.extTimerQuery,w=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),a[d]=w}return a}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;let a=this.context.extTimerQuery,d=this.context.gl,g=0;for(let v of r)g+=a.getQueryParameter(v,d.QUERY_RESULT)/1e6,a.deleteQueryEXT(v);return g}translatePosMatrix(r,a,d,g,v){if(!d[0]&&!d[1])return r;let w=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){let S=Math.sin(w),A=Math.cos(w);d=[d[0]*A-d[1]*S,d[0]*S+d[1]*A]}let E=[v?d[0]:i.a3(a,d[0],this.transform.zoom),v?d[1]:i.a3(a,d[1],this.transform.zoom),0],D=new Float32Array(16);return i.a6.translate(D,r,E),D}saveTileTexture(r){let a=r.size[0],d=this._tileTextures[a];d?d.push(r):this._tileTextures[a]=[r]}getTileTexture(r){let a=this._tileTextures[r];return a&&a.length>0?a.pop():null}isPatternMissing(r,a){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString(),a)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,a,d){let g=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,v=this.terrain&&this.terrain.exaggeration()===0,w=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT"),v&&w.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||w.push("FOG","FOG_DITHERING"),g&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(r,a){this.cache=this.cache||{};let d=a&&a.defines||[],g=a&&a.config,v=a&&a.transformFeedback,w=this.currentGlobalDefines(r,a&&a.overrideFog,a&&a.overrideRtt).concat(d),E=nf.cacheKey(Wd[r],r,w,g);return this.cache[E]||(this.cache[E]=new nf(this.context,r,Wd[r],g,P0[r],w,v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,a){if(this.style.enable3dLights()){let d=this.style.directionalLight,g=this.style.ambientLight;if(d&&g){let v=((w,E)=>{let D=w.properties.get("direction"),S=w.properties.get("color").toArray01(),A=w.properties.get("intensity"),R=E.properties.get("color").toArray01(),k=E.properties.get("intensity"),F=[D.x,D.y,D.z],$=i.cn(R,k),U=i.cn(S,A);return{u_lighting_ambient_color:$,u_lighting_directional_dir:F,u_lighting_directional_color:U,u_ground_radiance:ef(F,U,$)}})(d,g);a.setLightsUniformValues(r,v)}}}uploadCommonUniforms(r,a,d,g,v){if(this.uploadCommonLightUniforms(r,a),this.terrain&&this.terrain.renderingToTexture)return;let w=this.style.fog;if(w){let E=w.getOpacity(this.transform.pitch),D=((S,A,R,k,F,$,U,G,B,q,Q,X)=>{let ee=S.transform,H=A.properties.get("color").toArray01();H[3]=k;let te=S.frameCounter/1e3%1,[oe,ae]=A.properties.get("vertical-range");return{u_fog_matrix:R?ee.calculateFogTileMatrix(R):X||S.identityMat,u_fog_range:A.getFovAdjustedRange(ee._fov),u_fog_color:H,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(oe,ae),ae],u_fog_temporal_offset:te,u_frustum_tl:F,u_frustum_tr:$,u_frustum_br:U,u_frustum_bl:G,u_globe_pos:B,u_globe_radius:q,u_viewport:Q,u_globe_transition:i.S(ee.zoom),u_is_globe:+(ee.projection.name==="globe")}})(this,w,d,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.f.devicePixelRatio,this.transform.height*i.f.devicePixelRatio],g);a.setFogUniformValues(r,D)}v&&a.setCutoffUniformValues(r,v.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){let r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){let r=this.context.gl,a=r.createTexture();return r.bindTexture(r.TEXTURE_2D,a),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let r=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(let g of d)a[g.key]=r[g.key]||new Es(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(r,a){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||r.sourceLayer!=="building"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[r.key];return a||(this._cachedTileFogOpacities[r.key]=a=this.style.fog.getOpacityForTile(r)),a[0]>=Sn||a[1]>=Sn}}function Mc(h,r){let a=!1,d=null,g=()=>{d=null,a&&(h(),d=setTimeout(g,r),a=!1)};return()=>(a=!0,d||g(),d)}class Wu{constructor(r){this._hashName=r&&encodeURIComponent(r),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let r=this._map;if(!r)return"";let a=Df(r);if(this._hashName){let d=this._hashName,g=!1,v=location.hash.slice(1).split("&").map(w=>{let E=w.split("=")[0];return E===d?(g=!0,`${E}=${a}`):w}).filter(w=>w);return g||v.push(`${d}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){let r=location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return r.split("/")}_onHashChange(){let r=this._map;if(!r)return!1;let a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){let d=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(a[3]||0):r.getBearing();return r.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Df(h,r){let a=h.getCenter(),d=Math.round(100*h.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),w=Math.round(a.lng*v)/v,E=Math.round(a.lat*v)/v,D=h.getBearing(),S=h.getPitch(),A=r?`/${w}/${E}/${d}`:`${d}/${E}/${w}`;return(D||S)&&(A+="/"+Math.round(10*D)/10),S&&(A+=`/${Math.round(S)}`),A}let Cc={linearity:.3,easing:i.c_(0,0,.3,1)},Pi=i.e({deceleration:2500,maxSpeed:1400},Cc),F0=i.e({deceleration:20,maxSpeed:1400},Cc),Zu=i.e({deceleration:1e3,maxSpeed:360},Cc),er=i.e({deceleration:1e3,maxSpeed:90},Cc);class Rn{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.f.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,a=i.f.now();for(;r.length>0&&a-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let a={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);let d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){let v=xo(a.pan.mag(),d,i.e({},Pi,r||{}));g.offset=a.pan.mult(v.amount/a.pan.mag()),g.center=this._map.transform.center,Sc(g,v)}if(a.zoom){let v=xo(a.zoom,d,F0);g.zoom=this._map.transform.zoom+v.amount,Sc(g,v)}if(a.bearing){let v=xo(a.bearing,d,Zu);g.bearing=this._map.transform.bearing+i.aa(v.amount,-179,179),Sc(g,v)}if(a.pitch){let v=xo(a.pitch,d,er);g.pitch=this._map.transform.pitch+v.amount,Sc(g,v)}if(g.zoom||g.bearing){let v=a.pinchAround===void 0?a.around:a.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Sc(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function xo(h,r,a){let{maxSpeed:d,linearity:g,deceleration:v}=a,w=i.aa(h*g/(r/1e3),-d,d),E=Math.abs(w)/(v*g);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class xi extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,d,g={}){let v=gr(a.getCanvasContainer(),d),w=a.unproject(v);super(r,i.e({point:v,lngLat:w,originalEvent:d},g)),this._defaultPrevented=!1,this.target=a}}class Jo extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,d){let g=r==="touchend"?d.changedTouches:d.touches,v=qn(a.getCanvasContainer(),g),w=v.map(D=>a.unproject(D)),E=v.reduce((D,S,A,R)=>D.add(S.div(R.length)),new i.P(0,0));super(r,{points:v,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:d}),this._defaultPrevented=!1}}class Mf extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,d){super(r,{originalEvent:d}),this._defaultPrevented=!1}}class Cf{constructor(r,a){this._map=r,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Mf(r.type,this._map,r))}mousedown(r,a){return this._mousedownPos=a,this._firePreventable(new xi(r.type,this._map,r))}mouseup(r){this._map.fire(new xi(r.type,this._map,r))}preclick(r){let a=i.e({},r);a.type="preclick",this._map.fire(new xi(a.type,this._map,a))}click(r,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(r),this._map.fire(new xi(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new xi(r.type,this._map,r))}mouseover(r){this._map.fire(new xi(r.type,this._map,r))}mouseout(r){this._map.fire(new xi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Jo(r.type,this._map,r))}touchmove(r){this._map.fire(new Jo(r.type,this._map,r))}touchend(r){this._map.fire(new Jo(r.type,this._map,r))}touchcancel(r){this._map.fire(new Jo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fs{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new xi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new xi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zs{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,a){this.isEnabled()&&r.shiftKey&&r.button===0&&(Pn(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(r,a){if(!this._active)return;let d=a,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));let w=Math.min(g.x,d.x),E=Math.max(g.x,d.x),D=Math.min(g.y,d.y),S=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${D}px)`,this._box.style.width=E-w+"px",this._box.style.height=S-D+"px")})}mouseupWindow(r,a){if(!this._active)return;let d=this._startPos,g=a;if(d&&r.button===0){if(this.reset(),Tr(),d.x!==g.x||d.y!==g.y)return this._map.fire(new i.b("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Zt(),delete this._startPos,delete this._lastPos}_fireEvent(r,a){return this._map.fire(new i.b(r,{originalEvent:a}))}}function vl(h,r){let a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=r[d];return a}class Xu{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){let v=new i.P(0,0);for(let w of g)v._add(w);return v.div(g.length)}(a),this.touches=vl(d,a)))}touchmove(r,a,d){if(this.aborted||!this.centroid)return;let g=vl(d,a);for(let v in this.touches){let w=g[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,a,d){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ac{constructor(r){this.singleTap=new Xu(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,a,d){this.singleTap.touchstart(r,a,d)}touchmove(r,a,d){this.singleTap.touchmove(r,a,d)}touchend(r,a,d){let g=this.singleTap.touchend(r,a,d);if(g){let v=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(v&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Sf{constructor(){this._zoomIn=new Ac({numTouches:1,numTaps:2}),this._zoomOut=new Ac({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,a,d){this._zoomIn.touchstart(r,a,d),this._zoomOut.touchstart(r,a,d)}touchmove(r,a,d){this._zoomIn.touchmove(r,a,d),this._zoomOut.touchmove(r,a,d)}touchend(r,a,d){let g=this._zoomIn.touchend(r,a,d),v=this._zoomOut.touchend(r,a,d);return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(g)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Af={0:1,2:2};class No{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,a){return!1}_move(r,a){return{}}mousedown(r,a){if(this._lastPoint)return;let d=Br(r);this._correctButton(r,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(r,a){let d=this._lastPoint;if(d){if(r.preventDefault(),this._eventButton!=null&&function(g,v){let w=Af[v];return g.buttons===void 0||(g.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(r){this._lastPoint&&Br(r)===this._eventButton&&(this._moved&&Tr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pf extends No{mousedown(r,a){super.mousedown(r,a),this._lastPoint&&(this._active=!0)}_correctButton(r,a){return a===0&&!r.ctrlKey}_move(r,a){return{around:a,panDelta:a.sub(r)}}}class Pc extends No{_correctButton(r,a){return a===0&&r.ctrlKey||a===2}_move(r,a){let d=.8*(a.x-r.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(r){r.preventDefault()}}class Yu extends No{_correctButton(r,a){return a===0&&r.ctrlKey||a===2}_move(r,a){let d=-.5*(a.y-r.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(r){r.preventDefault()}}class Rf{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(r,a,d){return this._calculateTransform(r,a,d)}touchmove(r,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!i.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,a,d)}}touchend(r,a,d){this._calculateTransform(r,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,a,d){d.length>0&&(this._active=!0);let g=vl(d,a),v=new i.P(0,0),w=new i.P(0,0),E=0;for(let S in g){let A=g[S],R=this._touches[S];R&&(v._add(A),w._add(A.sub(R)),E++,g[S]=A)}if(this._touches=g,E<this._minTouches||!w.mag())return;let D=w.div(E);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Vr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,a,d){return{}}touchstart(r,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(r,a,d){let g=this._firstTwoTouches;if(!g)return;r.preventDefault();let[v,w]=g,E=xl(d,a,v),D=xl(d,a,w);if(!E||!D)return;let S=this._aroundCenter?null:E.add(D).div(2);return this._move([E,D],S,r)}touchend(r,a,d){if(!this._firstTwoTouches)return;let[g,v]=this._firstTwoTouches,w=xl(d,a,g),E=xl(d,a,v);w&&E||(this._active&&Tr(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xl(h,r,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return r[d]}function Ku(h,r){return Math.log(h/r)/Math.LN2}class Rc extends Vr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,a){let d=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Ku(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ku(this._distance,d),pinchAround:a}}}function Bs(h,r){return 180*h.angleWith(r)/Math.PI}class Lf extends Vr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,a){let d=this._vector;if(this._vector=r[0].sub(r[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Bs(this._vector,d),pinchAround:a}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;let g=Bs(r,d);return Math.abs(g)<a}}function Lc(h){return Math.abs(h.y)>Math.abs(h.x)}class Of extends Vr{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Lc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,a,d){let g=this._lastPoints;if(!g)return;let v=r[0].sub(g[0]),w=r[1].sub(g[1]);return this._map._cooperativeGestures&&!i.c$()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+w.y)/2*-.5})}gestureBeginsVertically(r,a,d){if(this._valid!==void 0)return this._valid;let g=r.mag()>=2,v=a.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;let w=r.y>0==a.y>0;return Lc(r)&&Lc(a)&&w}}let Ta={panStep:100,bearingStep:15,pitchStep:10};class Oc{constructor(){let r=Ta;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let a=0,d=0,g=0,v=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:r.shiftKey?d=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?d=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:E=>{let D=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Nf,zoom:a?Math.round(D)+a*(r.shiftKey?2:1):D,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nf(h){return h*(2-h)}let Nc=4.000244140625,kf=1/450;class Km{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=kf,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,d=i.f.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Nc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),r.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=r,this._delta-=a,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=gr(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let a=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){let S=this._type==="wheel"&&Math.abs(this._delta)>Nc?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);let R=a(),k=Math.pow(2,R),F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):k;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let d=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,v=this._easing,w,E=!1;if(this._type==="wheel"&&g&&v){let S=Math.min((i.f.now()-this._lastWheelEventTime)/200,1),A=v(S);w=i.U(g,d,A),S<1?this._frameId||(this._frameId=!0):E=!0}else w=d,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=w-a();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let a=i.d0;if(this._prevEase){let d=this._prevEase,g=(i.f.now()-d.start)/d.duration,v=d.easing(g+.01)-d.easing(g),w=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=i.c_(w,E,.25,1)}return this._prevEase={start:i.f.now(),duration:r,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Jm{constructor(r,a){this._clickZoom=r,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,a){return r.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(r.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eg{constructor(){this._tap=new Ac({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,a,d){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(r,a,d))}touchmove(r,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;let g=a[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,a,d)}touchend(r,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(r,a,d)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tg{constructor(r,a,d){this._el=r,this._mousePan=a,this._touchPan=d}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ng{constructor(r,a,d){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rg{constructor(r,a,d,g){this._el=r,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let kc=h=>h.zoom||h.drag||h.pitch||h.rotate;class ig extends i.b{}class og{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,a){let d=i.N.sub([],a,r);this.radius=i.N.length(d[2]<0?i.N.div([],d,this.constants):[d[0],d[1],0])}projectRay(r){i.N.div(r,r,this.constants),i.N.normalize(r,r),i.N.mul(r,r,this.constants);let a=i.N.scale([],r,this.radius);if(a[2]>0){let d=i.N.scale([],[0,0,1],i.N.dot(a,[0,0,1])),g=i.N.scale([],i.N.normalize([],[a[0],a[1],0]),this.radius),v=i.N.add([],a,i.N.scale([],i.N.sub([],i.N.add([],g,d),a),2));a[0]=v[0],a[1]=v[1]}return a}}function Fc(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class z0{constructor(r,a){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rn(r),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new og,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),i.aY(["handleEvent","handleWindowEvent"],this);let d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,v,w]of this._listeners){let E=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,E,w)}}destroy(){for(let[r,a,d]of this._listeners){let g=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(a,g,d)}}_addDefaultHandlers(r){let a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new Cf(a,r));let g=a.boxZoom=new zs(a,r);this._add("boxZoom",g);let v=new Sf,w=new Qm;a.doubleClickZoom=new Jm(w,v),this._add("tapZoom",v),this._add("clickZoom",w);let E=new eg;this._add("tapDragZoom",E);let D=a.touchPitch=new Of(a);this._add("touchPitch",D);let S=new Pc(r),A=new Yu(r);a.dragRotate=new ng(r,S,A),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);let R=new Pf(r),k=new Rf(a,r);a.dragPan=new tg(d,R,k),this._add("mousePan",R),this._add("touchPan",k,["touchZoom","touchRotate"]);let F=new Lf,$=new Rc;a.touchZoomRotate=new rg(d,$,F,E),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fs(a));let U=a.scrollZoom=new Km(a,this);this._add("scrollZoom",U,["mousePan"]);let G=a.keyboard=new Oc;this._add("keyboard",G);for(let B of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[B]&&a[B].enable(r[B])}_add(r,a,d){this._handlers.push({handlerName:r,handler:a,allowed:d}),this._handlersById[r]=a}stop(r){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,a,d){for(let g in r)if(g!==d&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){let a=[];for(let d of r)this._el.contains(d.target)&&a.push(d);return a}handleEvent(r,a){this._updatingCamera=!0;let d=r.type==="renderFrame",g=d?void 0:r,v={needsRenderFrame:!1},w={},E={},D=r.touches?this._getMapTouches(r.touches):void 0,S=D?qn(this._el,D):d?void 0:gr(this._el,r);for(let{handlerName:k,handler:F,allowed:$}of this._handlers){if(!F.isEnabled())continue;let U;this._blockedByActive(E,$,k)?F.reset():F[a||r.type]&&(U=F[a||r.type](r,S,D),this.mergeHandlerResult(v,w,U,k,g),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||F.isActive())&&(E[k]=F)}let A={};for(let k in this._previousActiveHandlers)E[k]||(A[k]=g);this._previousActiveHandlers=E,(Object.keys(A).length||Fc(v))&&(this._changes.push([v,w,A]),this._triggerRenderFrame()),(Object.keys(E).length||Fc(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:R}=v;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(r,a,d,g,v){if(!d)return;i.e(r,d);let w={handlerName:g,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(a.zoom=w),d.panDelta!==void 0&&(a.drag=w),d.pitchDelta!==void 0&&(a.pitch=w),d.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){let r={},a={},d={};for(let[g,v,w]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new i.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.aroundCoord!==void 0&&(r.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),i.e(a,v),i.e(d,w);this._updateMapTransform(r,a,d),this._changes=[]}_updateMapTransform(r,a,d){let g=this._map,v=g.transform,w=q=>[q.x,q.y,q.z];if((q=>{let Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!Fc(r)){let q=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),q!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!Fc(r))return void this._fireEvents(a,d,!0);let{panDelta:E,zoomDelta:D,bearingDelta:S,pitchDelta:A,around:R,aroundCoord:k,pinchAround:F}=r;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),F!==void 0&&(R=F),(D||(q=>a[q]&&!this._eventsInProgress[q])("drag"))&&R&&(this._dragOrigin=w(v.pointCoordinate3D(R)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),R=R||g.transform.centerPoint,S&&(v.bearing+=S),A&&(v.pitch+=A),v._updateCameraState();let $=[0,0,0];if(E)if(v.projection.name==="mercator"){let q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(R).dir),Q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(R.sub(E)).dir);$[0]=Q[0]-q[0],$[1]=Q[1]-q[1]}else{let q=v.pointCoordinate(R);if(v.projection.name==="globe"){E=E.rotate(-v.angle);let Q=v._pixelsPerMercatorPixel/v.worldSize;$[0]=-E.x*i.d1(i.au(q.y))*Q,$[1]=-E.y*i.d1(v.center.lat)*Q}else{let Q=v.pointCoordinate(R.sub(E));q&&Q&&($[0]=Q.x-q.x,$[1]=Q.y-q.y)}}let U=v.zoom,G=[0,0,0];if(D){let q=w(k||v.pointCoordinate3D(R)),Q={dir:i.N.normalize([],i.N.sub([],q,v._camera.position))};if(Q.dir[2]<0){let X=v.zoomDeltaToMovement(q,D);i.N.scale(G,Q.dir,X)}}let B=i.N.add($,$,G);v._translateCameraConstrained(B),D&&Math.abs(v.zoom-U)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(a,d,!0)}_fireEvents(r,a,d){let g=kc(this._eventsInProgress),v=kc(r),w={};for(let A in r){let{originalEvent:R}=r[A];this._eventsInProgress[A]||(w[`${A}start`]=R),this._eventsInProgress[A]=r[A]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(let A in w)this._fireEvent(A,w[A]);v&&this._fireEvent("move",v.originalEvent);for(let A in r){let{originalEvent:R}=r[A];this._fireEvent(A,R)}let E={},D;for(let A in this._eventsInProgress){let{handlerName:R,originalEvent:k}=this._eventsInProgress[A];this._handlersById[R].isActive()||(delete this._eventsInProgress[A],D=a[R]||k,E[`${A}end`]=D)}for(let A in E)this._fireEvent(A,E[A]);let S=kc(this._eventsInProgress);if(d&&(g||v)&&!S){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=k=>k!==0&&-this._bearingSnap<k&&k<this._bearingSnap;A?(R(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:D})):(this._map.fire(new i.b("moveend",{originalEvent:D})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,a){this._map.fire(new i.b(r,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new ig("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let sg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class yr extends i.E{constructor(r,a){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(r,a){return this.jumpTo({center:r},a)}panBy(r,a,d){return r=i.P.convert(r).mult(-1),this.panTo(this.transform.center,i.e({offset:r},a),d)}panTo(r,a,d){return this.easeTo(i.e({center:r},a),d)}getZoom(){return this.transform.zoom}setZoom(r,a){return this.jumpTo({zoom:r},a),this}zoomTo(r,a,d){return this.easeTo(i.e({zoom:r},a),d)}zoomIn(r,a){return this.zoomTo(this.getZoom()+1,r,a),this}zoomOut(r,a){return this.zoomTo(this.getZoom()-1,r,a),this}getBearing(){return this.transform.bearing}setBearing(r,a){return this.jumpTo({bearing:r},a),this}getPadding(){return this.transform.padding}setPadding(r,a){return this.jumpTo({padding:r},a),this}rotateTo(r,a,d){return this.easeTo(i.e({bearing:r},a),d)}resetNorth(r,a){return this.rotateTo(0,i.e({duration:1e3},r),a),this}resetNorthPitch(r,a){return this.easeTo(i.e({bearing:0,pitch:0,duration:1e3},r),a),this}snapToNorth(r,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,a):this}getPitch(){return this.transform.pitch}setPitch(r,a){return this.jumpTo({pitch:r},a),this}cameraForBounds(r,a){r=i.ad.convert(r);let d=a&&a.bearing||0,g=a&&a.pitch||0,v=r.getNorthWest(),w=r.getSouthEast();return this._cameraForBounds(this.transform,v,w,d,g,a)}_extendCameraOptions(r){let a={top:0,bottom:0,right:0,left:0};if(typeof(r=i.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){let d=r.padding;r.padding={top:d,bottom:d,right:d,left:d}}return r.padding=i.e(a,r.padding),r}_minimumAABBFrustumDistance(r,a){let d=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return d/g>r.aspect?d/(2*Math.tan(.5*r.fovX)*r.aspect):g/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,a,d,g,v,w){let E=r.clone(),D=this._extendCameraOptions(w);E.bearing=g,E.pitch=v;let S=i.bn.convert(a),A=i.bn.convert(d),R=.5*(S.lat+A.lat),k=.5*(S.lng+A.lng),F=i.d2(R,k),$=i.N.normalize([],F),U=i.N.normalize([],i.N.cross([],$,[0,1,0])),G=i.N.cross([],U,$),B=[U[0],U[1],U[2],0,G[0],G[1],G[2],0,$[0],$[1],$[2],0,0,0,0,1],q=[F,i.d2(S.lat,S.lng),i.d2(A.lat,S.lng),i.d2(A.lat,A.lng),i.d2(S.lat,A.lng),i.d2(R,S.lng),i.d2(R,A.lng),i.d2(S.lat,k),i.d2(A.lat,k)],Q=i.bS.fromPoints(q.map(_e=>[i.N.dot(U,_e),i.N.dot(G,_e),i.N.dot($,_e)])),X=i.N.transformMat4([],Q.center,B);i.N.squaredLength(X)===0&&i.N.set(X,0,0,1),i.N.normalize(X,X),i.N.scale(X,X,i.ab),E.center=i.d3(X);let ee=E.getWorldToCameraMatrix(),H=i.a6.invert(new Float64Array(16),ee);Q=i.bS.applyTransform(Q,i.a6.multiply([],ee,B)),i.N.transformMat4(X,X,ee);let te=.5*(Q.max[2]-Q.min[2]),oe=this._minimumAABBFrustumDistance(E,Q),ae=i.N.scale([],[0,0,1],te),ue=i.N.add(ae,X,ae),xe=oe+(E.pitch===0?0:i.N.distance(X,ue)),fe=E.globeCenterInViewSpace,De=i.N.sub([],X,[fe[0],fe[1],fe[2]]);i.N.normalize(De,De),i.N.scale(De,De,xe);let Ee=i.N.add([],X,De);i.N.transformMat4(Ee,Ee,H);let Be=i.d4/i.ab,pe=i.N.length(Ee),we=i.bl(Math.max(pe*Be-i.d4,Number.EPSILON),0),ce=Math.min(E.zoomFromMercatorZAdjusted(we),D.maxZoom);return ce>.5*(i.bG+i.bx)?(E.setProjection({name:"mercator"}),E.zoom=ce,this._cameraForBounds(E,a,d,g,v,w)):{center:E.center,zoom:ce,bearing:g,pitch:v}}queryTerrainElevation(r,a){let d=this.transform.elevation;return d?(a=i.e({},{exaggerated:!0},a),d.getAtPoint(i.L.fromLngLat(r),null,a.exaggerated)):null}_cameraForBounds(r,a,d,g,v,w){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,a,d,g,v,w);let E=r.clone(),D=this._extendCameraOptions(w),S=E.padding;E.bearing=g,E.pitch=v;let A=i.bn.convert(a),R=i.bn.convert(d),k=new i.bn(A.lng,R.lat),F=new i.bn(R.lng,A.lat),$=E.project(A),U=E.project(R),G=this.queryTerrainElevation(A),B=this.queryTerrainElevation(R),q=this.queryTerrainElevation(k),Q=this.queryTerrainElevation(F),X=[[$.x,$.y,Math.min(G||0,B||0,q||0,Q||0)],[U.x,U.y,Math.max(G||0,B||0,q||0,Q||0)]],ee=i.bS.fromPoints(X),H=E.getWorldToCameraMatrix(),te=i.a6.invert(new Float64Array(16),H);ee=i.bS.applyTransform(ee,H);let oe=i.N.sub([],ee.max,ee.min),ae=S.left||0,ue=S.right||0,xe=S.bottom||0,fe=S.top||0,{left:De,right:Ee,top:Be,bottom:pe}=D.padding,we=.5*(ae+ue),ce=.5*(fe+xe),_e=Math.min(E.scaleZoom(E.scale*Math.min((E.width-(ae+ue+De+Ee))/oe[0],(E.height-(xe+fe+pe+Be))/oe[1])),D.maxZoom),je=E.scale/E.zoomScale(_e);ee=new i.bS([ee.min[0]-(De+we)*je,ee.min[1]-(pe+ce)*je,ee.min[2]],[ee.max[0]+(Ee+we)*je,ee.max[1]+(Be+ce)*je,ee.max[2]]);let We=.5*oe[2],qe=this._minimumAABBFrustumDistance(E,ee),et=[0,0,1,0];i.a7.transformMat4(et,et,H),i.a7.normalize(et,et);let ft=i.N.scale([],et,qe+We),wt=i.N.add([],ee.center,ft),_t=(typeof D.offset.x=="number"&&typeof D.offset.y=="number"?new i.P(D.offset.x,D.offset.y):i.P.convert(D.offset)).rotate(-i.bj(g));ee.center[0]-=_t.x*je,ee.center[1]+=_t.y*je,i.N.transformMat4(ee.center,ee.center,te),i.N.transformMat4(wt,wt,te);let xt=[ee.center[0],ee.center[1],wt[2]*E.pixelsPerMeter];i.N.scale(xt,xt,1/E.worldSize);let Ut=i.at(xt[0]),Rt=i.au(xt[1]),zt=Math.min(E._zoomFromMercatorZ(xt[2]),D.maxZoom),kt=new i.bn(Ut,Rt);return E.mercatorFromTransition&&zt<.5*(i.bG+i.bx)?(E.setProjection({name:"globe"}),E.zoom=zt,this._cameraForBounds(E,a,d,g,v,w)):{center:kt,zoom:zt,bearing:g,pitch:v}}fitBounds(r,a,d){let g=this.cameraForBounds(r,a);return this._fitInternal(g,a,d)}fitScreenCoordinates(r,a,d,g,v){let w=i.P.convert(r),E=i.P.convert(a),D=new i.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),S=new i.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;let A=this.transform.pointLocation3D(D),R=this.transform.pointLocation3D(S),k=this.transform.pointLocation3D(new i.P(D.x,S.y)),F=this.transform.pointLocation3D(new i.P(S.x,D.y)),$=[Math.min(A.lng,R.lng,k.lng,F.lng),Math.min(A.lat,R.lat,k.lat,F.lat)],U=[Math.max(A.lng,R.lng,k.lng,F.lng),Math.max(A.lat,R.lat,k.lat,F.lat)],G=g&&g.pitch?g.pitch:this.getPitch(),B=this._cameraForBounds(this.transform,$,U,d,G,g);return this._fitInternal(B,g,v)}_fitInternal(r,a,d){return r?(delete(a=i.e(r,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(r,a){this.stop();let d=r.preloadOnly?this.transform.clone():this.transform,g=!1,v=!1,w=!1;return"zoom"in r&&d.zoom!==+r.zoom&&(g=!0,d.zoom=+r.zoom),r.center!==void 0&&(d.center=i.bn.convert(r.center)),"bearing"in r&&d.bearing!==+r.bearing&&(v=!0,d.bearing=+r.bearing),"pitch"in r&&d.pitch!==+r.pitch&&(w=!0,d.pitch=+r.pitch),r.padding==null||d.isPaddingEqual(r.padding)||(d.padding=r.padding),r.preloadOnly?(this._preloadTiles(d),this):(this.fire(new i.b("movestart",a)).fire(new i.b("move",a)),g&&this.fire(new i.b("zoomstart",a)).fire(new i.b("zoom",a)).fire(new i.b("zoomend",a)),v&&this.fire(new i.b("rotatestart",a)).fire(new i.b("rotate",a)).fire(new i.b("rotateend",a)),w&&this.fire(new i.b("pitchstart",a)).fire(new i.b("pitch",a)).fire(new i.b("pitchend",a)),this.fire(new i.b("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(sg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,a){let d=this.transform;if(!d.projection.supportsFreeCamera)return i.w(sg),this;this.stop();let g=d.zoom,v=d.pitch,w=d.bearing;d.setFreeCameraOptions(r);let E=g!==d.zoom,D=v!==d.pitch,S=w!==d.bearing;return this.fire(new i.b("movestart",a)).fire(new i.b("move",a)),E&&this.fire(new i.b("zoomstart",a)).fire(new i.b("zoom",a)).fire(new i.b("zoomend",a)),S&&this.fire(new i.b("rotatestart",a)).fire(new i.b("rotate",a)).fire(new i.b("rotateend",a)),D&&this.fire(new i.b("pitchstart",a)).fire(new i.b("pitch",a)).fire(new i.b("pitchend",a)),this.fire(new i.b("moveend",a)),this}easeTo(r,a){this._stop(!1,r.easeId),((r=i.e({offset:[0,0],duration:500,easing:i.d0},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);let d=this.transform,g=this.getZoom(),v=this.getBearing(),w=this.getPitch(),E=this.getPadding(),D="zoom"in r?+r.zoom:g,S="bearing"in r?this._normalizeBearing(r.bearing,v):v,A="pitch"in r?+r.pitch:w,R="padding"in r?r.padding:d.padding,k=i.P.convert(r.offset),F,$,U;if(d.projection.name==="globe"){let ae=i.L.fromLngLat(d.center),ue=k.rotate(-d.angle);ae.x+=ue.x/d.worldSize,ae.y+=ue.y/d.worldSize;let xe=ae.toLngLat(),fe=i.bn.convert(r.center||xe);this._normalizeCenter(fe),F=d.centerPoint.add(ue),$=new i.P(ae.x,ae.y).mult(d.worldSize),U=new i.P(i.a5(fe.lng),i.ae(fe.lat)).mult(d.worldSize).sub($)}else{F=d.centerPoint.add(k);let ae=d.pointLocation(F),ue=i.bn.convert(r.center||ae);this._normalizeCenter(ue),$=d.project(ae),U=d.project(ue).sub($)}let G=d.zoomScale(D-g),B,q;r.around&&(B=i.bn.convert(r.around),q=d.locationPoint(B));let Q=this._zooming||D!==g,X=this._rotating||v!==S,ee=this._pitching||A!==w,H=!d.isPaddingEqual(R),te=ae=>ue=>{if(Q&&(ae.zoom=i.U(g,D,ue)),X&&(ae.bearing=i.U(v,S,ue)),ee&&(ae.pitch=i.U(w,A,ue)),H&&(ae.interpolatePadding(E,R,ue),F=ae.centerPoint.add(k)),B)ae.setLocationAtPoint(B,q);else{let xe=ae.zoomScale(ae.zoom-g),fe=D>g?Math.min(2,G):Math.max(.5,G),De=Math.pow(fe,1-ue),Ee=ae.unproject($.add(U.mult(ue*De)).mult(xe));ae.setLocationAtPoint(ae.renderWorldCopies?Ee.wrap():Ee,F)}return r.preloadOnly||this._fireMoveEvents(a),ae};if(r.preloadOnly){let ae=this._emulate(te,r.duration,d);return this._preloadTiles(ae),this}let oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=X,this._pitching=ee,this._easeId=r.easeId,this._prepareEase(a,r.noMoveStart,oe),this._ease(te(d),ae=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,ae)},r),this}_prepareEase(r,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new i.b("movestart",r)),this._zooming&&!d.zooming&&this.fire(new i.b("zoomstart",r)),this._rotating&&!d.rotating&&this.fire(new i.b("rotatestart",r)),this._pitching&&!d.pitching&&this.fire(new i.b("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.b("move",r)),this._zooming&&this.fire(new i.b("zoom",r)),this._rotating&&this.fire(new i.b("rotate",r)),this._pitching&&this.fire(new i.b("pitch",r))}_afterEase(r,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let d=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,d&&this.fire(new i.b("zoomend",r)),g&&this.fire(new i.b("rotateend",r)),v&&this.fire(new i.b("pitchend",r)),this.fire(new i.b("moveend",r))}flyTo(r,a){if(this._prefersReducedMotion(r)){let pe=i.ac(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pe,a)}this.stop(),r=i.e({offset:[0,0],speed:1.2,curve:1.42,easing:i.d0},r);let d=this.transform,g=this.getZoom(),v=this.getBearing(),w=this.getPitch(),E="zoom"in r?i.aa(+r.zoom,d.minZoom,d.maxZoom):g,D="bearing"in r?this._normalizeBearing(r.bearing,v):v,S="pitch"in r?+r.pitch:w,A=d.zoomScale(E-g),R=i.P.convert(r.offset),k=d.centerPoint.add(R),F=d.pointLocation(k),$=r.center;if($&&r.padding){let pe=this._cameraForBounds(this.transform,$,$,D,S,r);pe&&($=pe.center)}$=i.bn.convert($||F),this._normalizeCenter($);let U=d.project(F),G=d.project($).sub(U),B=r.curve,q=Math.max(d.width,d.height),Q=q/A,X=G.mag();if("minZoom"in r){let pe=i.aa(Math.min(r.minZoom,g,E),d.minZoom,d.maxZoom),we=q/d.zoomScale(pe-g);B=Math.sqrt(we/X*2)}let ee=B*B;function H(pe){let we=(Q*Q-q*q+(pe?-1:1)*ee*ee*X*X)/(2*(pe?Q:q)*ee*X);return Math.log(Math.sqrt(we*we+1)-we)}function te(pe){return(Math.exp(pe)-Math.exp(-pe))/2}function oe(pe){return(Math.exp(pe)+Math.exp(-pe))/2}let ae=H(0),ue=function(pe){return oe(ae)/oe(ae+B*pe)},xe=function(pe){return q*((oe(ae)*(te(we=ae+B*pe)/oe(we))-te(ae))/ee)/X;var we},fe=(H(1)-ae)/B;if(Math.abs(X)<1e-6||!isFinite(fe)){if(Math.abs(q-Q)<1e-6)return this.easeTo(r,a);let pe=Q<q?-1:1;fe=Math.abs(Math.log(Q/q))/B,xe=function(){return 0},ue=function(we){return Math.exp(pe*B*we)}}r.duration="duration"in r?+r.duration:1e3*fe/("screenSpeed"in r?+r.screenSpeed/B:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);let De=v!==D,Ee=S!==w,Be=pe=>we=>{let ce=we*fe,_e=1/ue(ce);pe.zoom=we===1?E:g+pe.scaleZoom(_e),De&&(pe.bearing=i.U(v,D,we)),Ee&&(pe.pitch=i.U(w,S,we));let je=we===1?$:pe.unproject(U.add(G.mult(xe(ce))).mult(_e));return pe.setLocationAtPoint(pe.renderWorldCopies?je.wrap():je,k),pe._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(a),pe};if(r.preloadOnly){let pe=this._emulate(Be,r.duration,d);return this._preloadTiles(pe),this}return this._zooming=!0,this._rotating=De,this._pitching=Ee,this._prepareEase(a,!1),this._ease(Be(d),()=>this._afterEase(a),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!r){let d=this.handlers;d&&d.stop(!1)}return this}_ease(r,a,d){d.animate===!1||d.duration===0?(r(1),a()):(this._easeStart=i.f.now(),this._easeOptions=d,this._onEaseFrame=r,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((i.f.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,a){r=i.bh(r,-180,180);let d=Math.abs(r-a);return Math.abs(r-360-a)<d&&(r-=360),Math.abs(r+360-a)<d&&(r+=360),r}_normalizeCenter(r){let a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;let d=r.lng-a.center.lng;r.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.f.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,a,d){let g=Math.ceil(15*a/1e3),v=[],w=r(d.clone());for(let E=0;E<=g;E++){let D=w(E/g);v.push(D.clone())}return v}}class Ff{constructor(r={}){this.options=r,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){let a=this.options&&this.options.compact;return this._map=r,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),se("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,a){let d=this._map._getUIString(`AttributionControl.${a}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.d5.ACCESS_TOKEN}];if(r){let d=a.reduce((g,v,w)=>(v.value&&(g+=`${v.key}=${v.value}${w<a.length-1?"&":""}`),g),"?");r.href=`${i.d5.FEEDBACK_URL}/${d}#${Df(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let a=this._map.style._mergedSourceCaches;for(let g in a){let v=a[g];if(v.used){let w=v.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((g,v)=>g.length-v.length),r=r.filter((g,v)=>{for(let w=v+1;w<r.length;w++)if(r[w].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));let d=r.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,r.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ag{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=se("div","mapboxgl-ctrl");let a=se("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(let a in r){let d=r[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){let r=this._container.children;if(r.length){let a=r[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class lg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let a=++this._id;return this._queue.push({callback:r,id:a,cancelled:!1}),a}remove(r){let a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(let g of d)if(g.id===r)return void(g.cancelled=!0)}run(r=0){let a=this._currentlyRunning=this._queue;this._queue=[];for(let d of a)if(!d.cancelled&&(d.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function zc(h,r,a){if(h=new i.bn(h.lng,h.lat),r){let d=new i.bn(h.lng-360,h.lat),g=new i.bn(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),w=a.locationPoint(h).distSqr(r),E=r.x<0||r.y<0||r.x>a.width||r.y>a.height;a.locationPoint(d).distSqr(r)<w&&(E||Math.abs(d.lng-a.center.lng)<v)?h=d:a.locationPoint(g).distSqr(r)<w&&(E||Math.abs(g.lng-a.center.lng)<v)&&(h=g)}for(;Math.abs(h.lng-a.center.lng)>180;){let d=a.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}let Ju={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zf extends i.E{constructor(r,a){if(super(),(r instanceof HTMLElement||a)&&(r=i.e({element:r},a)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=i.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=se("div");let v=41,w=27,E=ve("svg",{display:"block",height:v*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${v}`},this._element),D=ve("radialGradient",{id:"shadowGradient"},ve("defs",{},E));ve("stop",{offset:"10%","stop-opacity":.4},D),ve("stop",{offset:"100%","stop-opacity":.05},D),ve("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),ve("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),ve("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),ve("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=i.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let d=this._element.classList;for(let v in Ju)d.remove(`mapboxgl-marker-anchor-${v}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=r&&r.className?r.className.trim().split(/\s+/):[];d.add(...g),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){let r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.bn.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){let a=r.code,d=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(r){let a=r.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let r=this._map,a=this._pos;if(!r||!a)return!1;let d=r.unproject(a),g=r.getFreeCameraOptions();if(!g.position)return!1;let v=g.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let r=this._map;if(!r)return;let a=this._pos;if(!a||a.x<0||a.x>r.transform.width||a.y<0||a.y>r.transform.height)return void this._clearFadeTimer();let d=r.unproject(a),g;r._showingGlobe()&&i.d6(r.transform,this._lngLat)?g=0:(g=1-r._queryFogOpacity(d),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let r=this._pos;if(!r||!this._map)return;let a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Ju[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){let r=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!r||d!=="map")return"";if(!a._showingGlobe()){let D=a.getPitch();return D?`rotateX(${D}deg)`:""}let g=i.bF(i.d7(a.transform,this._lngLat)),v=r.sub(i.d8(a.transform)),w=Math.abs(v.x)+Math.abs(v.y);if(w===0)return"";let E=g/w;return`rotateX(${-v.y*E}deg) rotateY(${v.x*E}deg)`}_calculateZTransform(){let r=this._pos,a=this._map;if(!a||!r)return"";let d=0,g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){let v=a.project(new i.bn(this._lngLat.lng,this._lngLat.lat+.001)),w=a.project(new i.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);d=i.bF(Math.atan2(w.y,w.x))-90}else d=-a.getBearing();else if(g==="horizon"){let v=i.O(4,6,a.getZoom()),w=i.d8(a.transform);w.y+=v*a.transform.height;let E=r.sub(w),D=i.bF(Math.atan2(E.y,E.x));d=(D>90?D-270:D+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);let a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=zc(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){let a=this._map;if(!a)return;let d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){let v=this._clickTolerance||a._clickTolerance;if(r.point.dist(d)<v)return;this._isDragging=!0}this._pos=r.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.b("dragstart"))),this.fire(new i.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.b("dragend")),this._state="inactive"}_addDragHandler(r){let a=this._map,d=this._pos;a&&d&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(d),this._pointerdownPos=r.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;let a=this._map;return a&&(r?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let cg={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ug=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hg(h=new i.P(0,0),r="bottom"){if(typeof h=="number"){let a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new i.P(0,h);case"top-left":return new i.P(a,a);case"top-right":return new i.P(-a,a);case"bottom":return new i.P(0,-h);case"bottom-left":return new i.P(a,-a);case"bottom-right":return new i.P(-a,-a);case"left":return new i.P(h,0);case"right":return new i.P(-h,0)}return new i.P(0,0)}return h instanceof i.P||Array.isArray(h)?i.P.convert(h):i.P.convert(h[r]||[0,0])}class Bf{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let a=i.cc((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,a,d){this._start=this.getValue(a),this._end=r,this._startTime=a,this._endTime=a+d}}let Bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},dg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class jf{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}let Qu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qo{constructor(r,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Pc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,d&&(this.mousePitch=new Yu({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(r,a){this.mouseRotate.mousedown(r,a),this.mousePitch&&this.mousePitch.mousedown(r,a),Pn()}move(r,a){let d=this.map,g=this.mouseRotate.mousemoveWindow(r,a),v=g&&g.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){let w=this.mousePitch.mousemoveWindow(r,a),E=w&&w.pitchDelta;E&&d.setPitch(d.getPitch()+E)}}off(){let r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Zt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.e({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),gr(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,gr(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=qn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let eh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hi={maxWidth:100,unit:"metric"},js={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:i.dk,supported:O,setRTLTextPlugin:i.dm,getRTLTextPluginStatus:i.dn,Map:class extends yr{constructor(h){let r=h;if((h=i.e({},dg,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&i.d9(window)&&(h.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new dc(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!1,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new lg,this._domRenderTaskQueue=new lg,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aC(),this._locale=i.e({},Bc,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.da(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Pt({},h.contextCreateOptions):{},typeof h.container=="string"){let a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new jf,this._tp=h.devtools?new Ic(this):new Ic,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,a=>{this.repaint=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,a=>{this.showTileAABBs=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,a=>{this.showPadding=a}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new z0(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||i.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Wu(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});let a=h.bounds;a&&(this.resize(),this.fitBounds(a,i.e({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Ff({customAttribution:h.customAttribution})),this._logoControl=new ag,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new i.b(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new i.b(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(h,r){if(r===void 0&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new i.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=h.onAdd(this);this._controls.push(h);let d=this._controlPositions[r];return r.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new i.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new i.b("movestart",h)).fire(new i.b("move",h)),this.fire(new i.b("resize",h)),r&&this.fire(new i.b("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(i.ad.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new i.b("zoomstart")).fire(new i.b("zoom")).fire(new i.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new i.b("zoomstart")).fire(new i.b("zoom")).fire(new i.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new i.b("pitchstart")).fire(new i.b("pitch")).fire(new i.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new i.b("pitchstart")).fire(new i.b("pitch")).fire(new i.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(r=>r==="auto"?navigator.language:r):h}setLanguage(h){let r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let h=this.transform,r=h.projection.name,a;r==="globe"&&h.zoom>=i.bx?(h.setMercatorFromTransition(),a=!0):r==="mercator"&&h.zoom<i.bx&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;return r=h.name==="globe"&&this.transform.zoom>=i.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(i.bn.convert(h))}unproject(h){return this.transform.pointLocation3D(i.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,a){if(h==="mouseenter"||h==="mouseover"){let d=!1,g=w=>{let E=r.filter(S=>this.getLayer(S)),D=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];D.length?d||(d=!0,a.call(this,new xi(h,this,w.originalEvent,{features:D}))):d=!1},v=()=>{d=!1};return{layers:new Set(r),listener:a,delegates:{mousemove:g,mouseout:v}}}if(h==="mouseleave"||h==="mouseout"){let d=!1,g=w=>{let E=r.filter(D=>this.getLayer(D));(E.length?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?d=!0:d&&(d=!1,a.call(this,new xi(h,this,w.originalEvent)))},v=w=>{d&&(d=!1,a.call(this,new xi(h,this,w.originalEvent)))};return{layers:new Set(r),listener:a,delegates:{mousemove:g,mouseout:v}}}{let d=g=>{let v=r.filter(E=>this.getLayer(E)),w=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];w.length&&(g.features=w,a.call(this,g),delete g.features)};return{layers:new Set(r),listener:a,delegates:{[h]:d}}}}on(h,r,a){if(a===void 0)return super.on(h,r);if(Array.isArray(r)||(r=[r]),r){for(let g of r)if(!this._isValidId(g))return this}let d=this._createDelegatedListener(h,r,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(let g in d.delegates)this.on(g,d.delegates[g]);return this}once(h,r,a){if(a===void 0)return super.once(h,r);if(Array.isArray(r)||(r=[r]),r){for(let g of r)if(!this._isValidId(g))return this}let d=this._createDelegatedListener(h,r,a);for(let g in d.delegates)this.once(g,d.delegates[g]);return this}off(h,r,a){if(a===void 0)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);for(let v of r)if(!this._isValidId(v))return this;let d=(v,w)=>{if(v.size!==w.size)return!1;for(let E of v)if(!w.has(E))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[h]:void 0;return g&&(v=>{for(let w=0;w<v.length;w++){let E=v[w];if(E.listener===a&&d(E.layers,r)){for(let D in E.delegates)this.off(D,E.delegates[D]);return v.splice(w,1),this}}})(g),this}queryRenderedFeatures(h,r){if(!this.style)return[];if(r!==void 0||h===void 0||h instanceof i.P||Array.isArray(h)||(r=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(let a of r.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(h,r){return this._isValidId(h)?this.style.querySourceFeatures(h,r):[]}isPointOnSurface(h){let{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(h))}setStyle(h,r){return(r=i.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){let r=this._locale[h];if(r==null)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new _o(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new _o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if(typeof h=="string"){let a=this._requestManager.normalizeStyleURL(h),d=this._requestManager.transformRequest(a,i.R.Style);i.g(d,(g,v)=>{g?this.fire(new i.a(g)):v&&this._updateDiff(v,r)})}else typeof h=="object"&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(a){i.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new i.a(new Error("IDs can't be empty."))),!1):!i.c4(h)||(this.fire(new i.a(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}addSource(h,r){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,r,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,r,{pixelRatio:a=1,sdf:d=!1,stretchX:g,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){let{width:E,height:D,data:S}=i.f.getImageData(r);this.style.addImage(h,{data:new i.h({width:E,height:D},S),pixelRatio:a,stretchX:g,stretchY:v,content:w,sdf:d,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new i.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:D}=r,S=r;this.style.addImage(h,{data:new i.h({width:E,height:D},new Uint8Array(S.data)),pixelRatio:a,stretchX:g,stretchY:v,content:w,sdf:d,version:0,userImage:S}),S.onAdd&&S.onAdd(this,h)}}updateImage(h,r){this._lazyInitEmptyStyle();let a=this.style.getImage(h);if(!a)return void this.fire(new i.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let d=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?i.f.getImageData(r):r,{width:g,height:v}=d,w=d.data;if(g===void 0||v===void 0)return void this.fire(new i.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||v!==a.data.height)return void this.fire(new i.a(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));let E=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);a.data.replace(w,E),this.style.updateImage(h,a)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new i.a(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){i.d(this._requestManager.transformRequest(h,i.R.Image),(a,d)=>{r(a,d instanceof HTMLImageElement?i.f.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,r){this._lazyInitEmptyStyle(),this.style.addModel(h,r)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new i.a(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,r){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)):this}getSlot(h){let r=this.getLayer(h);return r&&r.slot||null}setSlot(h,r){return this.style.setSlot(h,r),this.style.mergeLayers(),this._update(!0)}addImport(h,r){return this.style.addImport(h,r),this}updateImport(h,r){return typeof r!="string"&&r.id!==h?(this.removeImport(h),this.addImport(r)):(this.style.updateImport(h,r),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,r){return this.style.moveImport(h,r),this._update(!0)}moveLayer(h,r){return this._isValidId(h)?(this.style.moveLayer(h,r),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){return this._isValidId(h)?this.style.getOwnLayer(h):null}setLayerZoomRange(h,r,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,r,a),this._update(!0)):this}setFilter(h,r,a={}){return this._isValidId(h)?(this.style.setFilter(h,r,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,r,a,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,r,a,d),this._update(!0)):this}getPaintProperty(h,r){return this._isValidId(h)?this.style.getPaintProperty(h,r):null}setLayoutProperty(h,r,a,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,r,a,d),this._update(!0)):this}getLayoutProperty(h,r){return this._isValidId(h)?this.style.getLayoutProperty(h,r):null}getConfigProperty(h,r){return this.style.getConfigProperty(h,r)}setConfigProperty(h,r,a){return this.style.setConfigProperty(h,r,a),this._update(!0)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){let r=h[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bn.convert(h),this.transform):0}setFeatureState(h,r){return this._isValidId(h.source)?(this.style.setFeatureState(h,r),this._update()):this}removeFeatureState(h,r){return this._isValidId(h.source)?(this.style.removeFeatureState(h,r),this._update()):this}getFeatureState(h){return this._isValidId(h.source)?this.style.getFeatureState(h):null}_updateContainerDimensions(){if(!this._container)return;let h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300,a,d,g,v=this._container;for(;v&&(!d||!g);){let w=window.getComputedStyle(v).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),v=v.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=g?Math.abs(r/g):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=se("div","mapboxgl-canvas-container",h);this._canvas=se("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let a=this._controlContainer=se("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=se("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){let a=i.f.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){let r=this._markers.indexOf(h);r!==-1&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){let r=this._popups.indexOf(h);r!==-1&&this._popups.splice(r,1)}_setupPainter(){let h=i.e({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",h);r?(i.db(r,!0),this.painter=new Ym(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.dc.testSupport(r)):this.fire(new i.a(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.b("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new i.b("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;this.fire(new i.b("renderstart"));let a=this.painter.context.extTimerQuery,d=i.f.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let D=this.transform.zoom,S=this.transform.pitch,A=i.f.now(),R=new i.K(D,{now:A,fadeDuration:v,pitch:S,transition:this.style.transition});this.style.update(R)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let D=i.f.now()-d;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{let S=g.getQueryParameter(r,g.QUERY_RESULT)/1e6;g.deleteQuery(r),this.fire(new i.b("gpu-timing-frame",{cpuTime:D,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){let D=this.painter.collectGpuTimers();setTimeout(()=>{let S=this.painter.queryGpuTimers(D);this.fire(new i.b("gpu-timing-layer",{layerTimes:S}))},50)}if(this.listens("gpu-timing-deferred-render")){let D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let S=this.painter.queryGpuTimeDeferredRender(D);this.fire(new i.b("gpu-timing-deferred-render",{gpuTime:S}))},50)}let E=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(E||this._repaint)this.triggerRepaint();else{let D=!this.isMoving()&&this.loaded();if(D&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new i.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let S=this._calculateSpeedIndex();this.fire(new i.b("speedindexcompleted",{speedIndex:S})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._performanceMetricsCollection&&i.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(let r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(let r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){let a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);let d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){let g=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=h;let w=Math.abs(g-v);if(w>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(v),a(v);this._averageElevation.easeTo(v,h,300)}else if(w>1e-4)return this._averageElevation.jumpTo(v),a(v)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){i.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===i.df||h.status===401)){let r=this.painter.context.gl;i.db(r,!1),this._logoControl instanceof ag&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){let h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let a=this.painter.context.gl,d=a.createFramebuffer();function g(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);let w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(g(h),r.canvasCopies.map(g),r.timeStamps)}_canvasPixelComparison(h,r,a){let d=a[1]-a[0],g=h.length/4;for(let v=0;v<r.length;v++){let w=r[v],E=0;for(let D=0;D<w.length;D+=4)w[D]===h[D]&&w[D+1]===h[D+1]&&w[D+2]===h[D+2]&&w[D+3]===h[D+3]&&(E+=1);d+=(a[v+2]-a[v+1])*(1-E/g)}return d}remove(){this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.dh(this.painter.context.gl),i.di.remove(),i.dj.remove(),this._removed=!0,this.fire(new i.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=i.f.frame(r=>{let a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(r)}))}_preloadTiles(h){let r=this.style?Object.values(this.style._sourceCaches):[];return i.b1(r,(a,d)=>a._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){i.dl(h,r)}get version(){return i.dk}},NavigationControl:class{constructor(h){this.options=i.e({},Qu,h),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{let a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:r}):a.resetNorth({},{originalEvent:r}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let h=this._map;if(!h)return;let r=h.getZoom(),a=r===h.getMaxZoom(),d=r===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){let h=this._map;if(!h)return;let r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qo(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){let h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){let a=se("button",h,this._container);return a.type="button",a.addEventListener("click",r),a}_setButtonTitle(h,r){if(!this._map)return;let a=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends i.E{constructor(h){super();let r=navigator.geolocation;this.options=i.e({geolocation:r},eh,h),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){let r=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>r(a.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){let r=this._map.getMaxBounds(),a=h.coords;return!!r&&(a.longitude<r.getWest()||a.longitude>r.getEast()||a.latitude<r.getSouth()||a.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new i.b("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.b("geolocate",h)),this._finish()}}_updateCamera(h){let r=new i.bn(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),g=i.e({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(a),g,{geolocateSource:!0})}_updateMarker(h){if(h){let r=new i.bn(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let h=this._map.transform,r=i.bl(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.b("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.b("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ff,ScaleControl:class{constructor(h){this.options=i.e({},hi,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let h=this.options.maxWidth||100,r=this._map,a=r._containerHeight/2,d=r._containerWidth/2-h/2,g=r.unproject([d,a]),v=r.unproject([d+h,a]),w=g.distanceTo(v);if(this.options.unit==="imperial"){let E=3.2808*w;E>5280?this._setScale(h,E/5280,"mile"):this._setScale(h,E,"foot")}else this.options.unit==="nautical"?this._setScale(h,w/1852,"nautical-mile"):w>=1e3?this._setScale(h,w/1e3,"kilometer"):this._setScale(h,w,"meter")}_setScale(h,r,a){this._map._requestDomTask(()=>{let d=function(v){let w=Math.pow(10,`${Math.floor(v)}`.length-1),E=v/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(D){let S=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*S)/S}(E),w*E}(r),g=d/r;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${js[a]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let h=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(h){super(),this.options=i.e(Object.create(cg),h),i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new i.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new i.b("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=i.bn.convert(h),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let r=document.createDocumentFragment(),a=document.createElement("body"),d;for(a.innerHTML=h;d=a.firstChild,d;)r.appendChild(d);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){let a=this._closeButton=se("button","mapboxgl-popup-close-button",r);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;let r=this._map,a=this._container,d=this._pos;if(!r||!a||!d)return"bottom";let g=a.offsetWidth,v=a.offsetHeight,w=d.x<g/2,E=d.x>r.transform.width-g/2;if(d.y+h<v)return w?"top-left":E?"top-right":"top";if(d.y>r.transform.height-v){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){let h=this._container;if(!h)return;let r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){let r=this._map,a=this._content;if(!r||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=se("div","mapboxgl-popup",r.getContainer()),this._tip=se("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zc(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){let g=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),v=hg(this.options.offset),w=this._anchor=this._getAnchor(v.y),E=hg(this.options.offset,w),D=g.add(E).round();r._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Ju[w]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&r._showingGlobe()){let g=i.d6(r.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(ug);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:zf,Style:_o,LngLat:i.bn,LngLatBounds:i.ad,Point:i.P,MercatorCoordinate:i.L,FreeCameraOptions:uc,Evented:i.E,config:i.d5,prewarm:i.dp,clearPrewarmedResources:i.dq,get accessToken(){return i.d5.ACCESS_TOKEN},set accessToken(h){i.d5.ACCESS_TOKEN=h},get baseApiUrl(){return i.d5.API_URL},set baseApiUrl(h){i.d5.API_URL=h},get workerCount(){return i.dr.workerCount},set workerCount(h){i.dr.workerCount=h},get maxParallelImageRequests(){return i.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){i.d5.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){i.ds(h)},get workerUrl(){return i.dt.workerUrl},set workerUrl(h){i.dt.workerUrl=h},get workerClass(){return i.dt.workerClass},set workerClass(h){i.dt.workerClass=h},get workerParams(){return i.dt.workerParams},set workerParams(h){i.dt.workerParams=h},get dracoUrl(){return i.du()},set dracoUrl(h){i.dv(h)},get meshoptUrl(){return i.dw()},set meshoptUrl(h){i.dx(h)},setNow:i.f.setNow,restoreNow:i.f.restoreNow}});var y=m;return y})});var $D=null;var ux=1,GD=Symbol("SIGNAL");function or(l){let s=$D;return $D=l,s}var HD={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function UO(l){if(!(fx(l)&&!l.dirty)&&!(!l.dirty&&l.lastCleanEpoch===ux)){if(!l.producerMustRecompute(l)&&!hx(l)){l.dirty=!1,l.lastCleanEpoch=ux;return}l.producerRecomputeValue(l),l.dirty=!1,l.lastCleanEpoch=ux}}function qD(l){return l&&(l.nextProducerIndex=0),or(l)}function WD(l,s){if(or(s),!(!l||l.producerNode===void 0||l.producerIndexOfThis===void 0||l.producerLastReadVersion===void 0)){if(fx(l))for(let m=l.nextProducerIndex;m<l.producerNode.length;m++)dx(l.producerNode[m],l.producerIndexOfThis[m]);for(;l.producerNode.length>l.nextProducerIndex;)l.producerNode.pop(),l.producerLastReadVersion.pop(),l.producerIndexOfThis.pop()}}function hx(l){h_(l);for(let s=0;s<l.producerNode.length;s++){let m=l.producerNode[s],p=l.producerLastReadVersion[s];if(p!==m.version||(UO(m),p!==m.version))return!0}return!1}function ZD(l){if(h_(l),fx(l))for(let s=0;s<l.producerNode.length;s++)dx(l.producerNode[s],l.producerIndexOfThis[s]);l.producerNode.length=l.producerLastReadVersion.length=l.producerIndexOfThis.length=0,l.liveConsumerNode&&(l.liveConsumerNode.length=l.liveConsumerIndexOfThis.length=0)}function dx(l,s){if($O(l),h_(l),l.liveConsumerNode.length===1)for(let p=0;p<l.producerNode.length;p++)dx(l.producerNode[p],l.producerIndexOfThis[p]);let m=l.liveConsumerNode.length-1;if(l.liveConsumerNode[s]=l.liveConsumerNode[m],l.liveConsumerIndexOfThis[s]=l.liveConsumerIndexOfThis[m],l.liveConsumerNode.length--,l.liveConsumerIndexOfThis.length--,s<l.liveConsumerNode.length){let p=l.liveConsumerIndexOfThis[s],y=l.liveConsumerNode[s];h_(y),y.producerIndexOfThis[p]=s}}function fx(l){return l.consumerIsAlwaysLive||(l?.liveConsumerNode?.length??0)>0}function h_(l){l.producerNode??=[],l.producerIndexOfThis??=[],l.producerLastReadVersion??=[]}function $O(l){l.liveConsumerNode??=[],l.liveConsumerIndexOfThis??=[]}function GO(){throw new Error}var HO=GO;function XD(l){HO=l}function An(l){return typeof l=="function"}function wh(l){let m=l(p=>{Error.call(p),p.stack=new Error().stack});return m.prototype=Object.create(Error.prototype),m.prototype.constructor=m,m}var d_=wh(l=>function(m){l(this),this.message=m?`${m.length} errors occurred during unsubscription:
${m.map((p,y)=>`${y+1}) ${p.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=m});function gp(l,s){if(l){let m=l.indexOf(s);0<=m&&l.splice(m,1)}}var ai=class l{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:m}=this;if(m)if(this._parentage=null,Array.isArray(m))for(let i of m)i.remove(this);else m.remove(this);let{initialTeardown:p}=this;if(An(p))try{p()}catch(i){s=i instanceof d_?i.errors:[i]}let{_finalizers:y}=this;if(y){this._finalizers=null;for(let i of y)try{YD(i)}catch(C){s=s??[],C instanceof d_?s=[...s,...C.errors]:s.push(C)}}if(s)throw new d_(s)}}add(s){var m;if(s&&s!==this)if(this.closed)YD(s);else{if(s instanceof l){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(m=this._finalizers)!==null&&m!==void 0?m:[]).push(s)}}_hasParent(s){let{_parentage:m}=this;return m===s||Array.isArray(m)&&m.includes(s)}_addParent(s){let{_parentage:m}=this;this._parentage=Array.isArray(m)?(m.push(s),m):m?[m,s]:s}_removeParent(s){let{_parentage:m}=this;m===s?this._parentage=null:Array.isArray(m)&&gp(m,s)}remove(s){let{_finalizers:m}=this;m&&gp(m,s),s instanceof l&&s._removeParent(this)}};ai.EMPTY=(()=>{let l=new ai;return l.closed=!0,l})();var px=ai.EMPTY;function f_(l){return l instanceof ai||l&&"closed"in l&&An(l.remove)&&An(l.add)&&An(l.unsubscribe)}function YD(l){An(l)?l():l.unsubscribe()}var cs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Th={setTimeout(l,s,...m){let{delegate:p}=Th;return p?.setTimeout?p.setTimeout(l,s,...m):setTimeout(l,s,...m)},clearTimeout(l){let{delegate:s}=Th;return(s?.clearTimeout||clearTimeout)(l)},delegate:void 0};function p_(l){Th.setTimeout(()=>{let{onUnhandledError:s}=cs;if(s)s(l);else throw l})}function _p(){}var KD=mx("C",void 0,void 0);function JD(l){return mx("E",void 0,l)}function QD(l){return mx("N",l,void 0)}function mx(l,s,m){return{kind:l,value:s,error:m}}var Kc=null;function Eh(l){if(cs.useDeprecatedSynchronousErrorHandling){let s=!Kc;if(s&&(Kc={errorThrown:!1,error:null}),l(),s){let{errorThrown:m,error:p}=Kc;if(Kc=null,m)throw p}}else l()}function eM(l){cs.useDeprecatedSynchronousErrorHandling&&Kc&&(Kc.errorThrown=!0,Kc.error=l)}var Jc=class extends ai{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,f_(s)&&s.add(this)):this.destination=ZO}static create(s,m,p){return new Ih(s,m,p)}next(s){this.isStopped?_x(QD(s),this):this._next(s)}error(s){this.isStopped?_x(JD(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?_x(KD,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},qO=Function.prototype.bind;function gx(l,s){return qO.call(l,s)}var yx=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:m}=this;if(m.next)try{m.next(s)}catch(p){m_(p)}}error(s){let{partialObserver:m}=this;if(m.error)try{m.error(s)}catch(p){m_(p)}else m_(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(m){m_(m)}}},Ih=class extends Jc{constructor(s,m,p){super();let y;if(An(s)||!s)y={next:s??void 0,error:m??void 0,complete:p??void 0};else{let i;this&&cs.useDeprecatedNextContext?(i=Object.create(s),i.unsubscribe=()=>this.unsubscribe(),y={next:s.next&&gx(s.next,i),error:s.error&&gx(s.error,i),complete:s.complete&&gx(s.complete,i)}):y=s}this.destination=new yx(y)}};function m_(l){cs.useDeprecatedSynchronousErrorHandling?eM(l):p_(l)}function WO(l){throw l}function _x(l,s){let{onStoppedNotification:m}=cs;m&&Th.setTimeout(()=>m(l,s))}var ZO={closed:!0,next:_p,error:WO,complete:_p};var Dh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Mo(l){return l}function vx(...l){return xx(l)}function xx(l){return l.length===0?Mo:l.length===1?l[0]:function(m){return l.reduce((p,y)=>y(p),m)}}var sr=(()=>{class l{constructor(m){m&&(this._subscribe=m)}lift(m){let p=new l;return p.source=this,p.operator=m,p}subscribe(m,p,y){let i=YO(m)?m:new Ih(m,p,y);return Eh(()=>{let{operator:C,source:O}=this;i.add(C?C.call(i,O):O?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(m){try{return this._subscribe(m)}catch(p){m.error(p)}}forEach(m,p){return p=tM(p),new p((y,i)=>{let C=new Ih({next:O=>{try{m(O)}catch(j){i(j),C.unsubscribe()}},error:i,complete:y});this.subscribe(C)})}_subscribe(m){var p;return(p=this.source)===null||p===void 0?void 0:p.subscribe(m)}[Dh](){return this}pipe(...m){return xx(m)(this)}toPromise(m){return m=tM(m),new m((p,y)=>{let i;this.subscribe(C=>i=C,C=>y(C),()=>p(i))})}}return l.create=s=>new l(s),l})();function tM(l){var s;return(s=l??cs.Promise)!==null&&s!==void 0?s:Promise}function XO(l){return l&&An(l.next)&&An(l.error)&&An(l.complete)}function YO(l){return l&&l instanceof Jc||XO(l)&&f_(l)}function bx(l){return An(l?.lift)}function Yn(l){return s=>{if(bx(s))return s.lift(function(m){try{return l(m,this)}catch(p){this.error(p)}});throw new TypeError("Unable to lift unknown Observable type")}}function Kn(l,s,m,p,y){return new wx(l,s,m,p,y)}var wx=class extends Jc{constructor(s,m,p,y,i,C){super(s),this.onFinalize=i,this.shouldUnsubscribe=C,this._next=m?function(O){try{m(O)}catch(j){s.error(j)}}:super._next,this._error=y?function(O){try{y(O)}catch(j){s.error(j)}finally{this.unsubscribe()}}:super._error,this._complete=p?function(){try{p()}catch(O){s.error(O)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:m}=this;super.unsubscribe(),!m&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function Mh(){return Yn((l,s)=>{let m=null;l._refCount++;let p=Kn(s,void 0,void 0,void 0,()=>{if(!l||l._refCount<=0||0<--l._refCount){m=null;return}let y=l._connection,i=m;m=null,y&&(!i||y===i)&&y.unsubscribe(),s.unsubscribe()});l.subscribe(p),p.closed||(m=l.connect())})}var Ch=class extends sr{constructor(s,m){super(),this.source=s,this.subjectFactory=m,this._subject=null,this._refCount=0,this._connection=null,bx(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new ai;let m=this.getSubject();s.add(this.source.subscribe(Kn(m,void 0,()=>{this._teardown(),m.complete()},p=>{this._teardown(),m.error(p)},()=>this._teardown()))),s.closed&&(this._connection=null,s=ai.EMPTY)}return s}refCount(){return Mh()(this)}};var nM=wh(l=>function(){l(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Hi=(()=>{class l extends sr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(m){let p=new g_(this,this);return p.operator=m,p}_throwIfClosed(){if(this.closed)throw new nM}next(m){Eh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let p of this.currentObservers)p.next(m)}})}error(m){Eh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=m;let{observers:p}=this;for(;p.length;)p.shift().error(m)}})}complete(){Eh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:m}=this;for(;m.length;)m.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var m;return((m=this.observers)===null||m===void 0?void 0:m.length)>0}_trySubscribe(m){return this._throwIfClosed(),super._trySubscribe(m)}_subscribe(m){return this._throwIfClosed(),this._checkFinalizedStatuses(m),this._innerSubscribe(m)}_innerSubscribe(m){let{hasError:p,isStopped:y,observers:i}=this;return p||y?px:(this.currentObservers=null,i.push(m),new ai(()=>{this.currentObservers=null,gp(i,m)}))}_checkFinalizedStatuses(m){let{hasError:p,thrownError:y,isStopped:i}=this;p?m.error(y):i&&m.complete()}asObservable(){let m=new sr;return m.source=this,m}}return l.create=(s,m)=>new g_(s,m),l})(),g_=class extends Hi{constructor(s,m){super(),this.destination=s,this.source=m}next(s){var m,p;(p=(m=this.destination)===null||m===void 0?void 0:m.next)===null||p===void 0||p.call(m,s)}error(s){var m,p;(p=(m=this.destination)===null||m===void 0?void 0:m.error)===null||p===void 0||p.call(m,s)}complete(){var s,m;(m=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||m===void 0||m.call(s)}_subscribe(s){var m,p;return(p=(m=this.source)===null||m===void 0?void 0:m.subscribe(s))!==null&&p!==void 0?p:px}};var Ti=class extends Hi{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let m=super._subscribe(s);return!m.closed&&s.next(this._value),m}getValue(){let{hasError:s,thrownError:m,_value:p}=this;if(s)throw m;return this._throwIfClosed(),p}next(s){super.next(this._value=s)}};var Co=new sr(l=>l.complete());function rM(l){return l&&An(l.schedule)}function iM(l){return l[l.length-1]}function oM(l){return An(iM(l))?l.pop():void 0}function Nl(l){return rM(iM(l))?l.pop():void 0}function aM(l,s,m,p){function y(i){return i instanceof m?i:new m(function(C){C(i)})}return new(m||(m=Promise))(function(i,C){function O(se){try{Z(p.next(se))}catch(ve){C(ve)}}function j(se){try{Z(p.throw(se))}catch(ve){C(ve)}}function Z(se){se.done?i(se.value):y(se.value).then(O,j)}Z((p=p.apply(l,s||[])).next())})}function sM(l){var s=typeof Symbol=="function"&&Symbol.iterator,m=s&&l[s],p=0;if(m)return m.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qc(l){return this instanceof Qc?(this.v=l,this):new Qc(l)}function lM(l,s,m){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var p=m.apply(l,s||[]),y,i=[];return y={},C("next"),C("throw"),C("return"),y[Symbol.asyncIterator]=function(){return this},y;function C(ze){p[ze]&&(y[ze]=function(at){return new Promise(function(Wt,Pn){i.push([ze,at,Wt,Pn])>1||O(ze,at)})})}function O(ze,at){try{j(p[ze](at))}catch(Wt){ve(i[0][3],Wt)}}function j(ze){ze.value instanceof Qc?Promise.resolve(ze.value.v).then(Z,se):ve(i[0][2],ze)}function Z(ze){O("next",ze)}function se(ze){O("throw",ze)}function ve(ze,at){ze(at),i.shift(),i.length&&O(i[0][0],i[0][1])}}function cM(l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=l[Symbol.asyncIterator],m;return s?s.call(l):(l=typeof sM=="function"?sM(l):l[Symbol.iterator](),m={},p("next"),p("throw"),p("return"),m[Symbol.asyncIterator]=function(){return this},m);function p(i){m[i]=l[i]&&function(C){return new Promise(function(O,j){C=l[i](C),y(O,j,C.done,C.value)})}}function y(i,C,O,j){Promise.resolve(j).then(function(Z){i({value:Z,done:O})},C)}}var __=l=>l&&typeof l.length=="number"&&typeof l!="function";function y_(l){return An(l?.then)}function v_(l){return An(l[Dh])}function x_(l){return Symbol.asyncIterator&&An(l?.[Symbol.asyncIterator])}function b_(l){return new TypeError(`You provided ${l!==null&&typeof l=="object"?"an invalid object":`'${l}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function KO(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var w_=KO();function T_(l){return An(l?.[w_])}function E_(l){return lM(this,arguments,function*(){let m=l.getReader();try{for(;;){let{value:p,done:y}=yield Qc(m.read());if(y)return yield Qc(void 0);yield yield Qc(p)}}finally{m.releaseLock()}})}function I_(l){return An(l?.getReader)}function fi(l){if(l instanceof sr)return l;if(l!=null){if(v_(l))return JO(l);if(__(l))return QO(l);if(y_(l))return eN(l);if(x_(l))return uM(l);if(T_(l))return tN(l);if(I_(l))return nN(l)}throw b_(l)}function JO(l){return new sr(s=>{let m=l[Dh]();if(An(m.subscribe))return m.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function QO(l){return new sr(s=>{for(let m=0;m<l.length&&!s.closed;m++)s.next(l[m]);s.complete()})}function eN(l){return new sr(s=>{l.then(m=>{s.closed||(s.next(m),s.complete())},m=>s.error(m)).then(null,p_)})}function tN(l){return new sr(s=>{for(let m of l)if(s.next(m),s.closed)return;s.complete()})}function uM(l){return new sr(s=>{rN(l,s).catch(m=>s.error(m))})}function nN(l){return uM(E_(l))}function rN(l,s){var m,p,y,i;return aM(this,void 0,void 0,function*(){try{for(m=cM(l);p=yield m.next(),!p.done;){let C=p.value;if(s.next(C),s.closed)return}}catch(C){y={error:C}}finally{try{p&&!p.done&&(i=m.return)&&(yield i.call(m))}finally{if(y)throw y.error}}s.complete()})}function lo(l,s,m,p=0,y=!1){let i=s.schedule(function(){m(),y?l.add(this.schedule(null,p)):this.unsubscribe()},p);if(l.add(i),!y)return i}function D_(l,s=0){return Yn((m,p)=>{m.subscribe(Kn(p,y=>lo(p,l,()=>p.next(y),s),()=>lo(p,l,()=>p.complete(),s),y=>lo(p,l,()=>p.error(y),s)))})}function M_(l,s=0){return Yn((m,p)=>{p.add(l.schedule(()=>m.subscribe(p),s))})}function hM(l,s){return fi(l).pipe(M_(s),D_(s))}function dM(l,s){return fi(l).pipe(M_(s),D_(s))}function fM(l,s){return new sr(m=>{let p=0;return s.schedule(function(){p===l.length?m.complete():(m.next(l[p++]),m.closed||this.schedule())})})}function pM(l,s){return new sr(m=>{let p;return lo(m,s,()=>{p=l[w_](),lo(m,s,()=>{let y,i;try{({value:y,done:i}=p.next())}catch(C){m.error(C);return}i?m.complete():m.next(y)},0,!0)}),()=>An(p?.return)&&p.return()})}function C_(l,s){if(!l)throw new Error("Iterable cannot be null");return new sr(m=>{lo(m,s,()=>{let p=l[Symbol.asyncIterator]();lo(m,s,()=>{p.next().then(y=>{y.done?m.complete():m.next(y.value)})},0,!0)})})}function mM(l,s){return C_(E_(l),s)}function gM(l,s){if(l!=null){if(v_(l))return hM(l,s);if(__(l))return fM(l,s);if(y_(l))return dM(l,s);if(x_(l))return C_(l,s);if(T_(l))return pM(l,s);if(I_(l))return mM(l,s)}throw b_(l)}function kr(l,s){return s?gM(l,s):fi(l)}function pn(...l){let s=Nl(l);return kr(l,s)}function Sh(l,s){let m=An(l)?l:()=>l,p=y=>y.error(m());return new sr(s?y=>s.schedule(p,0,y):p)}function Tx(l){return!!l&&(l instanceof sr||An(l.lift)&&An(l.subscribe))}var Ra=wh(l=>function(){l(this),this.name="EmptyError",this.message="no elements in sequence"});function kn(l,s){return Yn((m,p)=>{let y=0;m.subscribe(Kn(p,i=>{p.next(l.call(s,i,y++))}))})}var{isArray:iN}=Array;function oN(l,s){return iN(s)?l(...s):l(s)}function _M(l){return kn(s=>oN(l,s))}var{isArray:sN}=Array,{getPrototypeOf:aN,prototype:lN,keys:cN}=Object;function yM(l){if(l.length===1){let s=l[0];if(sN(s))return{args:s,keys:null};if(uN(s)){let m=cN(s);return{args:m.map(p=>s[p]),keys:m}}}return{args:l,keys:null}}function uN(l){return l&&typeof l=="object"&&aN(l)===lN}function vM(l,s){return l.reduce((m,p,y)=>(m[p]=s[y],m),{})}function yp(...l){let s=Nl(l),m=oM(l),{args:p,keys:y}=yM(l);if(p.length===0)return kr([],s);let i=new sr(hN(p,s,y?C=>vM(y,C):Mo));return m?i.pipe(_M(m)):i}function hN(l,s,m=Mo){return p=>{xM(s,()=>{let{length:y}=l,i=new Array(y),C=y,O=y;for(let j=0;j<y;j++)xM(s,()=>{let Z=kr(l[j],s),se=!1;Z.subscribe(Kn(p,ve=>{i[j]=ve,se||(se=!0,O--),O||p.next(m(i.slice()))},()=>{--C||p.complete()}))},p)},p)}}function xM(l,s,m){l?lo(m,l,s):s()}function bM(l,s,m,p,y,i,C,O){let j=[],Z=0,se=0,ve=!1,ze=()=>{ve&&!j.length&&!Z&&s.complete()},at=Pn=>Z<p?Wt(Pn):j.push(Pn),Wt=Pn=>{i&&s.next(Pn),Z++;let Zt=!1;fi(m(Pn,se++)).subscribe(Kn(s,Qt=>{y?.(Qt),i?at(Qt):s.next(Qt)},()=>{Zt=!0},void 0,()=>{if(Zt)try{for(Z--;j.length&&Z<p;){let Qt=j.shift();C?lo(s,C,()=>Wt(Qt)):Wt(Qt)}ze()}catch(Qt){s.error(Qt)}}))};return l.subscribe(Kn(s,at,()=>{ve=!0,ze()})),()=>{O?.()}}function ri(l,s,m=1/0){return An(s)?ri((p,y)=>kn((i,C)=>s(p,i,y,C))(fi(l(p,y))),m):(typeof s=="number"&&(m=s),Yn((p,y)=>bM(p,y,l,m)))}function Ah(l=1/0){return ri(Mo,l)}function wM(){return Ah(1)}function Ph(...l){return wM()(kr(l,Nl(l)))}function S_(l){return new sr(s=>{fi(l()).subscribe(s)})}function co(l,s){return Yn((m,p)=>{let y=0;m.subscribe(Kn(p,i=>l.call(s,i,y++)&&p.next(i)))})}function kl(l){return Yn((s,m)=>{let p=null,y=!1,i;p=s.subscribe(Kn(m,void 0,void 0,C=>{i=fi(l(C,kl(l)(s))),p?(p.unsubscribe(),p=null,i.subscribe(m)):y=!0})),y&&(p.unsubscribe(),p=null,i.subscribe(m))})}function TM(l,s,m,p,y){return(i,C)=>{let O=m,j=s,Z=0;i.subscribe(Kn(C,se=>{let ve=Z++;j=O?l(j,se,ve):(O=!0,se),p&&C.next(j)},y&&(()=>{O&&C.next(j),C.complete()})))}}function La(l,s){return An(s)?ri(l,s,1):ri(l,1)}function Fl(l){return Yn((s,m)=>{let p=!1;s.subscribe(Kn(m,y=>{p=!0,m.next(y)},()=>{p||m.next(l),m.complete()}))})}function Oa(l){return l<=0?()=>Co:Yn((s,m)=>{let p=0;s.subscribe(Kn(m,y=>{++p<=l&&(m.next(y),l<=p&&m.complete())}))})}function Ex(l){return kn(()=>l)}function A_(l=dN){return Yn((s,m)=>{let p=!1;s.subscribe(Kn(m,y=>{p=!0,m.next(y)},()=>p?m.complete():m.error(l())))})}function dN(){return new Ra}function zl(l){return Yn((s,m)=>{try{s.subscribe(m)}finally{m.add(l)}})}function qs(l,s){let m=arguments.length>=2;return p=>p.pipe(l?co((y,i)=>l(y,i,p)):Mo,Oa(1),m?Fl(s):A_(()=>new Ra))}function Rh(l){return l<=0?()=>Co:Yn((s,m)=>{let p=[];s.subscribe(Kn(m,y=>{p.push(y),l<p.length&&p.shift()},()=>{for(let y of p)m.next(y);m.complete()},void 0,()=>{p=null}))})}function Ix(l,s){let m=arguments.length>=2;return p=>p.pipe(l?co((y,i)=>l(y,i,p)):Mo,Rh(1),m?Fl(s):A_(()=>new Ra))}function Dx(l,s){return Yn(TM(l,s,arguments.length>=2,!0))}function Mx(...l){let s=Nl(l);return Yn((m,p)=>{(s?Ph(l,m,s):Ph(l,m)).subscribe(p)})}function uo(l,s){return Yn((m,p)=>{let y=null,i=0,C=!1,O=()=>C&&!y&&p.complete();m.subscribe(Kn(p,j=>{y?.unsubscribe();let Z=0,se=i++;fi(l(j,se)).subscribe(y=Kn(p,ve=>p.next(s?s(j,ve,se,Z++):ve),()=>{y=null,O()}))},()=>{C=!0,O()}))})}function Cx(l){return Yn((s,m)=>{fi(l).subscribe(Kn(m,()=>m.complete(),_p)),!m.closed&&s.subscribe(m)})}function pi(l,s,m){let p=An(l)||s||m?{next:l,error:s,complete:m}:l;return p?Yn((y,i)=>{var C;(C=p.subscribe)===null||C===void 0||C.call(p);let O=!0;y.subscribe(Kn(i,j=>{var Z;(Z=p.next)===null||Z===void 0||Z.call(p,j),i.next(j)},()=>{var j;O=!1,(j=p.complete)===null||j===void 0||j.call(p),i.complete()},j=>{var Z;O=!1,(Z=p.error)===null||Z===void 0||Z.call(p,j),i.error(j)},()=>{var j,Z;O&&((j=p.unsubscribe)===null||j===void 0||j.call(p)),(Z=p.finalize)===null||Z===void 0||Z.call(p)}))}):Mo}var fN="https://g.co/ng/security#xss",rn=class extends Error{constructor(s,m){super(sy(s,m)),this.code=s}};function sy(l,s){return`${`NG0${Math.abs(l)}`}${s?": "+s:""}`}function Rp(l){return{toString:l}.toString()}var P_="__parameters__";function pN(l){return function(...m){if(l){let p=l(...m);for(let y in p)this[y]=p[y]}}}function lC(l,s,m){return Rp(()=>{let p=pN(s);function y(...i){if(this instanceof y)return p.apply(this,i),this;let C=new y(...i);return O.annotation=C,O;function O(j,Z,se){let ve=j.hasOwnProperty(P_)?j[P_]:Object.defineProperty(j,P_,{value:[]})[P_];for(;ve.length<=se;)ve.push(null);return(ve[se]=ve[se]||[]).push(C),j}}return m&&(y.prototype=Object.create(m.prototype)),y.prototype.ngMetadataName=l,y.annotationCls=y,y})}var So=globalThis;function wr(l){for(let s in l)if(l[s]===wr)return s;throw Error("Could not find renamed property on target object.")}function qi(l){if(typeof l=="string")return l;if(Array.isArray(l))return"["+l.map(qi).join(", ")+"]";if(l==null)return""+l;if(l.overriddenName)return`${l.overriddenName}`;if(l.name)return`${l.name}`;let s=l.toString();if(s==null)return""+s;let m=s.indexOf(`
`);return m===-1?s:s.substring(0,m)}function EM(l,s){return l==null||l===""?s===null?"":s:s==null||s===""?l:l+" "+s}var mN=wr({__forward_ref__:wr});function cC(l){return l.__forward_ref__=cC,l.toString=function(){return qi(this())},l}function jo(l){return uC(l)?l():l}function uC(l){return typeof l=="function"&&l.hasOwnProperty(mN)&&l.__forward_ref__===cC}function Ft(l){return{token:l.token,providedIn:l.providedIn||null,factory:l.factory,value:void 0}}function Zi(l){return{providers:l.providers||[],imports:l.imports||[]}}function ay(l){return IM(l,dC)||IM(l,fC)}function hC(l){return ay(l)!==null}function IM(l,s){return l.hasOwnProperty(s)?l[s]:null}function gN(l){let s=l&&(l[dC]||l[fC]);return s||null}function DM(l){return l&&(l.hasOwnProperty(MM)||l.hasOwnProperty(_N))?l[MM]:null}var dC=wr({\u0275prov:wr}),MM=wr({\u0275inj:wr}),fC=wr({ngInjectableDef:wr}),_N=wr({ngInjectorDef:wr}),sn=class{constructor(s,m){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof m=="number"?this.__NG_ELEMENT_ID__=m:m!==void 0&&(this.\u0275prov=Ft({token:this,providedIn:m.providedIn||"root",factory:m.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function pC(l){return l&&!!l.\u0275providers}var yN=wr({\u0275cmp:wr}),vN=wr({\u0275dir:wr}),xN=wr({\u0275pipe:wr}),bN=wr({\u0275mod:wr}),j_=wr({\u0275fac:wr}),vp=wr({__NG_ELEMENT_ID__:wr}),CM=wr({__NG_ENV_ID__:wr});function mC(l){return typeof l=="string"?l:l==null?"":String(l)}function wN(l){return typeof l=="function"?l.name||l.toString():typeof l=="object"&&l!=null&&typeof l.type=="function"?l.type.name||l.type.toString():mC(l)}function TN(l,s){let m=s?`. Dependency path: ${s.join(" > ")} > ${l}`:"";throw new rn(-200,l)}function O1(l,s){throw new rn(-201,!1)}var Bn=function(l){return l[l.Default=0]="Default",l[l.Host=1]="Host",l[l.Self=2]="Self",l[l.SkipSelf=4]="SkipSelf",l[l.Optional=8]="Optional",l}(Bn||{}),Vx;function gC(){return Vx}function Bo(l){let s=Vx;return Vx=l,s}function _C(l,s,m){let p=ay(l);if(p&&p.providedIn=="root")return p.value===void 0?p.value=p.factory():p.value;if(m&Bn.Optional)return null;if(s!==void 0)return s;O1(l,"Injector")}var EN={},bp=EN,Ux="__NG_DI_FLAG__",V_="ngTempTokenPath",IN="ngTokenPath",DN=/\n/gm,MN="\u0275",SM="__source",Fh;function CN(){return Fh}function Bl(l){let s=Fh;return Fh=l,s}function SN(l,s=Bn.Default){if(Fh===void 0)throw new rn(-203,!1);return Fh===null?_C(l,void 0,s):Fh.get(l,s&Bn.Optional?null:void 0,s)}function Nt(l,s=Bn.Default){return(gC()||SN)(jo(l),s)}function Tt(l,s=Bn.Default){return Nt(l,ly(s))}function ly(l){return typeof l>"u"||typeof l=="number"?l:0|(l.optional&&8)|(l.host&&1)|(l.self&&2)|(l.skipSelf&&4)}function $x(l){let s=[];for(let m=0;m<l.length;m++){let p=jo(l[m]);if(Array.isArray(p)){if(p.length===0)throw new rn(900,!1);let y,i=Bn.Default;for(let C=0;C<p.length;C++){let O=p[C],j=AN(O);typeof j=="number"?j===-1?y=O.token:i|=j:y=O}s.push(Nt(y,i))}else s.push(Nt(p))}return s}function yC(l,s){return l[Ux]=s,l.prototype[Ux]=s,l}function AN(l){return l[Ux]}function PN(l,s,m,p){let y=l[V_];throw s[SM]&&y.unshift(s[SM]),l.message=RN(`
`+l.message,y,m,p),l[IN]=y,l[V_]=null,l}function RN(l,s,m,p=null){l=l&&l.charAt(0)===`
`&&l.charAt(1)==MN?l.slice(2):l;let y=qi(s);if(Array.isArray(s))y=s.map(qi).join(" -> ");else if(typeof s=="object"){let i=[];for(let C in s)if(s.hasOwnProperty(C)){let O=s[C];i.push(C+":"+(typeof O=="string"?JSON.stringify(O):qi(O)))}y=`{${i.join(", ")}}`}return`${m}${p?"("+p+")":""}[${y}]: ${l.replace(DN,`
  `)}`}var cy=yC(lC("Optional"),8);var N1=yC(lC("SkipSelf"),4);function Bh(l,s){let m=l.hasOwnProperty(j_);return m?l[j_]:null}function LN(l,s,m){if(l.length!==s.length)return!1;for(let p=0;p<l.length;p++){let y=l[p],i=s[p];if(m&&(y=m(y),i=m(i)),i!==y)return!1}return!0}function ON(l){return l.flat(Number.POSITIVE_INFINITY)}function k1(l,s){l.forEach(m=>Array.isArray(m)?k1(m,s):s(m))}function vC(l,s,m){s>=l.length?l.push(m):l.splice(s,0,m)}function U_(l,s){return s>=l.length-1?l.pop():l.splice(s,1)[0]}function NN(l,s,m,p){let y=l.length;if(y==s)l.push(m,p);else if(y===1)l.push(p,l[0]),l[0]=m;else{for(y--,l.push(l[y-1],l[y]);y>s;){let i=y-2;l[y]=l[i],y--}l[s]=m,l[s+1]=p}}function kN(l,s,m){let p=Lp(l,s);return p>=0?l[p|1]=m:(p=~p,NN(l,p,s,m)),p}function Sx(l,s){let m=Lp(l,s);if(m>=0)return l[m|1]}function Lp(l,s){return FN(l,s,1)}function FN(l,s,m){let p=0,y=l.length>>m;for(;y!==p;){let i=p+(y-p>>1),C=l[i<<m];if(s===C)return i<<m;C>s?y=i:p=i+1}return~(y<<m)}var wp={},hs=[],jh=new sn(""),xC=new sn("",-1),bC=new sn(""),$_=class{get(s,m=bp){if(m===bp){let p=new Error(`NullInjectorError: No provider for ${qi(s)}!`);throw p.name="NullInjectorError",p}return m}},wC=function(l){return l[l.OnPush=0]="OnPush",l[l.Default=1]="Default",l}(wC||{}),Xs=function(l){return l[l.Emulated=0]="Emulated",l[l.None=2]="None",l[l.ShadowDom=3]="ShadowDom",l}(Xs||{}),Na=function(l){return l[l.None=0]="None",l[l.SignalBased=1]="SignalBased",l[l.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",l}(Na||{});function zN(l,s,m){let p=l.length;for(;;){let y=l.indexOf(s,m);if(y===-1)return y;if(y===0||l.charCodeAt(y-1)<=32){let i=s.length;if(y+i===p||l.charCodeAt(y+i)<=32)return y}m=y+1}}function Gx(l,s,m){let p=0;for(;p<m.length;){let y=m[p];if(typeof y=="number"){if(y!==0)break;p++;let i=m[p++],C=m[p++],O=m[p++];l.setAttribute(s,C,O,i)}else{let i=y,C=m[++p];jN(i)?l.setProperty(s,i,C):l.setAttribute(s,i,C),p++}}return p}function BN(l){return l===3||l===4||l===6}function jN(l){return l.charCodeAt(0)===64}function F1(l,s){if(!(s===null||s.length===0))if(l===null||l.length===0)l=s.slice();else{let m=-1;for(let p=0;p<s.length;p++){let y=s[p];typeof y=="number"?m=y:m===0||(m===-1||m===2?AM(l,m,y,null,s[++p]):AM(l,m,y,null,null))}}return l}function AM(l,s,m,p,y){let i=0,C=l.length;if(s===-1)C=-1;else for(;i<l.length;){let O=l[i++];if(typeof O=="number"){if(O===s){C=-1;break}else if(O>s){C=i-1;break}}}for(;i<l.length;){let O=l[i];if(typeof O=="number")break;if(O===m){if(p===null){y!==null&&(l[i+1]=y);return}else if(p===l[i+1]){l[i+2]=y;return}}i++,p!==null&&i++,y!==null&&i++}C!==-1&&(l.splice(C,0,s),i=C+1),l.splice(i++,0,m),p!==null&&l.splice(i++,0,p),y!==null&&l.splice(i++,0,y)}var TC="ng-template";function VN(l,s,m,p){let y=0;if(p){for(;y<s.length&&typeof s[y]=="string";y+=2)if(s[y]==="class"&&zN(s[y+1].toLowerCase(),m,0)!==-1)return!0}else if(z1(l))return!1;if(y=s.indexOf(1,y),y>-1){let i;for(;++y<s.length&&typeof(i=s[y])=="string";)if(i.toLowerCase()===m)return!0}return!1}function z1(l){return l.type===4&&l.value!==TC}function UN(l,s,m){let p=l.type===4&&!m?TC:l.value;return s===p}function $N(l,s,m){let p=4,y=l.attrs,i=y!==null?qN(y):0,C=!1;for(let O=0;O<s.length;O++){let j=s[O];if(typeof j=="number"){if(!C&&!us(p)&&!us(j))return!1;if(C&&us(j))continue;C=!1,p=j|p&1;continue}if(!C)if(p&4){if(p=2|p&1,j!==""&&!UN(l,j,m)||j===""&&s.length===1){if(us(p))return!1;C=!0}}else if(p&8){if(y===null||!VN(l,y,j,m)){if(us(p))return!1;C=!0}}else{let Z=s[++O],se=GN(j,y,z1(l),m);if(se===-1){if(us(p))return!1;C=!0;continue}if(Z!==""){let ve;if(se>i?ve="":ve=y[se+1].toLowerCase(),p&2&&Z!==ve){if(us(p))return!1;C=!0}}}}return us(p)||C}function us(l){return(l&1)===0}function GN(l,s,m,p){if(s===null)return-1;let y=0;if(p||!m){let i=!1;for(;y<s.length;){let C=s[y];if(C===l)return y;if(C===3||C===6)i=!0;else if(C===1||C===2){let O=s[++y];for(;typeof O=="string";)O=s[++y];continue}else{if(C===4)break;if(C===0){y+=4;continue}}y+=i?1:2}return-1}else return WN(s,l)}function HN(l,s,m=!1){for(let p=0;p<s.length;p++)if($N(l,s[p],m))return!0;return!1}function qN(l){for(let s=0;s<l.length;s++){let m=l[s];if(BN(m))return s}return l.length}function WN(l,s){let m=l.indexOf(4);if(m>-1)for(m++;m<l.length;){let p=l[m];if(typeof p=="number")return-1;if(p===s)return m;m++}return-1}function PM(l,s){return l?":not("+s.trim()+")":s}function ZN(l){let s=l[0],m=1,p=2,y="",i=!1;for(;m<l.length;){let C=l[m];if(typeof C=="string")if(p&2){let O=l[++m];y+="["+C+(O.length>0?'="'+O+'"':"")+"]"}else p&8?y+="."+C:p&4&&(y+=" "+C);else y!==""&&!us(C)&&(s+=PM(i,y),y=""),p=C,i=i||!us(p);m++}return y!==""&&(s+=PM(i,y)),s}function XN(l){return l.map(ZN).join(",")}function YN(l){let s=[],m=[],p=1,y=2;for(;p<l.length;){let i=l[p];if(typeof i=="string")y===2?i!==""&&s.push(i,l[++p]):y===8&&m.push(i);else{if(!us(y))break;y=i}p++}return{attrs:s,classes:m}}function mi(l){return Rp(()=>{let s=CC(l),m=Gr(Pt({},s),{decls:l.decls,vars:l.vars,template:l.template,consts:l.consts||null,ngContentSelectors:l.ngContentSelectors,onPush:l.changeDetection===wC.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&l.dependencies||null,getStandaloneInjector:null,signals:l.signals??!1,data:l.data||{},encapsulation:l.encapsulation||Xs.Emulated,styles:l.styles||hs,_:null,schemas:l.schemas||null,tView:null,id:""});SC(m);let p=l.dependencies;return m.directiveDefs=LM(p,!1),m.pipeDefs=LM(p,!0),m.id=QN(m),m})}function KN(l){return Vl(l)||EC(l)}function JN(l){return l!==null}function Xi(l){return Rp(()=>({type:l.type,bootstrap:l.bootstrap||hs,declarations:l.declarations||hs,imports:l.imports||hs,exports:l.exports||hs,transitiveCompileScopes:null,schemas:l.schemas||null,id:l.id||null}))}function RM(l,s){if(l==null)return wp;let m={};for(let p in l)if(l.hasOwnProperty(p)){let y=l[p],i,C,O=Na.None;Array.isArray(y)?(O=y[0],i=y[1],C=y[2]??i):(i=y,C=y),s?(m[i]=O!==Na.None?[p,O]:p,s[i]=C):m[i]=p}return m}function qh(l){return Rp(()=>{let s=CC(l);return SC(s),s})}function Vl(l){return l[yN]||null}function EC(l){return l[vN]||null}function IC(l){return l[xN]||null}function DC(l){let s=Vl(l)||EC(l)||IC(l);return s!==null?s.standalone:!1}function MC(l,s){let m=l[bN]||null;if(!m&&s===!0)throw new Error(`Type ${qi(l)} does not have '\u0275mod' property.`);return m}function CC(l){let s={};return{type:l.type,providersResolver:null,factory:null,hostBindings:l.hostBindings||null,hostVars:l.hostVars||0,hostAttrs:l.hostAttrs||null,contentQueries:l.contentQueries||null,declaredInputs:s,inputTransforms:null,inputConfig:l.inputs||wp,exportAs:l.exportAs||null,standalone:l.standalone===!0,signals:l.signals===!0,selectors:l.selectors||hs,viewQuery:l.viewQuery||null,features:l.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:RM(l.inputs,s),outputs:RM(l.outputs),debugInfo:null}}function SC(l){l.features?.forEach(s=>s(l))}function LM(l,s){if(!l)return null;let m=s?IC:KN;return()=>(typeof l=="function"?l():l).map(p=>m(p)).filter(JN)}function QN(l){let s=0,m=[l.selectors,l.ngContentSelectors,l.hostVars,l.hostAttrs,l.consts,l.vars,l.decls,l.encapsulation,l.standalone,l.signals,l.exportAs,JSON.stringify(l.inputs),JSON.stringify(l.outputs),Object.getOwnPropertyNames(l.type.prototype),!!l.contentQueries,!!l.viewQuery].join("|");for(let y of m)s=Math.imul(31,s)+y.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function uy(l){return{\u0275providers:l}}function ek(...l){return{\u0275providers:AC(!0,l),\u0275fromNgModule:!0}}function AC(l,...s){let m=[],p=new Set,y,i=C=>{m.push(C)};return k1(s,C=>{let O=C;Hx(O,i,[],p)&&(y||=[],y.push(O))}),y!==void 0&&PC(y,i),m}function PC(l,s){for(let m=0;m<l.length;m++){let{ngModule:p,providers:y}=l[m];B1(y,i=>{s(i,p)})}}function Hx(l,s,m,p){if(l=jo(l),!l)return!1;let y=null,i=DM(l),C=!i&&Vl(l);if(!i&&!C){let j=l.ngModule;if(i=DM(j),i)y=j;else return!1}else{if(C&&!C.standalone)return!1;y=l}let O=p.has(y);if(C){if(O)return!1;if(p.add(y),C.dependencies){let j=typeof C.dependencies=="function"?C.dependencies():C.dependencies;for(let Z of j)Hx(Z,s,m,p)}}else if(i){if(i.imports!=null&&!O){p.add(y);let Z;try{k1(i.imports,se=>{Hx(se,s,m,p)&&(Z||=[],Z.push(se))})}finally{}Z!==void 0&&PC(Z,s)}if(!O){let Z=Bh(y)||(()=>new y);s({provide:y,useFactory:Z,deps:hs},y),s({provide:bC,useValue:y,multi:!0},y),s({provide:jh,useValue:()=>Nt(y),multi:!0},y)}let j=i.providers;if(j!=null&&!O){let Z=l;B1(j,se=>{s(se,Z)})}}else return!1;return y!==l&&l.providers!==void 0}function B1(l,s){for(let m of l)pC(m)&&(m=m.\u0275providers),Array.isArray(m)?B1(m,s):s(m)}var tk=wr({provide:String,useValue:wr});function RC(l){return l!==null&&typeof l=="object"&&tk in l}function nk(l){return!!(l&&l.useExisting)}function rk(l){return!!(l&&l.useFactory)}function qx(l){return typeof l=="function"}var hy=new sn(""),O_={},ik={},Ax;function j1(){return Ax===void 0&&(Ax=new $_),Ax}var Wi=class{},Tp=class extends Wi{get destroyed(){return this._destroyed}constructor(s,m,p,y){super(),this.parent=m,this.source=p,this.scopes=y,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Zx(s,C=>this.processProvider(C)),this.records.set(xC,Lh(void 0,this)),y.has("environment")&&this.records.set(Wi,Lh(void 0,this));let i=this.records.get(hy);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(bC,hs,Bn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let s=or(null);try{for(let p of this._ngOnDestroyHooks)p.ngOnDestroy();let m=this._onDestroyHooks;this._onDestroyHooks=[];for(let p of m)p()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),or(s)}}onDestroy(s){return this.assertNotDestroyed(),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){this.assertNotDestroyed();let m=Bl(this),p=Bo(void 0),y;try{return s()}finally{Bl(m),Bo(p)}}get(s,m=bp,p=Bn.Default){if(this.assertNotDestroyed(),s.hasOwnProperty(CM))return s[CM](this);p=ly(p);let y,i=Bl(this),C=Bo(void 0);try{if(!(p&Bn.SkipSelf)){let j=this.records.get(s);if(j===void 0){let Z=uk(s)&&ay(s);Z&&this.injectableDefInScope(Z)?j=Lh(Wx(s),O_):j=null,this.records.set(s,j)}if(j!=null)return this.hydrate(s,j)}let O=p&Bn.Self?j1():this.parent;return m=p&Bn.Optional&&m===bp?null:m,O.get(s,m)}catch(O){if(O.name==="NullInjectorError"){if((O[V_]=O[V_]||[]).unshift(qi(s)),i)throw O;return PN(O,s,"R3InjectorError",this.source)}else throw O}finally{Bo(C),Bl(i)}}resolveInjectorInitializers(){let s=or(null),m=Bl(this),p=Bo(void 0),y;try{let i=this.get(jh,hs,Bn.Self);for(let C of i)C()}finally{Bl(m),Bo(p),or(s)}}toString(){let s=[],m=this.records;for(let p of m.keys())s.push(qi(p));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new rn(205,!1)}processProvider(s){s=jo(s);let m=qx(s)?s:jo(s&&s.provide),p=sk(s);if(!qx(s)&&s.multi===!0){let y=this.records.get(m);y||(y=Lh(void 0,O_,!0),y.factory=()=>$x(y.multi),this.records.set(m,y)),m=s,y.multi.push(s)}this.records.set(m,p)}hydrate(s,m){let p=or(null);try{return m.value===O_&&(m.value=ik,m.value=m.factory()),typeof m.value=="object"&&m.value&&ck(m.value)&&this._ngOnDestroyHooks.add(m.value),m.value}finally{or(p)}}injectableDefInScope(s){if(!s.providedIn)return!1;let m=jo(s.providedIn);return typeof m=="string"?m==="any"||this.scopes.has(m):this.injectorDefTypes.has(m)}removeOnDestroy(s){let m=this._onDestroyHooks.indexOf(s);m!==-1&&this._onDestroyHooks.splice(m,1)}};function Wx(l){let s=ay(l),m=s!==null?s.factory:Bh(l);if(m!==null)return m;if(l instanceof sn)throw new rn(204,!1);if(l instanceof Function)return ok(l);throw new rn(204,!1)}function ok(l){if(l.length>0)throw new rn(204,!1);let m=gN(l);return m!==null?()=>m.factory(l):()=>new l}function sk(l){if(RC(l))return Lh(void 0,l.useValue);{let s=ak(l);return Lh(s,O_)}}function ak(l,s,m){let p;if(qx(l)){let y=jo(l);return Bh(y)||Wx(y)}else if(RC(l))p=()=>jo(l.useValue);else if(rk(l))p=()=>l.useFactory(...$x(l.deps||[]));else if(nk(l))p=()=>Nt(jo(l.useExisting));else{let y=jo(l&&(l.useClass||l.provide));if(lk(l))p=()=>new y(...$x(l.deps));else return Bh(y)||Wx(y)}return p}function Lh(l,s,m=!1){return{factory:l,value:s,multi:m?[]:void 0}}function lk(l){return!!l.deps}function ck(l){return l!==null&&typeof l=="object"&&typeof l.ngOnDestroy=="function"}function uk(l){return typeof l=="function"||typeof l=="object"&&l instanceof sn}function Zx(l,s){for(let m of l)Array.isArray(m)?Zx(m,s):m&&pC(m)?Zx(m.\u0275providers,s):s(m)}function ps(l,s){l instanceof Tp&&l.assertNotDestroyed();let m,p=Bl(l),y=Bo(void 0);try{return s()}finally{Bl(p),Bo(y)}}function LC(){return gC()!==void 0||CN()!=null}function hk(l){if(!LC())throw new rn(-203,!1)}function dk(l){let s=So.ng;if(s&&s.\u0275compilerFacade)return s.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function fk(l){return typeof l=="function"}var Ba=0,jn=1,bn=2,Ei=3,ds=4,ms=5,G_=6,Ep=7,fs=8,Vh=9,Ys=10,Fi=11,Ip=12,OM=13,Wh=14,Ks=15,Op=16,Oh=17,ka=18,dy=19,OC=20,jl=21,Px=22,nu=23,Fa=25,NC=1;var ru=7,H_=8,Uh=9,Ao=10,V1=function(l){return l[l.None=0]="None",l[l.HasTransplantedViews=2]="HasTransplantedViews",l}(V1||{});function eu(l){return Array.isArray(l)&&typeof l[NC]=="object"}function ja(l){return Array.isArray(l)&&l[NC]===!0}function kC(l){return(l.flags&4)!==0}function fy(l){return l.componentOffset>-1}function U1(l){return(l.flags&1)===1}function Np(l){return!!l.template}function pk(l){return(l[bn]&512)!==0}var Xx=class{constructor(s,m,p){this.previousValue=s,this.currentValue=m,this.firstChange=p}isFirstChange(){return this.firstChange}};function FC(l,s,m,p){s!==null?s.applyValueToInputSignal(s,p):l[m]=p}function py(){return zC}function zC(l){return l.type.prototype.ngOnChanges&&(l.setInput=gk),mk}py.ngInherit=!0;function mk(){let l=jC(this),s=l?.current;if(s){let m=l.previous;if(m===wp)l.previous=s;else for(let p in s)m[p]=s[p];l.current=null,this.ngOnChanges(s)}}function gk(l,s,m,p,y){let i=this.declaredInputs[p],C=jC(l)||_k(l,{previous:wp,current:null}),O=C.current||(C.current={}),j=C.previous,Z=j[i];O[i]=new Xx(Z&&Z.currentValue,m,j===wp),FC(l,s,y,m)}var BC="__ngSimpleChanges__";function jC(l){return l[BC]||null}function _k(l,s){return l[BC]=s}var NM=null;var Ws=function(l,s,m){NM?.(l,s,m)},yk="svg",vk="math",xk=!1;function bk(){return xk}function Js(l){for(;Array.isArray(l);)l=l[Ba];return l}function VC(l,s){return Js(s[l])}function gs(l,s){return Js(s[l.index])}function UC(l,s){return l.data[s]}function wk(l,s){return l[s]}function $l(l,s){let m=s[l];return eu(m)?m:m[Ba]}function Tk(l){return(l[bn]&4)===4}function $1(l){return(l[bn]&128)===128}function Ek(l){return ja(l[Ei])}function q_(l,s){return s==null?null:l[s]}function $C(l){l[Oh]=0}function Ik(l){l[bn]&1024||(l[bn]|=1024,$1(l)&&Dp(l))}function Dk(l,s){for(;l>0;)s=s[Wh],l--;return s}function G1(l){return!!(l[bn]&9216||l[nu]?.dirty)}function Yx(l){l[Ys].changeDetectionScheduler?.notify(1),G1(l)?Dp(l):l[bn]&64&&(bk()?(l[bn]|=1024,Dp(l)):l[Ys].changeDetectionScheduler?.notify())}function Dp(l){l[Ys].changeDetectionScheduler?.notify();let s=Mp(l);for(;s!==null&&!(s[bn]&8192||(s[bn]|=8192,!$1(s)));)s=Mp(s)}function GC(l,s){if((l[bn]&256)===256)throw new rn(911,!1);l[jl]===null&&(l[jl]=[]),l[jl].push(s)}function Mk(l,s){if(l[jl]===null)return;let m=l[jl].indexOf(s);m!==-1&&l[jl].splice(m,1)}function Mp(l){let s=l[Ei];return ja(s)?s[Ei]:s}var Vn={lFrame:JC(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Ck(){return Vn.lFrame.elementDepthCount}function Sk(){Vn.lFrame.elementDepthCount++}function Ak(){Vn.lFrame.elementDepthCount--}function HC(){return Vn.bindingsEnabled}function Pk(){return Vn.skipHydrationRootTNode!==null}function Rk(l){return Vn.skipHydrationRootTNode===l}function Lk(){Vn.skipHydrationRootTNode=null}function Fr(){return Vn.lFrame.lView}function ea(){return Vn.lFrame.tView}function kp(l){return Vn.lFrame.contextLView=l,l[fs]}function Fp(l){return Vn.lFrame.contextLView=null,l}function _s(){let l=qC();for(;l!==null&&l.type===64;)l=l.parent;return l}function qC(){return Vn.lFrame.currentTNode}function Ok(){let l=Vn.lFrame,s=l.currentTNode;return l.isParent?s:s.parent}function zp(l,s){let m=Vn.lFrame;m.currentTNode=l,m.isParent=s}function WC(){return Vn.lFrame.isParent}function Nk(){Vn.lFrame.isParent=!1}function kk(){return Vn.lFrame.contextLView}function Fk(l){return Vn.lFrame.bindingIndex=l}function ZC(){return Vn.lFrame.bindingIndex++}function zk(l){let s=Vn.lFrame,m=s.bindingIndex;return s.bindingIndex=s.bindingIndex+l,m}function Bk(){return Vn.lFrame.inI18n}function jk(l,s){let m=Vn.lFrame;m.bindingIndex=m.bindingRootIndex=l,Kx(s)}function Vk(){return Vn.lFrame.currentDirectiveIndex}function Kx(l){Vn.lFrame.currentDirectiveIndex=l}function Uk(l){let s=Vn.lFrame.currentDirectiveIndex;return s===-1?null:l[s]}function XC(){return Vn.lFrame.currentQueryIndex}function H1(l){Vn.lFrame.currentQueryIndex=l}function $k(l){let s=l[jn];return s.type===2?s.declTNode:s.type===1?l[ms]:null}function YC(l,s,m){if(m&Bn.SkipSelf){let y=s,i=l;for(;y=y.parent,y===null&&!(m&Bn.Host);)if(y=$k(i),y===null||(i=i[Wh],y.type&10))break;if(y===null)return!1;s=y,l=i}let p=Vn.lFrame=KC();return p.currentTNode=s,p.lView=l,!0}function q1(l){let s=KC(),m=l[jn];Vn.lFrame=s,s.currentTNode=m.firstChild,s.lView=l,s.tView=m,s.contextLView=l,s.bindingIndex=m.bindingStartIndex,s.inI18n=!1}function KC(){let l=Vn.lFrame,s=l===null?null:l.child;return s===null?JC(l):s}function JC(l){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:l,child:null,inI18n:!1};return l!==null&&(l.child=s),s}function QC(){let l=Vn.lFrame;return Vn.lFrame=l.parent,l.currentTNode=null,l.lView=null,l}var eS=QC;function W1(){let l=QC();l.isParent=!0,l.tView=null,l.selectedIndex=-1,l.contextLView=null,l.elementDepthCount=0,l.currentDirectiveIndex=-1,l.currentNamespace=null,l.bindingRootIndex=-1,l.bindingIndex=-1,l.currentQueryIndex=0}function Gk(l){return(Vn.lFrame.contextLView=Dk(l,Vn.lFrame.contextLView))[fs]}function Zh(){return Vn.lFrame.selectedIndex}function iu(l){Vn.lFrame.selectedIndex=l}function Hk(){let l=Vn.lFrame;return UC(l.tView,l.selectedIndex)}function qk(){return Vn.lFrame.currentNamespace}var tS=!0;function Z1(){return tS}function X1(l){tS=l}function Wk(l,s,m){let{ngOnChanges:p,ngOnInit:y,ngDoCheck:i}=s.type.prototype;if(p){let C=zC(s);(m.preOrderHooks??=[]).push(l,C),(m.preOrderCheckHooks??=[]).push(l,C)}y&&(m.preOrderHooks??=[]).push(0-l,y),i&&((m.preOrderHooks??=[]).push(l,i),(m.preOrderCheckHooks??=[]).push(l,i))}function Y1(l,s){for(let m=s.directiveStart,p=s.directiveEnd;m<p;m++){let i=l.data[m].type.prototype,{ngAfterContentInit:C,ngAfterContentChecked:O,ngAfterViewInit:j,ngAfterViewChecked:Z,ngOnDestroy:se}=i;C&&(l.contentHooks??=[]).push(-m,C),O&&((l.contentHooks??=[]).push(m,O),(l.contentCheckHooks??=[]).push(m,O)),j&&(l.viewHooks??=[]).push(-m,j),Z&&((l.viewHooks??=[]).push(m,Z),(l.viewCheckHooks??=[]).push(m,Z)),se!=null&&(l.destroyHooks??=[]).push(m,se)}}function N_(l,s,m){nS(l,s,3,m)}function k_(l,s,m,p){(l[bn]&3)===m&&nS(l,s,m,p)}function Rx(l,s){let m=l[bn];(m&3)===s&&(m&=16383,m+=1,l[bn]=m)}function nS(l,s,m,p){let y=p!==void 0?l[Oh]&65535:0,i=p??-1,C=s.length-1,O=0;for(let j=y;j<C;j++)if(typeof s[j+1]=="number"){if(O=s[j],p!=null&&O>=p)break}else s[j]<0&&(l[Oh]+=65536),(O<i||i==-1)&&(Zk(l,m,s,j),l[Oh]=(l[Oh]&4294901760)+j+2),j++}function kM(l,s){Ws(4,l,s);let m=or(null);try{s.call(l)}finally{or(m),Ws(5,l,s)}}function Zk(l,s,m,p){let y=m[p]<0,i=m[p+1],C=y?-m[p]:m[p],O=l[C];y?l[bn]>>14<l[Oh]>>16&&(l[bn]&3)===s&&(l[bn]+=16384,kM(O,i)):kM(O,i)}var zh=-1,Cp=class{constructor(s,m,p){this.factory=s,this.resolving=!1,this.canSeeViewProviders=m,this.injectImpl=p}};function Xk(l){return l instanceof Cp}function Yk(l){return(l.flags&8)!==0}function Kk(l){return(l.flags&16)!==0}function rS(l){return l!==zh}function W_(l){return l&32767}function Jk(l){return l>>16}function Z_(l,s){let m=Jk(l),p=s;for(;m>0;)p=p[Wh],m--;return p}var Jx=!0;function FM(l){let s=Jx;return Jx=l,s}var Qk=256,iS=Qk-1,oS=5,eF=0,Zs={};function tF(l,s,m){let p;typeof m=="string"?p=m.charCodeAt(0)||0:m.hasOwnProperty(vp)&&(p=m[vp]),p==null&&(p=m[vp]=eF++);let y=p&iS,i=1<<y;s.data[l+(y>>oS)]|=i}function sS(l,s){let m=aS(l,s);if(m!==-1)return m;let p=s[jn];p.firstCreatePass&&(l.injectorIndex=s.length,Lx(p.data,l),Lx(s,null),Lx(p.blueprint,null));let y=K1(l,s),i=l.injectorIndex;if(rS(y)){let C=W_(y),O=Z_(y,s),j=O[jn].data;for(let Z=0;Z<8;Z++)s[i+Z]=O[C+Z]|j[C+Z]}return s[i+8]=y,i}function Lx(l,s){l.push(0,0,0,0,0,0,0,0,s)}function aS(l,s){return l.injectorIndex===-1||l.parent&&l.parent.injectorIndex===l.injectorIndex||s[l.injectorIndex+8]===null?-1:l.injectorIndex}function K1(l,s){if(l.parent&&l.parent.injectorIndex!==-1)return l.parent.injectorIndex;let m=0,p=null,y=s;for(;y!==null;){if(p=dS(y),p===null)return zh;if(m++,y=y[Wh],p.injectorIndex!==-1)return p.injectorIndex|m<<16}return zh}function nF(l,s,m){tF(l,s,m)}function lS(l,s,m){if(m&Bn.Optional||l!==void 0)return l;O1(s,"NodeInjector")}function cS(l,s,m,p){if(m&Bn.Optional&&p===void 0&&(p=null),!(m&(Bn.Self|Bn.Host))){let y=l[Vh],i=Bo(void 0);try{return y?y.get(s,p,m&Bn.Optional):_C(s,p,m&Bn.Optional)}finally{Bo(i)}}return lS(p,s,m)}function uS(l,s,m,p=Bn.Default,y){if(l!==null){if(s[bn]&2048&&!(p&Bn.Self)){let C=sF(l,s,m,p,Zs);if(C!==Zs)return C}let i=hS(l,s,m,p,Zs);if(i!==Zs)return i}return cS(s,m,p,y)}function hS(l,s,m,p,y){let i=iF(m);if(typeof i=="function"){if(!YC(s,l,p))return p&Bn.Host?lS(y,m,p):cS(s,m,p,y);try{let C;if(C=i(p),C==null&&!(p&Bn.Optional))O1(m);else return C}finally{eS()}}else if(typeof i=="number"){let C=null,O=aS(l,s),j=zh,Z=p&Bn.Host?s[Ks][ms]:null;for((O===-1||p&Bn.SkipSelf)&&(j=O===-1?K1(l,s):s[O+8],j===zh||!BM(p,!1)?O=-1:(C=s[jn],O=W_(j),s=Z_(j,s)));O!==-1;){let se=s[jn];if(zM(i,O,se.data)){let ve=rF(O,s,m,C,p,Z);if(ve!==Zs)return ve}j=s[O+8],j!==zh&&BM(p,s[jn].data[O+8]===Z)&&zM(i,O,s)?(C=se,O=W_(j),s=Z_(j,s)):O=-1}}return y}function rF(l,s,m,p,y,i){let C=s[jn],O=C.data[l+8],j=p==null?fy(O)&&Jx:p!=C&&(O.type&3)!==0,Z=y&Bn.Host&&i===O,se=F_(O,C,m,j,Z);return se!==null?$h(s,C,se,O):Zs}function F_(l,s,m,p,y){let i=l.providerIndexes,C=s.data,O=i&1048575,j=l.directiveStart,Z=l.directiveEnd,se=i>>20,ve=p?O:O+se,ze=y?O+se:Z;for(let at=ve;at<ze;at++){let Wt=C[at];if(at<j&&m===Wt||at>=j&&Wt.type===m)return at}if(y){let at=C[j];if(at&&Np(at)&&at.type===m)return j}return null}function $h(l,s,m,p){let y=l[m],i=s.data;if(Xk(y)){let C=y;C.resolving&&TN(wN(i[m]));let O=FM(C.canSeeViewProviders);C.resolving=!0;let j,Z=C.injectImpl?Bo(C.injectImpl):null,se=YC(l,p,Bn.Default);try{y=l[m]=C.factory(void 0,i,l,p),s.firstCreatePass&&m>=p.directiveStart&&Wk(m,i[m],s)}finally{Z!==null&&Bo(Z),FM(O),C.resolving=!1,eS()}}return y}function iF(l){if(typeof l=="string")return l.charCodeAt(0)||0;let s=l.hasOwnProperty(vp)?l[vp]:void 0;return typeof s=="number"?s>=0?s&iS:oF:s}function zM(l,s,m){let p=1<<l;return!!(m[s+(l>>oS)]&p)}function BM(l,s){return!(l&Bn.Self)&&!(l&Bn.Host&&s)}var tu=class{constructor(s,m){this._tNode=s,this._lView=m}get(s,m,p){return uS(this._tNode,this._lView,s,ly(p),m)}};function oF(){return new tu(_s(),Fr())}function J1(l){return Rp(()=>{let s=l.prototype.constructor,m=s[j_]||Qx(s),p=Object.prototype,y=Object.getPrototypeOf(l.prototype).constructor;for(;y&&y!==p;){let i=y[j_]||Qx(y);if(i&&i!==m)return i;y=Object.getPrototypeOf(y)}return i=>new i})}function Qx(l){return uC(l)?()=>{let s=Qx(jo(l));return s&&s()}:Bh(l)}function sF(l,s,m,p,y){let i=l,C=s;for(;i!==null&&C!==null&&C[bn]&2048&&!(C[bn]&512);){let O=hS(i,C,m,p|Bn.Self,Zs);if(O!==Zs)return O;let j=i.parent;if(!j){let Z=C[OC];if(Z){let se=Z.get(m,Zs,p);if(se!==Zs)return se}j=dS(C),C=C[Wh]}i=j}return y}function dS(l){let s=l[jn],m=s.type;return m===2?s.declTNode:m===1?l[ms]:null}function jM(l,s=null,m=null,p){let y=fS(l,s,m,p);return y.resolveInjectorInitializers(),y}function fS(l,s=null,m=null,p,y=new Set){let i=[m||hs,ek(l)];return p=p||(typeof l=="object"?void 0:qi(l)),new Tp(i,s||j1(),p||null,y)}var ta=(()=>{let s=class s{static create(p,y){if(Array.isArray(p))return jM({name:""},y,p,"");{let i=p.name??"";return jM({name:i},p.parent,p.providers,i)}}};s.THROW_IF_NOT_FOUND=bp,s.NULL=new $_,s.\u0275prov=Ft({token:s,providedIn:"any",factory:()=>Nt(xC)}),s.__NG_ELEMENT_ID__=-1;let l=s;return l})();var aF="ngOriginalError";function Ox(l){return l[aF]}var Qs=class{constructor(){this._console=console}handleError(s){let m=this._findOriginalError(s);this._console.error("ERROR",s),m&&this._console.error("ORIGINAL ERROR",m)}_findOriginalError(s){let m=s&&Ox(s);for(;m&&Ox(m);)m=Ox(m);return m||null}},pS=new sn("",{providedIn:"root",factory:()=>Tt(Qs).handleError.bind(void 0)}),Q1=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=lF,s.__NG_ENV_ID__=p=>p;let l=s;return l})(),e1=class extends Q1{constructor(s){super(),this._lView=s}onDestroy(s){return GC(this._lView,s),()=>Mk(this._lView,s)}};function lF(){return new e1(Fr())}function cF(){return Xh(_s(),Fr())}function Xh(l,s){return new Gl(gs(l,s))}var Gl=(()=>{let s=class s{constructor(p){this.nativeElement=p}};s.__NG_ELEMENT_ID__=cF;let l=s;return l})();function uF(l){return l instanceof Gl?l.nativeElement:l}var t1=class extends Hi{constructor(s=!1){super(),this.destroyRef=void 0,this.__isAsync=s,LC()&&(this.destroyRef=Tt(Q1,{optional:!0})??void 0)}emit(s){let m=or(null);try{super.next(s)}finally{or(m)}}subscribe(s,m,p){let y=s,i=m||(()=>null),C=p;if(s&&typeof s=="object"){let j=s;y=j.next?.bind(j),i=j.error?.bind(j),C=j.complete?.bind(j)}this.__isAsync&&(i=Nx(i),y&&(y=Nx(y)),C&&(C=Nx(C)));let O=super.subscribe({next:y,error:i,complete:C});return s instanceof ai&&s.add(O),O}};function Nx(l){return s=>{setTimeout(l,void 0,s)}}var ki=t1;function hF(){return this._results[Symbol.iterator]()}var n1=class l{get changes(){return this._changes??=new ki}constructor(s=!1){this._emitDistinctChangesOnly=s,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let m=l.prototype;m[Symbol.iterator]||(m[Symbol.iterator]=hF)}get(s){return this._results[s]}map(s){return this._results.map(s)}filter(s){return this._results.filter(s)}find(s){return this._results.find(s)}reduce(s,m){return this._results.reduce(s,m)}forEach(s){this._results.forEach(s)}some(s){return this._results.some(s)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(s,m){this.dirty=!1;let p=ON(s);(this._changesDetected=!LN(this._results,p,m))&&(this._results=p,this.length=p.length,this.last=p[this.length-1],this.first=p[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(s){this._onDirty=s}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function mS(l){return(l.flags&128)===128}var gS=new Map,dF=0;function fF(){return dF++}function pF(l){gS.set(l[dy],l)}function mF(l){gS.delete(l[dy])}var VM="__ngContext__";function ou(l,s){eu(s)?(l[VM]=s[dy],pF(s)):l[VM]=s}function _S(l){return vS(l[Ip])}function yS(l){return vS(l[ds])}function vS(l){for(;l!==null&&!ja(l);)l=l[ds];return l}var r1;function xS(l){r1=l}function gF(){if(r1!==void 0)return r1;if(typeof document<"u")return document;throw new rn(210,!1)}var my=new sn("",{providedIn:"root",factory:()=>_F}),_F="ng",eb=new sn(""),na=new sn("",{providedIn:"platform",factory:()=>"unknown"});var tb=new sn("",{providedIn:"root",factory:()=>gF().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var yF="h",vF="b";var xF=()=>null;function nb(l,s,m=!1){return xF(l,s,m)}var bS=!1,bF=new sn("",{providedIn:"root",factory:()=>bS});var i1=class{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${fN})`}};function rb(l){return l instanceof i1?l.changingThisBreaksApplicationSecurity:l}function wS(l){return l instanceof Function?l():l}function wF(l){return(l??Tt(ta)).get(na)==="browser"}var za=function(l){return l[l.Important=1]="Important",l[l.DashCase=2]="DashCase",l}(za||{}),TF;function ib(l,s){return TF(l,s)}function Nh(l,s,m,p,y){if(p!=null){let i,C=!1;ja(p)?i=p:eu(p)&&(C=!0,p=p[Ba]);let O=Js(p);l===0&&m!==null?y==null?MS(s,m,O):X_(s,m,O,y||null,!0):l===1&&m!==null?X_(s,m,O,y||null,!0):l===2?jF(s,O,C):l===3&&s.destroyNode(O),i!=null&&UF(s,l,i,m,y)}}function EF(l,s){return l.createText(s)}function IF(l,s,m){l.setValue(s,m)}function TS(l,s,m){return l.createElement(s,m)}function DF(l,s){ES(l,s),s[Ba]=null,s[ms]=null}function MF(l,s,m,p,y,i){p[Ba]=y,p[ms]=s,gy(l,p,m,1,y,i)}function ES(l,s){s[Ys].changeDetectionScheduler?.notify(1),gy(l,s,s[Fi],2,null,null)}function CF(l){let s=l[Ip];if(!s)return kx(l[jn],l);for(;s;){let m=null;if(eu(s))m=s[Ip];else{let p=s[Ao];p&&(m=p)}if(!m){for(;s&&!s[ds]&&s!==l;)eu(s)&&kx(s[jn],s),s=s[Ei];s===null&&(s=l),eu(s)&&kx(s[jn],s),m=s&&s[ds]}s=m}}function SF(l,s,m,p){let y=Ao+p,i=m.length;p>0&&(m[y-1][ds]=s),p<i-Ao?(s[ds]=m[y],vC(m,Ao+p,s)):(m.push(s),s[ds]=null),s[Ei]=m;let C=s[Op];C!==null&&m!==C&&AF(C,s);let O=s[ka];O!==null&&O.insertView(l),Yx(s),s[bn]|=128}function AF(l,s){let m=l[Uh],y=s[Ei][Ei][Ks];s[Ks]!==y&&(l[bn]|=V1.HasTransplantedViews),m===null?l[Uh]=[s]:m.push(s)}function IS(l,s){let m=l[Uh],p=m.indexOf(s);m.splice(p,1)}function o1(l,s){if(l.length<=Ao)return;let m=Ao+s,p=l[m];if(p){let y=p[Op];y!==null&&y!==l&&IS(y,p),s>0&&(l[m-1][ds]=p[ds]);let i=U_(l,Ao+s);DF(p[jn],p);let C=i[ka];C!==null&&C.detachView(i[jn]),p[Ei]=null,p[ds]=null,p[bn]&=-129}return p}function DS(l,s){if(!(s[bn]&256)){let m=s[Fi];m.destroyNode&&gy(l,s,m,3,null,null),CF(s)}}function kx(l,s){if(s[bn]&256)return;let m=or(null);try{s[bn]&=-129,s[bn]|=256,s[nu]&&ZD(s[nu]),RF(l,s),PF(l,s),s[jn].type===1&&s[Fi].destroy();let p=s[Op];if(p!==null&&ja(s[Ei])){p!==s[Ei]&&IS(p,s);let y=s[ka];y!==null&&y.detachView(l)}mF(s)}finally{or(m)}}function PF(l,s){let m=l.cleanup,p=s[Ep];if(m!==null)for(let i=0;i<m.length-1;i+=2)if(typeof m[i]=="string"){let C=m[i+3];C>=0?p[C]():p[-C].unsubscribe(),i+=2}else{let C=p[m[i+1]];m[i].call(C)}p!==null&&(s[Ep]=null);let y=s[jl];if(y!==null){s[jl]=null;for(let i=0;i<y.length;i++){let C=y[i];C()}}}function RF(l,s){let m;if(l!=null&&(m=l.destroyHooks)!=null)for(let p=0;p<m.length;p+=2){let y=s[m[p]];if(!(y instanceof Cp)){let i=m[p+1];if(Array.isArray(i))for(let C=0;C<i.length;C+=2){let O=y[i[C]],j=i[C+1];Ws(4,O,j);try{j.call(O)}finally{Ws(5,O,j)}}else{Ws(4,y,i);try{i.call(y)}finally{Ws(5,y,i)}}}}}function LF(l,s,m){return OF(l,s.parent,m)}function OF(l,s,m){let p=s;for(;p!==null&&p.type&40;)s=p,p=s.parent;if(p===null)return m[Ba];{let{componentOffset:y}=p;if(y>-1){let{encapsulation:i}=l.data[p.directiveStart+y];if(i===Xs.None||i===Xs.Emulated)return null}return gs(p,m)}}function X_(l,s,m,p,y){l.insertBefore(s,m,p,y)}function MS(l,s,m){l.appendChild(s,m)}function UM(l,s,m,p,y){p!==null?X_(l,s,m,p,y):MS(l,s,m)}function NF(l,s,m,p){l.removeChild(s,m,p)}function ob(l,s){return l.parentNode(s)}function kF(l,s){return l.nextSibling(s)}function FF(l,s,m){return BF(l,s,m)}function zF(l,s,m){return l.type&40?gs(l,m):null}var BF=zF,$M;function sb(l,s,m,p){let y=LF(l,p,s),i=s[Fi],C=p.parent||s[ms],O=FF(C,p,s);if(y!=null)if(Array.isArray(m))for(let j=0;j<m.length;j++)UM(i,y,m[j],O,!1);else UM(i,y,m,O,!1);$M!==void 0&&$M(i,p,s,m,y)}function z_(l,s){if(s!==null){let m=s.type;if(m&3)return gs(s,l);if(m&4)return s1(-1,l[s.index]);if(m&8){let p=s.child;if(p!==null)return z_(l,p);{let y=l[s.index];return ja(y)?s1(-1,y):Js(y)}}else{if(m&32)return ib(s,l)()||Js(l[s.index]);{let p=CS(l,s);if(p!==null){if(Array.isArray(p))return p[0];let y=Mp(l[Ks]);return z_(y,p)}else return z_(l,s.next)}}}return null}function CS(l,s){if(s!==null){let p=l[Ks][ms],y=s.projection;return p.projection[y]}return null}function s1(l,s){let m=Ao+l+1;if(m<s.length){let p=s[m],y=p[jn].firstChild;if(y!==null)return z_(p,y)}return s[ru]}function jF(l,s,m){let p=ob(l,s);p&&NF(l,p,s,m)}function ab(l,s,m,p,y,i,C){for(;m!=null;){let O=p[m.index],j=m.type;if(C&&s===0&&(O&&ou(Js(O),p),m.flags|=2),(m.flags&32)!==32)if(j&8)ab(l,s,m.child,p,y,i,!1),Nh(s,l,y,O,i);else if(j&32){let Z=ib(m,p),se;for(;se=Z();)Nh(s,l,y,se,i);Nh(s,l,y,O,i)}else j&16?VF(l,s,p,m,y,i):Nh(s,l,y,O,i);m=C?m.projectionNext:m.next}}function gy(l,s,m,p,y,i){ab(m,p,l.firstChild,s,y,i,!1)}function VF(l,s,m,p,y,i){let C=m[Ks],j=C[ms].projection[p.projection];if(Array.isArray(j))for(let Z=0;Z<j.length;Z++){let se=j[Z];Nh(s,l,y,se,i)}else{let Z=j,se=C[Ei];mS(p)&&(Z.flags|=128),ab(l,s,Z,se,y,i,!0)}}function UF(l,s,m,p,y){let i=m[ru],C=Js(m);i!==C&&Nh(s,l,p,i,y);for(let O=Ao;O<m.length;O++){let j=m[O];gy(j[jn],j,l,s,p,i)}}function $F(l,s,m,p,y){if(s)y?l.addClass(m,p):l.removeClass(m,p);else{let i=p.indexOf("-")===-1?void 0:za.DashCase;y==null?l.removeStyle(m,p,i):(typeof y=="string"&&y.endsWith("!important")&&(y=y.slice(0,-10),i|=za.Important),l.setStyle(m,p,y,i))}}function GF(l,s,m){l.setAttribute(s,"style",m)}function SS(l,s,m){m===""?l.removeAttribute(s,"class"):l.setAttribute(s,"class",m)}function AS(l,s,m){let{mergedAttrs:p,classes:y,styles:i}=m;p!==null&&Gx(l,s,p),y!==null&&SS(l,s,y),i!==null&&GF(l,s,i)}var Yh={};function Kh(l=1){PS(ea(),Fr(),Zh()+l,!1)}function PS(l,s,m,p){if(!p)if((s[bn]&3)===3){let i=l.preOrderCheckHooks;i!==null&&N_(s,i,m)}else{let i=l.preOrderHooks;i!==null&&k_(s,i,0,m)}iu(m)}function zr(l,s=Bn.Default){let m=Fr();if(m===null)return Nt(l,s);let p=_s();return uS(p,m,jo(l),s)}function RS(){let l="invalid";throw new Error(l)}function LS(l,s,m,p,y,i){let C=or(null);try{let O=null;y&Na.SignalBased&&(O=s[p][GD]),O!==null&&O.transformFn!==void 0&&(i=O.transformFn(i)),y&Na.HasDecoratorInputTransform&&(i=l.inputTransforms[p].call(s,i)),l.setInput!==null?l.setInput(s,O,i,m,p):FC(s,O,p,i)}finally{or(C)}}function HF(l,s){let m=l.hostBindingOpCodes;if(m!==null)try{for(let p=0;p<m.length;p++){let y=m[p];if(y<0)iu(~y);else{let i=y,C=m[++p],O=m[++p];jk(C,i);let j=s[i];O(2,j)}}}finally{iu(-1)}}function _y(l,s,m,p,y,i,C,O,j,Z,se){let ve=s.blueprint.slice();return ve[Ba]=y,ve[bn]=p|4|128|8|64,(Z!==null||l&&l[bn]&2048)&&(ve[bn]|=2048),$C(ve),ve[Ei]=ve[Wh]=l,ve[fs]=m,ve[Ys]=C||l&&l[Ys],ve[Fi]=O||l&&l[Fi],ve[Vh]=j||l&&l[Vh]||null,ve[ms]=i,ve[dy]=fF(),ve[G_]=se,ve[OC]=Z,ve[Ks]=s.type==2?l[Ks]:ve,ve}function yy(l,s,m,p,y){let i=l.data[s];if(i===null)i=qF(l,s,m,p,y),Bk()&&(i.flags|=32);else if(i.type&64){i.type=m,i.value=p,i.attrs=y;let C=Ok();i.injectorIndex=C===null?-1:C.injectorIndex}return zp(i,!0),i}function qF(l,s,m,p,y){let i=qC(),C=WC(),O=C?i:i&&i.parent,j=l.data[s]=JF(l,O,m,s,p,y);return l.firstChild===null&&(l.firstChild=j),i!==null&&(C?i.child==null&&j.parent!==null&&(i.child=j):i.next===null&&(i.next=j,j.prev=i)),j}function OS(l,s,m,p){if(m===0)return-1;let y=s.length;for(let i=0;i<m;i++)s.push(p),l.blueprint.push(p),l.data.push(null);return y}function NS(l,s,m,p,y){let i=Zh(),C=p&2;try{iu(-1),C&&s.length>Fa&&PS(l,s,Fa,!1),Ws(C?2:0,y),m(p,y)}finally{iu(i),Ws(C?3:1,y)}}function kS(l,s,m){if(kC(s)){let p=or(null);try{let y=s.directiveStart,i=s.directiveEnd;for(let C=y;C<i;C++){let O=l.data[C];if(O.contentQueries){let j=m[C];O.contentQueries(1,j,C)}}}finally{or(p)}}}function FS(l,s,m){HC()&&(o3(l,s,m,gs(m,s)),(m.flags&64)===64&&US(l,s,m))}function zS(l,s,m=gs){let p=s.localNames;if(p!==null){let y=s.index+1;for(let i=0;i<p.length;i+=2){let C=p[i+1],O=C===-1?m(s,l):l[C];l[y++]=O}}}function BS(l){let s=l.tView;return s===null||s.incompleteFirstPass?l.tView=lb(1,null,l.template,l.decls,l.vars,l.directiveDefs,l.pipeDefs,l.viewQuery,l.schemas,l.consts,l.id):s}function lb(l,s,m,p,y,i,C,O,j,Z,se){let ve=Fa+p,ze=ve+y,at=WF(ve,ze),Wt=typeof Z=="function"?Z():Z;return at[jn]={type:l,blueprint:at,template:m,queries:null,viewQuery:O,declTNode:s,data:at.slice().fill(null,ve),bindingStartIndex:ve,expandoStartIndex:ze,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof C=="function"?C():C,firstChild:null,schemas:j,consts:Wt,incompleteFirstPass:!1,ssrId:se}}function WF(l,s){let m=[];for(let p=0;p<s;p++)m.push(p<l?null:Yh);return m}function ZF(l,s,m,p){let i=p.get(bF,bS)||m===Xs.ShadowDom,C=l.selectRootElement(s,i);return XF(C),C}function XF(l){YF(l)}var YF=()=>null;function KF(l,s,m,p){let y=HS(s);y.push(m),l.firstCreatePass&&qS(l).push(p,y.length-1)}function JF(l,s,m,p,y,i){let C=s?s.injectorIndex:-1,O=0;return Pk()&&(O|=128),{type:m,index:p,insertBeforeIndex:null,injectorIndex:C,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:O,providerIndexes:0,value:y,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function GM(l,s,m,p,y){for(let i in s){if(!s.hasOwnProperty(i))continue;let C=s[i];if(C===void 0)continue;p??={};let O,j=Na.None;Array.isArray(C)?(O=C[0],j=C[1]):O=C;let Z=i;if(y!==null){if(!y.hasOwnProperty(i))continue;Z=y[i]}l===0?HM(p,m,Z,O,j):HM(p,m,Z,O)}return p}function HM(l,s,m,p,y){let i;l.hasOwnProperty(m)?(i=l[m]).push(s,p):i=l[m]=[s,p],y!==void 0&&i.push(y)}function QF(l,s,m){let p=s.directiveStart,y=s.directiveEnd,i=l.data,C=s.attrs,O=[],j=null,Z=null;for(let se=p;se<y;se++){let ve=i[se],ze=m?m.get(ve):null,at=ze?ze.inputs:null,Wt=ze?ze.outputs:null;j=GM(0,ve.inputs,se,j,at),Z=GM(1,ve.outputs,se,Z,Wt);let Pn=j!==null&&C!==null&&!z1(s)?p3(j,se,C):null;O.push(Pn)}j!==null&&(j.hasOwnProperty("class")&&(s.flags|=8),j.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=O,s.inputs=j,s.outputs=Z}function e3(l){return l==="class"?"className":l==="for"?"htmlFor":l==="formaction"?"formAction":l==="innerHtml"?"innerHTML":l==="readonly"?"readOnly":l==="tabindex"?"tabIndex":l}function t3(l,s,m,p,y,i,C,O){let j=gs(s,m),Z=s.inputs,se;!O&&Z!=null&&(se=Z[p])?(cb(l,m,se,p,y),fy(s)&&n3(m,s.index)):s.type&3?(p=e3(p),y=C!=null?C(y,s.value||"",p):y,i.setProperty(j,p,y)):s.type&12}function n3(l,s){let m=$l(s,l);m[bn]&16||(m[bn]|=64)}function jS(l,s,m,p){if(HC()){let y=p===null?null:{"":-1},i=a3(l,m),C,O;i===null?C=O=null:[C,O]=i,C!==null&&VS(l,s,m,C,y,O),y&&l3(m,p,y)}m.mergedAttrs=F1(m.mergedAttrs,m.attrs)}function VS(l,s,m,p,y,i){for(let Z=0;Z<p.length;Z++)nF(sS(m,s),l,p[Z].type);u3(m,l.data.length,p.length);for(let Z=0;Z<p.length;Z++){let se=p[Z];se.providersResolver&&se.providersResolver(se)}let C=!1,O=!1,j=OS(l,s,p.length,null);for(let Z=0;Z<p.length;Z++){let se=p[Z];m.mergedAttrs=F1(m.mergedAttrs,se.hostAttrs),h3(l,m,s,j,se),c3(j,se,y),se.contentQueries!==null&&(m.flags|=4),(se.hostBindings!==null||se.hostAttrs!==null||se.hostVars!==0)&&(m.flags|=64);let ve=se.type.prototype;!C&&(ve.ngOnChanges||ve.ngOnInit||ve.ngDoCheck)&&((l.preOrderHooks??=[]).push(m.index),C=!0),!O&&(ve.ngOnChanges||ve.ngDoCheck)&&((l.preOrderCheckHooks??=[]).push(m.index),O=!0),j++}QF(l,m,i)}function r3(l,s,m,p,y){let i=y.hostBindings;if(i){let C=l.hostBindingOpCodes;C===null&&(C=l.hostBindingOpCodes=[]);let O=~s.index;i3(C)!=O&&C.push(O),C.push(m,p,i)}}function i3(l){let s=l.length;for(;s>0;){let m=l[--s];if(typeof m=="number"&&m<0)return m}return 0}function o3(l,s,m,p){let y=m.directiveStart,i=m.directiveEnd;fy(m)&&d3(s,m,l.data[y+m.componentOffset]),l.firstCreatePass||sS(m,s),ou(p,s);let C=m.initialInputs;for(let O=y;O<i;O++){let j=l.data[O],Z=$h(s,l,O,m);if(ou(Z,s),C!==null&&f3(s,O-y,Z,j,m,C),Np(j)){let se=$l(m.index,s);se[fs]=$h(s,l,O,m)}}}function US(l,s,m){let p=m.directiveStart,y=m.directiveEnd,i=m.index,C=Vk();try{iu(i);for(let O=p;O<y;O++){let j=l.data[O],Z=s[O];Kx(O),(j.hostBindings!==null||j.hostVars!==0||j.hostAttrs!==null)&&s3(j,Z)}}finally{iu(-1),Kx(C)}}function s3(l,s){l.hostBindings!==null&&l.hostBindings(1,s)}function a3(l,s){let m=l.directiveRegistry,p=null,y=null;if(m)for(let i=0;i<m.length;i++){let C=m[i];if(HN(s,C.selectors,!1))if(p||(p=[]),Np(C))if(C.findHostDirectiveDefs!==null){let O=[];y=y||new Map,C.findHostDirectiveDefs(C,O,y),p.unshift(...O,C);let j=O.length;a1(l,s,j)}else p.unshift(C),a1(l,s,0);else y=y||new Map,C.findHostDirectiveDefs?.(C,p,y),p.push(C)}return p===null?null:[p,y]}function a1(l,s,m){s.componentOffset=m,(l.components??=[]).push(s.index)}function l3(l,s,m){if(s){let p=l.localNames=[];for(let y=0;y<s.length;y+=2){let i=m[s[y+1]];if(i==null)throw new rn(-301,!1);p.push(s[y],i)}}}function c3(l,s,m){if(m){if(s.exportAs)for(let p=0;p<s.exportAs.length;p++)m[s.exportAs[p]]=l;Np(s)&&(m[""]=l)}}function u3(l,s,m){l.flags|=1,l.directiveStart=s,l.directiveEnd=s+m,l.providerIndexes=s}function h3(l,s,m,p,y){l.data[p]=y;let i=y.factory||(y.factory=Bh(y.type,!0)),C=new Cp(i,Np(y),zr);l.blueprint[p]=C,m[p]=C,r3(l,s,p,OS(l,m,y.hostVars,Yh),y)}function d3(l,s,m){let p=gs(s,l),y=BS(m),i=l[Ys].rendererFactory,C=16;m.signals?C=4096:m.onPush&&(C=64);let O=vy(l,_y(l,y,null,C,p,s,null,i.createRenderer(p,m),null,null,null));l[s.index]=O}function f3(l,s,m,p,y,i){let C=i[s];if(C!==null)for(let O=0;O<C.length;){let j=C[O++],Z=C[O++],se=C[O++],ve=C[O++];LS(p,m,j,Z,se,ve)}}function p3(l,s,m){let p=null,y=0;for(;y<m.length;){let i=m[y];if(i===0){y+=4;continue}else if(i===5){y+=2;continue}if(typeof i=="number")break;if(l.hasOwnProperty(i)){p===null&&(p=[]);let C=l[i];for(let O=0;O<C.length;O+=3)if(C[O]===s){p.push(i,C[O+1],C[O+2],m[y+1]);break}}y+=2}return p}function $S(l,s,m,p){return[l,!0,0,s,null,p,null,m,null,null]}function GS(l,s){let m=l.contentQueries;if(m!==null){let p=or(null);try{for(let y=0;y<m.length;y+=2){let i=m[y],C=m[y+1];if(C!==-1){let O=l.data[C];H1(i),O.contentQueries(2,s[C],C)}}}finally{or(p)}}}function vy(l,s){return l[Ip]?l[OM][ds]=s:l[Ip]=s,l[OM]=s,s}function l1(l,s,m){H1(0);let p=or(null);try{s(l,m)}finally{or(p)}}function HS(l){return l[Ep]||(l[Ep]=[])}function qS(l){return l.cleanup||(l.cleanup=[])}function WS(l,s){let m=l[Vh],p=m?m.get(Qs,null):null;p&&p.handleError(s)}function cb(l,s,m,p,y){for(let i=0;i<m.length;){let C=m[i++],O=m[i++],j=m[i++],Z=s[C],se=l.data[C];LS(se,Z,p,O,j,y)}}function m3(l,s,m){let p=VC(s,l);IF(l[Fi],p,m)}function g3(l,s){let m=$l(s,l),p=m[jn];_3(p,m);let y=m[Ba];y!==null&&m[G_]===null&&(m[G_]=nb(y,m[Vh])),ub(p,m,m[fs])}function _3(l,s){for(let m=s.length;m<l.blueprint.length;m++)s.push(l.blueprint[m])}function ub(l,s,m){q1(s);try{let p=l.viewQuery;p!==null&&l1(1,p,m);let y=l.template;y!==null&&NS(l,s,y,1,m),l.firstCreatePass&&(l.firstCreatePass=!1),s[ka]?.finishViewCreation(l),l.staticContentQueries&&GS(l,s),l.staticViewQueries&&l1(2,l.viewQuery,m);let i=l.components;i!==null&&y3(s,i)}catch(p){throw l.firstCreatePass&&(l.incompleteFirstPass=!0,l.firstCreatePass=!1),p}finally{s[bn]&=-5,W1()}}function y3(l,s){for(let m=0;m<s.length;m++)g3(l,s[m])}function v3(l,s,m,p){let y=or(null);try{let i=s.tView,O=l[bn]&4096?4096:16,j=_y(l,i,m,O,null,s,null,null,p?.injector??null,p?.embeddedViewInjector??null,p?.dehydratedView??null),Z=l[s.index];j[Op]=Z;let se=l[ka];return se!==null&&(j[ka]=se.createEmbeddedView(i)),ub(i,j,m),j}finally{or(y)}}function qM(l,s){return!s||s.firstChild===null||mS(l)}function x3(l,s,m,p=!0){let y=s[jn];if(SF(y,s,l,m),p){let C=s1(m,l),O=s[Fi],j=ob(O,l[ru]);j!==null&&MF(y,l[ms],O,s,j,C)}let i=s[G_];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function Y_(l,s,m,p,y=!1){for(;m!==null;){let i=s[m.index];i!==null&&p.push(Js(i)),ja(i)&&b3(i,p);let C=m.type;if(C&8)Y_(l,s,m.child,p);else if(C&32){let O=ib(m,s),j;for(;j=O();)p.push(j)}else if(C&16){let O=CS(s,m);if(Array.isArray(O))p.push(...O);else{let j=Mp(s[Ks]);Y_(j[jn],j,O,p,!0)}}m=y?m.projectionNext:m.next}return p}function b3(l,s){for(let m=Ao;m<l.length;m++){let p=l[m],y=p[jn].firstChild;y!==null&&Y_(p[jn],p,y,s)}l[ru]!==l[Ba]&&s.push(l[ru])}var ZS=[];function w3(l){return l[nu]??T3(l)}function T3(l){let s=ZS.pop()??Object.create(I3);return s.lView=l,s}function E3(l){l.lView[nu]!==l&&(l.lView=null,ZS.push(l))}var I3=Gr(Pt({},HD),{consumerIsAlwaysLive:!0,consumerMarkedDirty:l=>{Dp(l.lView)},consumerOnSignalRead(){this.lView[nu]=this}}),XS=100;function YS(l,s=!0,m=0){let p=l[Ys],y=p.rendererFactory,i=!1;i||y.begin?.();try{D3(l,m)}catch(C){throw s&&WS(l,C),C}finally{i||(y.end?.(),p.inlineEffectRunner?.flush())}}function D3(l,s){c1(l,s);let m=0;for(;G1(l);){if(m===XS)throw new rn(103,!1);m++,c1(l,1)}}function M3(l,s,m,p){let y=s[bn];if((y&256)===256)return;let i=!1;!i&&s[Ys].inlineEffectRunner?.flush(),q1(s);let C=null,O=null;!i&&C3(l)&&(O=w3(s),C=qD(O));try{$C(s),Fk(l.bindingStartIndex),m!==null&&NS(l,s,m,2,p);let j=(y&3)===3;if(!i)if(j){let ve=l.preOrderCheckHooks;ve!==null&&N_(s,ve,null)}else{let ve=l.preOrderHooks;ve!==null&&k_(s,ve,0,null),Rx(s,0)}if(S3(s),KS(s,0),l.contentQueries!==null&&GS(l,s),!i)if(j){let ve=l.contentCheckHooks;ve!==null&&N_(s,ve)}else{let ve=l.contentHooks;ve!==null&&k_(s,ve,1),Rx(s,1)}HF(l,s);let Z=l.components;Z!==null&&QS(s,Z,0);let se=l.viewQuery;if(se!==null&&l1(2,se,p),!i)if(j){let ve=l.viewCheckHooks;ve!==null&&N_(s,ve)}else{let ve=l.viewHooks;ve!==null&&k_(s,ve,2),Rx(s,2)}if(l.firstUpdatePass===!0&&(l.firstUpdatePass=!1),s[Px]){for(let ve of s[Px])ve();s[Px]=null}i||(s[bn]&=-73)}catch(j){throw Dp(s),j}finally{O!==null&&(WD(O,C),E3(O)),W1()}}function C3(l){return l.type!==2}function KS(l,s){for(let m=_S(l);m!==null;m=yS(m))for(let p=Ao;p<m.length;p++){let y=m[p];JS(y,s)}}function S3(l){for(let s=_S(l);s!==null;s=yS(s)){if(!(s[bn]&V1.HasTransplantedViews))continue;let m=s[Uh];for(let p=0;p<m.length;p++){let y=m[p],i=y[Ei];Ik(y)}}}function A3(l,s,m){let p=$l(s,l);JS(p,m)}function JS(l,s){$1(l)&&c1(l,s)}function c1(l,s){let p=l[jn],y=l[bn],i=l[nu],C=!!(s===0&&y&16);if(C||=!!(y&64&&s===0),C||=!!(y&1024),C||=!!(i?.dirty&&hx(i)),i&&(i.dirty=!1),l[bn]&=-9217,C)M3(p,l,p.template,l[fs]);else if(y&8192){KS(l,1);let O=p.components;O!==null&&QS(l,O,1)}}function QS(l,s,m){for(let p=0;p<s.length;p++)A3(l,s[p],m)}function hb(l){for(l[Ys].changeDetectionScheduler?.notify();l;){l[bn]|=64;let s=Mp(l);if(pk(l)&&!s)return l;l=s}return null}var su=class{get rootNodes(){let s=this._lView,m=s[jn];return Y_(m,s,m.firstChild,[])}constructor(s,m,p=!0){this._lView=s,this._cdRefInjectingView=m,this.notifyErrorHandler=p,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[fs]}set context(s){this._lView[fs]=s}get destroyed(){return(this._lView[bn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[Ei];if(ja(s)){let m=s[H_],p=m?m.indexOf(this):-1;p>-1&&(o1(s,p),U_(m,p))}this._attachedToViewContainer=!1}DS(this._lView[jn],this._lView)}onDestroy(s){GC(this._lView,s)}markForCheck(){hb(this._cdRefInjectingView||this._lView)}detach(){this._lView[bn]&=-129}reattach(){Yx(this._lView),this._lView[bn]|=128}detectChanges(){this._lView[bn]|=1024,YS(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new rn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,ES(this._lView[jn],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new rn(902,!1);this._appRef=s,Yx(this._lView)}},au=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=L3;let l=s;return l})(),P3=au,R3=class extends P3{constructor(s,m,p){super(),this._declarationLView=s,this._declarationTContainer=m,this.elementRef=p}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(s,m){return this.createEmbeddedViewImpl(s,m)}createEmbeddedViewImpl(s,m,p){let y=v3(this._declarationLView,this._declarationTContainer,s,{embeddedViewInjector:m,dehydratedView:p});return new su(y)}};function L3(){return xy(_s(),Fr())}function xy(l,s){return l.type&4?new R3(s,l,Xh(l,s)):null}var CG=new RegExp(`^(\\d+)*(${vF}|${yF})*(.*)`);var O3=()=>null;function WM(l,s){return O3(l,s)}var K_=class{},u1=class{},J_=class{};function N3(l){let s=Error(`No component factory found for ${qi(l)}.`);return s[k3]=l,s}var k3="ngComponent";var h1=class{resolveComponentFactory(s){throw N3(s)}},by=(()=>{let s=class s{};s.NULL=new h1;let l=s;return l})(),Sp=class{},wy=(()=>{let s=class s{constructor(){this.destroyNode=null}};s.__NG_ELEMENT_ID__=()=>F3();let l=s;return l})();function F3(){let l=Fr(),s=_s(),m=$l(s.index,l);return(eu(m)?m:l)[Fi]}var z3=(()=>{let s=class s{};s.\u0275prov=Ft({token:s,providedIn:"root",factory:()=>null});let l=s;return l})(),Fx={};var ZM=new Set;function Ty(l){ZM.has(l)||(ZM.add(l),performance?.mark?.("mark_feature_usage",{detail:{feature:l}}))}function XM(...l){}function B3(){let l=typeof So.requestAnimationFrame=="function",s=So[l?"requestAnimationFrame":"setTimeout"],m=So[l?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&s&&m){let p=s[Zone.__symbol__("OriginalDelegate")];p&&(s=p);let y=m[Zone.__symbol__("OriginalDelegate")];y&&(m=y)}return{nativeRequestAnimationFrame:s,nativeCancelAnimationFrame:m}}var br=class l{constructor({enableLongStackTrace:s=!1,shouldCoalesceEventChangeDetection:m=!1,shouldCoalesceRunChangeDetection:p=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ki(!1),this.onMicrotaskEmpty=new ki(!1),this.onStable=new ki(!1),this.onError=new ki(!1),typeof Zone>"u")throw new rn(908,!1);Zone.assertZonePatched();let y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),s&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!p&&m,y.shouldCoalesceRunChangeDetection=p,y.lastRequestAnimationFrameId=-1,y.nativeRequestAnimationFrame=B3().nativeRequestAnimationFrame,U3(y)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!l.isInAngularZone())throw new rn(909,!1)}static assertNotInAngularZone(){if(l.isInAngularZone())throw new rn(909,!1)}run(s,m,p){return this._inner.run(s,m,p)}runTask(s,m,p,y){let i=this._inner,C=i.scheduleEventTask("NgZoneEvent: "+y,s,j3,XM,XM);try{return i.runTask(C,m,p)}finally{i.cancelTask(C)}}runGuarded(s,m,p){return this._inner.runGuarded(s,m,p)}runOutsideAngular(s){return this._outer.run(s)}},j3={};function db(l){if(l._nesting==0&&!l.hasPendingMicrotasks&&!l.isStable)try{l._nesting++,l.onMicrotaskEmpty.emit(null)}finally{if(l._nesting--,!l.hasPendingMicrotasks)try{l.runOutsideAngular(()=>l.onStable.emit(null))}finally{l.isStable=!0}}}function V3(l){l.isCheckStableRunning||l.lastRequestAnimationFrameId!==-1||(l.lastRequestAnimationFrameId=l.nativeRequestAnimationFrame.call(So,()=>{l.fakeTopEventTask||(l.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{l.lastRequestAnimationFrameId=-1,d1(l),l.isCheckStableRunning=!0,db(l),l.isCheckStableRunning=!1},void 0,()=>{},()=>{})),l.fakeTopEventTask.invoke()}),d1(l))}function U3(l){let s=()=>{V3(l)};l._inner=l._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(m,p,y,i,C,O)=>{if($3(O))return m.invokeTask(y,i,C,O);try{return YM(l),m.invokeTask(y,i,C,O)}finally{(l.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||l.shouldCoalesceRunChangeDetection)&&s(),KM(l)}},onInvoke:(m,p,y,i,C,O,j)=>{try{return YM(l),m.invoke(y,i,C,O,j)}finally{l.shouldCoalesceRunChangeDetection&&s(),KM(l)}},onHasTask:(m,p,y,i)=>{m.hasTask(y,i),p===y&&(i.change=="microTask"?(l._hasPendingMicrotasks=i.microTask,d1(l),db(l)):i.change=="macroTask"&&(l.hasPendingMacrotasks=i.macroTask))},onHandleError:(m,p,y,i)=>(m.handleError(y,i),l.runOutsideAngular(()=>l.onError.emit(i)),!1)})}function d1(l){l._hasPendingMicrotasks||(l.shouldCoalesceEventChangeDetection||l.shouldCoalesceRunChangeDetection)&&l.lastRequestAnimationFrameId!==-1?l.hasPendingMicrotasks=!0:l.hasPendingMicrotasks=!1}function YM(l){l._nesting++,l.isStable&&(l.isStable=!1,l.onUnstable.emit(null))}function KM(l){l._nesting--,db(l)}var f1=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ki,this.onMicrotaskEmpty=new ki,this.onStable=new ki,this.onError=new ki}run(s,m,p){return s.apply(m,p)}runGuarded(s,m,p){return s.apply(m,p)}runOutsideAngular(s){return s()}runTask(s,m,p,y){return s.apply(m,p)}};function $3(l){return!Array.isArray(l)||l.length!==1?!1:l[0].data?.__ignore_ng_zone__===!0}function G3(l="zone.js",s){return l==="noop"?new f1:l==="zone.js"?new br(s):l}var kh=function(l){return l[l.EarlyRead=0]="EarlyRead",l[l.Write=1]="Write",l[l.MixedReadWrite=2]="MixedReadWrite",l[l.Read=3]="Read",l}(kh||{}),H3={destroy(){}};function fb(l,s){!s&&hk(fb);let m=s?.injector??Tt(ta);if(!wF(m))return H3;Ty("NgAfterNextRender");let p=m.get(pb),y=p.handler??=new m1,i=s?.phase??kh.MixedReadWrite,C=()=>{y.unregister(j),O()},O=m.get(Q1).onDestroy(C),j=ps(m,()=>new p1(i,()=>{C(),l()}));return y.register(j),{destroy:C}}var p1=class{constructor(s,m){this.phase=s,this.callbackFn=m,this.zone=Tt(br),this.errorHandler=Tt(Qs,{optional:!0}),Tt(K_,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(s){this.errorHandler?.handleError(s)}}},m1=class{constructor(){this.executingCallbacks=!1,this.buckets={[kh.EarlyRead]:new Set,[kh.Write]:new Set,[kh.MixedReadWrite]:new Set,[kh.Read]:new Set},this.deferredCallbacks=new Set}register(s){(this.executingCallbacks?this.deferredCallbacks:this.buckets[s.phase]).add(s)}unregister(s){this.buckets[s.phase].delete(s),this.deferredCallbacks.delete(s)}execute(){this.executingCallbacks=!0;for(let s of Object.values(this.buckets))for(let m of s)m.invoke();this.executingCallbacks=!1;for(let s of this.deferredCallbacks)this.buckets[s.phase].add(s);this.deferredCallbacks.clear()}destroy(){for(let s of Object.values(this.buckets))s.clear();this.deferredCallbacks.clear()}},pb=(()=>{let s=class s{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let p=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let y of p)y()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};s.\u0275prov=Ft({token:s,providedIn:"root",factory:()=>new s});let l=s;return l})();function g1(l,s,m){let p=m?l.styles:null,y=m?l.classes:null,i=0;if(s!==null)for(let C=0;C<s.length;C++){let O=s[C];if(typeof O=="number")i=O;else if(i==1)y=EM(y,O);else if(i==2){let j=O,Z=s[++C];p=EM(p,j+": "+Z+";")}}m?l.styles=p:l.stylesWithoutHost=p,m?l.classes=y:l.classesWithoutHost=y}var Q_=class extends by{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let m=Vl(s);return new Gh(m,this.ngModule)}};function JM(l){let s=[];for(let m in l){if(!l.hasOwnProperty(m))continue;let p=l[m];p!==void 0&&s.push({propName:Array.isArray(p)?p[0]:p,templateName:m})}return s}function q3(l){let s=l.toLowerCase();return s==="svg"?yk:s==="math"?vk:null}var _1=class{constructor(s,m){this.injector=s,this.parentInjector=m}get(s,m,p){p=ly(p);let y=this.injector.get(s,Fx,p);return y!==Fx||m===Fx?y:this.parentInjector.get(s,m,p)}},Gh=class extends J_{get inputs(){let s=this.componentDef,m=s.inputTransforms,p=JM(s.inputs);if(m!==null)for(let y of p)m.hasOwnProperty(y.propName)&&(y.transform=m[y.propName]);return p}get outputs(){return JM(this.componentDef.outputs)}constructor(s,m){super(),this.componentDef=s,this.ngModule=m,this.componentType=s.type,this.selector=XN(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!m}create(s,m,p,y){let i=or(null);try{y=y||this.ngModule;let C=y instanceof Wi?y:y?.injector;C&&this.componentDef.getStandaloneInjector!==null&&(C=this.componentDef.getStandaloneInjector(C)||C);let O=C?new _1(s,C):s,j=O.get(Sp,null);if(j===null)throw new rn(407,!1);let Z=O.get(z3,null),se=O.get(pb,null),ve=O.get(K_,null),ze={rendererFactory:j,sanitizer:Z,inlineEffectRunner:null,afterRenderEventManager:se,changeDetectionScheduler:ve},at=j.createRenderer(null,this.componentDef),Wt=this.componentDef.selectors[0][0]||"div",Pn=p?ZF(at,p,this.componentDef.encapsulation,O):TS(at,Wt,q3(Wt)),Zt=512;this.componentDef.signals?Zt|=4096:this.componentDef.onPush||(Zt|=16);let Qt=null;Pn!==null&&(Qt=nb(Pn,O,!0));let Tr=lb(0,null,null,1,0,null,null,null,null,null,null),gr=_y(null,Tr,null,Zt,null,null,ze,at,O,null,Qt);q1(gr);let qn,Br;try{let Ge=this.componentDef,ci,Uo=null;Ge.findHostDirectiveDefs?(ci=[],Uo=new Map,Ge.findHostDirectiveDefs(Ge,ci,Uo),ci.push(Ge)):ci=[Ge];let an=W3(gr,Pn),Hr=Z3(an,Pn,Ge,ci,gr,ze,at);Br=UC(Tr,Fa),Pn&&K3(at,Ge,Pn,p),m!==void 0&&J3(Br,this.ngContentSelectors,m),qn=Y3(Hr,Ge,ci,Uo,gr,[Q3]),ub(Tr,gr,null)}finally{W1()}return new y1(this.componentType,qn,Xh(Br,gr),gr,Br)}finally{or(i)}}},y1=class extends u1{constructor(s,m,p,y,i){super(),this.location=p,this._rootLView=y,this._tNode=i,this.previousInputValues=null,this.instance=m,this.hostView=this.changeDetectorRef=new su(y,void 0,!1),this.componentType=s}setInput(s,m){let p=this._tNode.inputs,y;if(p!==null&&(y=p[s])){if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),m))return;let i=this._rootLView;cb(i[jn],i,y,s,m),this.previousInputValues.set(s,m);let C=$l(this._tNode.index,i);hb(C)}}get injector(){return new tu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function W3(l,s){let m=l[jn],p=Fa;return l[p]=s,yy(m,p,2,"#host",null)}function Z3(l,s,m,p,y,i,C){let O=y[jn];X3(p,l,s,C);let j=null;s!==null&&(j=nb(s,y[Vh]));let Z=i.rendererFactory.createRenderer(s,m),se=16;m.signals?se=4096:m.onPush&&(se=64);let ve=_y(y,BS(m),null,se,y[l.index],l,i,Z,null,null,j);return O.firstCreatePass&&a1(O,l,p.length-1),vy(y,ve),y[l.index]=ve}function X3(l,s,m,p){for(let y of l)s.mergedAttrs=F1(s.mergedAttrs,y.hostAttrs);s.mergedAttrs!==null&&(g1(s,s.mergedAttrs,!0),m!==null&&AS(p,m,s))}function Y3(l,s,m,p,y,i){let C=_s(),O=y[jn],j=gs(C,y);VS(O,y,C,m,null,p);for(let se=0;se<m.length;se++){let ve=C.directiveStart+se,ze=$h(y,O,ve,C);ou(ze,y)}US(O,y,C),j&&ou(j,y);let Z=$h(y,O,C.directiveStart+C.componentOffset,C);if(l[fs]=y[fs]=Z,i!==null)for(let se of i)se(Z,s);return kS(O,C,y),Z}function K3(l,s,m,p){if(p)Gx(l,m,["ng-version","17.3.4"]);else{let{attrs:y,classes:i}=YN(s.selectors[0]);y&&Gx(l,m,y),i&&i.length>0&&SS(l,m,i.join(" "))}}function J3(l,s,m){let p=l.projection=[];for(let y=0;y<s.length;y++){let i=m[y];p.push(i!=null?Array.from(i):null)}}function Q3(){let l=_s();Y1(Fr()[jn],l)}var Hl=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=ez;let l=s;return l})();function ez(){let l=_s();return tA(l,Fr())}var tz=Hl,eA=class extends tz{constructor(s,m,p){super(),this._lContainer=s,this._hostTNode=m,this._hostLView=p}get element(){return Xh(this._hostTNode,this._hostLView)}get injector(){return new tu(this._hostTNode,this._hostLView)}get parentInjector(){let s=K1(this._hostTNode,this._hostLView);if(rS(s)){let m=Z_(s,this._hostLView),p=W_(s),y=m[jn].data[p+8];return new tu(y,m)}else return new tu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let m=QM(this._lContainer);return m!==null&&m[s]||null}get length(){return this._lContainer.length-Ao}createEmbeddedView(s,m,p){let y,i;typeof p=="number"?y=p:p!=null&&(y=p.index,i=p.injector);let C=WM(this._lContainer,s.ssrId),O=s.createEmbeddedViewImpl(m||{},i,C);return this.insertImpl(O,y,qM(this._hostTNode,C)),O}createComponent(s,m,p,y,i){let C=s&&!fk(s),O;if(C)O=m;else{let Wt=m||{};O=Wt.index,p=Wt.injector,y=Wt.projectableNodes,i=Wt.environmentInjector||Wt.ngModuleRef}let j=C?s:new Gh(Vl(s)),Z=p||this.parentInjector;if(!i&&j.ngModule==null){let Pn=(C?Z:this.parentInjector).get(Wi,null);Pn&&(i=Pn)}let se=Vl(j.componentType??{}),ve=WM(this._lContainer,se?.id??null),ze=ve?.firstChild??null,at=j.create(Z,y,ze,i);return this.insertImpl(at.hostView,O,qM(this._hostTNode,ve)),at}insert(s,m){return this.insertImpl(s,m,!0)}insertImpl(s,m,p){let y=s._lView;if(Ek(y)){let O=this.indexOf(s);if(O!==-1)this.detach(O);else{let j=y[Ei],Z=new eA(j,j[ms],j[Ei]);Z.detach(Z.indexOf(s))}}let i=this._adjustIndex(m),C=this._lContainer;return x3(C,y,i,p),s.attachToViewContainerRef(),vC(zx(C),i,s),s}move(s,m){return this.insert(s,m)}indexOf(s){let m=QM(this._lContainer);return m!==null?m.indexOf(s):-1}remove(s){let m=this._adjustIndex(s,-1),p=o1(this._lContainer,m);p&&(U_(zx(this._lContainer),m),DS(p[jn],p))}detach(s){let m=this._adjustIndex(s,-1),p=o1(this._lContainer,m);return p&&U_(zx(this._lContainer),m)!=null?new su(p):null}_adjustIndex(s,m=0){return s??this.length+m}};function QM(l){return l[H_]}function zx(l){return l[H_]||(l[H_]=[])}function tA(l,s){let m,p=s[l.index];return ja(p)?m=p:(m=$S(p,s,null,l),s[l.index]=m,vy(s,m)),rz(m,s,l,p),new eA(m,l,s)}function nz(l,s){let m=l[Fi],p=m.createComment(""),y=gs(s,l),i=ob(m,y);return X_(m,i,p,kF(m,y),!1),p}var rz=sz,iz=()=>!1;function oz(l,s,m){return iz(l,s,m)}function sz(l,s,m,p){if(l[ru])return;let y;m.type&8?y=Js(p):y=nz(s,m),l[ru]=y}var v1=class l{constructor(s){this.queryList=s,this.matches=null}clone(){return new l(this.queryList)}setDirty(){this.queryList.setDirty()}},x1=class l{constructor(s=[]){this.queries=s}createEmbeddedView(s){let m=s.queries;if(m!==null){let p=s.contentQueries!==null?s.contentQueries[0]:m.length,y=[];for(let i=0;i<p;i++){let C=m.getByIndex(i),O=this.queries[C.indexInDeclarationView];y.push(O.clone())}return new l(y)}return null}insertView(s){this.dirtyQueriesWithMatches(s)}detachView(s){this.dirtyQueriesWithMatches(s)}finishViewCreation(s){this.dirtyQueriesWithMatches(s)}dirtyQueriesWithMatches(s){for(let m=0;m<this.queries.length;m++)mb(s,m).matches!==null&&this.queries[m].setDirty()}},b1=class{constructor(s,m,p=null){this.flags=m,this.read=p,typeof s=="string"?this.predicate=pz(s):this.predicate=s}},w1=class l{constructor(s=[]){this.queries=s}elementStart(s,m){for(let p=0;p<this.queries.length;p++)this.queries[p].elementStart(s,m)}elementEnd(s){for(let m=0;m<this.queries.length;m++)this.queries[m].elementEnd(s)}embeddedTView(s){let m=null;for(let p=0;p<this.length;p++){let y=m!==null?m.length:0,i=this.getByIndex(p).embeddedTView(s,y);i&&(i.indexInDeclarationView=p,m!==null?m.push(i):m=[i])}return m!==null?new l(m):null}template(s,m){for(let p=0;p<this.queries.length;p++)this.queries[p].template(s,m)}getByIndex(s){return this.queries[s]}get length(){return this.queries.length}track(s){this.queries.push(s)}},T1=class l{constructor(s,m=-1){this.metadata=s,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=m}elementStart(s,m){this.isApplyingToNode(m)&&this.matchTNode(s,m)}elementEnd(s){this._declarationNodeIndex===s.index&&(this._appliesToNextNode=!1)}template(s,m){this.elementStart(s,m)}embeddedTView(s,m){return this.isApplyingToNode(s)?(this.crossesNgTemplate=!0,this.addMatch(-s.index,m),new l(this.metadata)):null}isApplyingToNode(s){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let m=this._declarationNodeIndex,p=s.parent;for(;p!==null&&p.type&8&&p.index!==m;)p=p.parent;return m===(p!==null?p.index:-1)}return this._appliesToNextNode}matchTNode(s,m){let p=this.metadata.predicate;if(Array.isArray(p))for(let y=0;y<p.length;y++){let i=p[y];this.matchTNodeWithReadOption(s,m,az(m,i)),this.matchTNodeWithReadOption(s,m,F_(m,s,i,!1,!1))}else p===au?m.type&4&&this.matchTNodeWithReadOption(s,m,-1):this.matchTNodeWithReadOption(s,m,F_(m,s,p,!1,!1))}matchTNodeWithReadOption(s,m,p){if(p!==null){let y=this.metadata.read;if(y!==null)if(y===Gl||y===Hl||y===au&&m.type&4)this.addMatch(m.index,-2);else{let i=F_(m,s,y,!1,!1);i!==null&&this.addMatch(m.index,i)}else this.addMatch(m.index,p)}}addMatch(s,m){this.matches===null?this.matches=[s,m]:this.matches.push(s,m)}};function az(l,s){let m=l.localNames;if(m!==null){for(let p=0;p<m.length;p+=2)if(m[p]===s)return m[p+1]}return null}function lz(l,s){return l.type&11?Xh(l,s):l.type&4?xy(l,s):null}function cz(l,s,m,p){return m===-1?lz(s,l):m===-2?uz(l,s,p):$h(l,l[jn],m,s)}function uz(l,s,m){if(m===Gl)return Xh(s,l);if(m===au)return xy(s,l);if(m===Hl)return tA(s,l)}function nA(l,s,m,p){let y=s[ka].queries[p];if(y.matches===null){let i=l.data,C=m.matches,O=[];for(let j=0;C!==null&&j<C.length;j+=2){let Z=C[j];if(Z<0)O.push(null);else{let se=i[Z];O.push(cz(s,se,C[j+1],m.metadata.read))}}y.matches=O}return y.matches}function E1(l,s,m,p){let y=l.queries.getByIndex(m),i=y.matches;if(i!==null){let C=nA(l,s,y,m);for(let O=0;O<i.length;O+=2){let j=i[O];if(j>0)p.push(C[O/2]);else{let Z=i[O+1],se=s[-j];for(let ve=Ao;ve<se.length;ve++){let ze=se[ve];ze[Op]===ze[Ei]&&E1(ze[jn],ze,Z,p)}if(se[Uh]!==null){let ve=se[Uh];for(let ze=0;ze<ve.length;ze++){let at=ve[ze];E1(at[jn],at,Z,p)}}}}}return p}function hz(l,s){return l[ka].queries[s].queryList}function dz(l,s,m){let p=new n1((m&4)===4);return KF(l,s,p,p.destroy),(s[ka]??=new x1).queries.push(new v1(p))-1}function fz(l,s,m){let p=ea();return p.firstCreatePass&&(mz(p,new b1(l,s,m),-1),(s&2)===2&&(p.staticViewQueries=!0)),dz(p,Fr(),s)}function pz(l){return l.split(",").map(s=>s.trim())}function mz(l,s,m){l.queries===null&&(l.queries=new w1),l.queries.track(new T1(s,m))}function mb(l,s){return l.queries.getByIndex(s)}function gz(l,s){let m=l[jn],p=mb(m,s);return p.crossesNgTemplate?E1(m,l,s,[]):nA(m,l,p,s)}function _z(l){let s=[],m=new Map;function p(y){let i=m.get(y);if(!i){let C=l(y);m.set(y,i=C.then(bz))}return i}return ey.forEach((y,i)=>{let C=[];y.templateUrl&&C.push(p(y.templateUrl).then(Z=>{y.template=Z}));let O=typeof y.styles=="string"?[y.styles]:y.styles||[];if(y.styles=O,y.styleUrl&&y.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(y.styleUrls?.length){let Z=y.styles.length,se=y.styleUrls;y.styleUrls.forEach((ve,ze)=>{O.push(""),C.push(p(ve).then(at=>{O[Z+ze]=at,se.splice(se.indexOf(ve),1),se.length==0&&(y.styleUrls=void 0)}))})}else y.styleUrl&&C.push(p(y.styleUrl).then(Z=>{O.push(Z),y.styleUrl=void 0}));let j=Promise.all(C).then(()=>wz(i));s.push(j)}),vz(),Promise.all(s).then(()=>{})}var ey=new Map,yz=new Set;function vz(){let l=ey;return ey=new Map,l}function xz(){return ey.size===0}function bz(l){return typeof l=="string"?l:l.text()}function wz(l){yz.delete(l)}var Ul=class{},Ap=class{};var ty=class extends Ul{constructor(s,m,p){super(),this._parent=m,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Q_(this);let y=MC(s);this._bootstrapComponents=wS(y.bootstrap),this._r3Injector=fS(s,m,[{provide:Ul,useValue:this},{provide:by,useValue:this.componentFactoryResolver},...p],qi(s),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(s)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(m=>m()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},ny=class extends Ap{constructor(s){super(),this.moduleType=s}create(s){return new ty(this.moduleType,s,[])}};function Tz(l,s,m){return new ty(l,s,m)}var I1=class extends Ul{constructor(s){super(),this.componentFactoryResolver=new Q_(this),this.instance=null;let m=new Tp([...s.providers,{provide:Ul,useValue:this},{provide:by,useValue:this.componentFactoryResolver}],s.parent||j1(),s.debugName,new Set(["environment"]));this.injector=m,s.runEnvironmentInitializers&&m.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function Ey(l,s,m=null){return new I1({providers:l,parent:s,debugName:m,runEnvironmentInitializers:!0}).injector}var cu=(()=>{let s=class s{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ti(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let p=this.taskId++;return this.pendingTasks.add(p),p}remove(p){this.pendingTasks.delete(p),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function rA(l){return Iz(l)?Array.isArray(l)||!(l instanceof Map)&&Symbol.iterator in l:!1}function Ez(l,s){if(Array.isArray(l))for(let m=0;m<l.length;m++)s(l[m]);else{let m=l[Symbol.iterator](),p;for(;!(p=m.next()).done;)s(p.value)}}function Iz(l){return l!==null&&(typeof l=="function"||typeof l=="object")}function gb(l,s,m){let p=l[s];return Object.is(p,m)?!1:(l[s]=m,!0)}function Dz(l){return(l.flags&32)===32}function Mz(l,s,m,p,y,i,C,O,j){let Z=s.consts,se=yy(s,l,4,C||null,q_(Z,O));jS(s,m,se,q_(Z,j)),Y1(s,se);let ve=se.tView=lb(2,se,p,y,i,s.directiveRegistry,s.pipeRegistry,null,s.schemas,Z,null);return s.queries!==null&&(s.queries.template(s,se),ve.queries=s.queries.embeddedTView(se)),se}function Jh(l,s,m,p,y,i,C,O){let j=Fr(),Z=ea(),se=l+Fa,ve=Z.firstCreatePass?Mz(se,Z,j,s,m,p,y,i,C):Z.data[se];zp(ve,!1);let ze=Cz(Z,j,ve,l);Z1()&&sb(Z,j,ze,ve),ou(ze,j);let at=$S(ze,j,ze,ve);return j[se]=at,vy(j,at),oz(at,ve,j),U1(ve)&&FS(Z,j,ve),C!=null&&zS(j,ve,O),Jh}var Cz=Sz;function Sz(l,s,m,p){return X1(!0),s[Fi].createComment("")}function Az(l,s,m,p){return gb(l,ZC(),m)?s+mC(m)+p:Yh}function R_(l,s){return l<<17|s<<2}function lu(l){return l>>17&32767}function Pz(l){return(l&2)==2}function Rz(l,s){return l&131071|s<<17}function D1(l){return l|2}function Hh(l){return(l&131068)>>2}function Bx(l,s){return l&-131069|s<<2}function Lz(l){return(l&1)===1}function M1(l){return l|1}function Oz(l,s,m,p,y,i){let C=i?s.classBindings:s.styleBindings,O=lu(C),j=Hh(C);l[p]=m;let Z=!1,se;if(Array.isArray(m)){let ve=m;se=ve[1],(se===null||Lp(ve,se)>0)&&(Z=!0)}else se=m;if(y)if(j!==0){let ze=lu(l[O+1]);l[p+1]=R_(ze,O),ze!==0&&(l[ze+1]=Bx(l[ze+1],p)),l[O+1]=Rz(l[O+1],p)}else l[p+1]=R_(O,0),O!==0&&(l[O+1]=Bx(l[O+1],p)),O=p;else l[p+1]=R_(j,0),O===0?O=p:l[j+1]=Bx(l[j+1],p),j=p;Z&&(l[p+1]=D1(l[p+1])),eC(l,se,p,!0),eC(l,se,p,!1),Nz(s,se,l,p,i),C=R_(O,j),i?s.classBindings=C:s.styleBindings=C}function Nz(l,s,m,p,y){let i=y?l.residualClasses:l.residualStyles;i!=null&&typeof s=="string"&&Lp(i,s)>=0&&(m[p+1]=M1(m[p+1]))}function eC(l,s,m,p){let y=l[m+1],i=s===null,C=p?lu(y):Hh(y),O=!1;for(;C!==0&&(O===!1||i);){let j=l[C],Z=l[C+1];kz(j,s)&&(O=!0,l[C+1]=p?M1(Z):D1(Z)),C=p?lu(Z):Hh(Z)}O&&(l[m+1]=p?D1(y):M1(y))}function kz(l,s){return l===null||s==null||(Array.isArray(l)?l[1]:l)===s?!0:Array.isArray(l)&&typeof s=="string"?Lp(l,s)>=0:!1}function ql(l,s,m){let p=Fr(),y=ZC();if(gb(p,y,s)){let i=ea(),C=Hk();t3(i,C,p,l,s,p[Fi],m,!1)}return ql}function tC(l,s,m,p,y){let i=s.inputs,C=y?"class":"style";cb(l,m,i[C],C,p)}function _b(l,s){return Fz(l,s,null,!0),_b}function Fz(l,s,m,p){let y=Fr(),i=ea(),C=zk(2);if(i.firstUpdatePass&&Bz(i,l,C,p),s!==Yh&&gb(y,C,s)){let O=i.data[Zh()];Gz(i,O,y,y[Fi],l,y[C+1]=Hz(s,m),p,C)}}function zz(l,s){return s>=l.expandoStartIndex}function Bz(l,s,m,p){let y=l.data;if(y[m+1]===null){let i=y[Zh()],C=zz(l,m);qz(i,p)&&s===null&&!C&&(s=!1),s=jz(y,i,s,p),Oz(y,i,s,m,C,p)}}function jz(l,s,m,p){let y=Uk(l),i=p?s.residualClasses:s.residualStyles;if(y===null)(p?s.classBindings:s.styleBindings)===0&&(m=jx(null,l,s,m,p),m=Pp(m,s.attrs,p),i=null);else{let C=s.directiveStylingLast;if(C===-1||l[C]!==y)if(m=jx(y,l,s,m,p),i===null){let j=Vz(l,s,p);j!==void 0&&Array.isArray(j)&&(j=jx(null,l,s,j[1],p),j=Pp(j,s.attrs,p),Uz(l,s,p,j))}else i=$z(l,s,p)}return i!==void 0&&(p?s.residualClasses=i:s.residualStyles=i),m}function Vz(l,s,m){let p=m?s.classBindings:s.styleBindings;if(Hh(p)!==0)return l[lu(p)]}function Uz(l,s,m,p){let y=m?s.classBindings:s.styleBindings;l[lu(y)]=p}function $z(l,s,m){let p,y=s.directiveEnd;for(let i=1+s.directiveStylingLast;i<y;i++){let C=l[i].hostAttrs;p=Pp(p,C,m)}return Pp(p,s.attrs,m)}function jx(l,s,m,p,y){let i=null,C=m.directiveEnd,O=m.directiveStylingLast;for(O===-1?O=m.directiveStart:O++;O<C&&(i=s[O],p=Pp(p,i.hostAttrs,y),i!==l);)O++;return l!==null&&(m.directiveStylingLast=O),p}function Pp(l,s,m){let p=m?1:2,y=-1;if(s!==null)for(let i=0;i<s.length;i++){let C=s[i];typeof C=="number"?y=C:y===p&&(Array.isArray(l)||(l=l===void 0?[]:["",l]),kN(l,C,m?!0:s[++i]))}return l===void 0?null:l}function Gz(l,s,m,p,y,i,C,O){if(!(s.type&3))return;let j=l.data,Z=j[O+1],se=Lz(Z)?nC(j,s,m,y,Hh(Z),C):void 0;if(!ry(se)){ry(i)||Pz(Z)&&(i=nC(j,null,m,y,O,C));let ve=VC(Zh(),m);$F(p,C,ve,y,i)}}function nC(l,s,m,p,y,i){let C=s===null,O;for(;y>0;){let j=l[y],Z=Array.isArray(j),se=Z?j[1]:j,ve=se===null,ze=m[y+1];ze===Yh&&(ze=ve?hs:void 0);let at=ve?Sx(ze,p):se===p?ze:void 0;if(Z&&!ry(at)&&(at=Sx(j,p)),ry(at)&&(O=at,C))return O;let Wt=l[y+1];y=C?lu(Wt):Hh(Wt)}if(s!==null){let j=i?s.residualClasses:s.residualStyles;j!=null&&(O=Sx(j,p))}return O}function ry(l){return l!==void 0}function Hz(l,s){return l==null||l===""||(typeof s=="string"?l=l+s:typeof l=="object"&&(l=qi(rb(l)))),l}function qz(l,s){return(l.flags&(s?8:16))!==0}function Wz(l,s,m,p,y,i){let C=s.consts,O=q_(C,y),j=yy(s,l,2,p,O);return jS(s,m,j,q_(C,i)),j.attrs!==null&&g1(j,j.attrs,!1),j.mergedAttrs!==null&&g1(j,j.mergedAttrs,!0),s.queries!==null&&s.queries.elementStart(s,j),j}function Ii(l,s,m,p){let y=Fr(),i=ea(),C=Fa+l,O=y[Fi],j=i.firstCreatePass?Wz(C,i,y,s,m,p):i.data[C],Z=Zz(i,y,j,O,s,l);y[C]=Z;let se=U1(j);return zp(j,!0),AS(O,Z,j),!Dz(j)&&Z1()&&sb(i,y,Z,j),Ck()===0&&ou(Z,y),Sk(),se&&(FS(i,y,j),kS(i,j,y)),p!==null&&zS(y,j),Ii}function Di(){let l=_s();WC()?Nk():(l=l.parent,zp(l,!1));let s=l;Rk(s)&&Lk(),Ak();let m=ea();return m.firstCreatePass&&(Y1(m,l),kC(l)&&m.queries.elementEnd(l)),s.classesWithoutHost!=null&&Yk(s)&&tC(m,s,Fr(),s.classesWithoutHost,!0),s.stylesWithoutHost!=null&&Kk(s)&&tC(m,s,Fr(),s.stylesWithoutHost,!1),Di}function Yi(l,s,m,p){return Ii(l,s,m,p),Di(),Yi}var Zz=(l,s,m,p,y,i)=>(X1(!0),TS(p,y,qk()));function Iy(){return Fr()}var iy="en-US";var Xz=iy;function Yz(l){typeof l=="string"&&(Xz=l.toLowerCase().replace(/_/g,"-"))}function Va(l,s,m,p){let y=Fr(),i=ea(),C=_s();return Jz(i,y,y[Fi],C,l,s,p),Va}function Kz(l,s,m,p){let y=l.cleanup;if(y!=null)for(let i=0;i<y.length-1;i+=2){let C=y[i];if(C===m&&y[i+1]===p){let O=s[Ep],j=y[i+2];return O.length>j?O[j]:null}typeof C=="string"&&(i+=2)}return null}function Jz(l,s,m,p,y,i,C){let O=U1(p),Z=l.firstCreatePass&&qS(l),se=s[fs],ve=HS(s),ze=!0;if(p.type&3||C){let Pn=gs(p,s),Zt=C?C(Pn):Pn,Qt=ve.length,Tr=C?qn=>C(Js(qn[p.index])):p.index,gr=null;if(!C&&O&&(gr=Kz(l,s,y,p.index)),gr!==null){let qn=gr.__ngLastListenerFn__||gr;qn.__ngNextListenerFn__=i,gr.__ngLastListenerFn__=i,ze=!1}else{i=iC(p,s,se,i,!1);let qn=m.listen(Zt,y,i);ve.push(i,qn),Z&&Z.push(y,Tr,Qt,Qt+1)}}else i=iC(p,s,se,i,!1);let at=p.outputs,Wt;if(ze&&at!==null&&(Wt=at[y])){let Pn=Wt.length;if(Pn)for(let Zt=0;Zt<Pn;Zt+=2){let Qt=Wt[Zt],Tr=Wt[Zt+1],Br=s[Qt][Tr].subscribe(i),Ge=ve.length;ve.push(i,Br),Z&&Z.push(y,p.index,Ge,-(Ge+1))}}}function rC(l,s,m,p){let y=or(null);try{return Ws(6,s,m),m(p)!==!1}catch(i){return WS(l,i),!1}finally{Ws(7,s,m),or(y)}}function iC(l,s,m,p,y){return function i(C){if(C===Function)return p;let O=l.componentOffset>-1?$l(l.index,s):s;hb(O);let j=rC(s,m,p,C),Z=i.__ngNextListenerFn__;for(;Z;)j=rC(s,m,Z,C)&&j,Z=Z.__ngNextListenerFn__;return y&&j===!1&&C.preventDefault(),j}}function Bp(l=1){return Gk(l)}function iA(l,s,m){fz(l,s,m)}function yb(l){let s=Fr(),m=ea(),p=XC();H1(p+1);let y=mb(m,p);if(l.dirty&&Tk(s)===((y.metadata.flags&2)===2)){if(y.matches===null)l.reset([]);else{let i=gz(s,p);l.reset(i,uF),l.notifyOnChanges()}return!0}return!1}function vb(){return hz(Fr(),XC())}function Dy(l){let s=kk();return wk(s,Fa+l)}function ys(l,s=""){let m=Fr(),p=ea(),y=l+Fa,i=p.firstCreatePass?yy(p,y,1,s,null):p.data[y],C=Qz(p,m,i,s,l);m[y]=C,Z1()&&sb(p,m,C,i),zp(i,!1)}var Qz=(l,s,m,p,y)=>(X1(!0),EF(s[Fi],p));function My(l){return oA("",l,""),My}function oA(l,s,m){let p=Fr(),y=Az(p,l,s,m);return y!==Yh&&m3(p,Zh(),y),oA}var eB=(()=>{let s=class s{constructor(p){this._injector=p,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(p){if(!p.standalone)return null;if(!this.cachedInjectors.has(p)){let y=AC(!1,p.type),i=y.length>0?Ey([y],this._injector,`Standalone[${p.type.name}]`):null;this.cachedInjectors.set(p,i)}return this.cachedInjectors.get(p)}ngOnDestroy(){try{for(let p of this.cachedInjectors.values())p!==null&&p.destroy()}finally{this.cachedInjectors.clear()}}};s.\u0275prov=Ft({token:s,providedIn:"environment",factory:()=>new s(Nt(Wi))});let l=s;return l})();function sA(l){Ty("NgStandalone"),l.getStandaloneInjector=s=>s.get(eB).getOrCreateStandaloneInjector(l)}function aA(l,s){return xy(l,s)}var L_=null;function tB(l){L_!==null&&(l.defaultEncapsulation!==L_.defaultEncapsulation||l.preserveWhitespaces!==L_.preserveWhitespaces)||(L_=l)}var Cy=(()=>{let s=class s{log(p){console.log(p)}warn(p){console.warn(p)}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"platform"});let l=s;return l})();var xb=new sn(""),jp=new sn(""),Sy=(()=>{let s=class s{constructor(p,y,i){this._ngZone=p,this.registry=y,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,bb||(nB(i),i.addToWindow(y)),this._watchAngularEvents(),p.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{br.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&this._pendingCount===0&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let p=this._callbacks.pop();clearTimeout(p.timeoutId),p.doneCb()}});else{let p=this.getPendingTasks();this._callbacks=this._callbacks.filter(y=>y.updateCb&&y.updateCb(p)?(clearTimeout(y.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(p=>({source:p.source,creationLocation:p.creationLocation,data:p.data})):[]}addCallback(p,y,i){let C=-1;y&&y>0&&(C=setTimeout(()=>{this._callbacks=this._callbacks.filter(O=>O.timeoutId!==C),p()},y)),this._callbacks.push({doneCb:p,timeoutId:C,updateCb:i})}whenStable(p,y,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(p,y,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(p){this.registry.registerApplication(p,this)}unregisterApplication(p){this.registry.unregisterApplication(p)}findProviders(p,y,i){return[]}};s.\u0275fac=function(y){return new(y||s)(Nt(br),Nt(Ay),Nt(jp))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),Ay=(()=>{let s=class s{constructor(){this._applications=new Map}registerApplication(p,y){this._applications.set(p,y)}unregisterApplication(p){this._applications.delete(p)}unregisterAllApplications(){this._applications.clear()}getTestability(p){return this._applications.get(p)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(p,y=!0){return bb?.findTestabilityInTree(this,p,y)??null}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"platform"});let l=s;return l})();function nB(l){bb=l}var bb;function Vp(l){return!!l&&typeof l.then=="function"}function lA(l){return!!l&&typeof l.subscribe=="function"}var Py=new sn(""),cA=(()=>{let s=class s{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((p,y)=>{this.resolve=p,this.reject=y}),this.appInits=Tt(Py,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let p=[];for(let i of this.appInits){let C=i();if(Vp(C))p.push(C);else if(lA(C)){let O=new Promise((j,Z)=>{C.subscribe({complete:j,error:Z})});p.push(O)}}let y=()=>{this.done=!0,this.resolve()};Promise.all(p).then(()=>{y()}).catch(i=>{this.reject(i)}),p.length===0&&y(),this.initialized=!0}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),Ry=new sn("");function rB(){XD(()=>{throw new rn(600,!1)})}function iB(l){return l.isBoundToModule}function oB(l,s,m){try{let p=m();return Vp(p)?p.catch(y=>{throw s.runOutsideAngular(()=>l.handleError(y)),y}):p}catch(p){throw s.runOutsideAngular(()=>l.handleError(p)),p}}function uA(l,s){return Array.isArray(s)?s.reduce(uA,l):Pt(Pt({},l),s)}var uu=(()=>{let s=class s{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Tt(pS),this.afterRenderEffectManager=Tt(pb),this.externalTestViews=new Set,this.beforeRender=new Hi,this.afterTick=new Hi,this.componentTypes=[],this.components=[],this.isStable=Tt(cu).hasPendingTasks.pipe(kn(p=>!p)),this._injector=Tt(Wi)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(p,y){let i=p instanceof J_;if(!this._injector.get(cA).done){let at=!i&&DC(p),Wt=!1;throw new rn(405,Wt)}let O;i?O=p:O=this._injector.get(by).resolveComponentFactory(p),this.componentTypes.push(O.componentType);let j=iB(O)?void 0:this._injector.get(Ul),Z=y||O.selector,se=O.create(ta.NULL,[],Z,j),ve=se.location.nativeElement,ze=se.injector.get(xb,null);return ze?.registerApplication(ve),se.onDestroy(()=>{this.detachView(se.hostView),B_(this.components,se),ze?.unregisterApplication(ve)}),this._loadComponent(se),se}tick(){this._tick(!0)}_tick(p){if(this._runningTick)throw new rn(101,!1);let y=or(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(p)}catch(i){this.internalErrorHandler(i)}finally{this.afterTick.next(),this._runningTick=!1,or(y)}}detectChangesInAttachedViews(p){let y=0,i=this.afterRenderEffectManager;for(;;){if(y===XS)throw new rn(103,!1);if(p){let C=y===0;this.beforeRender.next(C);for(let{_lView:O,notifyErrorHandler:j}of this._views)sB(O,C,j)}if(y++,i.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:C})=>C1(C))&&(i.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:C})=>C1(C))))break}}attachView(p){let y=p;this._views.push(y),y.attachToAppRef(this)}detachView(p){let y=p;B_(this._views,y),y.detachFromAppRef()}_loadComponent(p){this.attachView(p.hostView),this.tick(),this.components.push(p);let y=this._injector.get(Ry,[]);[...this._bootstrapListeners,...y].forEach(i=>i(p))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(p=>p()),this._views.slice().forEach(p=>p.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(p){return this._destroyListeners.push(p),()=>B_(this._destroyListeners,p)}destroy(){if(this._destroyed)throw new rn(406,!1);let p=this._injector;p.destroy&&!p.destroyed&&p.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function B_(l,s){let m=l.indexOf(s);m>-1&&l.splice(m,1)}function sB(l,s,m){!s&&!C1(l)||aB(l,m,s)}function C1(l){return G1(l)}function aB(l,s,m){let p;m?(p=0,l[bn]|=1024):l[bn]&64?p=0:p=1,YS(l,s,p)}var S1=class{constructor(s,m){this.ngModuleFactory=s,this.componentFactories=m}},Ly=(()=>{let s=class s{compileModuleSync(p){return new ny(p)}compileModuleAsync(p){return Promise.resolve(this.compileModuleSync(p))}compileModuleAndAllComponentsSync(p){let y=this.compileModuleSync(p),i=MC(p),C=wS(i.declarations).reduce((O,j)=>{let Z=Vl(j);return Z&&O.push(new Gh(Z)),O},[]);return new S1(y,C)}compileModuleAndAllComponentsAsync(p){return Promise.resolve(this.compileModuleAndAllComponentsSync(p))}clearCache(){}clearCacheFor(p){}getModuleId(p){}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),lB=new sn("");function cB(l,s,m){let p=new ny(m);return Promise.resolve(p)}function oC(l){for(let s=l.length-1;s>=0;s--)if(l[s]!==void 0)return l[s]}var uB=(()=>{let s=class s{constructor(){this.zone=Tt(br),this.applicationRef=Tt(uu)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function hB(l){return[{provide:br,useFactory:l},{provide:jh,multi:!0,useFactory:()=>{let s=Tt(uB,{optional:!0});return()=>s.initialize()}},{provide:jh,multi:!0,useFactory:()=>{let s=Tt(pB);return()=>{s.initialize()}}},{provide:pS,useFactory:dB}]}function dB(){let l=Tt(br),s=Tt(Qs);return m=>l.runOutsideAngular(()=>s.handleError(m))}function fB(l){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:l?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:l?.runCoalescing??!1}}var pB=(()=>{let s=class s{constructor(){this.subscription=new ai,this.initialized=!1,this.zone=Tt(br),this.pendingTasks=Tt(cu)}initialize(){if(this.initialized)return;this.initialized=!0;let p=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(p=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{br.assertNotInAngularZone(),queueMicrotask(()=>{p!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(p),p=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{br.assertInAngularZone(),p??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function mB(){return typeof $localize<"u"&&$localize.locale||iy}var wb=new sn("",{providedIn:"root",factory:()=>Tt(wb,Bn.Optional|Bn.SkipSelf)||mB()});var hA=new sn(""),dA=(()=>{let s=class s{constructor(p){this._injector=p,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(p,y){let i=G3(y?.ngZone,fB({eventCoalescing:y?.ngZoneEventCoalescing,runCoalescing:y?.ngZoneRunCoalescing}));return i.run(()=>{let C=Tz(p.moduleType,this.injector,hB(()=>i)),O=C.injector.get(Qs,null);return i.runOutsideAngular(()=>{let j=i.onError.subscribe({next:Z=>{O.handleError(Z)}});C.onDestroy(()=>{B_(this._modules,C),j.unsubscribe()})}),oB(O,i,()=>{let j=C.injector.get(cA);return j.runInitializers(),j.donePromise.then(()=>{let Z=C.injector.get(wb,iy);return Yz(Z||iy),this._moduleDoBootstrap(C),C})})})}bootstrapModule(p,y=[]){let i=uA({},y);return cB(this.injector,i,p).then(C=>this.bootstrapModuleFactory(C,i))}_moduleDoBootstrap(p){let y=p.injector.get(uu);if(p._bootstrapComponents.length>0)p._bootstrapComponents.forEach(i=>y.bootstrap(i));else if(p.instance.ngDoBootstrap)p.instance.ngDoBootstrap(y);else throw new rn(-403,!1);this._modules.push(p)}onDestroy(p){this._destroyListeners.push(p)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new rn(404,!1);this._modules.slice().forEach(y=>y.destroy()),this._destroyListeners.forEach(y=>y());let p=this._injector.get(hA,null);p&&(p.forEach(y=>y()),p.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};s.\u0275fac=function(y){return new(y||s)(Nt(ta))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"platform"});let l=s;return l})(),xp=null,fA=new sn("");function gB(l){if(xp&&!xp.get(fA,!1))throw new rn(400,!1);rB(),xp=l;let s=l.get(dA);return vB(l),s}function Tb(l,s,m=[]){let p=`Platform: ${s}`,y=new sn(p);return(i=[])=>{let C=pA();if(!C||C.injector.get(fA,!1)){let O=[...m,...i,{provide:y,useValue:!0}];l?l(O):gB(_B(O,p))}return yB(y)}}function _B(l=[],s){return ta.create({name:s,providers:[{provide:hy,useValue:"platform"},{provide:hA,useValue:new Set([()=>xp=null])},...l]})}function yB(l){let s=pA();if(!s)throw new rn(401,!1);return s}function pA(){return xp?.get(dA)??null}function vB(l){l.get(eb,null)?.forEach(m=>m())}var Up=(()=>{let s=class s{};s.__NG_ELEMENT_ID__=xB;let l=s;return l})();function xB(l){return bB(_s(),Fr(),(l&16)===16)}function bB(l,s,m){if(fy(l)&&!m){let p=$l(l.index,s);return new su(p,p)}else if(l.type&47){let p=s[Ks];return new su(p,s)}return null}var A1=class{constructor(){}supports(s){return rA(s)}create(s){return new P1(s)}},wB=(l,s)=>s,P1=class{constructor(s){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=s||wB}forEachItem(s){let m;for(m=this._itHead;m!==null;m=m._next)s(m)}forEachOperation(s){let m=this._itHead,p=this._removalsHead,y=0,i=null;for(;m||p;){let C=!p||m&&m.currentIndex<sC(p,y,i)?m:p,O=sC(C,y,i),j=C.currentIndex;if(C===p)y--,p=p._nextRemoved;else if(m=m._next,C.previousIndex==null)y++;else{i||(i=[]);let Z=O-y,se=j-y;if(Z!=se){for(let ze=0;ze<Z;ze++){let at=ze<i.length?i[ze]:i[ze]=0,Wt=at+ze;se<=Wt&&Wt<Z&&(i[ze]=at+1)}let ve=C.previousIndex;i[ve]=se-Z}}O!==j&&s(C,O,j)}}forEachPreviousItem(s){let m;for(m=this._previousItHead;m!==null;m=m._nextPrevious)s(m)}forEachAddedItem(s){let m;for(m=this._additionsHead;m!==null;m=m._nextAdded)s(m)}forEachMovedItem(s){let m;for(m=this._movesHead;m!==null;m=m._nextMoved)s(m)}forEachRemovedItem(s){let m;for(m=this._removalsHead;m!==null;m=m._nextRemoved)s(m)}forEachIdentityChange(s){let m;for(m=this._identityChangesHead;m!==null;m=m._nextIdentityChange)s(m)}diff(s){if(s==null&&(s=[]),!rA(s))throw new rn(900,!1);return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let m=this._itHead,p=!1,y,i,C;if(Array.isArray(s)){this.length=s.length;for(let O=0;O<this.length;O++)i=s[O],C=this._trackByFn(O,i),m===null||!Object.is(m.trackById,C)?(m=this._mismatch(m,i,C,O),p=!0):(p&&(m=this._verifyReinsertion(m,i,C,O)),Object.is(m.item,i)||this._addIdentityChange(m,i)),m=m._next}else y=0,Ez(s,O=>{C=this._trackByFn(y,O),m===null||!Object.is(m.trackById,C)?(m=this._mismatch(m,O,C,y),p=!0):(p&&(m=this._verifyReinsertion(m,O,C,y)),Object.is(m.item,O)||this._addIdentityChange(m,O)),m=m._next,y++}),this.length=y;return this._truncate(m),this.collection=s,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let s;for(s=this._previousItHead=this._itHead;s!==null;s=s._next)s._nextPrevious=s._next;for(s=this._additionsHead;s!==null;s=s._nextAdded)s.previousIndex=s.currentIndex;for(this._additionsHead=this._additionsTail=null,s=this._movesHead;s!==null;s=s._nextMoved)s.previousIndex=s.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(s,m,p,y){let i;return s===null?i=this._itTail:(i=s._prev,this._remove(s)),s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(p,null),s!==null?(Object.is(s.item,m)||this._addIdentityChange(s,m),this._reinsertAfter(s,i,y)):(s=this._linkedRecords===null?null:this._linkedRecords.get(p,y),s!==null?(Object.is(s.item,m)||this._addIdentityChange(s,m),this._moveAfter(s,i,y)):s=this._addAfter(new R1(m,p),i,y)),s}_verifyReinsertion(s,m,p,y){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(p,null);return i!==null?s=this._reinsertAfter(i,s._prev,y):s.currentIndex!=y&&(s.currentIndex=y,this._addToMoves(s,y)),s}_truncate(s){for(;s!==null;){let m=s._next;this._addToRemovals(this._unlink(s)),s=m}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(s,m,p){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(s);let y=s._prevRemoved,i=s._nextRemoved;return y===null?this._removalsHead=i:y._nextRemoved=i,i===null?this._removalsTail=y:i._prevRemoved=y,this._insertAfter(s,m,p),this._addToMoves(s,p),s}_moveAfter(s,m,p){return this._unlink(s),this._insertAfter(s,m,p),this._addToMoves(s,p),s}_addAfter(s,m,p){return this._insertAfter(s,m,p),this._additionsTail===null?this._additionsTail=this._additionsHead=s:this._additionsTail=this._additionsTail._nextAdded=s,s}_insertAfter(s,m,p){let y=m===null?this._itHead:m._next;return s._next=y,s._prev=m,y===null?this._itTail=s:y._prev=s,m===null?this._itHead=s:m._next=s,this._linkedRecords===null&&(this._linkedRecords=new oy),this._linkedRecords.put(s),s.currentIndex=p,s}_remove(s){return this._addToRemovals(this._unlink(s))}_unlink(s){this._linkedRecords!==null&&this._linkedRecords.remove(s);let m=s._prev,p=s._next;return m===null?this._itHead=p:m._next=p,p===null?this._itTail=m:p._prev=m,s}_addToMoves(s,m){return s.previousIndex===m||(this._movesTail===null?this._movesTail=this._movesHead=s:this._movesTail=this._movesTail._nextMoved=s),s}_addToRemovals(s){return this._unlinkedRecords===null&&(this._unlinkedRecords=new oy),this._unlinkedRecords.put(s),s.currentIndex=null,s._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=s,s._prevRemoved=null):(s._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=s),s}_addIdentityChange(s,m){return s.item=m,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=s:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=s,s}},R1=class{constructor(s,m){this.item=s,this.trackById=m,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},L1=class{constructor(){this._head=null,this._tail=null}add(s){this._head===null?(this._head=this._tail=s,s._nextDup=null,s._prevDup=null):(this._tail._nextDup=s,s._prevDup=this._tail,s._nextDup=null,this._tail=s)}get(s,m){let p;for(p=this._head;p!==null;p=p._nextDup)if((m===null||m<=p.currentIndex)&&Object.is(p.trackById,s))return p;return null}remove(s){let m=s._prevDup,p=s._nextDup;return m===null?this._head=p:m._nextDup=p,p===null?this._tail=m:p._prevDup=m,this._head===null}},oy=class{constructor(){this.map=new Map}put(s){let m=s.trackById,p=this.map.get(m);p||(p=new L1,this.map.set(m,p)),p.add(s)}get(s,m){let p=s,y=this.map.get(p);return y?y.get(s,m):null}remove(s){let m=s.trackById;return this.map.get(m).remove(s)&&this.map.delete(m),s}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function sC(l,s,m){let p=l.previousIndex;if(p===null)return p;let y=0;return m&&p<m.length&&(y=m[p]),p+s+y}function aC(){return new Eb([new A1])}var Eb=(()=>{let s=class s{constructor(p){this.factories=p}static create(p,y){if(y!=null){let i=y.factories.slice();p=p.concat(i)}return new s(p)}static extend(p){return{provide:s,useFactory:y=>s.create(p,y||aC()),deps:[[s,new N1,new cy]]}}find(p){let y=this.factories.find(i=>i.supports(p));if(y!=null)return y;throw new rn(901,!1)}};s.\u0275prov=Ft({token:s,providedIn:"root",factory:aC});let l=s;return l})();var mA=Tb(null,"core",[]),gA=(()=>{let s=class s{constructor(p){}};s.\u0275fac=function(y){return new(y||s)(Nt(uu))},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({});let l=s;return l})();function _A(l){let s=Vl(l);if(!s)return null;let m=new Gh(s);return{get selector(){return m.selector},get type(){return m.componentType},get inputs(){return m.inputs},get outputs(){return m.outputs},get ngContentSelectors(){return m.ngContentSelectors},get isStandalone(){return s.standalone},get isSignal(){return s.signals}}}var EA=null;function hu(){return EA}function IA(l){EA??=l}var Oy=class{};var zi=new sn(""),Ab=(()=>{let s=class s{historyGo(p){throw new Error("")}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>Tt(DB),providedIn:"platform"});let l=s;return l})(),DA=new sn(""),DB=(()=>{let s=class s extends Ab{constructor(){super(),this._doc=Tt(zi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return hu().getBaseHref(this._doc)}onPopState(p){let y=hu().getGlobalEventTarget(this._doc,"window");return y.addEventListener("popstate",p,!1),()=>y.removeEventListener("popstate",p)}onHashChange(p){let y=hu().getGlobalEventTarget(this._doc,"window");return y.addEventListener("hashchange",p,!1),()=>y.removeEventListener("hashchange",p)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(p){this._location.pathname=p}pushState(p,y,i){this._history.pushState(p,y,i)}replaceState(p,y,i){this._history.replaceState(p,y,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(p=0){this._history.go(p)}getState(){return this._history.state}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>new s,providedIn:"platform"});let l=s;return l})();function Pb(l,s){if(l.length==0)return s;if(s.length==0)return l;let m=0;return l.endsWith("/")&&m++,s.startsWith("/")&&m++,m==2?l+s.substring(1):m==1?l+s:l+"/"+s}function yA(l){let s=l.match(/#|\?|$/),m=s&&s.index||l.length,p=m-(l[m-1]==="/"?1:0);return l.slice(0,p)+l.slice(m)}function Ua(l){return l&&l[0]!=="?"?"?"+l:l}var du=(()=>{let s=class s{historyGo(p){throw new Error("")}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>Tt(Rb),providedIn:"root"});let l=s;return l})(),MA=new sn(""),Rb=(()=>{let s=class s extends du{constructor(p,y){super(),this._platformLocation=p,this._removeListenerFns=[],this._baseHref=y??this._platformLocation.getBaseHrefFromDOM()??Tt(zi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(p){this._removeListenerFns.push(this._platformLocation.onPopState(p),this._platformLocation.onHashChange(p))}getBaseHref(){return this._baseHref}prepareExternalUrl(p){return Pb(this._baseHref,p)}path(p=!1){let y=this._platformLocation.pathname+Ua(this._platformLocation.search),i=this._platformLocation.hash;return i&&p?`${y}${i}`:y}pushState(p,y,i,C){let O=this.prepareExternalUrl(i+Ua(C));this._platformLocation.pushState(p,y,O)}replaceState(p,y,i,C){let O=this.prepareExternalUrl(i+Ua(C));this._platformLocation.replaceState(p,y,O)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(p=0){this._platformLocation.historyGo?.(p)}};s.\u0275fac=function(y){return new(y||s)(Nt(Ab),Nt(MA,8))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),CA=(()=>{let s=class s extends du{constructor(p,y){super(),this._platformLocation=p,this._baseHref="",this._removeListenerFns=[],y!=null&&(this._baseHref=y)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(p){this._removeListenerFns.push(this._platformLocation.onPopState(p),this._platformLocation.onHashChange(p))}getBaseHref(){return this._baseHref}path(p=!1){let y=this._platformLocation.hash??"#";return y.length>0?y.substring(1):y}prepareExternalUrl(p){let y=Pb(this._baseHref,p);return y.length>0?"#"+y:y}pushState(p,y,i,C){let O=this.prepareExternalUrl(i+Ua(C));O.length==0&&(O=this._platformLocation.pathname),this._platformLocation.pushState(p,y,O)}replaceState(p,y,i,C){let O=this.prepareExternalUrl(i+Ua(C));O.length==0&&(O=this._platformLocation.pathname),this._platformLocation.replaceState(p,y,O)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(p=0){this._platformLocation.historyGo?.(p)}};s.\u0275fac=function(y){return new(y||s)(Nt(Ab),Nt(MA,8))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),ed=(()=>{let s=class s{constructor(p){this._subject=new ki,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=p;let y=this._locationStrategy.getBaseHref();this._basePath=SB(yA(vA(y))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(p=!1){return this.normalize(this._locationStrategy.path(p))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(p,y=""){return this.path()==this.normalize(p+Ua(y))}normalize(p){return s.stripTrailingSlash(CB(this._basePath,vA(p)))}prepareExternalUrl(p){return p&&p[0]!=="/"&&(p="/"+p),this._locationStrategy.prepareExternalUrl(p)}go(p,y="",i=null){this._locationStrategy.pushState(i,"",p,y),this._notifyUrlChangeListeners(this.prepareExternalUrl(p+Ua(y)),i)}replaceState(p,y="",i=null){this._locationStrategy.replaceState(i,"",p,y),this._notifyUrlChangeListeners(this.prepareExternalUrl(p+Ua(y)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(p=0){this._locationStrategy.historyGo?.(p)}onUrlChange(p){return this._urlChangeListeners.push(p),this._urlChangeSubscription??=this.subscribe(y=>{this._notifyUrlChangeListeners(y.url,y.state)}),()=>{let y=this._urlChangeListeners.indexOf(p);this._urlChangeListeners.splice(y,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(p="",y){this._urlChangeListeners.forEach(i=>i(p,y))}subscribe(p,y,i){return this._subject.subscribe({next:p,error:y,complete:i})}};s.normalizeQueryParams=Ua,s.joinWithSlash=Pb,s.stripTrailingSlash=yA,s.\u0275fac=function(y){return new(y||s)(Nt(du))},s.\u0275prov=Ft({token:s,factory:()=>MB(),providedIn:"root"});let l=s;return l})();function MB(){return new ed(Nt(du))}function CB(l,s){if(!l||!s.startsWith(l))return s;let m=s.substring(l.length);return m===""||["/",";","?","#"].includes(m[0])?m:s}function vA(l){return l.replace(/\/index.html$/,"")}function SB(l){if(new RegExp("^(https?:)?//").test(l)){let[,m]=l.split(/\/\/[^\/]+/);return m}return l}function Ny(l,s){s=encodeURIComponent(s);for(let m of l.split(";")){let p=m.indexOf("="),[y,i]=p==-1?[m,""]:[m.slice(0,p),m.slice(p+1)];if(y.trim()===s)return decodeURIComponent(i)}return null}var Ib=/\s+/,xA=[],SA=(()=>{let s=class s{constructor(p,y){this._ngEl=p,this._renderer=y,this.initialClasses=xA,this.stateMap=new Map}set klass(p){this.initialClasses=p!=null?p.trim().split(Ib):xA}set ngClass(p){this.rawClass=typeof p=="string"?p.trim().split(Ib):p}ngDoCheck(){for(let y of this.initialClasses)this._updateState(y,!0);let p=this.rawClass;if(Array.isArray(p)||p instanceof Set)for(let y of p)this._updateState(y,!0);else if(p!=null)for(let y of Object.keys(p))this._updateState(y,!!p[y]);this._applyStateDiff()}_updateState(p,y){let i=this.stateMap.get(p);i!==void 0?(i.enabled!==y&&(i.changed=!0,i.enabled=y),i.touched=!0):this.stateMap.set(p,{enabled:y,changed:!0,touched:!0})}_applyStateDiff(){for(let p of this.stateMap){let y=p[0],i=p[1];i.changed?(this._toggleClass(y,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(y,!1),this.stateMap.delete(y)),i.touched=!1}}_toggleClass(p,y){p=p.trim(),p.length>0&&p.split(Ib).forEach(i=>{y?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}};s.\u0275fac=function(y){return new(y||s)(zr(Gl),zr(wy))},s.\u0275dir=qh({type:s,selectors:[["","ngClass",""]],inputs:{klass:[Na.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let l=s;return l})();var Db=class{constructor(s,m,p,y){this.$implicit=s,this.ngForOf=m,this.index=p,this.count=y}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},AA=(()=>{let s=class s{set ngForOf(p){this._ngForOf=p,this._ngForOfDirty=!0}set ngForTrackBy(p){this._trackByFn=p}get ngForTrackBy(){return this._trackByFn}constructor(p,y,i){this._viewContainer=p,this._template=y,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(p){p&&(this._template=p)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let p=this._ngForOf;if(!this._differ&&p)if(0)try{}catch{}else this._differ=this._differs.find(p).create(this.ngForTrackBy)}if(this._differ){let p=this._differ.diff(this._ngForOf);p&&this._applyChanges(p)}}_applyChanges(p){let y=this._viewContainer;p.forEachOperation((i,C,O)=>{if(i.previousIndex==null)y.createEmbeddedView(this._template,new Db(i.item,this._ngForOf,-1,-1),O===null?void 0:O);else if(O==null)y.remove(C===null?void 0:C);else if(C!==null){let j=y.get(C);y.move(j,O),bA(j,i)}});for(let i=0,C=y.length;i<C;i++){let j=y.get(i).context;j.index=i,j.count=C,j.ngForOf=this._ngForOf}p.forEachIdentityChange(i=>{let C=y.get(i.currentIndex);bA(C,i)})}static ngTemplateContextGuard(p,y){return!0}};s.\u0275fac=function(y){return new(y||s)(zr(Hl),zr(au),zr(Eb))},s.\u0275dir=qh({type:s,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let l=s;return l})();function bA(l,s){l.context.$implicit=s.item}var ky=(()=>{let s=class s{constructor(p,y){this._viewContainer=p,this._context=new Mb,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=y}set ngIf(p){this._context.$implicit=this._context.ngIf=p,this._updateView()}set ngIfThen(p){wA("ngIfThen",p),this._thenTemplateRef=p,this._thenViewRef=null,this._updateView()}set ngIfElse(p){wA("ngIfElse",p),this._elseTemplateRef=p,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(p,y){return!0}};s.\u0275fac=function(y){return new(y||s)(zr(Hl),zr(au))},s.\u0275dir=qh({type:s,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let l=s;return l})(),Mb=class{constructor(){this.$implicit=null,this.ngIf=null}};function wA(l,s){if(!!!(!s||s.createEmbeddedView))throw new Error(`${l} must be a TemplateRef, but received '${qi(s)}'.`)}var Fy=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({});let l=s;return l})(),Lb="browser",AB="server";function PB(l){return l===Lb}function zy(l){return l===AB}var PA=(()=>{let s=class s{};s.\u0275prov=Ft({token:s,providedIn:"root",factory:()=>PB(Tt(na))?new Cb(Tt(zi),window):new Sb});let l=s;return l})(),Cb=class{constructor(s,m){this.document=s,this.window=m,this.offset=()=>[0,0]}setOffset(s){Array.isArray(s)?this.offset=()=>s:this.offset=s}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(s){this.window.scrollTo(s[0],s[1])}scrollToAnchor(s){let m=RB(this.document,s);m&&(this.scrollToElement(m),m.focus())}setHistoryScrollRestoration(s){this.window.history.scrollRestoration=s}scrollToElement(s){let m=s.getBoundingClientRect(),p=m.left+this.window.pageXOffset,y=m.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(p-i[0],y-i[1])}};function RB(l,s){let m=l.getElementById(s)||l.getElementsByName(s)[0];if(m)return m;if(typeof l.createTreeWalker=="function"&&l.body&&typeof l.body.attachShadow=="function"){let p=l.createTreeWalker(l.body,NodeFilter.SHOW_ELEMENT),y=p.currentNode;for(;y;){let i=y.shadowRoot;if(i){let C=i.getElementById(s)||i.querySelector(`[name="${s}"]`);if(C)return C}y=p.nextNode()}}return null}var Sb=class{setOffset(s){}getScrollPosition(){return[0,0]}scrollToPosition(s){}scrollToAnchor(s){}setHistoryScrollRestoration(s){}},Qh=class{};var $a=class{},jy=class{},fu=class l{constructor(s){this.normalizedNames=new Map,this.lazyUpdate=null,s?typeof s=="string"?this.lazyInit=()=>{this.headers=new Map,s.split(`
`).forEach(m=>{let p=m.indexOf(":");if(p>0){let y=m.slice(0,p),i=y.toLowerCase(),C=m.slice(p+1).trim();this.maybeSetNormalizedName(y,i),this.headers.has(i)?this.headers.get(i).push(C):this.headers.set(i,[C])}})}:typeof Headers<"u"&&s instanceof Headers?(this.headers=new Map,s.forEach((m,p)=>{this.setHeaderEntries(p,m)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(s).forEach(([m,p])=>{this.setHeaderEntries(m,p)})}:this.headers=new Map}has(s){return this.init(),this.headers.has(s.toLowerCase())}get(s){this.init();let m=this.headers.get(s.toLowerCase());return m&&m.length>0?m[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(s){return this.init(),this.headers.get(s.toLowerCase())||null}append(s,m){return this.clone({name:s,value:m,op:"a"})}set(s,m){return this.clone({name:s,value:m,op:"s"})}delete(s,m){return this.clone({name:s,value:m,op:"d"})}maybeSetNormalizedName(s,m){this.normalizedNames.has(m)||this.normalizedNames.set(m,s)}init(){this.lazyInit&&(this.lazyInit instanceof l?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(s=>this.applyUpdate(s)),this.lazyUpdate=null))}copyFrom(s){s.init(),Array.from(s.headers.keys()).forEach(m=>{this.headers.set(m,s.headers.get(m)),this.normalizedNames.set(m,s.normalizedNames.get(m))})}clone(s){let m=new l;return m.lazyInit=this.lazyInit&&this.lazyInit instanceof l?this.lazyInit:this,m.lazyUpdate=(this.lazyUpdate||[]).concat([s]),m}applyUpdate(s){let m=s.name.toLowerCase();switch(s.op){case"a":case"s":let p=s.value;if(typeof p=="string"&&(p=[p]),p.length===0)return;this.maybeSetNormalizedName(s.name,m);let y=(s.op==="a"?this.headers.get(m):void 0)||[];y.push(...p),this.headers.set(m,y);break;case"d":let i=s.value;if(!i)this.headers.delete(m),this.normalizedNames.delete(m);else{let C=this.headers.get(m);if(!C)return;C=C.filter(O=>i.indexOf(O)===-1),C.length===0?(this.headers.delete(m),this.normalizedNames.delete(m)):this.headers.set(m,C)}break}}setHeaderEntries(s,m){let p=(Array.isArray(m)?m:[m]).map(i=>i.toString()),y=s.toLowerCase();this.headers.set(y,p),this.maybeSetNormalizedName(s,y)}forEach(s){this.init(),Array.from(this.normalizedNames.keys()).forEach(m=>s(this.normalizedNames.get(m),this.headers.get(m)))}};var kb=class{encodeKey(s){return RA(s)}encodeValue(s){return RA(s)}decodeKey(s){return decodeURIComponent(s)}decodeValue(s){return decodeURIComponent(s)}};function NB(l,s){let m=new Map;return l.length>0&&l.replace(/^\?/,"").split("&").forEach(y=>{let i=y.indexOf("="),[C,O]=i==-1?[s.decodeKey(y),""]:[s.decodeKey(y.slice(0,i)),s.decodeValue(y.slice(i+1))],j=m.get(C)||[];j.push(O),m.set(C,j)}),m}var kB=/%(\d[a-f0-9])/gi,FB={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function RA(l){return encodeURIComponent(l).replace(kB,(s,m)=>FB[m]??s)}function By(l){return`${l}`}var Wl=class l{constructor(s={}){if(this.updates=null,this.cloneFrom=null,this.encoder=s.encoder||new kb,s.fromString){if(s.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=NB(s.fromString,this.encoder)}else s.fromObject?(this.map=new Map,Object.keys(s.fromObject).forEach(m=>{let p=s.fromObject[m],y=Array.isArray(p)?p.map(By):[By(p)];this.map.set(m,y)})):this.map=null}has(s){return this.init(),this.map.has(s)}get(s){this.init();let m=this.map.get(s);return m?m[0]:null}getAll(s){return this.init(),this.map.get(s)||null}keys(){return this.init(),Array.from(this.map.keys())}append(s,m){return this.clone({param:s,value:m,op:"a"})}appendAll(s){let m=[];return Object.keys(s).forEach(p=>{let y=s[p];Array.isArray(y)?y.forEach(i=>{m.push({param:p,value:i,op:"a"})}):m.push({param:p,value:y,op:"a"})}),this.clone(m)}set(s,m){return this.clone({param:s,value:m,op:"s"})}delete(s,m){return this.clone({param:s,value:m,op:"d"})}toString(){return this.init(),this.keys().map(s=>{let m=this.encoder.encodeKey(s);return this.map.get(s).map(p=>m+"="+this.encoder.encodeValue(p)).join("&")}).filter(s=>s!=="").join("&")}clone(s){let m=new l({encoder:this.encoder});return m.cloneFrom=this.cloneFrom||this,m.updates=(this.updates||[]).concat(s),m}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(s=>this.map.set(s,this.cloneFrom.map.get(s))),this.updates.forEach(s=>{switch(s.op){case"a":case"s":let m=(s.op==="a"?this.map.get(s.param):void 0)||[];m.push(By(s.value)),this.map.set(s.param,m);break;case"d":if(s.value!==void 0){let p=this.map.get(s.param)||[],y=p.indexOf(By(s.value));y!==-1&&p.splice(y,1),p.length>0?this.map.set(s.param,p):this.map.delete(s.param)}else{this.map.delete(s.param);break}}}),this.cloneFrom=this.updates=null)}};var Fb=class{constructor(){this.map=new Map}set(s,m){return this.map.set(s,m),this}get(s){return this.map.has(s)||this.map.set(s,s.defaultValue()),this.map.get(s)}delete(s){return this.map.delete(s),this}has(s){return this.map.has(s)}keys(){return this.map.keys()}};function zB(l){switch(l){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function LA(l){return typeof ArrayBuffer<"u"&&l instanceof ArrayBuffer}function OA(l){return typeof Blob<"u"&&l instanceof Blob}function NA(l){return typeof FormData<"u"&&l instanceof FormData}function BB(l){return typeof URLSearchParams<"u"&&l instanceof URLSearchParams}var $p=class l{constructor(s,m,p,y){this.url=m,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=s.toUpperCase();let i;if(zB(this.method)||y?(this.body=p!==void 0?p:null,i=y):i=p,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new fu,this.context??=new Fb,!this.params)this.params=new Wl,this.urlWithParams=m;else{let C=this.params.toString();if(C.length===0)this.urlWithParams=m;else{let O=m.indexOf("?"),j=O===-1?"?":O<m.length-1?"&":"";this.urlWithParams=m+j+C}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||LA(this.body)||OA(this.body)||NA(this.body)||BB(this.body)?this.body:this.body instanceof Wl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||NA(this.body)?null:OA(this.body)?this.body.type||null:LA(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Wl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(s={}){let m=s.method||this.method,p=s.url||this.url,y=s.responseType||this.responseType,i=s.transferCache??this.transferCache,C=s.body!==void 0?s.body:this.body,O=s.withCredentials??this.withCredentials,j=s.reportProgress??this.reportProgress,Z=s.headers||this.headers,se=s.params||this.params,ve=s.context??this.context;return s.setHeaders!==void 0&&(Z=Object.keys(s.setHeaders).reduce((ze,at)=>ze.set(at,s.setHeaders[at]),Z)),s.setParams&&(se=Object.keys(s.setParams).reduce((ze,at)=>ze.set(at,s.setParams[at]),se)),new l(m,p,C,{params:se,headers:Z,context:ve,reportProgress:j,responseType:y,withCredentials:O,transferCache:i})}},td=function(l){return l[l.Sent=0]="Sent",l[l.UploadProgress=1]="UploadProgress",l[l.ResponseHeader=2]="ResponseHeader",l[l.DownloadProgress=3]="DownloadProgress",l[l.Response=4]="Response",l[l.User=5]="User",l}(td||{}),Gp=class{constructor(s,m=$y.Ok,p="OK"){this.headers=s.headers||new fu,this.status=s.status!==void 0?s.status:m,this.statusText=s.statusText||p,this.url=s.url||null,this.ok=this.status>=200&&this.status<300}},zb=class l extends Gp{constructor(s={}){super(s),this.type=td.ResponseHeader}clone(s={}){return new l({headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},Vy=class l extends Gp{constructor(s={}){super(s),this.type=td.Response,this.body=s.body!==void 0?s.body:null}clone(s={}){return new l({body:s.body!==void 0?s.body:this.body,headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},Uy=class extends Gp{constructor(s){super(s,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${s.url||"(unknown url)"}`:this.message=`Http failure response for ${s.url||"(unknown url)"}: ${s.status} ${s.statusText}`,this.error=s.error||null}},$y=function(l){return l[l.Continue=100]="Continue",l[l.SwitchingProtocols=101]="SwitchingProtocols",l[l.Processing=102]="Processing",l[l.EarlyHints=103]="EarlyHints",l[l.Ok=200]="Ok",l[l.Created=201]="Created",l[l.Accepted=202]="Accepted",l[l.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",l[l.NoContent=204]="NoContent",l[l.ResetContent=205]="ResetContent",l[l.PartialContent=206]="PartialContent",l[l.MultiStatus=207]="MultiStatus",l[l.AlreadyReported=208]="AlreadyReported",l[l.ImUsed=226]="ImUsed",l[l.MultipleChoices=300]="MultipleChoices",l[l.MovedPermanently=301]="MovedPermanently",l[l.Found=302]="Found",l[l.SeeOther=303]="SeeOther",l[l.NotModified=304]="NotModified",l[l.UseProxy=305]="UseProxy",l[l.Unused=306]="Unused",l[l.TemporaryRedirect=307]="TemporaryRedirect",l[l.PermanentRedirect=308]="PermanentRedirect",l[l.BadRequest=400]="BadRequest",l[l.Unauthorized=401]="Unauthorized",l[l.PaymentRequired=402]="PaymentRequired",l[l.Forbidden=403]="Forbidden",l[l.NotFound=404]="NotFound",l[l.MethodNotAllowed=405]="MethodNotAllowed",l[l.NotAcceptable=406]="NotAcceptable",l[l.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",l[l.RequestTimeout=408]="RequestTimeout",l[l.Conflict=409]="Conflict",l[l.Gone=410]="Gone",l[l.LengthRequired=411]="LengthRequired",l[l.PreconditionFailed=412]="PreconditionFailed",l[l.PayloadTooLarge=413]="PayloadTooLarge",l[l.UriTooLong=414]="UriTooLong",l[l.UnsupportedMediaType=415]="UnsupportedMediaType",l[l.RangeNotSatisfiable=416]="RangeNotSatisfiable",l[l.ExpectationFailed=417]="ExpectationFailed",l[l.ImATeapot=418]="ImATeapot",l[l.MisdirectedRequest=421]="MisdirectedRequest",l[l.UnprocessableEntity=422]="UnprocessableEntity",l[l.Locked=423]="Locked",l[l.FailedDependency=424]="FailedDependency",l[l.TooEarly=425]="TooEarly",l[l.UpgradeRequired=426]="UpgradeRequired",l[l.PreconditionRequired=428]="PreconditionRequired",l[l.TooManyRequests=429]="TooManyRequests",l[l.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",l[l.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",l[l.InternalServerError=500]="InternalServerError",l[l.NotImplemented=501]="NotImplemented",l[l.BadGateway=502]="BadGateway",l[l.ServiceUnavailable=503]="ServiceUnavailable",l[l.GatewayTimeout=504]="GatewayTimeout",l[l.HttpVersionNotSupported=505]="HttpVersionNotSupported",l[l.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",l[l.InsufficientStorage=507]="InsufficientStorage",l[l.LoopDetected=508]="LoopDetected",l[l.NotExtended=510]="NotExtended",l[l.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",l}($y||{});function Nb(l,s){return{body:s,headers:l.headers,context:l.context,observe:l.observe,params:l.params,reportProgress:l.reportProgress,responseType:l.responseType,withCredentials:l.withCredentials,transferCache:l.transferCache}}var Hp=(()=>{let s=class s{constructor(p){this.handler=p}request(p,y,i={}){let C;if(p instanceof $p)C=p;else{let Z;i.headers instanceof fu?Z=i.headers:Z=new fu(i.headers);let se;i.params&&(i.params instanceof Wl?se=i.params:se=new Wl({fromObject:i.params})),C=new $p(p,y,i.body!==void 0?i.body:null,{headers:Z,context:i.context,params:se,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials,transferCache:i.transferCache})}let O=pn(C).pipe(La(Z=>this.handler.handle(Z)));if(p instanceof $p||i.observe==="events")return O;let j=O.pipe(co(Z=>Z instanceof Vy));switch(i.observe||"body"){case"body":switch(C.responseType){case"arraybuffer":return j.pipe(kn(Z=>{if(Z.body!==null&&!(Z.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Z.body}));case"blob":return j.pipe(kn(Z=>{if(Z.body!==null&&!(Z.body instanceof Blob))throw new Error("Response is not a Blob.");return Z.body}));case"text":return j.pipe(kn(Z=>{if(Z.body!==null&&typeof Z.body!="string")throw new Error("Response is not a string.");return Z.body}));case"json":default:return j.pipe(kn(Z=>Z.body))}case"response":return j;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(p,y={}){return this.request("DELETE",p,y)}get(p,y={}){return this.request("GET",p,y)}head(p,y={}){return this.request("HEAD",p,y)}jsonp(p,y){return this.request("JSONP",p,{params:new Wl().append(y,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(p,y={}){return this.request("OPTIONS",p,y)}patch(p,y,i={}){return this.request("PATCH",p,Nb(i,y))}post(p,y,i={}){return this.request("POST",p,Nb(i,y))}put(p,y,i={}){return this.request("PUT",p,Nb(i,y))}};s.\u0275fac=function(y){return new(y||s)(Nt($a))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})();function BA(l,s){return s(l)}function jB(l,s){return(m,p)=>s.intercept(m,{handle:y=>l(y,p)})}function VB(l,s,m){return(p,y)=>ps(m,()=>s(p,i=>l(i,y)))}var UB=new sn(""),Bb=new sn(""),$B=new sn(""),GB=new sn("");function HB(){let l=null;return(s,m)=>{l===null&&(l=(Tt(UB,{optional:!0})??[]).reduceRight(jB,BA));let p=Tt(cu),y=p.add();return l(s,m).pipe(zl(()=>p.remove(y)))}}var kA=(()=>{let s=class s extends $a{constructor(p,y){super(),this.backend=p,this.injector=y,this.chain=null,this.pendingTasks=Tt(cu);let i=Tt(GB,{optional:!0});this.backend=i??p}handle(p){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(Bb),...this.injector.get($B,[])]));this.chain=i.reduceRight((C,O)=>VB(C,O,this.injector),BA)}let y=this.pendingTasks.add();return this.chain(p,i=>this.backend.handle(i)).pipe(zl(()=>this.pendingTasks.remove(y)))}};s.\u0275fac=function(y){return new(y||s)(Nt(jy),Nt(Wi))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})();var qB=/^\)\]\}',?\n/;function WB(l){return"responseURL"in l&&l.responseURL?l.responseURL:/^X-Request-URL:/m.test(l.getAllResponseHeaders())?l.getResponseHeader("X-Request-URL"):null}var FA=(()=>{let s=class s{constructor(p){this.xhrFactory=p}handle(p){if(p.method==="JSONP")throw new rn(-2800,!1);let y=this.xhrFactory;return(y.\u0275loadImpl?kr(y.\u0275loadImpl()):pn(null)).pipe(uo(()=>new sr(C=>{let O=y.build();if(O.open(p.method,p.urlWithParams),p.withCredentials&&(O.withCredentials=!0),p.headers.forEach((Zt,Qt)=>O.setRequestHeader(Zt,Qt.join(","))),p.headers.has("Accept")||O.setRequestHeader("Accept","application/json, text/plain, */*"),!p.headers.has("Content-Type")){let Zt=p.detectContentTypeHeader();Zt!==null&&O.setRequestHeader("Content-Type",Zt)}if(p.responseType){let Zt=p.responseType.toLowerCase();O.responseType=Zt!=="json"?Zt:"text"}let j=p.serializeBody(),Z=null,se=()=>{if(Z!==null)return Z;let Zt=O.statusText||"OK",Qt=new fu(O.getAllResponseHeaders()),Tr=WB(O)||p.url;return Z=new zb({headers:Qt,status:O.status,statusText:Zt,url:Tr}),Z},ve=()=>{let{headers:Zt,status:Qt,statusText:Tr,url:gr}=se(),qn=null;Qt!==$y.NoContent&&(qn=typeof O.response>"u"?O.responseText:O.response),Qt===0&&(Qt=qn?$y.Ok:0);let Br=Qt>=200&&Qt<300;if(p.responseType==="json"&&typeof qn=="string"){let Ge=qn;qn=qn.replace(qB,"");try{qn=qn!==""?JSON.parse(qn):null}catch(ci){qn=Ge,Br&&(Br=!1,qn={error:ci,text:qn})}}Br?(C.next(new Vy({body:qn,headers:Zt,status:Qt,statusText:Tr,url:gr||void 0})),C.complete()):C.error(new Uy({error:qn,headers:Zt,status:Qt,statusText:Tr,url:gr||void 0}))},ze=Zt=>{let{url:Qt}=se(),Tr=new Uy({error:Zt,status:O.status||0,statusText:O.statusText||"Unknown Error",url:Qt||void 0});C.error(Tr)},at=!1,Wt=Zt=>{at||(C.next(se()),at=!0);let Qt={type:td.DownloadProgress,loaded:Zt.loaded};Zt.lengthComputable&&(Qt.total=Zt.total),p.responseType==="text"&&O.responseText&&(Qt.partialText=O.responseText),C.next(Qt)},Pn=Zt=>{let Qt={type:td.UploadProgress,loaded:Zt.loaded};Zt.lengthComputable&&(Qt.total=Zt.total),C.next(Qt)};return O.addEventListener("load",ve),O.addEventListener("error",ze),O.addEventListener("timeout",ze),O.addEventListener("abort",ze),p.reportProgress&&(O.addEventListener("progress",Wt),j!==null&&O.upload&&O.upload.addEventListener("progress",Pn)),O.send(j),C.next({type:td.Sent}),()=>{O.removeEventListener("error",ze),O.removeEventListener("abort",ze),O.removeEventListener("load",ve),O.removeEventListener("timeout",ze),p.reportProgress&&(O.removeEventListener("progress",Wt),j!==null&&O.upload&&O.upload.removeEventListener("progress",Pn)),O.readyState!==O.DONE&&O.abort()}})))}};s.\u0275fac=function(y){return new(y||s)(Nt(Qh))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),jA=new sn(""),ZB="XSRF-TOKEN",XB=new sn("",{providedIn:"root",factory:()=>ZB}),YB="X-XSRF-TOKEN",KB=new sn("",{providedIn:"root",factory:()=>YB}),Gy=class{},JB=(()=>{let s=class s{constructor(p,y,i){this.doc=p,this.platform=y,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let p=this.doc.cookie||"";return p!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ny(p,this.cookieName),this.lastCookieString=p),this.lastToken}};s.\u0275fac=function(y){return new(y||s)(Nt(zi),Nt(na),Nt(XB))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})();function QB(l,s){let m=l.url.toLowerCase();if(!Tt(jA)||l.method==="GET"||l.method==="HEAD"||m.startsWith("http://")||m.startsWith("https://"))return s(l);let p=Tt(Gy).getToken(),y=Tt(KB);return p!=null&&!l.headers.has(y)&&(l=l.clone({headers:l.headers.set(y,p)})),s(l)}var VA=function(l){return l[l.Interceptors=0]="Interceptors",l[l.LegacyInterceptors=1]="LegacyInterceptors",l[l.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",l[l.NoXsrfProtection=3]="NoXsrfProtection",l[l.JsonpSupport=4]="JsonpSupport",l[l.RequestsMadeViaParent=5]="RequestsMadeViaParent",l[l.Fetch=6]="Fetch",l}(VA||{});function e4(l,s){return{\u0275kind:l,\u0275providers:s}}function t4(...l){let s=[Hp,FA,kA,{provide:$a,useExisting:kA},{provide:jy,useExisting:FA},{provide:Bb,useValue:QB,multi:!0},{provide:jA,useValue:!0},{provide:Gy,useClass:JB}];for(let m of l)s.push(...m.\u0275providers);return uy(s)}var zA=new sn("");function n4(){return e4(VA.LegacyInterceptors,[{provide:zA,useFactory:HB},{provide:Bb,useExisting:zA,multi:!0}])}var UA=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({providers:[t4(n4())]});let l=s;return l})();var Ub=class extends Oy{constructor(){super(...arguments),this.supportsDOMEvents=!0}},$b=class l extends Ub{static makeCurrent(){IA(new l)}onAndCancel(s,m,p){return s.addEventListener(m,p),()=>{s.removeEventListener(m,p)}}dispatchEvent(s,m){s.dispatchEvent(m)}remove(s){s.parentNode&&s.parentNode.removeChild(s)}createElement(s,m){return m=m||this.getDefaultDocument(),m.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,m){return m==="window"?window:m==="document"?s:m==="body"?s.body:null}getBaseHref(s){let m=r4();return m==null?null:i4(m)}resetBaseElement(){qp=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return Ny(document.cookie,s)}},qp=null;function r4(){return qp=qp||document.querySelector("base"),qp?qp.getAttribute("href"):null}function i4(l){return new URL(l,document.baseURI).pathname}var Gb=class{addToWindow(s){So.getAngularTestability=(p,y=!0)=>{let i=s.findTestabilityInTree(p,y);if(i==null)throw new rn(5103,!1);return i},So.getAllAngularTestabilities=()=>s.getAllTestabilities(),So.getAllAngularRootElements=()=>s.getAllRootElements();let m=p=>{let y=So.getAllAngularTestabilities(),i=y.length,C=function(){i--,i==0&&p()};y.forEach(O=>{O.whenStable(C)})};So.frameworkStabilizers||(So.frameworkStabilizers=[]),So.frameworkStabilizers.push(m)}findTestabilityInTree(s,m,p){if(m==null)return null;let y=s.getTestability(m);return y??(p?hu().isShadowRoot(m)?this.findTestabilityInTree(s,m.host,!0):this.findTestabilityInTree(s,m.parentElement,!0):null)}},o4=(()=>{let s=class s{build(){return new XMLHttpRequest}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),Hb=new sn(""),WA=(()=>{let s=class s{constructor(p,y){this._zone=y,this._eventNameToPlugin=new Map,p.forEach(i=>{i.manager=this}),this._plugins=p.slice().reverse()}addEventListener(p,y,i){return this._findPluginFor(y).addEventListener(p,y,i)}getZone(){return this._zone}_findPluginFor(p){let y=this._eventNameToPlugin.get(p);if(y)return y;if(y=this._plugins.find(C=>C.supports(p)),!y)throw new rn(5101,!1);return this._eventNameToPlugin.set(p,y),y}};s.\u0275fac=function(y){return new(y||s)(Nt(Hb),Nt(br))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),Hy=class{constructor(s){this._doc=s}},jb="ng-app-id",ZA=(()=>{let s=class s{constructor(p,y,i,C={}){this.doc=p,this.appId=y,this.nonce=i,this.platformId=C,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=zy(C),this.resetHostNodes()}addStyles(p){for(let y of p)this.changeUsageCount(y,1)===1&&this.onStyleAdded(y)}removeStyles(p){for(let y of p)this.changeUsageCount(y,-1)<=0&&this.onStyleRemoved(y)}ngOnDestroy(){let p=this.styleNodesInDOM;p&&(p.forEach(y=>y.remove()),p.clear());for(let y of this.getAllStyles())this.onStyleRemoved(y);this.resetHostNodes()}addHost(p){this.hostNodes.add(p);for(let y of this.getAllStyles())this.addStyleToHost(p,y)}removeHost(p){this.hostNodes.delete(p)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(p){for(let y of this.hostNodes)this.addStyleToHost(y,p)}onStyleRemoved(p){let y=this.styleRef;y.get(p)?.elements?.forEach(i=>i.remove()),y.delete(p)}collectServerRenderedStyles(){let p=this.doc.head?.querySelectorAll(`style[${jb}="${this.appId}"]`);if(p?.length){let y=new Map;return p.forEach(i=>{i.textContent!=null&&y.set(i.textContent,i)}),y}return null}changeUsageCount(p,y){let i=this.styleRef;if(i.has(p)){let C=i.get(p);return C.usage+=y,C.usage}return i.set(p,{usage:y,elements:[]}),y}getStyleElement(p,y){let i=this.styleNodesInDOM,C=i?.get(y);if(C?.parentNode===p)return i.delete(y),C.removeAttribute(jb),C;{let O=this.doc.createElement("style");return this.nonce&&O.setAttribute("nonce",this.nonce),O.textContent=y,this.platformIsServer&&O.setAttribute(jb,this.appId),p.appendChild(O),O}}addStyleToHost(p,y){let i=this.getStyleElement(p,y),C=this.styleRef,O=C.get(y)?.elements;O?O.push(i):C.set(y,{elements:[i],usage:1})}resetHostNodes(){let p=this.hostNodes;p.clear(),p.add(this.doc.head)}};s.\u0275fac=function(y){return new(y||s)(Nt(zi),Nt(my),Nt(tb,8),Nt(na))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),Vb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Wb=/%COMP%/g,XA="%COMP%",s4=`_nghost-${XA}`,a4=`_ngcontent-${XA}`,l4=!0,c4=new sn("",{providedIn:"root",factory:()=>l4});function u4(l){return a4.replace(Wb,l)}function h4(l){return s4.replace(Wb,l)}function YA(l,s){return s.map(m=>m.replace(Wb,l))}var GA=(()=>{let s=class s{constructor(p,y,i,C,O,j,Z,se=null){this.eventManager=p,this.sharedStylesHost=y,this.appId=i,this.removeStylesOnCompDestroy=C,this.doc=O,this.platformId=j,this.ngZone=Z,this.nonce=se,this.rendererByCompId=new Map,this.platformIsServer=zy(j),this.defaultRenderer=new Wp(p,O,Z,this.platformIsServer)}createRenderer(p,y){if(!p||!y)return this.defaultRenderer;this.platformIsServer&&y.encapsulation===Xs.ShadowDom&&(y=Gr(Pt({},y),{encapsulation:Xs.Emulated}));let i=this.getOrCreateRenderer(p,y);return i instanceof qy?i.applyToHost(p):i instanceof Zp&&i.applyStyles(),i}getOrCreateRenderer(p,y){let i=this.rendererByCompId,C=i.get(y.id);if(!C){let O=this.doc,j=this.ngZone,Z=this.eventManager,se=this.sharedStylesHost,ve=this.removeStylesOnCompDestroy,ze=this.platformIsServer;switch(y.encapsulation){case Xs.Emulated:C=new qy(Z,se,y,this.appId,ve,O,j,ze);break;case Xs.ShadowDom:return new qb(Z,se,p,y,O,j,this.nonce,ze);default:C=new Zp(Z,se,y,ve,O,j,ze);break}i.set(y.id,C)}return C}ngOnDestroy(){this.rendererByCompId.clear()}};s.\u0275fac=function(y){return new(y||s)(Nt(WA),Nt(ZA),Nt(my),Nt(c4),Nt(zi),Nt(na),Nt(br),Nt(tb))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),Wp=class{constructor(s,m,p,y){this.eventManager=s,this.doc=m,this.ngZone=p,this.platformIsServer=y,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(s,m){return m?this.doc.createElementNS(Vb[m]||m,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,m){(HA(s)?s.content:s).appendChild(m)}insertBefore(s,m,p){s&&(HA(s)?s.content:s).insertBefore(m,p)}removeChild(s,m){s&&s.removeChild(m)}selectRootElement(s,m){let p=typeof s=="string"?this.doc.querySelector(s):s;if(!p)throw new rn(-5104,!1);return m||(p.textContent=""),p}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,m,p,y){if(y){m=y+":"+m;let i=Vb[y];i?s.setAttributeNS(i,m,p):s.setAttribute(m,p)}else s.setAttribute(m,p)}removeAttribute(s,m,p){if(p){let y=Vb[p];y?s.removeAttributeNS(y,m):s.removeAttribute(`${p}:${m}`)}else s.removeAttribute(m)}addClass(s,m){s.classList.add(m)}removeClass(s,m){s.classList.remove(m)}setStyle(s,m,p,y){y&(za.DashCase|za.Important)?s.style.setProperty(m,p,y&za.Important?"important":""):s.style[m]=p}removeStyle(s,m,p){p&za.DashCase?s.style.removeProperty(m):s.style[m]=""}setProperty(s,m,p){s!=null&&(s[m]=p)}setValue(s,m){s.nodeValue=m}listen(s,m,p){if(typeof s=="string"&&(s=hu().getGlobalEventTarget(this.doc,s),!s))throw new Error(`Unsupported event target ${s} for event ${m}`);return this.eventManager.addEventListener(s,m,this.decoratePreventDefault(p))}decoratePreventDefault(s){return m=>{if(m==="__ngUnwrap__")return s;(this.platformIsServer?this.ngZone.runGuarded(()=>s(m)):s(m))===!1&&m.preventDefault()}}};function HA(l){return l.tagName==="TEMPLATE"&&l.content!==void 0}var qb=class extends Wp{constructor(s,m,p,y,i,C,O,j){super(s,i,C,j),this.sharedStylesHost=m,this.hostEl=p,this.shadowRoot=p.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let Z=YA(y.id,y.styles);for(let se of Z){let ve=document.createElement("style");O&&ve.setAttribute("nonce",O),ve.textContent=se,this.shadowRoot.appendChild(ve)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,m){return super.appendChild(this.nodeOrShadowRoot(s),m)}insertBefore(s,m,p){return super.insertBefore(this.nodeOrShadowRoot(s),m,p)}removeChild(s,m){return super.removeChild(this.nodeOrShadowRoot(s),m)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Zp=class extends Wp{constructor(s,m,p,y,i,C,O,j){super(s,i,C,O),this.sharedStylesHost=m,this.removeStylesOnCompDestroy=y,this.styles=j?YA(j,p.styles):p.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},qy=class extends Zp{constructor(s,m,p,y,i,C,O,j){let Z=y+"-"+p.id;super(s,m,p,i,C,O,j,Z),this.contentAttr=u4(Z),this.hostAttr=h4(Z)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,m){let p=super.createElement(s,m);return super.setAttribute(p,this.contentAttr,""),p}},d4=(()=>{let s=class s extends Hy{constructor(p){super(p)}supports(p){return!0}addEventListener(p,y,i){return p.addEventListener(y,i,!1),()=>this.removeEventListener(p,y,i)}removeEventListener(p,y,i){return p.removeEventListener(y,i)}};s.\u0275fac=function(y){return new(y||s)(Nt(zi))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})(),qA=["alt","control","meta","shift"],f4={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},p4={alt:l=>l.altKey,control:l=>l.ctrlKey,meta:l=>l.metaKey,shift:l=>l.shiftKey},m4=(()=>{let s=class s extends Hy{constructor(p){super(p)}supports(p){return s.parseEventName(p)!=null}addEventListener(p,y,i){let C=s.parseEventName(y),O=s.eventCallback(C.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hu().onAndCancel(p,C.domEventName,O))}static parseEventName(p){let y=p.toLowerCase().split("."),i=y.shift();if(y.length===0||!(i==="keydown"||i==="keyup"))return null;let C=s._normalizeKey(y.pop()),O="",j=y.indexOf("code");if(j>-1&&(y.splice(j,1),O="code."),qA.forEach(se=>{let ve=y.indexOf(se);ve>-1&&(y.splice(ve,1),O+=se+".")}),O+=C,y.length!=0||C.length===0)return null;let Z={};return Z.domEventName=i,Z.fullKey=O,Z}static matchEventFullKeyCode(p,y){let i=f4[p.key]||p.key,C="";return y.indexOf("code.")>-1&&(i=p.code,C="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),qA.forEach(O=>{if(O!==i){let j=p4[O];j(p)&&(C+=O+".")}}),C+=i,C===y)}static eventCallback(p,y,i){return C=>{s.matchEventFullKeyCode(C,p)&&i.runGuarded(()=>y(C))}}static _normalizeKey(p){return p==="esc"?"escape":p}};s.\u0275fac=function(y){return new(y||s)(Nt(zi))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})();function g4(){$b.makeCurrent()}function _4(){return new Qs}function y4(){return xS(document),document}var v4=[{provide:na,useValue:Lb},{provide:eb,useValue:g4,multi:!0},{provide:zi,useFactory:y4,deps:[]}],KA=Tb(mA,"browser",v4),x4=new sn(""),b4=[{provide:jp,useClass:Gb,deps:[]},{provide:xb,useClass:Sy,deps:[br,Ay,jp]},{provide:Sy,useClass:Sy,deps:[br,Ay,jp]}],w4=[{provide:hy,useValue:"root"},{provide:Qs,useFactory:_4,deps:[]},{provide:Hb,useClass:d4,multi:!0,deps:[zi,br,na]},{provide:Hb,useClass:m4,multi:!0,deps:[zi]},GA,ZA,WA,{provide:Sp,useExisting:GA},{provide:Qh,useClass:o4,deps:[]},[]],JA=(()=>{let s=class s{constructor(p){}static withServerTransition(p){return{ngModule:s,providers:[{provide:my,useValue:p.appId}]}}};s.\u0275fac=function(y){return new(y||s)(Nt(x4,12))},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({providers:[...w4,...b4],imports:[Fy,gA]});let l=s;return l})();var QA=(()=>{let s=class s{constructor(p){this._doc=p}getTitle(){return this._doc.title}setTitle(p){this._doc.title=p||""}};s.\u0275fac=function(y){return new(y||s)(Nt(zi))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();var Ln="primary",cm=Symbol("RouteTitle"),Jb=class{constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let m=this.params[s];return Array.isArray(m)?m[0]:m}return null}getAll(s){if(this.has(s)){let m=this.params[s];return Array.isArray(m)?m:[m]}return[]}get keys(){return Object.keys(this.params)}};function sd(l){return new Jb(l)}function T4(l,s,m){let p=m.path.split("/");if(p.length>l.length||m.pathMatch==="full"&&(s.hasChildren()||p.length<l.length))return null;let y={};for(let i=0;i<p.length;i++){let C=p[i],O=l[i];if(C.startsWith(":"))y[C.substring(1)]=O;else if(C!==O.path)return null}return{consumed:l.slice(0,p.length),posParams:y}}function E4(l,s){if(l.length!==s.length)return!1;for(let m=0;m<l.length;++m)if(!ra(l[m],s[m]))return!1;return!0}function ra(l,s){let m=l?Qb(l):void 0,p=s?Qb(s):void 0;if(!m||!p||m.length!=p.length)return!1;let y;for(let i=0;i<m.length;i++)if(y=m[i],!c2(l[y],s[y]))return!1;return!0}function Qb(l){return[...Object.keys(l),...Object.getOwnPropertySymbols(l)]}function c2(l,s){if(Array.isArray(l)&&Array.isArray(s)){if(l.length!==s.length)return!1;let m=[...l].sort(),p=[...s].sort();return m.every((y,i)=>p[i]===y)}else return l===s}function u2(l){return l.length>0?l[l.length-1]:null}function Kl(l){return Tx(l)?l:Vp(l)?kr(Promise.resolve(l)):pn(l)}var I4={exact:d2,subset:f2},h2={exact:D4,subset:M4,ignored:()=>!0};function t2(l,s,m){return I4[m.paths](l.root,s.root,m.matrixParams)&&h2[m.queryParams](l.queryParams,s.queryParams)&&!(m.fragment==="exact"&&l.fragment!==s.fragment)}function D4(l,s){return ra(l,s)}function d2(l,s,m){if(!mu(l.segments,s.segments)||!Xy(l.segments,s.segments,m)||l.numberOfChildren!==s.numberOfChildren)return!1;for(let p in s.children)if(!l.children[p]||!d2(l.children[p],s.children[p],m))return!1;return!0}function M4(l,s){return Object.keys(s).length<=Object.keys(l).length&&Object.keys(s).every(m=>c2(l[m],s[m]))}function f2(l,s,m){return p2(l,s,s.segments,m)}function p2(l,s,m,p){if(l.segments.length>m.length){let y=l.segments.slice(0,m.length);return!(!mu(y,m)||s.hasChildren()||!Xy(y,m,p))}else if(l.segments.length===m.length){if(!mu(l.segments,m)||!Xy(l.segments,m,p))return!1;for(let y in s.children)if(!l.children[y]||!f2(l.children[y],s.children[y],p))return!1;return!0}else{let y=m.slice(0,l.segments.length),i=m.slice(l.segments.length);return!mu(l.segments,y)||!Xy(l.segments,y,p)||!l.children[Ln]?!1:p2(l.children[Ln],s,i,p)}}function Xy(l,s,m){return s.every((p,y)=>h2[m](l[y].parameters,p.parameters))}var Zl=class{constructor(s=new dr([],{}),m={},p=null){this.root=s,this.queryParams=m,this.fragment=p}get queryParamMap(){return this._queryParamMap??=sd(this.queryParams),this._queryParamMap}toString(){return A4.serialize(this)}},dr=class{constructor(s,m){this.segments=s,this.children=m,this.parent=null,Object.values(m).forEach(p=>p.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Yy(this)}},pu=class{constructor(s,m){this.path=s,this.parameters=m}get parameterMap(){return this._parameterMap??=sd(this.parameters),this._parameterMap}toString(){return g2(this)}};function C4(l,s){return mu(l,s)&&l.every((m,p)=>ra(m.parameters,s[p].parameters))}function mu(l,s){return l.length!==s.length?!1:l.every((m,p)=>m.path===s[p].path)}function S4(l,s){let m=[];return Object.entries(l.children).forEach(([p,y])=>{p===Ln&&(m=m.concat(s(y,p)))}),Object.entries(l.children).forEach(([p,y])=>{p!==Ln&&(m=m.concat(s(y,p)))}),m}var um=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>new tm,providedIn:"root"});let l=s;return l})(),tm=class{parse(s){let m=new tw(s);return new Zl(m.parseRootSegment(),m.parseQueryParams(),m.parseFragment())}serialize(s){let m=`/${Xp(s.root,!0)}`,p=L4(s.queryParams),y=typeof s.fragment=="string"?`#${P4(s.fragment)}`:"";return`${m}${p}${y}`}},A4=new tm;function Yy(l){return l.segments.map(s=>g2(s)).join("/")}function Xp(l,s){if(!l.hasChildren())return Yy(l);if(s){let m=l.children[Ln]?Xp(l.children[Ln],!1):"",p=[];return Object.entries(l.children).forEach(([y,i])=>{y!==Ln&&p.push(`${y}:${Xp(i,!1)}`)}),p.length>0?`${m}(${p.join("//")})`:m}else{let m=S4(l,(p,y)=>y===Ln?[Xp(l.children[Ln],!1)]:[`${y}:${Xp(p,!1)}`]);return Object.keys(l.children).length===1&&l.children[Ln]!=null?`${Yy(l)}/${m[0]}`:`${Yy(l)}/(${m.join("//")})`}}function m2(l){return encodeURIComponent(l).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Wy(l){return m2(l).replace(/%3B/gi,";")}function P4(l){return encodeURI(l)}function ew(l){return m2(l).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ky(l){return decodeURIComponent(l)}function n2(l){return Ky(l.replace(/\+/g,"%20"))}function g2(l){return`${ew(l.path)}${R4(l.parameters)}`}function R4(l){return Object.entries(l).map(([s,m])=>`;${ew(s)}=${ew(m)}`).join("")}function L4(l){let s=Object.entries(l).map(([m,p])=>Array.isArray(p)?p.map(y=>`${Wy(m)}=${Wy(y)}`).join("&"):`${Wy(m)}=${Wy(p)}`).filter(m=>m);return s.length?`?${s.join("&")}`:""}var O4=/^[^\/()?;#]+/;function Zb(l){let s=l.match(O4);return s?s[0]:""}var N4=/^[^\/()?;=#]+/;function k4(l){let s=l.match(N4);return s?s[0]:""}var F4=/^[^=?&#]+/;function z4(l){let s=l.match(F4);return s?s[0]:""}var B4=/^[^&#]+/;function j4(l){let s=l.match(B4);return s?s[0]:""}var tw=class{constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new dr([],{}):new dr([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let m={};this.peekStartsWith("/(")&&(this.capture("/"),m=this.parseParens(!0));let p={};return this.peekStartsWith("(")&&(p=this.parseParens(!1)),(s.length>0||Object.keys(m).length>0)&&(p[Ln]=new dr(s,m)),p}parseSegment(){let s=Zb(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new rn(4009,!1);return this.capture(s),new pu(Ky(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let m=k4(this.remaining);if(!m)return;this.capture(m);let p="";if(this.consumeOptional("=")){let y=Zb(this.remaining);y&&(p=y,this.capture(p))}s[Ky(m)]=Ky(p)}parseQueryParam(s){let m=z4(this.remaining);if(!m)return;this.capture(m);let p="";if(this.consumeOptional("=")){let C=j4(this.remaining);C&&(p=C,this.capture(p))}let y=n2(m),i=n2(p);if(s.hasOwnProperty(y)){let C=s[y];Array.isArray(C)||(C=[C],s[y]=C),C.push(i)}else s[y]=i}parseParens(s){let m={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let p=Zb(this.remaining),y=this.remaining[p.length];if(y!=="/"&&y!==")"&&y!==";")throw new rn(4010,!1);let i;p.indexOf(":")>-1?(i=p.slice(0,p.indexOf(":")),this.capture(i),this.capture(":")):s&&(i=Ln);let C=this.parseChildren();m[i]=Object.keys(C).length===1?C[Ln]:new dr([],C),this.consumeOptional("//")}return m}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new rn(4011,!1)}};function _2(l){return l.segments.length>0?new dr([],{[Ln]:l}):l}function y2(l){let s={};for(let[p,y]of Object.entries(l.children)){let i=y2(y);if(p===Ln&&i.segments.length===0&&i.hasChildren())for(let[C,O]of Object.entries(i.children))s[C]=O;else(i.segments.length>0||i.hasChildren())&&(s[p]=i)}let m=new dr(l.segments,s);return V4(m)}function V4(l){if(l.numberOfChildren===1&&l.children[Ln]){let s=l.children[Ln];return new dr(l.segments.concat(s.segments),s.children)}return l}function ad(l){return l instanceof Zl}function U4(l,s,m=null,p=null){let y=v2(l);return x2(y,s,m,p)}function v2(l){let s;function m(i){let C={};for(let j of i.children){let Z=m(j);C[j.outlet]=Z}let O=new dr(i.url,C);return i===l&&(s=O),O}let p=m(l.root),y=_2(p);return s??y}function x2(l,s,m,p){let y=l;for(;y.parent;)y=y.parent;if(s.length===0)return Xb(y,y,y,m,p);let i=$4(s);if(i.toRoot())return Xb(y,y,new dr([],{}),m,p);let C=G4(i,y,l),O=C.processChildren?Jp(C.segmentGroup,C.index,i.commands):w2(C.segmentGroup,C.index,i.commands);return Xb(y,C.segmentGroup,O,m,p)}function Jy(l){return typeof l=="object"&&l!=null&&!l.outlets&&!l.segmentPath}function nm(l){return typeof l=="object"&&l!=null&&l.outlets}function Xb(l,s,m,p,y){let i={};p&&Object.entries(p).forEach(([j,Z])=>{i[j]=Array.isArray(Z)?Z.map(se=>`${se}`):`${Z}`});let C;l===s?C=m:C=b2(l,s,m);let O=_2(y2(C));return new Zl(O,i,y)}function b2(l,s,m){let p={};return Object.entries(l.children).forEach(([y,i])=>{i===s?p[y]=m:p[y]=b2(i,s,m)}),new dr(l.segments,p)}var Qy=class{constructor(s,m,p){if(this.isAbsolute=s,this.numberOfDoubleDots=m,this.commands=p,s&&p.length>0&&Jy(p[0]))throw new rn(4003,!1);let y=p.find(nm);if(y&&y!==u2(p))throw new rn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function $4(l){if(typeof l[0]=="string"&&l.length===1&&l[0]==="/")return new Qy(!0,0,l);let s=0,m=!1,p=l.reduce((y,i,C)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let O={};return Object.entries(i.outlets).forEach(([j,Z])=>{O[j]=typeof Z=="string"?Z.split("/"):Z}),[...y,{outlets:O}]}if(i.segmentPath)return[...y,i.segmentPath]}return typeof i!="string"?[...y,i]:C===0?(i.split("/").forEach((O,j)=>{j==0&&O==="."||(j==0&&O===""?m=!0:O===".."?s++:O!=""&&y.push(O))}),y):[...y,i]},[]);return new Qy(m,s,p)}var id=class{constructor(s,m,p){this.segmentGroup=s,this.processChildren=m,this.index=p}};function G4(l,s,m){if(l.isAbsolute)return new id(s,!0,0);if(!m)return new id(s,!1,NaN);if(m.parent===null)return new id(m,!0,0);let p=Jy(l.commands[0])?0:1,y=m.segments.length-1+p;return H4(m,y,l.numberOfDoubleDots)}function H4(l,s,m){let p=l,y=s,i=m;for(;i>y;){if(i-=y,p=p.parent,!p)throw new rn(4005,!1);y=p.segments.length}return new id(p,!1,y-i)}function q4(l){return nm(l[0])?l[0].outlets:{[Ln]:l}}function w2(l,s,m){if(l??=new dr([],{}),l.segments.length===0&&l.hasChildren())return Jp(l,s,m);let p=W4(l,s,m),y=m.slice(p.commandIndex);if(p.match&&p.pathIndex<l.segments.length){let i=new dr(l.segments.slice(0,p.pathIndex),{});return i.children[Ln]=new dr(l.segments.slice(p.pathIndex),l.children),Jp(i,0,y)}else return p.match&&y.length===0?new dr(l.segments,{}):p.match&&!l.hasChildren()?nw(l,s,m):p.match?Jp(l,0,y):nw(l,s,m)}function Jp(l,s,m){if(m.length===0)return new dr(l.segments,{});{let p=q4(m),y={};if(Object.keys(p).some(i=>i!==Ln)&&l.children[Ln]&&l.numberOfChildren===1&&l.children[Ln].segments.length===0){let i=Jp(l.children[Ln],s,m);return new dr(l.segments,i.children)}return Object.entries(p).forEach(([i,C])=>{typeof C=="string"&&(C=[C]),C!==null&&(y[i]=w2(l.children[i],s,C))}),Object.entries(l.children).forEach(([i,C])=>{p[i]===void 0&&(y[i]=C)}),new dr(l.segments,y)}}function W4(l,s,m){let p=0,y=s,i={match:!1,pathIndex:0,commandIndex:0};for(;y<l.segments.length;){if(p>=m.length)return i;let C=l.segments[y],O=m[p];if(nm(O))break;let j=`${O}`,Z=p<m.length-1?m[p+1]:null;if(y>0&&j===void 0)break;if(j&&Z&&typeof Z=="object"&&Z.outlets===void 0){if(!i2(j,Z,C))return i;p+=2}else{if(!i2(j,{},C))return i;p++}y++}return{match:!0,pathIndex:y,commandIndex:p}}function nw(l,s,m){let p=l.segments.slice(0,s),y=0;for(;y<m.length;){let i=m[y];if(nm(i)){let j=Z4(i.outlets);return new dr(p,j)}if(y===0&&Jy(m[0])){let j=l.segments[s];p.push(new pu(j.path,r2(m[0]))),y++;continue}let C=nm(i)?i.outlets[Ln]:`${i}`,O=y<m.length-1?m[y+1]:null;C&&O&&Jy(O)?(p.push(new pu(C,r2(O))),y+=2):(p.push(new pu(C,{})),y++)}return new dr(p,{})}function Z4(l){let s={};return Object.entries(l).forEach(([m,p])=>{typeof p=="string"&&(p=[p]),p!==null&&(s[m]=nw(new dr([],{}),0,p))}),s}function r2(l){let s={};return Object.entries(l).forEach(([m,p])=>s[m]=`${p}`),s}function i2(l,s,m){return l==m.path&&ra(s,m.parameters)}var Qp="imperative",gi=function(l){return l[l.NavigationStart=0]="NavigationStart",l[l.NavigationEnd=1]="NavigationEnd",l[l.NavigationCancel=2]="NavigationCancel",l[l.NavigationError=3]="NavigationError",l[l.RoutesRecognized=4]="RoutesRecognized",l[l.ResolveStart=5]="ResolveStart",l[l.ResolveEnd=6]="ResolveEnd",l[l.GuardsCheckStart=7]="GuardsCheckStart",l[l.GuardsCheckEnd=8]="GuardsCheckEnd",l[l.RouteConfigLoadStart=9]="RouteConfigLoadStart",l[l.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",l[l.ChildActivationStart=11]="ChildActivationStart",l[l.ChildActivationEnd=12]="ChildActivationEnd",l[l.ActivationStart=13]="ActivationStart",l[l.ActivationEnd=14]="ActivationEnd",l[l.Scroll=15]="Scroll",l[l.NavigationSkipped=16]="NavigationSkipped",l}(gi||{}),Vo=class{constructor(s,m){this.id=s,this.url=m}},ld=class extends Vo{constructor(s,m,p="imperative",y=null){super(s,m),this.type=gi.NavigationStart,this.navigationTrigger=p,this.restoredState=y}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ga=class extends Vo{constructor(s,m,p){super(s,m),this.urlAfterRedirects=p,this.type=gi.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ro=function(l){return l[l.Redirect=0]="Redirect",l[l.SupersededByNewNavigation=1]="SupersededByNewNavigation",l[l.NoDataFromResolver=2]="NoDataFromResolver",l[l.GuardRejected=3]="GuardRejected",l}(Ro||{}),e0=function(l){return l[l.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",l[l.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",l}(e0||{}),Xl=class extends Vo{constructor(s,m,p,y){super(s,m),this.reason=p,this.code=y,this.type=gi.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Yl=class extends Vo{constructor(s,m,p,y){super(s,m),this.reason=p,this.code=y,this.type=gi.NavigationSkipped}},rm=class extends Vo{constructor(s,m,p,y){super(s,m),this.error=p,this.target=y,this.type=gi.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},t0=class extends Vo{constructor(s,m,p,y){super(s,m),this.urlAfterRedirects=p,this.state=y,this.type=gi.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rw=class extends Vo{constructor(s,m,p,y){super(s,m),this.urlAfterRedirects=p,this.state=y,this.type=gi.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},iw=class extends Vo{constructor(s,m,p,y,i){super(s,m),this.urlAfterRedirects=p,this.state=y,this.shouldActivate=i,this.type=gi.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},ow=class extends Vo{constructor(s,m,p,y){super(s,m),this.urlAfterRedirects=p,this.state=y,this.type=gi.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sw=class extends Vo{constructor(s,m,p,y){super(s,m),this.urlAfterRedirects=p,this.state=y,this.type=gi.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aw=class{constructor(s){this.route=s,this.type=gi.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},lw=class{constructor(s){this.route=s,this.type=gi.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},cw=class{constructor(s){this.snapshot=s,this.type=gi.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uw=class{constructor(s){this.snapshot=s,this.type=gi.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hw=class{constructor(s){this.snapshot=s,this.type=gi.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},dw=class{constructor(s){this.snapshot=s,this.type=gi.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},n0=class{constructor(s,m,p){this.routerEvent=s,this.position=m,this.anchor=p,this.type=gi.Scroll}toString(){let s=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${s}')`}},im=class{},om=class{constructor(s){this.url=s}};var fw=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new hm,this.attachRef=null}},hm=(()=>{let s=class s{constructor(){this.contexts=new Map}onChildOutletCreated(p,y){let i=this.getOrCreateContext(p);i.outlet=y,this.contexts.set(p,i)}onChildOutletDestroyed(p){let y=this.getContext(p);y&&(y.outlet=null,y.attachRef=null)}onOutletDeactivated(){let p=this.contexts;return this.contexts=new Map,p}onOutletReAttached(p){this.contexts=p}getOrCreateContext(p){let y=this.getContext(p);return y||(y=new fw,this.contexts.set(p,y)),y}getContext(p){return this.contexts.get(p)||null}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),r0=class{constructor(s){this._root=s}get root(){return this._root.value}parent(s){let m=this.pathFromRoot(s);return m.length>1?m[m.length-2]:null}children(s){let m=pw(s,this._root);return m?m.children.map(p=>p.value):[]}firstChild(s){let m=pw(s,this._root);return m&&m.children.length>0?m.children[0].value:null}siblings(s){let m=mw(s,this._root);return m.length<2?[]:m[m.length-2].children.map(y=>y.value).filter(y=>y!==s)}pathFromRoot(s){return mw(s,this._root).map(m=>m.value)}};function pw(l,s){if(l===s.value)return s;for(let m of s.children){let p=pw(l,m);if(p)return p}return null}function mw(l,s){if(l===s.value)return[s];for(let m of s.children){let p=mw(l,m);if(p.length)return p.unshift(s),p}return[]}var Po=class{constructor(s,m){this.value=s,this.children=m}toString(){return`TreeNode(${this.value})`}};function rd(l){let s={};return l&&l.children.forEach(m=>s[m.value.outlet]=m),s}var i0=class extends r0{constructor(s,m){super(s),this.snapshot=m,Iw(this,s)}toString(){return this.snapshot.toString()}};function T2(l){let s=X4(l),m=new Ti([new pu("",{})]),p=new Ti({}),y=new Ti({}),i=new Ti({}),C=new Ti(""),O=new cd(m,p,i,C,y,Ln,l,s.root);return O.snapshot=s.root,new i0(new Po(O,[]),s)}function X4(l){let s={},m={},p={},y="",i=new sm([],s,p,y,m,Ln,l,null,{});return new o0("",new Po(i,[]))}var cd=class{constructor(s,m,p,y,i,C,O,j){this.urlSubject=s,this.paramsSubject=m,this.queryParamsSubject=p,this.fragmentSubject=y,this.dataSubject=i,this.outlet=C,this.component=O,this._futureSnapshot=j,this.title=this.dataSubject?.pipe(kn(Z=>Z[cm]))??pn(void 0),this.url=s,this.params=m,this.queryParams=p,this.fragment=y,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(kn(s=>sd(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(kn(s=>sd(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ew(l,s,m="emptyOnly"){let p,{routeConfig:y}=l;return s!==null&&(m==="always"||y?.path===""||!s.component&&!s.routeConfig?.loadComponent)?p={params:Pt(Pt({},s.params),l.params),data:Pt(Pt({},s.data),l.data),resolve:Pt(Pt(Pt(Pt({},l.data),s.data),y?.data),l._resolvedData)}:p={params:Pt({},l.params),data:Pt({},l.data),resolve:Pt(Pt({},l.data),l._resolvedData??{})},y&&I2(y)&&(p.resolve[cm]=y.title),p}var sm=class{get title(){return this.data?.[cm]}constructor(s,m,p,y,i,C,O,j,Z){this.url=s,this.params=m,this.queryParams=p,this.fragment=y,this.data=i,this.outlet=C,this.component=O,this.routeConfig=j,this._resolve=Z}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=sd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=sd(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(p=>p.toString()).join("/"),m=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${m}')`}},o0=class extends r0{constructor(s,m){super(m),this.url=s,Iw(this,m)}toString(){return E2(this._root)}};function Iw(l,s){s.value._routerState=l,s.children.forEach(m=>Iw(l,m))}function E2(l){let s=l.children.length>0?` { ${l.children.map(E2).join(", ")} } `:"";return`${l.value}${s}`}function Yb(l){if(l.snapshot){let s=l.snapshot,m=l._futureSnapshot;l.snapshot=m,ra(s.queryParams,m.queryParams)||l.queryParamsSubject.next(m.queryParams),s.fragment!==m.fragment&&l.fragmentSubject.next(m.fragment),ra(s.params,m.params)||l.paramsSubject.next(m.params),E4(s.url,m.url)||l.urlSubject.next(m.url),ra(s.data,m.data)||l.dataSubject.next(m.data)}else l.snapshot=l._futureSnapshot,l.dataSubject.next(l._futureSnapshot.data)}function gw(l,s){let m=ra(l.params,s.params)&&C4(l.url,s.url),p=!l.parent!=!s.parent;return m&&!p&&(!l.parent||gw(l.parent,s.parent))}function I2(l){return typeof l.title=="string"||l.title===null}var Y4=(()=>{let s=class s{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ln,this.activateEvents=new ki,this.deactivateEvents=new ki,this.attachEvents=new ki,this.detachEvents=new ki,this.parentContexts=Tt(hm),this.location=Tt(Hl),this.changeDetector=Tt(Up),this.environmentInjector=Tt(Wi),this.inputBinder=Tt(u0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(p){if(p.name){let{firstChange:y,previousValue:i}=p.name;if(y)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(p){return this.parentContexts.getContext(p)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let p=this.parentContexts.getContext(this.name);p?.route&&(p.attachRef?this.attach(p.attachRef,p.route):this.activateWith(p.route,p.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new rn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new rn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new rn(4012,!1);this.location.detach();let p=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(p.instance),p}attach(p,y){this.activated=p,this._activatedRoute=y,this.location.insert(p.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(p.instance)}deactivate(){if(this.activated){let p=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(p)}}activateWith(p,y){if(this.isActivated)throw new rn(4013,!1);this._activatedRoute=p;let i=this.location,O=p.snapshot.component,j=this.parentContexts.getOrCreateContext(this.name).children,Z=new _w(p,j,i.injector);this.activated=i.createComponent(O,{index:i.length,injector:Z,environmentInjector:y??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};s.\u0275fac=function(y){return new(y||s)},s.\u0275dir=qh({type:s,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[py]});let l=s;return l})(),_w=class{constructor(s,m,p){this.route=s,this.childContexts=m,this.parent=p,this.__ngOutletInjector=!0}get(s,m){return s===cd?this.route:s===hm?this.childContexts:this.parent.get(s,m)}},u0=new sn(""),o2=(()=>{let s=class s{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(p){this.unsubscribeFromRouteData(p),this.subscribeToRouteData(p)}unsubscribeFromRouteData(p){this.outletDataSubscriptions.get(p)?.unsubscribe(),this.outletDataSubscriptions.delete(p)}subscribeToRouteData(p){let{activatedRoute:y}=p,i=yp([y.queryParams,y.params,y.data]).pipe(uo(([C,O,j],Z)=>(j=Pt(Pt(Pt({},C),O),j),Z===0?pn(j):Promise.resolve(j)))).subscribe(C=>{if(!p.isActivated||!p.activatedComponentRef||p.activatedRoute!==y||y.component===null){this.unsubscribeFromRouteData(p);return}let O=_A(y.component);if(!O){this.unsubscribeFromRouteData(p);return}for(let{templateName:j}of O.inputs)p.activatedComponentRef.setInput(j,C[j])});this.outletDataSubscriptions.set(p,i)}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})();function K4(l,s,m){let p=am(l,s._root,m?m._root:void 0);return new i0(p,s)}function am(l,s,m){if(m&&l.shouldReuseRoute(s.value,m.value.snapshot)){let p=m.value;p._futureSnapshot=s.value;let y=J4(l,s,m);return new Po(p,y)}else{if(l.shouldAttach(s.value)){let i=l.retrieve(s.value);if(i!==null){let C=i.route;return C.value._futureSnapshot=s.value,C.children=s.children.map(O=>am(l,O)),C}}let p=Q4(s.value),y=s.children.map(i=>am(l,i));return new Po(p,y)}}function J4(l,s,m){return s.children.map(p=>{for(let y of m.children)if(l.shouldReuseRoute(p.value,y.value.snapshot))return am(l,p,y);return am(l,p)})}function Q4(l){return new cd(new Ti(l.url),new Ti(l.params),new Ti(l.queryParams),new Ti(l.fragment),new Ti(l.data),l.outlet,l.component,l)}var D2="ngNavigationCancelingError";function M2(l,s){let{redirectTo:m,navigationBehaviorOptions:p}=ad(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,y=C2(!1,Ro.Redirect);return y.url=m,y.navigationBehaviorOptions=p,y}function C2(l,s){let m=new Error(`NavigationCancelingError: ${l||""}`);return m[D2]=!0,m.cancellationCode=s,m}function e5(l){return S2(l)&&ad(l.url)}function S2(l){return!!l&&l[D2]}var t5=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275cmp=mi({type:s,selectors:[["ng-component"]],standalone:!0,features:[sA],decls:1,vars:0,template:function(y,i){y&1&&Yi(0,"router-outlet")},dependencies:[Y4],encapsulation:2});let l=s;return l})();function n5(l,s){return l.providers&&!l._injector&&(l._injector=Ey(l.providers,s,`Route: ${l.path}`)),l._injector??s}function Dw(l){let s=l.children&&l.children.map(Dw),m=s?Gr(Pt({},l),{children:s}):Pt({},l);return!m.component&&!m.loadComponent&&(s||m.loadChildren)&&m.outlet&&m.outlet!==Ln&&(m.component=t5),m}function ia(l){return l.outlet||Ln}function r5(l,s){let m=l.filter(p=>ia(p)===s);return m.push(...l.filter(p=>ia(p)!==s)),m}function dm(l){if(!l)return null;if(l.routeConfig?._injector)return l.routeConfig._injector;for(let s=l.parent;s;s=s.parent){let m=s.routeConfig;if(m?._loadedInjector)return m._loadedInjector;if(m?._injector)return m._injector}return null}var i5=(l,s,m,p)=>kn(y=>(new yw(s,y.targetRouterState,y.currentRouterState,m,p).activate(l),y)),yw=class{constructor(s,m,p,y,i){this.routeReuseStrategy=s,this.futureState=m,this.currState=p,this.forwardEvent=y,this.inputBindingEnabled=i}activate(s){let m=this.futureState._root,p=this.currState?this.currState._root:null;this.deactivateChildRoutes(m,p,s),Yb(this.futureState.root),this.activateChildRoutes(m,p,s)}deactivateChildRoutes(s,m,p){let y=rd(m);s.children.forEach(i=>{let C=i.value.outlet;this.deactivateRoutes(i,y[C],p),delete y[C]}),Object.values(y).forEach(i=>{this.deactivateRouteAndItsChildren(i,p)})}deactivateRoutes(s,m,p){let y=s.value,i=m?m.value:null;if(y===i)if(y.component){let C=p.getContext(y.outlet);C&&this.deactivateChildRoutes(s,m,C.children)}else this.deactivateChildRoutes(s,m,p);else i&&this.deactivateRouteAndItsChildren(m,p)}deactivateRouteAndItsChildren(s,m){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,m):this.deactivateRouteAndOutlet(s,m)}detachAndStoreRouteSubtree(s,m){let p=m.getContext(s.value.outlet),y=p&&s.value.component?p.children:m,i=rd(s);for(let C of Object.values(i))this.deactivateRouteAndItsChildren(C,y);if(p&&p.outlet){let C=p.outlet.detach(),O=p.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:C,route:s,contexts:O})}}deactivateRouteAndOutlet(s,m){let p=m.getContext(s.value.outlet),y=p&&s.value.component?p.children:m,i=rd(s);for(let C of Object.values(i))this.deactivateRouteAndItsChildren(C,y);p&&(p.outlet&&(p.outlet.deactivate(),p.children.onOutletDeactivated()),p.attachRef=null,p.route=null)}activateChildRoutes(s,m,p){let y=rd(m);s.children.forEach(i=>{this.activateRoutes(i,y[i.value.outlet],p),this.forwardEvent(new dw(i.value.snapshot))}),s.children.length&&this.forwardEvent(new uw(s.value.snapshot))}activateRoutes(s,m,p){let y=s.value,i=m?m.value:null;if(Yb(y),y===i)if(y.component){let C=p.getOrCreateContext(y.outlet);this.activateChildRoutes(s,m,C.children)}else this.activateChildRoutes(s,m,p);else if(y.component){let C=p.getOrCreateContext(y.outlet);if(this.routeReuseStrategy.shouldAttach(y.snapshot)){let O=this.routeReuseStrategy.retrieve(y.snapshot);this.routeReuseStrategy.store(y.snapshot,null),C.children.onOutletReAttached(O.contexts),C.attachRef=O.componentRef,C.route=O.route.value,C.outlet&&C.outlet.attach(O.componentRef,O.route.value),Yb(O.route.value),this.activateChildRoutes(s,null,C.children)}else{let O=dm(y.snapshot);C.attachRef=null,C.route=y,C.injector=O,C.outlet&&C.outlet.activateWith(y,C.injector),this.activateChildRoutes(s,null,C.children)}}else this.activateChildRoutes(s,null,p)}},s0=class{constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},od=class{constructor(s,m){this.component=s,this.route=m}};function o5(l,s,m){let p=l._root,y=s?s._root:null;return Yp(p,y,m,[p.value])}function s5(l){let s=l.routeConfig?l.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:l,guards:s}}function hd(l,s){let m=Symbol(),p=s.get(l,m);return p===m?typeof l=="function"&&!hC(l)?l:s.get(l):p}function Yp(l,s,m,p,y={canDeactivateChecks:[],canActivateChecks:[]}){let i=rd(s);return l.children.forEach(C=>{a5(C,i[C.value.outlet],m,p.concat([C.value]),y),delete i[C.value.outlet]}),Object.entries(i).forEach(([C,O])=>em(O,m.getContext(C),y)),y}function a5(l,s,m,p,y={canDeactivateChecks:[],canActivateChecks:[]}){let i=l.value,C=s?s.value:null,O=m?m.getContext(l.value.outlet):null;if(C&&i.routeConfig===C.routeConfig){let j=l5(C,i,i.routeConfig.runGuardsAndResolvers);j?y.canActivateChecks.push(new s0(p)):(i.data=C.data,i._resolvedData=C._resolvedData),i.component?Yp(l,s,O?O.children:null,p,y):Yp(l,s,m,p,y),j&&O&&O.outlet&&O.outlet.isActivated&&y.canDeactivateChecks.push(new od(O.outlet.component,C))}else C&&em(s,O,y),y.canActivateChecks.push(new s0(p)),i.component?Yp(l,null,O?O.children:null,p,y):Yp(l,null,m,p,y);return y}function l5(l,s,m){if(typeof m=="function")return m(l,s);switch(m){case"pathParamsChange":return!mu(l.url,s.url);case"pathParamsOrQueryParamsChange":return!mu(l.url,s.url)||!ra(l.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!gw(l,s)||!ra(l.queryParams,s.queryParams);case"paramsChange":default:return!gw(l,s)}}function em(l,s,m){let p=rd(l),y=l.value;Object.entries(p).forEach(([i,C])=>{y.component?s?em(C,s.children.getContext(i),m):em(C,null,m):em(C,s,m)}),y.component?s&&s.outlet&&s.outlet.isActivated?m.canDeactivateChecks.push(new od(s.outlet.component,y)):m.canDeactivateChecks.push(new od(null,y)):m.canDeactivateChecks.push(new od(null,y))}function fm(l){return typeof l=="function"}function c5(l){return typeof l=="boolean"}function u5(l){return l&&fm(l.canLoad)}function h5(l){return l&&fm(l.canActivate)}function d5(l){return l&&fm(l.canActivateChild)}function f5(l){return l&&fm(l.canDeactivate)}function p5(l){return l&&fm(l.canMatch)}function A2(l){return l instanceof Ra||l?.name==="EmptyError"}var Zy=Symbol("INITIAL_VALUE");function ud(){return uo(l=>yp(l.map(s=>s.pipe(Oa(1),Mx(Zy)))).pipe(kn(s=>{for(let m of s)if(m!==!0){if(m===Zy)return Zy;if(m===!1||m instanceof Zl)return m}return!0}),co(s=>s!==Zy),Oa(1)))}function m5(l,s){return ri(m=>{let{targetSnapshot:p,currentSnapshot:y,guards:{canActivateChecks:i,canDeactivateChecks:C}}=m;return C.length===0&&i.length===0?pn(Gr(Pt({},m),{guardsResult:!0})):g5(C,p,y,l).pipe(ri(O=>O&&c5(O)?_5(p,i,l,s):pn(O)),kn(O=>Gr(Pt({},m),{guardsResult:O})))})}function g5(l,s,m,p){return kr(l).pipe(ri(y=>w5(y.component,y.route,m,s,p)),qs(y=>y!==!0,!0))}function _5(l,s,m,p){return kr(s).pipe(La(y=>Ph(v5(y.route.parent,p),y5(y.route,p),b5(l,y.path,m),x5(l,y.route,m))),qs(y=>y!==!0,!0))}function y5(l,s){return l!==null&&s&&s(new hw(l)),pn(!0)}function v5(l,s){return l!==null&&s&&s(new cw(l)),pn(!0)}function x5(l,s,m){let p=s.routeConfig?s.routeConfig.canActivate:null;if(!p||p.length===0)return pn(!0);let y=p.map(i=>S_(()=>{let C=dm(s)??m,O=hd(i,C),j=h5(O)?O.canActivate(s,l):ps(C,()=>O(s,l));return Kl(j).pipe(qs())}));return pn(y).pipe(ud())}function b5(l,s,m){let p=s[s.length-1],i=s.slice(0,s.length-1).reverse().map(C=>s5(C)).filter(C=>C!==null).map(C=>S_(()=>{let O=C.guards.map(j=>{let Z=dm(C.node)??m,se=hd(j,Z),ve=d5(se)?se.canActivateChild(p,l):ps(Z,()=>se(p,l));return Kl(ve).pipe(qs())});return pn(O).pipe(ud())}));return pn(i).pipe(ud())}function w5(l,s,m,p,y){let i=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!i||i.length===0)return pn(!0);let C=i.map(O=>{let j=dm(s)??y,Z=hd(O,j),se=f5(Z)?Z.canDeactivate(l,s,m,p):ps(j,()=>Z(l,s,m,p));return Kl(se).pipe(qs())});return pn(C).pipe(ud())}function T5(l,s,m,p){let y=s.canLoad;if(y===void 0||y.length===0)return pn(!0);let i=y.map(C=>{let O=hd(C,l),j=u5(O)?O.canLoad(s,m):ps(l,()=>O(s,m));return Kl(j)});return pn(i).pipe(ud(),P2(p))}function P2(l){return vx(pi(s=>{if(ad(s))throw M2(l,s)}),kn(s=>s===!0))}function E5(l,s,m,p){let y=s.canMatch;if(!y||y.length===0)return pn(!0);let i=y.map(C=>{let O=hd(C,l),j=p5(O)?O.canMatch(s,m):ps(l,()=>O(s,m));return Kl(j)});return pn(i).pipe(ud(),P2(p))}var lm=class{constructor(s){this.segmentGroup=s||null}},a0=class extends Error{constructor(s){super(),this.urlTree=s}};function nd(l){return Sh(new lm(l))}function I5(l){return Sh(new rn(4e3,!1))}function D5(l){return Sh(C2(!1,Ro.GuardRejected))}var vw=class{constructor(s,m){this.urlSerializer=s,this.urlTree=m}lineralizeSegments(s,m){let p=[],y=m.root;for(;;){if(p=p.concat(y.segments),y.numberOfChildren===0)return pn(p);if(y.numberOfChildren>1||!y.children[Ln])return I5(s.redirectTo);y=y.children[Ln]}}applyRedirectCommands(s,m,p){let y=this.applyRedirectCreateUrlTree(m,this.urlSerializer.parse(m),s,p);if(m.startsWith("/"))throw new a0(y);return y}applyRedirectCreateUrlTree(s,m,p,y){let i=this.createSegmentGroup(s,m.root,p,y);return new Zl(i,this.createQueryParams(m.queryParams,this.urlTree.queryParams),m.fragment)}createQueryParams(s,m){let p={};return Object.entries(s).forEach(([y,i])=>{if(typeof i=="string"&&i.startsWith(":")){let O=i.substring(1);p[y]=m[O]}else p[y]=i}),p}createSegmentGroup(s,m,p,y){let i=this.createSegments(s,m.segments,p,y),C={};return Object.entries(m.children).forEach(([O,j])=>{C[O]=this.createSegmentGroup(s,j,p,y)}),new dr(i,C)}createSegments(s,m,p,y){return m.map(i=>i.path.startsWith(":")?this.findPosParam(s,i,y):this.findOrReturn(i,p))}findPosParam(s,m,p){let y=p[m.path.substring(1)];if(!y)throw new rn(4001,!1);return y}findOrReturn(s,m){let p=0;for(let y of m){if(y.path===s.path)return m.splice(p),y;p++}return s}},xw={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function M5(l,s,m,p,y){let i=Mw(l,s,m);return i.matched?(p=n5(s,p),E5(p,s,m,y).pipe(kn(C=>C===!0?i:Pt({},xw)))):pn(i)}function Mw(l,s,m){if(s.path==="**")return C5(m);if(s.path==="")return s.pathMatch==="full"&&(l.hasChildren()||m.length>0)?Pt({},xw):{matched:!0,consumedSegments:[],remainingSegments:m,parameters:{},positionalParamSegments:{}};let y=(s.matcher||T4)(m,l,s);if(!y)return Pt({},xw);let i={};Object.entries(y.posParams??{}).forEach(([O,j])=>{i[O]=j.path});let C=y.consumed.length>0?Pt(Pt({},i),y.consumed[y.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:y.consumed,remainingSegments:m.slice(y.consumed.length),parameters:C,positionalParamSegments:y.posParams??{}}}function C5(l){return{matched:!0,parameters:l.length>0?u2(l).parameters:{},consumedSegments:l,remainingSegments:[],positionalParamSegments:{}}}function s2(l,s,m,p){return m.length>0&&P5(l,m,p)?{segmentGroup:new dr(s,A5(p,new dr(m,l.children))),slicedSegments:[]}:m.length===0&&R5(l,m,p)?{segmentGroup:new dr(l.segments,S5(l,m,p,l.children)),slicedSegments:m}:{segmentGroup:new dr(l.segments,l.children),slicedSegments:m}}function S5(l,s,m,p){let y={};for(let i of m)if(h0(l,s,i)&&!p[ia(i)]){let C=new dr([],{});y[ia(i)]=C}return Pt(Pt({},p),y)}function A5(l,s){let m={};m[Ln]=s;for(let p of l)if(p.path===""&&ia(p)!==Ln){let y=new dr([],{});m[ia(p)]=y}return m}function P5(l,s,m){return m.some(p=>h0(l,s,p)&&ia(p)!==Ln)}function R5(l,s,m){return m.some(p=>h0(l,s,p))}function h0(l,s,m){return(l.hasChildren()||s.length>0)&&m.pathMatch==="full"?!1:m.path===""}function L5(l,s,m,p){return ia(l)!==p&&(p===Ln||!h0(s,m,l))?!1:Mw(s,l,m).matched}function O5(l,s,m){return s.length===0&&!l.children[m]}var bw=class{};function N5(l,s,m,p,y,i,C="emptyOnly"){return new ww(l,s,m,p,y,C,i).recognize()}var k5=31,ww=class{constructor(s,m,p,y,i,C,O){this.injector=s,this.configLoader=m,this.rootComponentType=p,this.config=y,this.urlTree=i,this.paramsInheritanceStrategy=C,this.urlSerializer=O,this.applyRedirects=new vw(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(s){return new rn(4002,`'${s.segmentGroup}'`)}recognize(){let s=s2(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(kn(m=>{let p=new sm([],Object.freeze({}),Object.freeze(Pt({},this.urlTree.queryParams)),this.urlTree.fragment,{},Ln,this.rootComponentType,null,{}),y=new Po(p,m),i=new o0("",y),C=U4(p,[],this.urlTree.queryParams,this.urlTree.fragment);return C.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(C),this.inheritParamsAndData(i._root,null),{state:i,tree:C}}))}match(s){return this.processSegmentGroup(this.injector,this.config,s,Ln).pipe(kl(p=>{if(p instanceof a0)return this.urlTree=p.urlTree,this.match(p.urlTree.root);throw p instanceof lm?this.noMatchError(p):p}))}inheritParamsAndData(s,m){let p=s.value,y=Ew(p,m,this.paramsInheritanceStrategy);p.params=Object.freeze(y.params),p.data=Object.freeze(y.data),s.children.forEach(i=>this.inheritParamsAndData(i,p))}processSegmentGroup(s,m,p,y){return p.segments.length===0&&p.hasChildren()?this.processChildren(s,m,p):this.processSegment(s,m,p,p.segments,y,!0).pipe(kn(i=>i instanceof Po?[i]:[]))}processChildren(s,m,p){let y=[];for(let i of Object.keys(p.children))i==="primary"?y.unshift(i):y.push(i);return kr(y).pipe(La(i=>{let C=p.children[i],O=r5(m,i);return this.processSegmentGroup(s,O,C,i)}),Dx((i,C)=>(i.push(...C),i)),Fl(null),Ix(),ri(i=>{if(i===null)return nd(p);let C=R2(i);return F5(C),pn(C)}))}processSegment(s,m,p,y,i,C){return kr(m).pipe(La(O=>this.processSegmentAgainstRoute(O._injector??s,m,O,p,y,i,C).pipe(kl(j=>{if(j instanceof lm)return pn(null);throw j}))),qs(O=>!!O),kl(O=>{if(A2(O))return O5(p,y,i)?pn(new bw):nd(p);throw O}))}processSegmentAgainstRoute(s,m,p,y,i,C,O){return L5(p,y,i,C)?p.redirectTo===void 0?this.matchSegmentAgainstRoute(s,y,p,i,C):this.allowRedirects&&O?this.expandSegmentAgainstRouteUsingRedirect(s,y,m,p,i,C):nd(y):nd(y)}expandSegmentAgainstRouteUsingRedirect(s,m,p,y,i,C){let{matched:O,consumedSegments:j,positionalParamSegments:Z,remainingSegments:se}=Mw(m,y,i);if(!O)return nd(m);y.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>k5&&(this.allowRedirects=!1));let ve=this.applyRedirects.applyRedirectCommands(j,y.redirectTo,Z);return this.applyRedirects.lineralizeSegments(y,ve).pipe(ri(ze=>this.processSegment(s,p,m,ze.concat(se),C,!1)))}matchSegmentAgainstRoute(s,m,p,y,i){let C=M5(m,p,y,s,this.urlSerializer);return p.path==="**"&&(m.children={}),C.pipe(uo(O=>O.matched?(s=p._injector??s,this.getChildConfig(s,p,y).pipe(uo(({routes:j})=>{let Z=p._loadedInjector??s,{consumedSegments:se,remainingSegments:ve,parameters:ze}=O,at=new sm(se,ze,Object.freeze(Pt({},this.urlTree.queryParams)),this.urlTree.fragment,B5(p),ia(p),p.component??p._loadedComponent??null,p,j5(p)),{segmentGroup:Wt,slicedSegments:Pn}=s2(m,se,ve,j);if(Pn.length===0&&Wt.hasChildren())return this.processChildren(Z,j,Wt).pipe(kn(Qt=>Qt===null?null:new Po(at,Qt)));if(j.length===0&&Pn.length===0)return pn(new Po(at,[]));let Zt=ia(p)===i;return this.processSegment(Z,j,Wt,Pn,Zt?Ln:i,!0).pipe(kn(Qt=>new Po(at,Qt instanceof Po?[Qt]:[])))}))):nd(m)))}getChildConfig(s,m,p){return m.children?pn({routes:m.children,injector:s}):m.loadChildren?m._loadedRoutes!==void 0?pn({routes:m._loadedRoutes,injector:m._loadedInjector}):T5(s,m,p,this.urlSerializer).pipe(ri(y=>y?this.configLoader.loadChildren(s,m).pipe(pi(i=>{m._loadedRoutes=i.routes,m._loadedInjector=i.injector})):D5(m))):pn({routes:[],injector:s})}};function F5(l){l.sort((s,m)=>s.value.outlet===Ln?-1:m.value.outlet===Ln?1:s.value.outlet.localeCompare(m.value.outlet))}function z5(l){let s=l.value.routeConfig;return s&&s.path===""}function R2(l){let s=[],m=new Set;for(let p of l){if(!z5(p)){s.push(p);continue}let y=s.find(i=>p.value.routeConfig===i.value.routeConfig);y!==void 0?(y.children.push(...p.children),m.add(y)):s.push(p)}for(let p of m){let y=R2(p.children);s.push(new Po(p.value,y))}return s.filter(p=>!m.has(p))}function B5(l){return l.data||{}}function j5(l){return l.resolve||{}}function V5(l,s,m,p,y,i){return ri(C=>N5(l,s,m,p,C.extractedUrl,y,i).pipe(kn(({state:O,tree:j})=>Gr(Pt({},C),{targetSnapshot:O,urlAfterRedirects:j}))))}function U5(l,s){return ri(m=>{let{targetSnapshot:p,guards:{canActivateChecks:y}}=m;if(!y.length)return pn(m);let i=new Set(y.map(j=>j.route)),C=new Set;for(let j of i)if(!C.has(j))for(let Z of L2(j))C.add(Z);let O=0;return kr(C).pipe(La(j=>i.has(j)?$5(j,p,l,s):(j.data=Ew(j,j.parent,l).resolve,pn(void 0))),pi(()=>O++),Rh(1),ri(j=>O===C.size?pn(m):Co))})}function L2(l){let s=l.children.map(m=>L2(m)).flat();return[l,...s]}function $5(l,s,m,p){let y=l.routeConfig,i=l._resolve;return y?.title!==void 0&&!I2(y)&&(i[cm]=y.title),G5(i,l,s,p).pipe(kn(C=>(l._resolvedData=C,l.data=Ew(l,l.parent,m).resolve,null)))}function G5(l,s,m,p){let y=Qb(l);if(y.length===0)return pn({});let i={};return kr(y).pipe(ri(C=>H5(l[C],s,m,p).pipe(qs(),pi(O=>{i[C]=O}))),Rh(1),Ex(i),kl(C=>A2(C)?Co:Sh(C)))}function H5(l,s,m,p){let y=dm(s)??p,i=hd(l,y),C=i.resolve?i.resolve(s,m):ps(y,()=>i(s,m));return Kl(C)}function Kb(l){return uo(s=>{let m=l(s);return m?kr(m).pipe(kn(()=>s)):pn(s)})}var O2=(()=>{let s=class s{buildTitle(p){let y,i=p.root;for(;i!==void 0;)y=this.getResolvedTitleForRoute(i)??y,i=i.children.find(C=>C.outlet===Ln);return y}getResolvedTitleForRoute(p){return p.data[cm]}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>Tt(q5),providedIn:"root"});let l=s;return l})(),q5=(()=>{let s=class s extends O2{constructor(p){super(),this.title=p}updateTitle(p){let y=this.buildTitle(p);y!==void 0&&this.title.setTitle(y)}};s.\u0275fac=function(y){return new(y||s)(Nt(QA))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),pm=new sn("",{providedIn:"root",factory:()=>({})}),l0=new sn(""),Cw=(()=>{let s=class s{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Tt(Ly)}loadComponent(p){if(this.componentLoaders.get(p))return this.componentLoaders.get(p);if(p._loadedComponent)return pn(p._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(p);let y=Kl(p.loadComponent()).pipe(kn(N2),pi(C=>{this.onLoadEndListener&&this.onLoadEndListener(p),p._loadedComponent=C}),zl(()=>{this.componentLoaders.delete(p)})),i=new Ch(y,()=>new Hi).pipe(Mh());return this.componentLoaders.set(p,i),i}loadChildren(p,y){if(this.childrenLoaders.get(y))return this.childrenLoaders.get(y);if(y._loadedRoutes)return pn({routes:y._loadedRoutes,injector:y._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(y);let C=W5(y,this.compiler,p,this.onLoadEndListener).pipe(zl(()=>{this.childrenLoaders.delete(y)})),O=new Ch(C,()=>new Hi).pipe(Mh());return this.childrenLoaders.set(y,O),O}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function W5(l,s,m,p){return Kl(l.loadChildren()).pipe(kn(N2),ri(y=>y instanceof Ap||Array.isArray(y)?pn(y):kr(s.compileModuleAsync(y))),kn(y=>{p&&p(l);let i,C,O=!1;return Array.isArray(y)?(C=y,O=!0):(i=y.create(m).injector,C=i.get(l0,[],{optional:!0,self:!0}).flat()),{routes:C.map(Dw),injector:i}}))}function Z5(l){return l&&typeof l=="object"&&"default"in l}function N2(l){return Z5(l)?l.default:l}var Sw=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>Tt(X5),providedIn:"root"});let l=s;return l})(),X5=(()=>{let s=class s{shouldProcessUrl(p){return!0}extract(p){return p}merge(p,y){return p}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),k2=new sn(""),F2=new sn("");function Y5(l,s,m){let p=l.get(F2),y=l.get(zi);return l.get(br).runOutsideAngular(()=>{if(!y.startViewTransition||p.skipNextTransition)return p.skipNextTransition=!1,Promise.resolve();let i,C=new Promise(Z=>{i=Z}),O=y.startViewTransition(()=>(i(),K5(l))),{onViewTransitionCreated:j}=p;return j&&ps(l,()=>j({transition:O,from:s,to:m})),C})}function K5(l){return new Promise(s=>{fb(s,{injector:l})})}var Aw=(()=>{let s=class s{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Hi,this.transitionAbortSubject=new Hi,this.configLoader=Tt(Cw),this.environmentInjector=Tt(Wi),this.urlSerializer=Tt(um),this.rootContexts=Tt(hm),this.location=Tt(ed),this.inputBindingEnabled=Tt(u0,{optional:!0})!==null,this.titleStrategy=Tt(O2),this.options=Tt(pm,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Tt(Sw),this.createViewTransition=Tt(k2,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>pn(void 0),this.rootComponentType=null;let p=i=>this.events.next(new aw(i)),y=i=>this.events.next(new lw(i));this.configLoader.onLoadEndListener=y,this.configLoader.onLoadStartListener=p}complete(){this.transitions?.complete()}handleNavigationRequest(p){let y=++this.navigationId;this.transitions?.next(Gr(Pt(Pt({},this.transitions.value),p),{id:y}))}setupNavigations(p,y,i){return this.transitions=new Ti({id:0,currentUrlTree:y,currentRawUrl:y,extractedUrl:this.urlHandlingStrategy.extract(y),urlAfterRedirects:this.urlHandlingStrategy.extract(y),rawUrl:y,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Qp,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(co(C=>C.id!==0),kn(C=>Gr(Pt({},C),{extractedUrl:this.urlHandlingStrategy.extract(C.rawUrl)})),uo(C=>{let O=!1,j=!1;return pn(C).pipe(uo(Z=>{if(this.navigationId>C.id)return this.cancelNavigationTransition(C,"",Ro.SupersededByNewNavigation),Co;this.currentTransition=C,this.currentNavigation={id:Z.id,initialUrl:Z.rawUrl,extractedUrl:Z.extractedUrl,trigger:Z.source,extras:Z.extras,previousNavigation:this.lastSuccessfulNavigation?Gr(Pt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let se=!p.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),ve=Z.extras.onSameUrlNavigation??p.onSameUrlNavigation;if(!se&&ve!=="reload"){let ze="";return this.events.next(new Yl(Z.id,this.urlSerializer.serialize(Z.rawUrl),ze,e0.IgnoredSameUrlNavigation)),Z.resolve(null),Co}if(this.urlHandlingStrategy.shouldProcessUrl(Z.rawUrl))return pn(Z).pipe(uo(ze=>{let at=this.transitions?.getValue();return this.events.next(new ld(ze.id,this.urlSerializer.serialize(ze.extractedUrl),ze.source,ze.restoredState)),at!==this.transitions?.getValue()?Co:Promise.resolve(ze)}),V5(this.environmentInjector,this.configLoader,this.rootComponentType,p.config,this.urlSerializer,this.paramsInheritanceStrategy),pi(ze=>{C.targetSnapshot=ze.targetSnapshot,C.urlAfterRedirects=ze.urlAfterRedirects,this.currentNavigation=Gr(Pt({},this.currentNavigation),{finalUrl:ze.urlAfterRedirects});let at=new t0(ze.id,this.urlSerializer.serialize(ze.extractedUrl),this.urlSerializer.serialize(ze.urlAfterRedirects),ze.targetSnapshot);this.events.next(at)}));if(se&&this.urlHandlingStrategy.shouldProcessUrl(Z.currentRawUrl)){let{id:ze,extractedUrl:at,source:Wt,restoredState:Pn,extras:Zt}=Z,Qt=new ld(ze,this.urlSerializer.serialize(at),Wt,Pn);this.events.next(Qt);let Tr=T2(this.rootComponentType).snapshot;return this.currentTransition=C=Gr(Pt({},Z),{targetSnapshot:Tr,urlAfterRedirects:at,extras:Gr(Pt({},Zt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=at,pn(C)}else{let ze="";return this.events.next(new Yl(Z.id,this.urlSerializer.serialize(Z.extractedUrl),ze,e0.IgnoredByUrlHandlingStrategy)),Z.resolve(null),Co}}),pi(Z=>{let se=new rw(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(se)}),kn(Z=>(this.currentTransition=C=Gr(Pt({},Z),{guards:o5(Z.targetSnapshot,Z.currentSnapshot,this.rootContexts)}),C)),m5(this.environmentInjector,Z=>this.events.next(Z)),pi(Z=>{if(C.guardsResult=Z.guardsResult,ad(Z.guardsResult))throw M2(this.urlSerializer,Z.guardsResult);let se=new iw(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot,!!Z.guardsResult);this.events.next(se)}),co(Z=>Z.guardsResult?!0:(this.cancelNavigationTransition(Z,"",Ro.GuardRejected),!1)),Kb(Z=>{if(Z.guards.canActivateChecks.length)return pn(Z).pipe(pi(se=>{let ve=new ow(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(ve)}),uo(se=>{let ve=!1;return pn(se).pipe(U5(this.paramsInheritanceStrategy,this.environmentInjector),pi({next:()=>ve=!0,complete:()=>{ve||this.cancelNavigationTransition(se,"",Ro.NoDataFromResolver)}}))}),pi(se=>{let ve=new sw(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(ve)}))}),Kb(Z=>{let se=ve=>{let ze=[];ve.routeConfig?.loadComponent&&!ve.routeConfig._loadedComponent&&ze.push(this.configLoader.loadComponent(ve.routeConfig).pipe(pi(at=>{ve.component=at}),kn(()=>{})));for(let at of ve.children)ze.push(...se(at));return ze};return yp(se(Z.targetSnapshot.root)).pipe(Fl(null),Oa(1))}),Kb(()=>this.afterPreactivation()),uo(()=>{let{currentSnapshot:Z,targetSnapshot:se}=C,ve=this.createViewTransition?.(this.environmentInjector,Z.root,se.root);return ve?kr(ve).pipe(kn(()=>C)):pn(C)}),kn(Z=>{let se=K4(p.routeReuseStrategy,Z.targetSnapshot,Z.currentRouterState);return this.currentTransition=C=Gr(Pt({},Z),{targetRouterState:se}),this.currentNavigation.targetRouterState=se,C}),pi(()=>{this.events.next(new im)}),i5(this.rootContexts,p.routeReuseStrategy,Z=>this.events.next(Z),this.inputBindingEnabled),Oa(1),pi({next:Z=>{O=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ga(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects))),this.titleStrategy?.updateTitle(Z.targetRouterState.snapshot),Z.resolve(!0)},complete:()=>{O=!0}}),Cx(this.transitionAbortSubject.pipe(pi(Z=>{throw Z}))),zl(()=>{!O&&!j&&this.cancelNavigationTransition(C,"",Ro.SupersededByNewNavigation),this.currentTransition?.id===C.id&&(this.currentNavigation=null,this.currentTransition=null)}),kl(Z=>{if(j=!0,S2(Z))this.events.next(new Xl(C.id,this.urlSerializer.serialize(C.extractedUrl),Z.message,Z.cancellationCode)),e5(Z)?this.events.next(new om(Z.url)):C.resolve(!1);else{this.events.next(new rm(C.id,this.urlSerializer.serialize(C.extractedUrl),Z,C.targetSnapshot??void 0));try{C.resolve(p.errorHandler(Z))}catch(se){this.options.resolveNavigationPromiseOnError?C.resolve(!1):C.reject(se)}}return Co}))}))}cancelNavigationTransition(p,y,i){let C=new Xl(p.id,this.urlSerializer.serialize(p.extractedUrl),y,i);this.events.next(C),p.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function J5(l){return l!==Qp}var Q5=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>Tt(ej),providedIn:"root"});let l=s;return l})(),Tw=class{shouldDetach(s){return!1}store(s,m){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,m){return s.routeConfig===m.routeConfig}},ej=(()=>{let s=class s extends Tw{};s.\u0275fac=(()=>{let p;return function(i){return(p||(p=J1(s)))(i||s)}})(),s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),z2=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:()=>Tt(tj),providedIn:"root"});let l=s;return l})(),tj=(()=>{let s=class s extends z2{constructor(){super(...arguments),this.location=Tt(ed),this.urlSerializer=Tt(um),this.options=Tt(pm,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Tt(Sw),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Zl,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=T2(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(p){return this.location.subscribe(y=>{y.type==="popstate"&&p(y.url,y.state)})}handleRouterEvent(p,y){if(p instanceof ld)this.stateMemento=this.createStateMemento();else if(p instanceof Yl)this.rawUrlTree=y.initialUrl;else if(p instanceof t0){if(this.urlUpdateStrategy==="eager"&&!y.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(y.finalUrl,y.initialUrl);this.setBrowserUrl(i,y)}}else p instanceof im?(this.currentUrlTree=y.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(y.finalUrl,y.initialUrl),this.routerState=y.targetRouterState,this.urlUpdateStrategy==="deferred"&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y))):p instanceof Xl&&(p.code===Ro.GuardRejected||p.code===Ro.NoDataFromResolver)?this.restoreHistory(y):p instanceof rm?this.restoreHistory(y,!0):p instanceof Ga&&(this.lastSuccessfulId=p.id,this.currentPageId=this.browserPageId)}setBrowserUrl(p,y){let i=this.urlSerializer.serialize(p);if(this.location.isCurrentPathEqualTo(i)||y.extras.replaceUrl){let C=this.browserPageId,O=Pt(Pt({},y.extras.state),this.generateNgRouterState(y.id,C));this.location.replaceState(i,"",O)}else{let C=Pt(Pt({},y.extras.state),this.generateNgRouterState(y.id,this.browserPageId+1));this.location.go(i,"",C)}}restoreHistory(p,y=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,C=this.currentPageId-i;C!==0?this.location.historyGo(C):this.currentUrlTree===p.finalUrl&&C===0&&(this.resetState(p),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(y&&this.resetState(p),this.resetUrlToCurrentUrlTree())}resetState(p){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,p.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(p,y){return this.canceledNavigationResolution==="computed"?{navigationId:p,\u0275routerPageId:y}:{navigationId:p}}};s.\u0275fac=(()=>{let p;return function(i){return(p||(p=J1(s)))(i||s)}})(),s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),Kp=function(l){return l[l.COMPLETE=0]="COMPLETE",l[l.FAILED=1]="FAILED",l[l.REDIRECTING=2]="REDIRECTING",l}(Kp||{});function B2(l,s){l.events.pipe(co(m=>m instanceof Ga||m instanceof Xl||m instanceof rm||m instanceof Yl),kn(m=>m instanceof Ga||m instanceof Yl?Kp.COMPLETE:(m instanceof Xl?m.code===Ro.Redirect||m.code===Ro.SupersededByNewNavigation:!1)?Kp.REDIRECTING:Kp.FAILED),co(m=>m!==Kp.REDIRECTING),Oa(1)).subscribe(()=>{s()})}function nj(l){throw l}var rj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ij={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},gu=(()=>{let s=class s{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Tt(Cy),this.stateManager=Tt(z2),this.options=Tt(pm,{optional:!0})||{},this.pendingTasks=Tt(cu),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Tt(Aw),this.urlSerializer=Tt(um),this.location=Tt(ed),this.urlHandlingStrategy=Tt(Sw),this._events=new Hi,this.errorHandler=this.options.errorHandler||nj,this.navigated=!1,this.routeReuseStrategy=Tt(Q5),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Tt(l0,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Tt(u0,{optional:!0}),this.eventsSubscription=new ai,this.isNgZoneEnabled=Tt(br)instanceof br&&br.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:p=>{this.console.warn(p)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let p=this.navigationTransitions.events.subscribe(y=>{try{let i=this.navigationTransitions.currentTransition,C=this.navigationTransitions.currentNavigation;if(i!==null&&C!==null){if(this.stateManager.handleRouterEvent(y,C),y instanceof Xl&&y.code!==Ro.Redirect&&y.code!==Ro.SupersededByNewNavigation)this.navigated=!0;else if(y instanceof Ga)this.navigated=!0;else if(y instanceof om){let O=this.urlHandlingStrategy.merge(y.url,i.currentRawUrl),j={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||J5(i.source)};this.scheduleNavigation(O,Qp,null,j,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}sj(y)&&this._events.next(y)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(p)}resetRootComponentType(p){this.routerState.root.component=p,this.navigationTransitions.rootComponentType=p}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Qp,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((p,y)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(p,"popstate",y)},0)})}navigateToSyncWithBrowser(p,y,i){let C={replaceUrl:!0},O=i?.navigationId?i:null;if(i){let Z=Pt({},i);delete Z.navigationId,delete Z.\u0275routerPageId,Object.keys(Z).length!==0&&(C.state=Z)}let j=this.parseUrl(p);this.scheduleNavigation(j,y,O,C)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(p){this.config=p.map(Dw),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(p,y={}){let{relativeTo:i,queryParams:C,fragment:O,queryParamsHandling:j,preserveFragment:Z}=y,se=Z?this.currentUrlTree.fragment:O,ve=null;switch(j){case"merge":ve=Pt(Pt({},this.currentUrlTree.queryParams),C);break;case"preserve":ve=this.currentUrlTree.queryParams;break;default:ve=C||null}ve!==null&&(ve=this.removeEmptyProps(ve));let ze;try{let at=i?i.snapshot:this.routerState.snapshot.root;ze=v2(at)}catch{(typeof p[0]!="string"||!p[0].startsWith("/"))&&(p=[]),ze=this.currentUrlTree.root}return x2(ze,p,ve,se??null)}navigateByUrl(p,y={skipLocationChange:!1}){let i=ad(p)?p:this.parseUrl(p),C=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(C,Qp,null,y)}navigate(p,y={skipLocationChange:!1}){return oj(p),this.navigateByUrl(this.createUrlTree(p,y),y)}serializeUrl(p){return this.urlSerializer.serialize(p)}parseUrl(p){try{return this.urlSerializer.parse(p)}catch{return this.urlSerializer.parse("/")}}isActive(p,y){let i;if(y===!0?i=Pt({},rj):y===!1?i=Pt({},ij):i=y,ad(p))return t2(this.currentUrlTree,p,i);let C=this.parseUrl(p);return t2(this.currentUrlTree,C,i)}removeEmptyProps(p){return Object.entries(p).reduce((y,[i,C])=>(C!=null&&(y[i]=C),y),{})}scheduleNavigation(p,y,i,C,O){if(this.disposed)return Promise.resolve(!1);let j,Z,se;O?(j=O.resolve,Z=O.reject,se=O.promise):se=new Promise((ze,at)=>{j=ze,Z=at});let ve=this.pendingTasks.add();return B2(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(ve))}),this.navigationTransitions.handleNavigationRequest({source:y,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:p,extras:C,resolve:j,reject:Z,promise:se,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),se.catch(ze=>Promise.reject(ze))}};s.\u0275fac=function(y){return new(y||s)},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();function oj(l){for(let s=0;s<l.length;s++)if(l[s]==null)throw new rn(4008,!1)}function sj(l){return!(l instanceof im)&&!(l instanceof om)}var c0=class{};var aj=(()=>{let s=class s{constructor(p,y,i,C,O){this.router=p,this.injector=i,this.preloadingStrategy=C,this.loader=O}setUpPreloading(){this.subscription=this.router.events.pipe(co(p=>p instanceof Ga),La(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(p,y){let i=[];for(let C of y){C.providers&&!C._injector&&(C._injector=Ey(C.providers,p,`Route: ${C.path}`));let O=C._injector??p,j=C._loadedInjector??O;(C.loadChildren&&!C._loadedRoutes&&C.canLoad===void 0||C.loadComponent&&!C._loadedComponent)&&i.push(this.preloadConfig(O,C)),(C.children||C._loadedRoutes)&&i.push(this.processRoutes(j,C.children??C._loadedRoutes))}return kr(i).pipe(Ah())}preloadConfig(p,y){return this.preloadingStrategy.preload(y,()=>{let i;y.loadChildren&&y.canLoad===void 0?i=this.loader.loadChildren(p,y):i=pn(null);let C=i.pipe(ri(O=>O===null?pn(void 0):(y._loadedRoutes=O.routes,y._loadedInjector=O.injector,this.processRoutes(O.injector??p,O.routes))));if(y.loadComponent&&!y._loadedComponent){let O=this.loader.loadComponent(y);return kr([C,O]).pipe(Ah())}else return C})}};s.\u0275fac=function(y){return new(y||s)(Nt(gu),Nt(Ly),Nt(Wi),Nt(c0),Nt(Cw))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})(),j2=new sn(""),lj=(()=>{let s=class s{constructor(p,y,i,C,O={}){this.urlSerializer=p,this.transitions=y,this.viewportScroller=i,this.zone=C,this.options=O,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},O.scrollPositionRestoration||="disabled",O.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(p=>{p instanceof ld?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=p.navigationTrigger,this.restoredId=p.restoredState?p.restoredState.navigationId:0):p instanceof Ga?(this.lastId=p.id,this.scheduleScrollEvent(p,this.urlSerializer.parse(p.urlAfterRedirects).fragment)):p instanceof Yl&&p.code===e0.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(p,this.urlSerializer.parse(p.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(p=>{p instanceof n0&&(p.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(p.position):p.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(p.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(p,y){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new n0(p,this.lastSource==="popstate"?this.store[this.restoredId]:null,y))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};s.\u0275fac=function(y){RS()},s.\u0275prov=Ft({token:s,factory:s.\u0275fac});let l=s;return l})();function cj(l){return l.routerState.root}function mm(l,s){return{\u0275kind:l,\u0275providers:s}}function uj(){let l=Tt(ta);return s=>{let m=l.get(uu);if(s!==m.components[0])return;let p=l.get(gu),y=l.get(V2);l.get(Pw)===1&&p.initialNavigation(),l.get(U2,null,Bn.Optional)?.setUpPreloading(),l.get(j2,null,Bn.Optional)?.init(),p.resetRootComponentType(m.componentTypes[0]),y.closed||(y.next(),y.complete(),y.unsubscribe())}}var V2=new sn("",{factory:()=>new Hi}),Pw=new sn("",{providedIn:"root",factory:()=>1});function hj(){return mm(2,[{provide:Pw,useValue:0},{provide:Py,multi:!0,deps:[ta],useFactory:s=>{let m=s.get(DA,Promise.resolve());return()=>m.then(()=>new Promise(p=>{let y=s.get(gu),i=s.get(V2);B2(y,()=>{p(!0)}),s.get(Aw).afterPreactivation=()=>(p(!0),i.closed?pn(void 0):i),y.initialNavigation()}))}}])}function dj(){return mm(3,[{provide:Py,multi:!0,useFactory:()=>{let s=Tt(gu);return()=>{s.setUpLocationChangeListener()}}},{provide:Pw,useValue:2}])}var U2=new sn("");function fj(l){return mm(0,[{provide:U2,useExisting:aj},{provide:c0,useExisting:l}])}function pj(){return mm(8,[o2,{provide:u0,useExisting:o2}])}function mj(l){let s=[{provide:k2,useValue:Y5},{provide:F2,useValue:Pt({skipNextTransition:!!l?.skipInitialTransition},l)}];return mm(9,s)}var a2=new sn("ROUTER_FORROOT_GUARD"),gj=[ed,{provide:um,useClass:tm},gu,hm,{provide:cd,useFactory:cj,deps:[gu]},Cw,[]],Rw=(()=>{let s=class s{constructor(p){}static forRoot(p,y){return{ngModule:s,providers:[gj,[],{provide:l0,multi:!0,useValue:p},{provide:a2,useFactory:xj,deps:[[gu,new cy,new N1]]},{provide:pm,useValue:y||{}},y?.useHash?yj():vj(),_j(),y?.preloadingStrategy?fj(y.preloadingStrategy).\u0275providers:[],y?.initialNavigation?bj(y):[],y?.bindToComponentInputs?pj().\u0275providers:[],y?.enableViewTransitions?mj().\u0275providers:[],wj()]}}static forChild(p){return{ngModule:s,providers:[{provide:l0,multi:!0,useValue:p}]}}};s.\u0275fac=function(y){return new(y||s)(Nt(a2,8))},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({});let l=s;return l})();function _j(){return{provide:j2,useFactory:()=>{let l=Tt(PA),s=Tt(br),m=Tt(pm),p=Tt(Aw),y=Tt(um);return m.scrollOffset&&l.setOffset(m.scrollOffset),new lj(y,p,l,s,m)}}}function yj(){return{provide:du,useClass:CA}}function vj(){return{provide:du,useClass:Rb}}function xj(l){return"guarded"}function bj(l){return[l.initialNavigation==="disabled"?dj().\u0275providers:[],l.initialNavigation==="enabledBlocking"?hj().\u0275providers:[]]}var l2=new sn("");function wj(){return[{provide:l2,useFactory:uj},{provide:Ry,multi:!0,useExisting:l2}]}var Tj=[],$2=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({imports:[Rw.forRoot(Tj),Rw]});let l=s;return l})();var _u=cx(d0());var f0={production:!1,apiKey:"pk.eyJ1IjoibWFncTIwMDIiLCJhIjoiY2x1d3Mwam5vMGZkejJpbWtrMWRzOTlwcSJ9.sLYdPBwyka2FUiK1n2zYWA"};var H2=(()=>{let s=class s extends Hp{constructor(p){super(p),this.baseUrl="https://api.mapbox.com/directions/v5/mapbox/driving"}get(p){return p=this.baseUrl+p,super.get(p,{params:{alternatives:!1,geometries:"geojson",language:"es",overview:"full",steps:"false",access_token:f0.apiKey}})}};s.\u0275fac=function(y){return new(y||s)(Nt($a))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();var Ha=(()=>{let s=class s{get isMapReady(){return!!this.map}constructor(p){this.directionsApi=p,this.markers=[]}setMap(p){this.map=p}flyTo(p){if(!this.isMapReady)throw Error("El mapa no esta inicializado");this.map?.flyTo({zoom:14,center:p})}createMarkersFromPlaces(p,y){if(!this.map)throw Error("Mapa no inicializado");this.markers.forEach(O=>O.remove());let i=[];for(let O of p){let[j,Z]=O.center,se=new _u.Popup().setHTML(`
          <h6>${O.text}</h6>
          <span>${O.place_name}</span>
        `),ve=new _u.Marker().setLngLat([j,Z]).setPopup(se).addTo(this.map);i.push(ve)}if(this.markers=i,p.length===0)return;let C=new _u.LngLatBounds;i.forEach(O=>C.extend(O.getLngLat())),C.extend(y),this.map.fitBounds(C,{padding:200})}getRouteBetweenPoints(p,y){this.directionsApi.get(`/${p.join(",")};${y.join(",")}`).subscribe(i=>this.drawPolyline(i.routes[0]))}drawPolyline(p){if(!this.map)throw Error("Mapa no inicializado");let y=p.geometry.coordinates,i=new _u.LngLatBounds;y.forEach(([O,j])=>{i.extend([O,j])}),this.map?.fitBounds(i,{padding:200});let C={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:y}}]}};this.map.getLayer("RouteString")&&(this.map.removeLayer("RouteString"),this.map.removeSource("RouteString")),this.map.addSource("RouteString",C),this.map.addLayer({id:"RouteString",type:"line",source:"RouteString",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":3}})}};s.\u0275fac=function(y){return new(y||s)(Nt(H2))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();var q2=(()=>{let s=class s extends Hp{constructor(p){super(p),this.baseUrl="https://api.mapbox.com/geocoding/v5/mapbox.places"}get(p,y){return p=this.baseUrl+p,super.get(p,{params:Pt({limit:5,Language:"es",access_token:f0.apiKey},y.params)})}};s.\u0275fac=function(y){return new(y||s)(Nt($a))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();var vs=(()=>{let s=class s{get isUserLocationReady(){return!!this.useLocation}constructor(p,y){this.placesApi=p,this.mapService=y,this.isLoadingPlaces=!1,this.places=[],this.getUserLocation()}getUserLocation(){return u_(this,null,function*(){return new Promise((p,y)=>{navigator.geolocation.getCurrentPosition(({coords:i})=>{this.useLocation=[i.longitude,i.latitude],p(this.useLocation)},i=>{alert("No se pudo obtener la geolocalizaci\xF3n"),console.log(i),y()})})})}getPlacesByQuery(p=""){if(p.length===0){this.places=[],this.isLoadingPlaces=!1;return}if(!this.useLocation)throw Error("No hay userLocation");this.isLoadingPlaces=!0,this.placesApi.get(`/${p}.json`,{params:{proximity:this.useLocation.join(",")}}).subscribe(y=>{this.isLoadingPlaces=!1,this.places=y.features,this.mapService.createMarkersFromPlaces(this.places,this.useLocation)})}deletePlaces(){this.places=[]}};s.\u0275fac=function(y){return new(y||s)(Nt(q2),Nt(Ha))},s.\u0275prov=Ft({token:s,factory:s.\u0275fac,providedIn:"root"});let l=s;return l})();var dd=cx(d0());var Mj=["mapDiv"],W2=(()=>{let s=class s{constructor(p,y){this.placesService=p,this.mapService=y}ngAfterViewInit(){if(!this.placesService.useLocation)throw Error("No hay placesService.userLocation");let p=new dd.default.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:this.placesService.useLocation,zoom:14}),y=new dd.Popup().setHTML(`
      <h6>Aqui estoy</h6>
      <span>Estoy en este lugar del mundo</span>
    `);new dd.Marker({color:"red"}).setLngLat(this.placesService.useLocation).setPopup(y).addTo(p),this.mapService.setMap(p)}};s.\u0275fac=function(y){return new(y||s)(zr(vs),zr(Ha))},s.\u0275cmp=mi({type:s,selectors:[["app-map-view"]],viewQuery:function(y,i){if(y&1&&iA(Mj,5),y&2){let C;yb(C=vb())&&(i.mapDivElement=C.first)}},decls:2,vars:0,consts:[["mapDiv",""],[1,"map-container"]],template:function(y,i){y&1&&Yi(0,"div",1,0)},styles:[".map-container[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:100vw;height:100vh}"]});let l=s;return l})();var Z2=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275cmp=mi({type:s,selectors:[["app-loading"]],decls:6,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center"],[1,"text-center"]],template:function(y,i){y&1&&(Ii(0,"div",0)(1,"div",1)(2,"h3"),ys(3,"Espere por favor"),Di(),Ii(4,"span"),ys(5,"Localizando..."),Di()()())},styles:["loading-map[_ngcontent-%COMP%]{background-color:#000c;color:#fff;height:100vh;position:fixed;right:0;top:0;width:100vw}"]});let l=s;return l})();var X2=(()=>{let s=class s{constructor(p,y){this.placesService=p,this.mapService=y}goToMyLocation(){if(!this.placesService.isUserLocationReady)throw Error("No hay ubicaci\xF3n del usuario");if(!this.mapService.isMapReady)throw Error("No hay mapa inicializado");this.mapService.flyTo(this.placesService.useLocation)}};s.\u0275fac=function(y){return new(y||s)(zr(vs),zr(Ha))},s.\u0275cmp=mi({type:s,selectors:[["app-btn-my-location"]],decls:2,vars:0,consts:[[1,"btn","btn-primary",3,"click"]],template:function(y,i){y&1&&(Ii(0,"button",0),Va("click",function(){return i.goToMyLocation()}),ys(1,` Mi ubicaci\xF3n
`),Di())},styles:["button[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px}"]});let l=s;return l})();var Y2=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275cmp=mi({type:s,selectors:[["app-angular-logo"]],decls:1,vars:0,consts:[["width","100","alt","Angular Logo","src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg=="]],template:function(y,i){y&1&&Yi(0,"img",0)},styles:["img[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px}"]});let l=s;return l})();function Rj(l,s){l&1&&(Ii(0,"div",2)(1,"h6"),ys(2,"Cargando"),Di(),Ii(3,"span"),ys(4,"Espere por favor..."),Di()())}function Lj(l,s){if(l&1){let m=Iy();Ii(0,"li",5),Va("click",function(){let y=kp(m).$implicit,i=Bp(2);return Fp(i.flyTo(y))}),Ii(1,"h6"),ys(2),Di(),Ii(3,"p"),ys(4),Di(),Ii(5,"button",6),Va("click",function(){let y=kp(m).$implicit,i=Bp(2);return Fp(i.getDirections(y))}),ys(6," Direcciones "),Di()()}if(l&2){let m=s.$implicit,p=Bp(2);_b("active",m.id===p.selectedId),Kh(2),My(m.text_es),Kh(2),My(m.place_name),Kh(),ql("ngClass",m.id===p.selectedId?"btn-outline-light":"btn-outline-secondary")}}function Oj(l,s){if(l&1&&(Ii(0,"ul",3),Jh(1,Lj,7,5,"li",4),Di()),l&2){let m=Bp();Kh(),ql("ngForOf",m.places)}}var K2=(()=>{let s=class s{constructor(p,y){this.placesService=p,this.mapService=y,this.selectedId=""}get isLoadingPlaces(){return this.placesService.isLoadingPlaces}get places(){return this.placesService.places}flyTo(p){this.selectedId=p.id;let[y,i]=p.center;this.mapService.flyTo([y,i])}getDirections(p){if(!this.placesService.useLocation)throw Error("No hay userLocation");this.placesService.deletePlaces();let y=this.placesService.useLocation,i=p.center;this.mapService.getRouteBetweenPoints(y,i)}};s.\u0275fac=function(y){return new(y||s)(zr(vs),zr(Ha))},s.\u0275cmp=mi({type:s,selectors:[["app-search-results"]],decls:2,vars:2,consts:[["class","alert alert-primary mt-2 text-center",4,"ngIf"],["class","list-group mt-2",4,"ngIf"],[1,"alert","alert-primary","mt-2","text-center"],[1,"list-group","mt-2"],["class","list-group-item list-group-item-action pointer",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","pointer",3,"click"],[1,"btn","btn-sm",3,"click","ngClass"]],template:function(y,i){y&1&&Jh(0,Rj,5,0,"div",0)(1,Oj,2,1,"ul",1),y&2&&(ql("ngIf",i.isLoadingPlaces),Kh(),ql("ngIf",i.places.length>0))},dependencies:[SA,AA,ky],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}"]});let l=s;return l})();var J2=(()=>{let s=class s{constructor(p){this.placesService=p}onQueryChanged(p=""){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.placesService.getPlacesByQuery(p)},350)}};s.\u0275fac=function(y){return new(y||s)(zr(vs))},s.\u0275cmp=mi({type:s,selectors:[["app-search-bar"]],decls:4,vars:0,consts:[["txtQuery",""],[1,"search-container"],["type","text","placeholder","Buscar lugar...",1,"form-control",3,"keyup"]],template:function(y,i){if(y&1){let C=Iy();Ii(0,"div",1)(1,"input",2,0),Va("keyup",function(){kp(C);let j=Dy(2);return Fp(i.onQueryChanged(j.value))}),Di(),Yi(3,"app-search-results"),Di()}},dependencies:[K2],styles:[".search-container[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;width:270px;background-color:#fff;padding:5px;box-shadow:0 10px 10px #0000001a;border-radius:5px;border:1px solid rgba(0,0,0,.1)}"]});let l=s;return l})();function Fj(l,s){l&1&&Yi(0,"app-loading")}function zj(l,s){l&1&&Yi(0,"app-map-view")(1,"app-btn-my-location")(2,"app-search-bar")}var Q2=(()=>{let s=class s{constructor(p){this.placesService=p}get isUserLocationReady(){return this.placesService.isUserLocationReady}};s.\u0275fac=function(y){return new(y||s)(zr(vs))},s.\u0275cmp=mi({type:s,selectors:[["app-map-screen"]],decls:4,vars:2,consts:[["mapReady",""],[4,"ngIf","ngIfElse"]],template:function(y,i){if(y&1&&(Jh(0,Fj,1,0,"app-loading",1)(1,zj,3,0,"ng-template",null,0,aA),Yi(3,"app-angular-logo")),y&2){let C=Dy(2);ql("ngIf",!i.isUserLocationReady)("ngIfElse",C)}},dependencies:[ky,W2,Z2,X2,Y2,J2]});let l=s;return l})();var eP=(()=>{let s=class s{constructor(){this.title="mapas-app"}};s.\u0275fac=function(y){return new(y||s)},s.\u0275cmp=mi({type:s,selectors:[["app-root"]],decls:1,vars:0,template:function(y,i){y&1&&Yi(0,"app-map-screen")},dependencies:[Q2]});let l=s;return l})();var tP=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275mod=Xi({type:s}),s.\u0275inj=Zi({imports:[Fy]});let l=s;return l})();var nP=(()=>{let s=class s{};s.\u0275fac=function(y){return new(y||s)},s.\u0275mod=Xi({type:s,bootstrap:[eP]}),s.\u0275inj=Zi({imports:[JA,$2,tP,UA]});let l=s;return l})();var rP=cx(d0());rP.default.accessToken="pk.eyJ1IjoibWFncTIwMDIiLCJhIjoiY2x1d3Mwam5vMGZkejJpbWtrMWRzOTlwcSJ9.sLYdPBwyka2FUiK1n2zYWA";if(!navigator.geolocation)throw alert("Navegador no soporta la Geolocation"),new Error("Navegador no soporta la Geolocation");KA().bootstrapModule(nP).catch(l=>console.error(l));
